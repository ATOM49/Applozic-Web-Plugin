var MCK_GROUP_MAP=[],MCK_CLIENT_GROUP_MAP=[];
(function(b,l,u){function jb(c){var h=this,Ha,n;MCK_GROUP_MAP=[];var P=[],ea,za,kb=!0,pa=[],ia=0;MCK_CLIENT_GROUP_MAP=[];var Aa=!1,ja=[],Ba=[],ta=90,H=[],N=[],T=[],Q=[],lb=!0,F=0,mb=c.mode;MCK_LABELS=c.labels;MCK_BASE_URL=c.baseUrl;var U=c.appId,nb=[],ob=[0,1,2,3],pb=[1,2,5,6,7,9,10],qa=[],Ya=!1,Va=c.launcher,cb=c.visitor,Ib=c.userName,qb=c.locShare,La=c.video,Ca=c.fileBaseUrl,Jb=c.awsS3Server?c.awsS3Server:!1,J=c.onInit,rb=c.onTopicDetails,jb=[0,1,2],sb=c.onClose,tb=c.displayText,ca=c.accessToken,
Sa=c.readConversation,W=c.maxGroupSize,ub=c.onTabClicked,Kb=c.contactNumber,ka=c.maxAttachmentSize,vb=c.appModuleName,Da=c.getTopicDetail,Ta=c.contactDisplayName,wb=c.validateMessage,ua=c.finalPriceResponse,Ma=c.contactDisplayImage,xb=c.priceWidget,fa=c.openGroupSettings,ra=c.offlineMessageDetail,db=c.authenticationTypeId,yb=c.getConversationDetail,dc=c.notificationIconLink,Lb=c.mapStaticAPIkey,Mb=c.notificationSoundLink?c.notificationSoundLink:"",x=cb?"guest":b.trim(c.userId),ec="undefined"===typeof c.source?
1:c.source,Ia="boolean"===typeof c.topicBox?c.topicBox:!1,eb="boolean"===typeof c.olStatus?c.olStatus:!1,Nb="boolean"===typeof c.messageBubbleAvator?c.messageBubbleAvator:!1,Za="boolean"===typeof c.showOfflineMessage?c.showOfflineMessage:!1,Ob="boolean"===typeof c.hideGroupSubtitle?c.hideGroupSubtitle:!1,Pb="undefined"===typeof c.defaultMessageMetaData?{}:c.defaultMessageMetaData,zb="boolean"===typeof c.groupUserCount?c.groupUserCount:!1,Qb="boolean"===typeof c.checkUserBusyWithStatus?c.checkUserBusyWithStatus:
!1,Rb="boolean"===typeof c.resetUserStatus?c.resetUserStatus:!1,va="boolean"===typeof c.topicHeader?c.topicHeader:!1,Sb=c.supportId?'data-mck-id\x3d"'+c.supportId+'"':"",Ab="boolean"===typeof c.loadOwnContacts?c.loadOwnContacts:!1,Tb="boolean"===typeof c.desktopNotification?c.desktopNotification:!1,Ub="boolean"===typeof c.notification?c.notification:!0,Vb="boolean"===typeof c.swNotification?c.swNotification:!1,Wb="boolean"===typeof c.autoTypeSearchEnabled?c.autoTypeSearchEnabled:!0,fb="boolean"===
typeof c.launchOnNewMessage?c.launchOnNewMessage:!1,Bb="boolean"===typeof c.launchOnUnreadMessage?c.launchOnUnreadMessage:!1,Xb="number"===typeof c.userTypeId?c.userTypeId:!1,K=["DEFAULT","NEW","OPEN"],Yb=["BLOCKED_TO","BLOCKED_BY","UNBLOCKED_TO","UNBLOCKED_BY"],A=new function(){var a=this,e=[],c=[],B=[],d=[];a.updateLatestMessage=function(b){var e=[];e.push(b);a.updateLatestMessageArray(e);a.updateMckMessageArray(e)};a.getLatestMessageArray=function(){return"undefined"!==typeof l.sessionStorage?
b.parseJSON(l.sessionStorage.getItem("mckLatestMessageArray")):e};a.setLatestMessageArray=function(a){"undefined"!==typeof l.sessionStorage?l.sessionStorage.setItem("mckLatestMessageArray",l.JSON.stringify(a)):e=a};a.updateLatestMessageArray=function(a){if("undefined"!==typeof l.sessionStorage){var d=b.parseJSON(l.sessionStorage.getItem("mckLatestMessageArray"));null!==d?(d=d.concat(a),l.sessionStorage.setItem("mckLatestMessageArray",l.JSON.stringify(d))):l.sessionStorage.setItem("mckLatestMessageArray",
l.JSON.stringify(a));return a}return e=e.concat(a)};a.getMckMessageArray=function(){return"undefined"!==typeof l.sessionStorage?b.parseJSON(l.sessionStorage.getItem("mckMessageArray")):c};a.clearMckMessageArray=function(){"undefined"!==typeof l.sessionStorage?(l.sessionStorage.removeItem("mckMessageArray"),l.sessionStorage.removeItem("mckLatestMessageArray")):(c.length=0,e.length=0)};a.clearAppHeaders=function(){"undefined"!==typeof l.sessionStorage&&l.sessionStorage.removeItem("mckAppHeaders")};
a.setAppHeaders=function(a){"undefined"!==typeof l.sessionStorage&&l.sessionStorage.setItem("mckAppHeaders",l.JSON.stringify(a))};a.getAppHeaders=function(a){return"undefined"!==typeof l.sessionStorage?b.parseJSON(l.sessionStorage.getItem("mckAppHeaders")):{}};a.getMessageByKey=function(a){return B[a]};a.updateMckMessageArray=function(a){for(var e=0;e<a.length;e++){var d=a[e];B[d.key]=d}return"undefined"!==typeof l.sessionStorage?(e=b.parseJSON(l.sessionStorage.getItem("mckMessageArray")),null!==
e?(e=e.concat(a),l.sessionStorage.setItem("mckMessageArray",l.JSON.stringify(e))):l.sessionStorage.setItem("mckMessageArray",l.JSON.stringify(a)),a):c=c.concat(a)};a.getMckContactNameArray=function(){return"undefined"!==typeof l.sessionStorage?b.parseJSON(l.sessionStorage.getItem("mckContactNameArray")):d};a.setMckContactNameArray=function(a){"undefined"!==typeof l.sessionStorage?l.sessionStorage.setItem("mckContactNameArray",l.JSON.stringify(a)):d=a};a.updateMckContactNameArray=function(a){if("undefined"!==
typeof l.sessionStorage){var e=b.parseJSON(l.sessionStorage.getItem("mckContactNameArray"));null!==e&&(a=a.concat(e));l.sessionStorage.setItem("mckContactNameArray",l.JSON.stringify(a));return a}return d=d.concat(a)};a.clearMckContactNameArray=function(){"undefined"!==typeof l.sessionStorage?l.sessionStorage.removeItem("mckContactNameArray"):d.length=0}},Z={},Na=[],Oa=[],Ja={},sa=[],wa=[],Ka=[],Y=[],Wa=new function(){var a=this,g=!1,c,B,d=b("#mck-file-menu"),h=b("#mck-message-cell .mck-message-inner");
b("#mck-tab-individual");var p=ta;a.getLauncherHtml=function(){return'\x3cdiv id\x3d"mck-sidebox-launcher" class\x3d"mck-sidebox-launcher"\x3e\x3ca href\x3d"#" target\x3d"_self" class\x3d"applozic-launcher mck-button-launcher" '+("support"===mb?Sb:"")+'\x3e\x3cspan class\x3d"mck-icon-chat"\x3e\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview" class\x3d"mck-msg-preview applozic-launcher"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-3 mck-preview-icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row mck-truncate mck-preview-content"\x3e\x3cstrong class\x3d"mck-preview-cont-name"\x3e\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row mck-preview-content"\x3e\x3cdiv class\x3d"mck-preview-msg-content"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-preview-file-content mck-msg-text notranslate blk-lg-12 mck-attachment n-vis"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview-btns" class\x3d"n-vis"\x3e\x3cbutton id\x3d"mck-vid-call-accept"\x3eAccept\x3c/button\x3e\x3cbutton id\x3d"mck-vid-call-reject"\x3ereject\x3c/reject\x3e\x3c/div\x3e\x3c/div\x3e'};
a.initializeApp=function(e,d){g=d;var c={applicationId:e.appId,userId:x};null!==Ib&&(c.displayName=e.userName);null!==e.email&&(c.email=e.email);null!==Kb&&(c.contactNumber=e.contactNumber);e.imageLink&&(c.imageLink=e.imageLink);e.appModuleName&&(c.appModuleName=e.appModuleName);ca&&(c.password=e.accessToken);-1===jb.indexOf(db)&&(db=0);Rb&&(c.resetUserStatus=!0);"number"==typeof Xb&&(c.userTypeId=Xb);c.enableEncryption=!0;c.appVersionCode=108;c.authenticationTypeId=db;ea=n="";a.validateAppSession(c)?
La&&da.InitilizeVideoClient(x,ea):b.ajax({url:MCK_BASE_URL+"/v2/tab/initialize.page",type:"post",data:l.JSON.stringify(c),contentType:"application/json",headers:{"Application-Key":U},success:function(b){La&&da.InitilizeVideoClient(b.userId,b.deviceKey);A.clearMckMessageArray();A.clearMckContactNameArray();"INVALID_PASSWORD"===b?"function"===typeof J&&J({status:"error",errorMessage:"INVALID PASSWORD"}):"INVALID_APPID"===b?"function"===typeof J&&J({status:"error",errorMessage:"INVALID APPLICATION ID"}):
"error"===b||"USER_NOT_FOUND"===b?"function"===typeof J&&J({status:"error",errorMessage:"USER NOT FOUND"}):"APPMODULE_NOT_FOUND"===b?"function"===typeof J&&J({status:"error",errorMessage:"APPMODULE NOT FOUND"}):"object"===typeof b&&null!==b&&b.token?(b.appId=c.applicationId,ca&&(b.accessToken=c.password),a.onInitApp(b)):"function"===typeof J&&J({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})},error:function(){A.clearMckMessageArray();"function"===typeof J&&J({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})}})};
a.onInitApp=function(d){a.appendLauncher();a.setLabels();b(".applozic-launcher").each(function(){b(this).hasClass("mck-msg-preview")||b(this).show()});Ha=d.token;mckUtils.setEncryptionKey(d.encryptionKey);x=d.userId;ea=d.deviceKey;za=d.websocketUrl;ta=d.websocketIdleTimeLimit;Ca=d.fileBaseUrl;Ya=d.deactivated;n=btoa(d.userId+":"+d.deviceKey);F=d.totalUnreadCount;cb||"guest"===x||"0"===x||"C0"===x||(g?X.reconnect():X.init());e.createContactWithDetail({userId:x,displayName:d.displayName,photoLink:d.imageLink});
b.ajaxPrefilter(function(b){-1!==b.url.indexOf(MCK_BASE_URL)&&(b.beforeSend=function(b){a.setHeaders(b)})});if(d.betaPackage){var c="https://www.applozic.com/?utm_source\x3d"+l.location.href+"\x26utm_medium\x3dwebplugin\x26utm_campaign\x3dpoweredby";b(".mck-running-on a").attr("href",c);b(".mck-running-on").removeClass("n-vis").addClass("vis")}c=A.getMckContactNameArray();if(null!==c&&0<c.length)for(var y=0;y<c.length;y++){var h=c[y];null!==h&&(sa[h[0]]=h[1])}S.checkUserConnectedStatus();"function"===
typeof J&&J("success",d);Wa.tabFocused();0<Ea.length&&0<F&&Ea.html(F);Bb&&v.loadMessageList({tabId:"",isGroup:!1,isLaunch:!0});$a.subscribeToServiceWorker();A.setAppHeaders(d);mckGroupService.loadGroups({apzCallback:t.loadGroups})};a.validateAppSession=function(b){var e=A.getAppHeaders();if(e&&e.userId){if(b.applicationId===e.appId&&b.userId===e.userId&&b.password===e.accessToken)return a.onInitApp(e),!0;A.clearAppHeaders()}return!1};a.setHeaders=function(a){a.setRequestHeader("UserId-Enabled",!0);
n&&a.setRequestHeader("Authorization","Basic "+n);a.setRequestHeader("Application-Key",U);ea&&a.setRequestHeader("Device-Key",ea);ca&&a.setRequestHeader("Access-Token",ca);vb&&a.setRequestHeader("App-Module-Name",vb)};a.setLabels=function(){b("#mck-conversation-title").html(MCK_LABELS["conversations.title"]).attr("title",MCK_LABELS["conversations.title"]);b("#mck-msg-new, #mck-sidebox-search .mck-box-title").html(MCK_LABELS["start.new"]).attr("title",MCK_LABELS["start.new"]);b("#mck-contact-search-tab strong").html(MCK_LABELS["search.contacts"]).attr("title",
MCK_LABELS["search.contacts"]);b("#mck-group-search-tab strong").html(MCK_LABELS["search.groups"]).attr("title",MCK_LABELS["search.groups"]);b("#mck-contact-search-input, #mck-group-search-input, #mck-group-member-search").attr("placeholder",MCK_LABELS["search.placeholder"]);b("#mck-loc-address").attr("placeholder",MCK_LABELS["location.placeholder"]);b("#mck-no-conversations").html(MCK_LABELS["empty.conversations"]);b("#mck-no-messages").html(MCK_LABELS["empty.messages"]);b("#mck-no-more-conversations").html(MCK_LABELS["no.more.conversations"]);
b("#mck-no-more-messages").html(MCK_LABELS["no.more.messages"]);b("#mck-no-search-contacts").html(MCK_LABELS["empty.contacts"]);b("#mck-no-search-groups").html(MCK_LABELS["empty.groups"]);b("#mck-new-group, #mck-group-create-tab .mck-box-title, #mck-btn-group-create").html(MCK_LABELS["create.group.title"]).attr("title",MCK_LABELS["create.group.title"]);b("#mck-gc-overlay-label").html(MCK_LABELS["add.group.icon"]);b("#mck-msg-error").html(MCK_LABELS["group.deleted"]);b("#mck-gc-title-label").html(MCK_LABELS["group.title"]);
b("#mck-gc-type-label").html(MCK_LABELS["group.type"]);b("#mck-group-info-btn, #mck-group-info-tab .mck-box-title").html(MCK_LABELS["group.info.title"]).attr("title",MCK_LABELS["group.info.title"]);b("#mck-gi-overlay-label").html(MCK_LABELS["change.group.icon"]);b("#mck-group-member-title").html(MCK_LABELS["members.title"]).attr("title",MCK_LABELS["members.title"]);b("#mck-group-add-member .blk-lg-9, #mck-gm-search-box .mck-box-title").html(MCK_LABELS["add.members.title"]).attr("title",MCK_LABELS["add.members.title"]);
b("#mck-btn-group-update").html(MCK_LABELS["group.info.update"]).attr("title",MCK_LABELS["group.info.update"]);b("#mck-btn-leave-group, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]);b("#mck-typing-label").html(MCK_LABELS.typing);b("#mck-btn-clear-messages").html(MCK_LABELS["clear.messages"]).attr("title",MCK_LABELS["clear.messages"]);b("#mck-block-button").html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]);b("#mck-loc-box .mck-box-title, #mck-share-loc-label").html(MCK_LABELS["location.share.title"]).attr("title",
MCK_LABELS["location.share.title"]);b("#mck-btn-loc").attr("title",MCK_LABELS["location.share.title"]);b("#mck-file-up-label").html(MCK_LABELS["file.attachment"]);b("#mck-file-up").attr("title",MCK_LABELS["file.attachment"]);b(".mck-file-attach-label").attr("title",MCK_LABELS["file.attach.title"]);b("#mck-my-loc").html(MCK_LABELS["my.location"]).attr("title",MCK_LABELS["my.location"]);b("#mck-btn-close-loc-box").html(MCK_LABELS.close).attr("title",MCK_LABELS.close);b("#mck-loc-submit").html(MCK_LABELS.send).attr("title",
MCK_LABELS.send);b("#mck-msg-sbmt").attr("title",MCK_LABELS["send.message"]);b("#mck-btn-smiley").attr("title",MCK_LABELS.smiley);b("#mck-group-name-save").attr("title",MCK_LABELS.save);b("#mck-btn-group-icon-save").attr("title",MCK_LABELS.save);b("#mck-group-name-edit").attr("title",MCK_LABELS.edit)};b(u).on("click",".fancybox",function(a){a=b(this);if(-1!==a.data("type").indexOf("video")){var e=a.find(".mck-video-box").html(),d;a.fancybox({content:e,title:a.data("name"),padding:0,openEffect:"none",
closeEffect:"none",helpers:{overlay:{locked:!1,css:{background:"rgba(0, 0, 0, 0.8)"}}},beforeShow:function(){d=b(".fancybox-inner").find("video").get(0);d.load();d.play()}})}else a=a.data("url"),b(this).fancybox({openEffect:"none",closeEffect:"none",padding:0,href:a,type:"image"})});b(l).on("resize",function(){"block"===d.css("display")&&Cb.fileMenuReposition();if(0===h.find(".mck-contact-list").length){var a=h.get(0).scrollHeight;h.height()<a&&h.animate({scrollTop:h.prop("scrollHeight")},0)}});a.appendLauncher=
function(){b("#mck-sidebox-launcher").remove();b("body").append(a.getLauncherHtml());$a.init()};a.tabFocused=function(){function b(d){var c={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1};d=d||l.event;(lb=d.type in c?c[d.type]:this[e]?!1:!0)?(1>p&&kb&&X.checkConnected(!0),a.stopIdleTimeCounter()):(1===ia&&X.sendTypingStatus(0),a.manageIdleTime())}var e="hidden";e in u?u.addEventListener("visibilitychange",b):("mozHidden"===e)in u?u.addEventListener("mozvisibilitychange",b):("webkitHidden"===
e)in u?u.addEventListener("webkitvisibilitychange",b):("msHidden"===e)in u?u.addEventListener("msvisibilitychange",b):"onfocusin"in u?u.onfocusin=u.onfocusout=b:l.onpageshow=l.onpagehide=l.onfocus=l.onblur=b;void 0!==u[e]&&b({type:u[e]?"blur":"focus"})};a.manageIdleTime=function(){p=ta;c&&clearInterval(c);c=setInterval(function(){0>--p&&(p=0,X.stopConnectedCheck(),clearInterval(c),c="")},6E4)};a.stopIdleTimeCounter=function(){p=ta;c&&clearInterval(c);c=""};a.manageOfflineMessageTime=function(a){if("object"!==
typeof ra||isNaN(ra.timeout))l.console.log("Offline message timeout required.");else{if(1===ra.type){if(!ra.userIds||0===ra.userIds.length){l.console.log("Offline message userIds required.");return}if(-1===ra.userIds.indexOf(a))return}B&&clearInterval(B);B=setTimeout(function(){clearInterval(B);B="";e.showOfflineMessage()},5E3*parseInt(ra.timeout))}};a.stopOfflineMessageCounter=function(){B&&clearInterval(B);B=""}},Cb=new function(){var a=this,e="",c="",h=!1,d=b("#mck-my-loc"),D=b("#mck-loc-box"),
p=b("#mck-loc-lat"),C=b("#mck-loc-lon"),L=b("#mck-btn-loc"),y=b("#mck-sidebox-ft"),s=b("#mck-file-menu"),n=b("#mck-btn-attach"),t=b("#mck-map-content"),u=b("#mck-loc-address");a.init=function(){qb&&l.google&&"object"===typeof l.google.maps&&(e=new l.google.maps.Geocoder,n.on("click",function(){a.fileMenuToggle()}),L.on("click",function(){h?D.mckModal():(mckMapUtils.getCurrentLocation(a.onGetCurrLocation,a.onErrorCurrLocation),h=!0)}));d.on("click",function(){mckMapUtils.getCurrentLocation(a.onGetMyCurrLocation,
a.onErrorMyCurrLocation)})};a.fileMenuReposition=function(){var a=y.offset();a.bottom=l.innerHeight-a.top;s.css({bottom:51<a.bottom?a.bottom:51,right:0})};a.fileMenuToggle=function(){n.hasClass("on")?(n.removeClass("on"),s.hide()):(a.fileMenuReposition(),n.addClass("on"),s.show())};a.onGetCurrLocation=function(b){MCK_CURR_LATITIUDE=b.coords.latitude;MCK_CURR_LONGITUDE=b.coords.longitude;a.openMapBox()};a.onErrorCurrLocation=function(){MCK_CURR_LATITIUDE=46.15242437752303;MCK_CURR_LONGITUDE=2.7470703125;
a.openMapBox()};a.onErrorMyCurrLocation=function(a){alert("Unable to retrieve your location. ERROR("+a.code+"): "+a.message)};a.onGetMyCurrLocation=function(a){MCK_CURR_LATITIUDE=a.coords.latitude;MCK_CURR_LONGITUDE=a.coords.longitude;p.val(MCK_CURR_LATITIUDE);C.val(MCK_CURR_LONGITUDE);p.trigger("change");C.trigger("change");c?u.val(c):e&&e.geocode({location:{lat:MCK_CURR_LATITIUDE,lng:MCK_CURR_LONGITUDE}},function(a,b){"OK"===b&&a[1]&&(c=a[1].formatted_address)})};a.openMapBox=function(){t.locationpicker({location:{latitude:MCK_CURR_LATITIUDE,
longitude:MCK_CURR_LONGITUDE},radius:0,scrollwheel:!0,inputBinding:{latitudeInput:p,longitudeInput:C,locationNameInput:u},enableAutocomplete:!0,enableReverseGeocode:!0,onchanged:function(a){MCK_CURR_LATITIUDE=a.latitude;MCK_CURR_LONGITUDE=a.longitude}});D.on("shown.bs.mck-box",function(){t.locationpicker("autosize")});D.mckModal()}},S=new function(){var a=this,e=b("#mck-msg-form"),c=b("#mck-msg-error"),h=b("#mck-tab-title"),d=b("#mck-tab-status"),D=b(".mck-typing-box"),p=b("#mck-block-button"),C=
b("#mck-message-cell .mck-message-inner");a.updateUserStatus=function(a){if("object"===typeof H[a.userId]){var b=H[a.userId];0===a.status?(b.connected=!1,b.lastSeenAtTime=a.lastSeenAtTime):1===a.status&&(b.connected=!0)}else b=[],b.push(a.userId),V.getUsersDetail(b,{})};a.getUserDetail=function(a){if("object"===typeof H[a])return H[a]};a.checkUserConnectedStatus=function(){var e=[],d=[];b(".mck-user-ol-status").each(function(){var a=b(this).data("mck-id");"undefined"!==typeof a&&""!==a&&(e.push(a),
a=mckContactUtils.formatContactId(""+a),b(this).addClass(a),b(this).next().addClass(a))});0<e.length&&(b.each(e,function(a,b){"undefined"===typeof H[b]&&d.push(b)}),0<d.length?V.getUsersDetail(d,{setStatus:!0}):a.updateUserConnectedStatus())};a.updateUserConnectedStatus=function(){b(".mck-user-ol-status").each(function(){var a=b(this),e=a.data("mck-id");if(e){var d=H[e];"undefined"!==typeof H[e]&&d.connected?(a.removeClass("n-vis").addClass("vis"),a.next().html("("+MCK_LABELS.online+")")):(a.removeClass("vis").addClass("n-vis"),
a.next().html("(Offline)"))}})};a.lastSeenOfGroupOfTwo=function(a){l.MCK_OL_MAP[a]?(d.attr("title",MCK_LABELS.online).html(MCK_LABELS.online),d.removeClass("n-vis").addClass("vis")):T[a]&&(a=mckDateUtils.getLastSeenAtStatus(T[a]),d.html(a),d.attr("title",a),h.addClass("mck-tab-title-w-status"),d.removeClass("n-vis").addClass("vis"))};a.toggleBlockUser=function(a,b){if(b)c.html(MCK_LABELS.blocked),c.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),e.removeClass("vis").addClass("n-vis"),h.removeClass("mck-tab-title-w-status"),
d.removeClass("vis").addClass("n-vis"),D.removeClass("vis").addClass("n-vis"),C.data("blocked",!0),p.html(MCK_LABELS["unblock.user"]).attr("title",MCK_LABELS["unblock.user"]);else if(c.html(""),c.removeClass("vis").addClass("n-vis").removeClass("mck-no-mb"),e.removeClass("n-vis").addClass("vis"),C.data("blocked",!1),p.html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),!Ba[a]&&(l.MCK_OL_MAP[a]||T[a])){if(l.MCK_OL_MAP[a])d.attr("title",MCK_LABELS.online).html(MCK_LABELS.online);else if(T[a]){var s=
mckDateUtils.getLastSeenAtStatus(T[a]);d.html(s);d.attr("title",s)}h.addClass("mck-tab-title-w-status");d.removeClass("n-vis").addClass("vis")}}};new function(){var a=b("#mck-msg-to");b("#mck-btn-loc");var e=b("#mck-loc-box"),c=b("#mck-msg-sbmt"),h=b("#mck-msg-error"),d=b("#mck-loc-submit"),D=b("#mck-msg-response"),p=b("#mck_response_text"),C=b("#mck-message-cell .mck-message-inner");d.on("click",function(){var b={type:5,contentType:2,message:l.JSON.stringify(mckMapUtils.getSelectedLocation())},d=
C.data("mck-conversationid"),s=C.data("mck-topicid");d?b.conversationId=d:s&&(d={topicId:s},s=N[s],"object"===typeof s&&(d.topicDetail=l.JSON.stringify(s)),b.conversationPxy=d);!0===C.data("isgroup")?b.groupId=a.val():b.to=a.val();c.attr("disabled",!0);h.removeClass("vis").addClass("n-vis");h.html("");p.html("");D.removeClass("vis").addClass("n-vis");v.sendMessage(b);e.mckModal("hide")})};var t=new function(){var a=this,c={0:"User",1:"Admin",2:"Moderator",3:"Member"},h=b("#mck-msg-form"),B=b("#mck-msg-error"),
d=b("#mck-tab-title"),D=b("#mck-tab-status"),p=b("#mck-no-gsm-text"),C=b("#mck-gms-loading"),L=b("#mck-contact-loading");b("#mck-tab-menu-box");b("#mck-search-loading");var y=b("#mck-group-info-tab"),s=b("#mck-sidebox-search");b("#mck-group-name-box");var n=b("#mck-group-back-link"),xa=b("#mck-group-name-edit"),Pa=b("#mck-group-name-save"),A=b("#mck-sidebox-content"),P=b("#mck-tab-option-panel"),E=b("#mck-btn-group-create"),k=b("#mck-group-create-tab"),M=b("#mck-contacts-content"),I=b("#mck-btn-group-update"),
q=b("#mck-group-create-type"),ga=b("#mck-group-icon-upload"),Db=b("#mck-group-icon-change"),Eb=b("#mck-group-member-list"),Fb=b("#mck-group-update-panel"),H=b(".mck-tab-message-option"),F=b("#mck-group-create-title"),Fa=b(".mck-group-menu-options"),fc=b("#mck-group-member-search"),la=b("#mck-btn-group-icon-save");b("#mck-group-info-icon-box");var ab=b(".mck-group-admin-options"),gb=b("#mck-group-add-member-box"),R=b("#mck-message-cell .mck-message-inner"),ma=b("#mck-group-name-sec .mck-group-title");
b("#mck-group-create-icon-box");var gc=b("#mck-group-info-icon-loading"),hb=b("#mck-gm-search-box");b("#mck-group-member-search-list");var J=b("#mck-group-create-icon-loading"),S=b("#mck-group-info-icon-box .mck-group-icon"),K=b("#mck-group-create-icon-box .mck-group-icon"),na=b("#mck-group-create-icon-box .mck-overlay-box"),U=b("#mck-gc-overlay-label");b.template("groupMemberTemplate",'\x3cli id\x3d"li-gm-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}" data-role\x3d"${roleVal}" data-alpha\x3d"${contFirstAlphaExpr}"\x3e\x3cdiv class\x3d"mck-row mck-group-member-info" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-text move-right vis"\x3e\x3cspan\x3e${roleExpr}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-options move-right ${enableAdminMenuExpr}"\x3e\x3cdiv class\x3d"mck-menu-box n-vis"\x3e\x3cdiv class\x3d"mck-dropdown-toggle mck-group-admin-menu-toggle mck-text-center" data-toggle\x3d"mckdropdown" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"mck-caret"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul id\x3d"mck-group-admin-menu" class\x3d"mck-dropdown-menu mck-group-admin-menu mck-tab-menu-box menu-right" role\x3d"menu"\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-remove-member menu-item" title\x3d"${removeMemberLabel}"\x3e${removeMemberLabel}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-change-role menu-item" title\x3d"${changeRoleLabel}"\x3e${changeRoleLabel}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-group-change-role-box" class\x3d"mck-row mck-group-change-role-box n-vis"\x3e\x3cdiv class\x3d"blk-lg-4"\x3e\x3cdiv class\x3d"mck-label"\x3eSelect role \x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-8 move-right"\x3e\x3cselect id\x3d"mck-change-role-type" class\x3d"mck-select"\x3e\x3coption value\x3d"0"\x3eUser\x3c/option\x3e\x3coption value\x3d"1"\x3eAdmin\x3c/option\x3e\x3coption value\x3d"2"\x3eModerator\x3c/option\x3e\x3coption value\x3d"3" selected\x3eMember\x3c/option\x3e\x3c/select\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');
b.template("groupMemberSearchTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}"\x3e\x3ca class\x3d"mck-add-to-group" href\x3d"#" data-mck-id\x3d"${contIdExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b(".mck-group-name-box div[contenteditable]").keypress(function(e){if(8===e.which||37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode||e.ctrlKey&&97===e.which)return!0;if(13!==e.keyCode||e.shiftKey||e.ctrlKey)return 30>this.innerHTML.length;b(e.target).hasClass("mck-group-create-title")&&a.submitCreateGroup();return!1}).on("paste",function(a){var b=this;setTimeout(function(){30<b.innerText.length&&(b.innerHTML=b.innerText.substring(0,30),mckUtils.setEndOfContenteditable(b));return!1},
"fast")}).on("drop",function(a){a.preventDefault();a.stopPropagation()});b(u).on("click",".mck-btn-change-role",function(a){a.preventDefault();a=b(this).parents(".mck-li-group-member").find(".mck-group-change-role-box");var e=b(this).parents(".mck-li-group-member").data("role");a.find("select").val(e);a.removeClass("n-vis").addClass("vis");Fb.removeClass("n-vis").addClass("vis")});I.on("click",function(){var a=[];b(".mck-group-change-role-box.vis").each(function(e,d){var c=b(this),q=parseInt(c.find("select").val()),
k=c.parents(".mck-li-group-member").data("role");q!==k&&(c={userId:c.parents(".mck-li-group-member").data("mck-id"),role:q},a.push(c))});if(0<a.length){var e=R.data("mck-id"),d=R.data("isgroup");e&&d&&(I.attr("disabled",!0).html(MCK_LABELS["group.info.updating"]),mckGroupService.updateGroupInfo({groupId:e,users:a,apzCallback:t.onUpdateGroupInfo}))}});b("#mck-group-info-icon-box .mck-overlay").on("click",function(a){Db.trigger("click")});b("#mck-group-create-icon-box .mck-overlay").on("click",function(a){ga.trigger("click")});
b(u).on("mouseenter",".mck-group-create-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-create-icon-box.mck-hover-on",function(){var a=b(this);0===a.find(".mck-group-icon-default").length&&a.find(".mck-overlay-box").addClass("n-vis")});b(u).on("mouseenter",".mck-group-info-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-info-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").addClass("n-vis")});
xa.on("click",function(){ma.attr("contenteditable",!0).focus();mckUtils.setEndOfContenteditable(ma[0]);Pa.removeClass("n-vis").addClass("vis");xa.removeClass("vis").addClass("n-vis")});Pa.on("click",function(){var a=b.trim(ma.text());if(0<a.length){var e=R.data("mck-id"),d=R.data("isgroup");e&&d&&(xa.removeClass("n-vis").addClass("vis"),Pa.removeClass("vis").addClass("n-vis"),ma.attr("contenteditable",!1),mckGroupService.updateGroupInfo({groupId:e,name:a,apzCallback:t.onUpdateGroupInfo}))}else ma.addClass("mck-req-border")});
la.on("click",function(){var a=S.data("iconurl");if(a){var b=R.data("mck-id"),e=R.data("isgroup");b&&e&&(setTimeout(function(){la.removeClass("vis").addClass("n-vis")},1E3),S.data("iconurl",""),mckGroupService.updateGroupInfo({groupId:b,imageUrl:a,apzCallback:t.onUpdateGroupInfo}))}else ma.addClass("mck-req-border")});E.on("click",function(){a.submitCreateGroup()});a.submitCreateGroup=function(){var a=b.trim(F.text()),e=q.val(),d=K.data("iconurl");0<a.length?(a={groupName:a},e&&(e=parseInt(e),-1!==
pb.indexOf(e)&&(a.type=e)),d&&(a.groupIcon=d),K.data("iconurl",""),a.isInternal=!0,E.attr("disabled",!0).html(MCK_LABELS["group.create.submit"]),v.getGroup(a)):F.addClass("mck-req-border")};a.loadGroups=function(a){a=a.data;Na.length=0;b.each(a,function(a,b){"undefined"!==typeof b.id&&(b=mckGroupUtils.addGroup(b),Na.push(b))})};a.getDeletedAtTime=function(a){if("object"===typeof MCK_GROUP_MAP[a])return MCK_GROUP_MAP[a].deletedAtTime};a.getGroupDisplayName=function(a){if("object"===typeof MCK_GROUP_MAP[a]){a=
MCK_GROUP_MAP[a];var b=a.displayName;if(7===a.type){var d=e.getContactFromGroupOfTwo(a);"undefined"!==typeof d&&(b=e.getTabDisplayName(d.contactId,!1))}3===a.type&&-1!==b.indexOf(x)&&(b=b.replace(x,"").replace(":",""),"function"===typeof Ta&&(b=(d=Ta(b))?d:b));b||5!==a.type||(b="Broadcast");b||(b=a.contactId);return b}return a};a.getGroupImage=function(a){return a?'\x3cimg src\x3d"'+a+'"/\x3e':'\x3cimg src\x3d"'+MCK_BASE_URL+'/resources/sidebox/css/app/images/mck-icon-group.png"/\x3e'};a.getGroupDefaultIcon=
function(){return'\x3cdiv class\x3d"mck-group-icon-default"\x3e\x3c/div\x3e'};a.addMemberToGroup=function(a,b){"object"===typeof a.members&&(-1===a.members.indexOf(b)&&a.members.push(b),"object"===typeof a.removedMembersId&&-1!==a.removedMembersId.indexOf(b)&&a.removedMembersId.splice(a.removedMembersId.indexOf(b),1),MCK_GROUP_MAP[a.contactId]=a);return a};a.removeMemberFromGroup=function(a,b){"object"!==typeof a.removedMembersId||1>a.removedMembersId.length?(a.removedMembersId=[],a.removedMembersId.push(b)):
-1===a.removedMembersId.indexOf(b)&&a.removedMembersId.push(b);return MCK_GROUP_MAP[a.contactId]=a};a.authenticateGroupUser=function(b){if(!a.isGroupLeft(b)&&0<b.members.length)for(var e=0;e<b.members.length;e++)if(x===""+b.members[e])return!0;return!1};a.isAppendOpenGroupContextMenu=function(b){return 0!==fa.deleteChatAccess&&a.authenticateGroupUser(b)?b.adminName===x||2===fa.deleteChatAccess?!0:!1:!1};a.validateOpenGroupUser=function(b){if(6===b.type){if(!a.authenticateGroupUser(b)){if(fa.disableChatForNonGroupMember){var e=
fa.defaultChatDisabledMessage;e||(e="Chat disabled");B.html(e);B.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");h.removeClass("vis").addClass("n-vis");d.removeClass("mck-tab-title-w-status");D.removeClass("vis").addClass("n-vis")}Fa.removeClass("vis").addClass("n-vis");H.removeClass("vis").addClass("n-vis");P.removeClass("vis").addClass("n-vis");"undefined"===typeof nb[b.contactId]&&X.subscribeToOpenGroup(b)}b.adminName===x?0===fa.deleteChatAccess&&H.removeClass("vis").addClass("n-vis"):
(fa.allowInfoAccessGroupMembers||Fa.removeClass("vis").addClass("n-vis"),2!==fa.deleteChatAccess&&H.removeClass("vis").addClass("n-vis"),fa.allowInfoAccessGroupMembers||2===fa.deleteChatAccess||P.removeClass("vis").addClass("n-vis"));return!1}return!0};a.addGroupStatus=function(b){var c=a.isGroupLeft(b);if(6!==b.type&&(c||Ob)){if(c)t.onGroupLeft("",{groupId:b.contactId});d.removeClass("mck-tab-title-w-status");D.removeClass("vis").addClass("n-vis")}else if(0<b.members.length){for(var c="",q=!1,k=
30>=b.members.length?b.members.length:25,g=0;g<k;g++)if(x===""+b.members[g]||-1!==b.removedMembersId.indexOf(b.members[g]))q=!0;else var l=e.fetchContact(""+b.members[g]),l=e.getTabDisplayName(l.contactId,!1),c=c+(" "+l+",");if(5!==b.type&&6!==b.type||q&&5!==b.type)c+=" You";30<b.members.length&&(c+=" and "+(b.members.length-25)+" more");c=c.replace(/,\s*$/,"");D.html(c);D.attr("title",c);D.removeClass("n-vis").addClass("vis");d.addClass("mck-tab-title-w-status");Fa.removeClass("n-vis").addClass("vis")}else d.removeClass("mck-tab-title-w-status"),
D.removeClass("vis").addClass("n-vis");7===b.type&&(D.html(""),Fa.removeClass("vis").addClass("n-vis"))};a.disableGroupTab=function(){B.html(MCK_LABELS["group.chat.disabled"]);B.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");h.removeClass("vis").addClass("n-vis");d.removeClass("mck-tab-title-w-status");D.removeClass("vis").addClass("n-vis")};a.isGroupLeft=function(a){var e=!1;a.removedMembersId&&0<a.removedMembersId.length&&b.each(a.removedMembersId,function(a,b){b===x&&(e=!0)});return e};
a.onGroupLeft=function(b,e){L.removeClass("vis").addClass("n-vis");if("object"===typeof b&&"error"===b.status)alert("Unable to process your request. "+b.errorMessage);else{var d=e.groupId;if(y.hasClass("vis")){var c=y.data("mck-id");d===c&&n.trigger("click")}else if(A.hasClass("vis")){var c=R.data("mck-id"),q=R.data("isgroup");c===d.toString()&&q&&(Fa.removeClass("vis").addClass("n-vis"),a.disableGroupTab())}}};a.onAddedGroupMember=function(d,c){L.removeClass("vis").addClass("n-vis");if("object"===
typeof d&&"error"===d.status)alert("Unable to process your request. "+d.errorMessage);else{var q=c.groupId,k=c.userId,g="";q?g=mckGroupUtils.getGroup(q):c.clientGroupId&&(g=mckGroupUtils.getGroupByClientGroupId(c.clientGroupId));if("object"===typeof g)if(g=a.addMemberToGroup(g,k),y.hasClass("vis")){var l=y.data("mck-id");q===l&&(q=e.fetchContact(""+k),0===b("#li-gm-"+q.htmlId).length&&a.addGroupMember(g,q),a.sortGroupMemberHtmlList(),a.enableGroupAdminMenuToggle())}else A.hasClass("vis")&&(k=R.data("mck-id"),
l=R.data("isgroup"),k===q.toString()&&l&&a.addGroupStatus(g));else mckGroupService.getGroupFeed({groupId:q,clientGroupId:c.clientGroupId,apzCallback:t.onGroupFeed})}};a.onRemovedGroupMember=function(d,c){L.removeClass("vis").addClass("n-vis");if("object"===typeof d&&"error"===d.status)alert("Unable to process your request. "+d.errorMessage);else{var q=c.groupId,k=c.userId,g="";q?g=mckGroupUtils.getGroup(q):c.clientGroupId&&(g=mckGroupUtils.getGroupByClientGroupId(c.clientGroupId));if("object"===typeof g)if(g=
a.removeMemberFromGroup(g,k),y.hasClass("vis"))g=y.data("mck-id"),q===g&&(q=e.fetchContact(""+k),q=b("#li-gm-"+q.htmlId),0<q.length&&q.remove());else{if(A.hasClass("vis")){var k=R.data("mck-id"),l=R.data("isgroup");k===q.toString()&&l&&a.addGroupStatus(g)}}else mckGroupService.getGroupFeed({groupId:q,clientGroupId:c.clientGroupId,apzCallback:t.onGroupFeed})}};a.onGroupFeed=function(d,c){L.removeClass("vis").addClass("n-vis");if("success"===d.status){var q=d.data,g=q.conversationPxy,k=mckGroupUtils.getGroup(q.id);
q.deletedAtTime&&(B.html(MCK_LABELS["group.deleted"]),B.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),h.removeClass("vis").addClass("n-vis"));var l=[];"object"===typeof g&&(Q[g.id]=g,qa[g.topicId]=[g.id],g.topicDetail&&(N[g.topicId]=b.parseJSON(g.topicDetail)),l.push(g));0<l.length&&(Y[c.groupId]=l);V.loadUserProfiles(q.membersId);c.isMessage&&"object"===typeof c.message&&e.populateMessage(c.messageType,c.message,c.notifyUser);c.isReloadTab&&a.reloadGroupTab(k)}};a.onUpdateGroupInfo=
function(e,c){L.removeClass("vis").addClass("n-vis");I.attr("disabled",!1).html("Update");Fb.removeClass("vis").addClass("n-vis");if("object"===typeof e&&"error"===e.status)alert("Unable to process your request. "+e.errorMessage);else{var q=c.groupId,g=c.groupInfo,k=mckGroupUtils.getGroup(q);if("object"===typeof k){g.imageUrl&&(k.imageUrl=g.imageUrl);g.newName&&(k.displayName=g.newName);g.users&&0<g.users.length&&b.each(g.users,function(a,b){b.userId&&(k.users[b.userId]=b)});if(y.hasClass("vis"))g.imageUrl&&
S.html(a.getGroupImage(k.imageUrl)),ma.html(k.displayName),g.users&&0<g.users.length&&(Eb.html(""),a.addMembersToGroupInfoList(k),k.adminName===x?gb.removeClass("n-vis").addClass("vis"):gb.removeClass("vis").addClass("n-vis"));else if(A.hasClass("vis")){var l=R.data("mck-id"),h=R.data("isgroup");l===q.toString()&&h?d.html(k.displayName):0<b("#li-group-"+k.htmlId).length&&(b("#li-group-"+k.htmlId+" .mck-cont-name strong").html(k.displayName),g.imageUrl&&b("#li-group-"+k.htmlId+" .blk-lg-3").html("\x3cimg src\x3d' "+
k.imageUrl+"'\x3e"))}MCK_GROUP_MAP[k.contactId]=k}}};a.getGroupFeedFromMessage=function(a){var b=a.message;if(b){a.groupId=b.groupId;a.isMessage=!0;if(b.conversationId){var e=Q[b.conversationId];if("object"!==typeof e||"object"!==typeof N[e.topicId])a.conversationId=b.conversationId}a.apzCallback=t.onGroupFeed;mckGroupService.getGroupFeed(a)}};a.reloadGroupTab=function(b){var e=R.data("mck-id"),d=R.data("isgroup");e===b.contactId.toString()&&d&&a.addGroupStatus(b)};a.loadGroupTab=function(a){"error"===
a.status?alert("Unable to process your request. "+a.errorMessage):(e.loadTab({tabId:a.data.contactId,isGroup:!0}),b("#mck-search").val(""))};a.addMembersToGroupInfoList=function(d){var c=d.members;c.sort();Eb.html("");b.each(c,function(c,g){if(g){var q=e.fetchContact(""+g);0===b("#li-gm-"+q.htmlId).length&&a.addGroupMember(d,q)}});a.sortGroupMemberHtmlList();a.enableGroupAdminMenuToggle()};a.enableGroupAdminMenuToggle=function(){b(".mck-group-member-info").bind("mouseenter",function(){b(this).find(".mck-menu-box").removeClass("n-vis")}).bind("mouseleave",
function(){b(this).find(".mck-menu-box").removeClass("open").addClass("n-vis")})};a.addGroupMember=function(a,d){var q="n-vis",k="n-vis",h=a.users[d.contactId],I="Member",ga=3;h&&"undefined"!==typeof h.role&&(ga=h.role,I=c[h.role]);h=e.getTabDisplayName(d.contactId,!1);d.contactId===a.adminName&&(q="vis");a.adminName===x&&(k="vis");d.contactId===x&&(h="You",k="n-vis");var B=e.getContactImageLink(d,h),D="";ja[d.contactId]||(l.MCK_OL_MAP[d.contactId]?D=MCK_LABELS.online:T[d.contactId]&&(D=mckDateUtils.getLastSeenAtStatus(T[d.contactId])));
q=[{roleExpr:I,roleVal:ga,removeMemberLabel:MCK_LABELS["remove.member"],changeRoleLabel:MCK_LABELS["change.role"],contHtmlExpr:d.htmlId,contIdExpr:d.contactId,contImgExpr:B,contLastSeenExpr:D,contNameExpr:h,contFirstAlphaExpr:h.charAt(0).toUpperCase(),isAdminExpr:q,enableAdminMenuExpr:k}];b.tmpl("groupMemberTemplate",q).appendTo("#mck-group-member-list")};a.addMembersToGroupSearchList=function(){var d=R.data("mck-id");if(R.data("isgroup")){var c=mckGroupUtils.getGroup(d),q=Ka,g=[],q=q.filter(function(a,
b){return q.indexOf(a)===b});q.sort();var k=c.members;b.each(q,function(b,d){d&&(d="object"===typeof d&&d.contactId?e.fetchContact(""+d.contactId):e.fetchContact(""+d),-1===k.indexOf(d.contactId)||-1!==k.indexOf(d.contactId)&&-1!==c.removedMembersId.indexOf(d.contactId))&&(a.addGroupSearchMember(d),g.push(d))});a.enableGroupAdminMenuToggle();0<g.length?p.removeClass("vis").addClass("n-vis"):p.removeClass("n-vis").addClass("vis");e.initAutoSuggest({contactsArray:g,$searchId:fc,isContactSearch:!1})}C.removeClass("vis").addClass("n-vis")};
a.addGroupSearchMember=function(a){var d=e.getTabDisplayName(a.contactId,!1),c=e.getContactImageLink(a,d),q="user-"+a.htmlId,g="";ja[a.contactId]||(l.MCK_OL_MAP[a.contactId]?g=MCK_LABELS.online:T[a.contactId]&&(g=mckDateUtils.getLastSeenAtStatus(T[a.contactId])));b.tmpl("groupMemberSearchTemplate",[{contHtmlExpr:q,contIdExpr:a.contactId,contImgExpr:c,contLastSeenExpr:g,contNameExpr:d}]).appendTo("#mck-group-member-search-list")};a.loadCreateGroupTab=function(){M.removeClass("vis").addClass("n-vis");
A.removeClass("vis").addClass("n-vis");s.removeClass("vis").addClass("n-vis");y.removeClass("vis").addClass("n-vis");J.removeClass("vis").addClass("n-vis");K.data("iconurl","");F.html("");na.removeClass("n-vis");U.html(MCK_LABELS["add.group.icon"]);K.html(a.getGroupDefaultIcon());k.removeClass("n-vis").addClass("vis")};a.loadGroupInfo=function(b){if(b.groupId){ma.attr("contenteditable",!1);Pa.removeClass("vis").addClass("n-vis");xa.removeClass("n-vis").addClass("vis");M.removeClass("vis").addClass("n-vis");
A.removeClass("vis").addClass("n-vis");s.removeClass("vis").addClass("n-vis");Fb.removeClass("vis").addClass("n-vis");k.removeClass("vis").addClass("n-vis");la.removeClass("vis").addClass("n-vis");gc.removeClass("vis").addClass("n-vis");y.removeClass("n-vis").addClass("vis");y.data("mck-id",b.groupId);S.data("iconurl","");b.conversationId&&y.data("mck-conversation-id",b.conversationId);Eb.html("");var e=mckGroupUtils.getGroup(b.groupId);"object"===typeof e?(S.html(a.getGroupImage(e.imageUrl)),ma.html(e.displayName),
a.addMembersToGroupInfoList(e),e.adminName===x?gb.removeClass("n-vis").addClass("vis"):gb.removeClass("vis").addClass("n-vis")):mckGroupService.getGroupFeed({groupId:b.groupId,apzCallback:t.onGroupFeed})}};a.sortGroupMemberHtmlList=function(){b("#mck-group-member-list .mck-li-group-member").sort(function(a,b){return a.dataset.alpha>b.dataset.alpha}).appendTo("#mck-group-member-list")};a.addGroupMemberFromSearch=function(a){var b=y.data("mck-id");if("undefined"!==typeof b&&"undefined"!==typeof a){var e=
mckGroupUtils.getGroup(b);"object"===typeof e&&x===e.adminName?(V.loadUserProfile(a),mckGroupService.addGroupMember({groupId:b,userId:a,apzCallback:t.onAddedGroupMember})):ab.removeClass("vis").addClass("n-vis")}hb.mckModal("hide")}},ba=new function(){var a=this,c=["CREATE","UPDATE"],l=b("#mck-file-box"),h=b(".mck-overlay"),d=b("#mck-msg-sbmt"),D=b("#mck-text-box"),p=b("#mck-file-input"),C=b(".mck-overlay-box"),L=b(".mck-file-upload"),y=b("#mck-group-icon-upload"),s=b("#mck-group-icon-change"),t=
b("#mck-group-info-icon-box"),v=b("#mck-btn-group-icon-save"),x=b("#mck-message-cell .mck-message-inner"),A=b("#mck-group-create-icon-box"),N=b("#mck-group-info-icon-loading"),E=b("#mck-group-create-icon-loading"),k=b("#mck-group-info-icon-box .mck-group-icon"),M=b("#mck-group-create-icon-box .mck-group-icon"),I=b("#mck-gc-overlay-label");b.template("fileboxTemplate",'\x3cdiv id\x3d"mck-filebox-${fileIdExpr}" class\x3d"mck-file-box ${fileIdExpr}"\x3e\x3cdiv class\x3d"mck-file-expr"\x3e\x3cspan class\x3d"mck-file-content blk-lg-8"\x3e\x3cspan class\x3d"mck-file-lb"\x3e{{html fileNameExpr}}\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"mck-file-sz"\x3e${fileSizeExpr}\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"progress progress-striped active blk-lg-3" role\x3d"progressbar" aria-valuemin\x3d"0" aria-valuemax\x3d"100" aria-valuenow\x3d"0"\x3e\x3cspan class\x3d"progress-bar progress-bar-success bar" stye\x3e\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"move-right"\x3e\x3cbutton type\x3d"button" class\x3d"mck-box-close mck-remove-file" data-dismiss\x3d"div" aria-hidden\x3d"true"\x3ex\x3c/button\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e');
a.init=function(){L.on("click",function(){p.trigger("click")});y.on("change",function(){var e=b(this)[0].files[0];a.uplaodFileToAWS(e,c[0]);return!1});s.on("change",function(){var e=b(this)[0].files[0];a.uplaodFileToAWS(e,c[1]);return!1});p.on("change",function(){var e=b(this)[0].files[0],d={};d.file=e;d.name=e.name;!0===Jb?a.uploadAttachment2AWS(d):a.uploadFile(d)});b(u).on("click",".mck-remove-file",function(){var e=b(this).parents(".mck-file-box"),c=e.data("mckfile");e.remove();d.attr("disabled",
!1);0===l.find(".mck-file-box").length&&(l.removeClass("vis").addClass("n-vis"),D.attr("required",""));"object"===typeof c&&(a.deleteFileMeta(c.blobKey),b.each(P,function(a,b){"undefined"!==typeof b&&b.blobKey===c.blobKey&&P.splice(a,1)}))})};a.audioRecoder=function(c){var g=c.file,k=new FormData,h=[];if("undefined"!==typeof g)if(4<b(".mck-file-box").length&&h.push("Can't upload more than 5 files at a time"),g.size>1048576*ka&&h.push("file size can not be more than "+ka+" MB"),0<h.length)alert(h.toString());
else{var h=mckUtils.randomId(),I=[{fileIdExpr:h,fileName:c.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+c.name+"\x3c/a\x3e",fileSizeExpr:a.getFilePreviewSize(g.size)}];b.tmpl("fileboxTemplate",I).appendTo("#mck-file-box");var B=b(".mck-file-box."+h),p=b(".mck-file-box."+h+" .mck-file-lb"),y=b(".mck-file-box."+h+" .progress .bar"),s=b(".mck-file-box."+h+" .progress"),C=b(".mck-file-box."+h+" .mck-remove-file");y.css("width","0%");s.removeClass("n-vis").addClass("vis");C.attr("disabled",
!0);L.attr("disabled",!0);l.removeClass("n-vis").addClass("vis");if(c.name===b(".mck-file-box."+h+" .mck-file-lb a").html()){var M=x.data("mck-id");Z[c.name+g.size]=M;d.attr("disabled",!0);k.append("file",g);var n=new XMLHttpRequest;(n.upload||n).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);y.css("width",a+"%")});n.addEventListener("load",function(a){a=b.parseJSON(this.responseText);if("object"===typeof a){a=a.fileMeta;var c="object"===typeof a?'\x3ca href\x3d"'+a.url+
'" target\x3d"_blank"\x3e'+a.name+"\x3c/a\x3e":"",g=a.name,k=a.size,q=x.data("mck-id"),g=g+k,k=Z[g];if(M!==q)e.updateDraftMessage(k,a),delete Z[g];else return C.attr("disabled",!1),L.attr("disabled",!1),d.attr("disabled",!1),delete Z[g],p.html(c),s.removeClass("vis").addClass("n-vis"),b(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),D.removeAttr("required"),P.push(a),B.data("mckfile",a),L.children("input").val(""),!1}else C.attr("disabled",!1),d.attr("disabled",!1),C.trigger("click")});
b.ajax({type:"GET",url:Ca+"/rest/ws/aws/file/url",global:!1,data:"data\x3d"+(new Date).getTime(),crosDomain:!0,success:function(a){var b=new FormData;b.append("files[]",g);n.open("POST",a,!0);n.send(b)},error:function(){}})}return!1}};a.uploadFile=function(c){var g=c.file,k=[];if("undefined"!==typeof g)if(4<b(".mck-file-box").length&&k.push("Can't upload more than 5 files at a time"),g.size>1048576*ka&&k.push("file size can not be more than "+ka+" MB"),0<k.length)alert(k.toString());else{var k=mckUtils.randomId(),
h=[{fileIdExpr:k,fileName:c.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+c.name+"\x3c/a\x3e",fileSizeExpr:a.getFilePreviewSize(g.size)}];b.tmpl("fileboxTemplate",h).appendTo("#mck-file-box");var I=b(".mck-file-box."+k),B=b(".mck-file-box."+k+" .mck-file-lb"),p=b(".mck-file-box."+k+" .progress .bar"),y=b(".mck-file-box."+k+" .progress"),s=b(".mck-file-box."+k+" .mck-remove-file");p.css("width","0%");y.removeClass("n-vis").addClass("vis");s.attr("disabled",!0);L.attr("disabled",!0);
l.removeClass("n-vis").addClass("vis");if(c.name===b(".mck-file-box."+k+" .mck-file-lb a").html()){var C=x.data("mck-id");Z[c.name+g.size]=C;d.attr("disabled",!0);c=[];c.push(g);var M=new XMLHttpRequest;(M.upload||M).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);p.css("width",a+"%")});M.addEventListener("load",function(c){c=b.parseJSON(this.responseText);if("object"===typeof c.fileMeta){c=c.fileMeta;var g=a.getFilePreviewPath(c),k=c.name,q=c.size,h=x.data("mck-id"),k=
k+q,q=Z[k];if(C!==h)e.updateDraftMessage(q,c),delete Z[k];else return s.attr("disabled",!1),L.attr("disabled",!1),d.attr("disabled",!1),delete Z[k],B.html(g),y.removeClass("vis").addClass("n-vis"),b(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),D.removeAttr("required"),P.push(c),I.data("mckfile",c),L.children("input").val(""),!1}else s.attr("disabled",!1),d.attr("disabled",!1),s.trigger("click")});b.ajax({type:"GET",url:Ca+"/rest/ws/aws/file/url",global:!1,data:"data\x3d"+(new Date).getTime(),
crosDomain:!0,success:function(a){var b=new FormData;b.append("files[]",g);M.open("POST",a,!0);M.send(b)},error:function(){}})}return!1}};a.uploadAttachment2AWS=function(c){var g=c.file,k=new FormData,h=[];if("undefined"!==typeof g)if(4<b(".mck-file-box").length&&h.push("Can't upload more than 5 files at a time"),g.size>1048576*ka&&h.push("file size can not be more than "+ka+" MB"),0<h.length)alert(h.toString());else{var h=mckUtils.randomId(),I=[{fileIdExpr:h,fileName:c.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+
c.name+"\x3c/a\x3e",fileSizeExpr:a.getFilePreviewSize(g.size)}];b.tmpl("fileboxTemplate",I).appendTo("#mck-file-box");var B=b(".mck-file-box."+h),p=b(".mck-file-box."+h+" .mck-file-lb"),s=b(".mck-file-box."+h+" .progress .bar"),y=b(".mck-file-box."+h+" .progress"),C=b(".mck-file-box."+h+" .mck-remove-file");s.css("width","0%");y.removeClass("n-vis").addClass("vis");C.attr("disabled",!0);L.attr("disabled",!0);l.removeClass("n-vis").addClass("vis");if(c.name===b(".mck-file-box."+h+" .mck-file-lb a").html()){var M=
x.data("mck-id");Z[c.name+g.size]=M;d.attr("disabled",!0);k.append("file",g);c=new XMLHttpRequest;(c.upload||c).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);s.css("width",a+"%")});c.addEventListener("load",function(a){a=b.parseJSON(this.responseText);if("object"===typeof a){var c="object"===typeof a?'\x3ca href\x3d"'+a.url+'" target\x3d"_blank"\x3e'+a.name+"\x3c/a\x3e":"",g=a.name,k=a.size,h=x.data("mck-id"),g=g+k,k=Z[g];if(M!==h)e.updateDraftMessage(k,a),delete Z[g];
else return C.attr("disabled",!1),L.attr("disabled",!1),d.attr("disabled",!1),delete Z[g],p.html(c),y.removeClass("vis").addClass("n-vis"),b(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),D.removeAttr("required"),P.push(a),B.data("mckfile",a),L.children("input").val(""),!1}else C.attr("disabled",!1),d.attr("disabled",!1),C.trigger("click")});c.open("post",MCK_BASE_URL+"/rest/ws/upload/image",!0);c.setRequestHeader("UserId-Enabled",!0);c.setRequestHeader("Authorization","Basic "+n);
c.setRequestHeader("Application-Key",U);c.setRequestHeader("Device-Key",ea);ca&&c.setRequestHeader("Access-Token",ca);c.send(k)}return!1}};a.uplaodFileToAWS=function(a,b){var e=new FormData,d=[];"undefined"!==typeof a&&(-1===a.type.indexOf("image")&&d.push("Please upload image file."),0<d.length?alert(d.toString()):(h.attr("disabled",!0),c[0]===b?(A.find(".mck-overlay-box").removeClass("n-vis"),A.removeClass("mck-hover-on"),E.removeClass("n-vis").addClass("vis")):(t.find(".mck-overlay-box").removeClass("n-vis"),
t.removeClass("mck-hover-on"),N.removeClass("n-vis").addClass("vis")),d=new XMLHttpRequest,d.addEventListener("load",function(a){if(a=this.responseText)c[0]===b?(M.html('\x3cimg src\x3d"'+a+'"/\x3e'),M.data("iconurl",a),I.html(MCK_LABELS["change.group.icon"]),E.removeClass("vis").addClass("n-vis"),A.addClass("mck-hover-on")):(k.html('\x3cimg src\x3d"'+a+'"/\x3e'),k.data("iconurl",a),N.removeClass("vis").addClass("n-vis"),t.addClass("mck-hover-on"),setTimeout(function(){v.removeClass("n-vis").addClass("vis")},
1500)),setTimeout(function(){C.addClass("n-vis")},1500);h.attr("disabled",!1);c[0]===b?y.val(""):s.val("");return!1}),e.append("file",a),d.open("post",MCK_BASE_URL+"/rest/ws/upload/file",!0),d.setRequestHeader("UserId-Enabled",!0),d.setRequestHeader("Authorization","Basic "+n),d.setRequestHeader("Application-Key",U),d.setRequestHeader("Device-Key",ea),ca&&d.setRequestHeader("Access-Token",ca),d.send(e)))};a.deleteFileMeta=function(a){mckUtils.ajax({url:Ca+"/rest/ws/aws/file/delete?key\x3d"+a,type:"post",
success:function(){},error:function(){}})};a.getFilePreviewPath=function(a){return"object"===typeof a?'\x3ca href\x3d"'+(a.hasOwnProperty("url")?""+a.url:Ca+"/rest/ws/aws/file"+a.blobKey)+'" target\x3d"_blank"\x3e'+a.name+"\x3c/a\x3e":""};a.getFilePreviewSize=function(a){return a?1048576<a?"("+parseInt(a/1048576)+" MB)":1024<a?"("+parseInt(a/1024)+" KB)":"("+parseInt(a)+" B)":""};a.addFileBox=function(a){var e=mckUtils.randomId(),c="";"object"===typeof a.fileMeta&&(e=a.fileMeta.createdAtTime,c=a.fileMeta.name);
b.tmpl("fileboxTemplate",[{fileNameExpr:a.filelb,fileSizeExpr:a.filesize,fileIdExpr:e,fileName:c}]).appendTo("#mck-file-box");var e=b(".mck-file-box."+e),c=e.find(".mck-remove-file"),g=e.find(".progress");"object"===typeof a.fileMeta?(e.data("mckblob",a.fileMeta.blobKey),D.removeAttr("required"),d.attr("disabled",!1),c.attr("disabled",!1),g.removeClass("vis").addClass("n-vis"),P.push(a.fileMeta)):(d.attr("disabled",!0),c.attr("disabled",!0),g.removeClass("n-vis").addClass("vis"))}},e=new function(){var a=
this,c="",h=b("#mck-search"),B=b("#mck-msg-to"),d=b(".mck-file-lb"),D=b(".mck-file-sz"),p=b("#mck-sidebox"),C=b("#mck-file-box"),n=b("#mck-msg-sbmt"),y=b("#mck-msg-form"),s=b("#mck-text-box"),aa=b("#mck-msg-error");b("#mck-show-more");var xa=b("#mck-tab-title"),Pa=b("#mck-tab-status"),K=b("#mck-message-cell"),J=b(".mck-typing-box"),E=b("#mck-no-messages"),k=b("#mck-product-box"),M=b(".mck-product-icon"),I=b(".mck-product-title"),q=b(".mck-product-subtitle"),ga=b("#mck-product-box .mck-caret"),Db=
b(".mck-product-rt-up .mck-product-key"),U=b("#mck-contact-search-input-box"),Z=b(".mck-product-rt-up .mck-product-value"),Ha=b(".mck-product-rt-down .mck-product-key"),fa=b(".mck-product-rt-down .mck-product-value");b("#li-mck-group-info");b("#li-mck-leave-group");var Fa=b("#mck-group-info-tab"),da=b("#mck-group-search-tab"),la=b("#mck-no-search-groups"),ab=b("#mck-group-create-tab"),ia=b("#mck-group-search-list");b("#mck-group-search-tabview");var R=b(".mck-group-menu-options"),ma=b(".mck-videocall-btn"),
qa=b("#mck-group-search-input"),hb=b("#mck-group-search-input-box"),ea=b("#mck-contact-search-list"),ca=b("#mck-contacts-content"),oa=b("#mck-contact-search-tab");b("#mck-contact-search-tabview");var na=b("#mck-contact-search-input");b("#mck-search-list");var W=b("#mck-no-search-contacts"),ka=b("#mck-search-tab-box li a"),Da=b("#mck-search-tabview-box"),ha=b("#mck-sidebox-search"),ua=b("#mck-contact-loading"),hc=b("#mck-typing-label"),r=b("#mck-price-widget"),Ga=b("#mck-msg-response"),ta=b("#mck_response_text"),
ya=b("#li-mck-block-user"),za=b("#li-mck-video-call"),Qa=b("#mck-search-loading"),Zb=b("#mck-tab-individual"),$b=b("#mck-attachfile-box"),f=b("#mck-attachmenu-box"),G=b("#mck-sidebox-content"),w=b("#mck-tab-option-panel"),O=b("#mck-tab-conversation"),Ra=b("#mck-conversation-header"),ib=b("#mck-no-conversations"),Xa=b("#mck-conversation-list"),Ua=b(".mck-tab-message-option"),bb=b(".mck-box-ft .mck-box-form"),ac=b("#mck-btn-clear-messages"),Gb=b("#mck-offline-message-box"),z=b("#mck-message-cell .mck-message-inner");
b("#mck-msg-new");var ic=RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi);b.template("convTemplate",'\x3cli id\x3d"li-${convIdExpr}" class\x3d"${convIdExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${convIdExpr}" data-mck-id\x3d"${tabIdExpr}" data-isgroup\x3d"${isGroupExpr}" data-mck-topicid\x3d"${topicIdExpr}" data-isconvtab\x3d"true"\x3e\x3cdiv class\x3d"mck-row mck-truncate" title\x3d"${convTitleExpr}"\x3e${convTitleExpr}\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b.template("messageTemplate",'\x3cdiv name\x3d"message" data-msgdelivered\x3d"${msgDeliveredExpr}" data-msgsent\x3d"${msgSentExpr}" data-msgtype\x3d"${msgTypeExpr}" data-msgtime\x3d"${msgCreatedAtTime}" data-msgcontent\x3d"${replyIdExpr}" data-msgkey\x3d"${msgKeyExpr}" data-contact\x3d"${toExpr}" class\x3d"mck-m-b ${msgKeyExpr} ${msgFloatExpr} ${msgAvatorClassExpr}"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12"\x3e\x3cdiv class\x3d"mck-msg-avator blk-lg-3"\x3e{{html msgImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-box ${msgClassExpr}"\x3e\x3cdiv class\x3d "move-right mck-msg-text"\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyToVisibleExpr}"\x3e\x3cdiv class\x3d"mck-msgto"\x3e${msgReplyTo} \x3c/div\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyDivExpr}"\x3e\x3cdiv class\x3d"mck-msgreply-border ${textreplyVisExpr}"\x3e${msgReply}\x3c/div\x3e\x3cdiv class\x3d"mck-msgreply-border ${msgpreviewvisExpr}"\x3e{{html msgPreview}}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${nameTextExpr} mck-truncate ${showNameExpr}"\x3e\x3cspan class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/span\x3e${msgNameExpr}\x3c/div\x3e\x3cdiv class\x3d"mck-file-text notranslate mck-attachment downloadimage ${downloadIconVisibleExpr}" data-filemetakey\x3d"${fileMetaKeyExpr}" data-filename\x3d"${fileNameExpr}" data-fileurl\x3d "${fileUrlExpr}" data-filesize\x3d"${fileSizeExpr}"\x3e\x3cdiv\x3e{{html fileExpr}}\x3c/div\x3e {{html downloadMediaUrlExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-text mck-msg-content"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${msgFloatExpr}-muted mck-text-light mck-text-muted mck-text-xs mck-t-xs"\x3e${createdAtTimeExpr} \x3cspan class\x3d"${statusIconExpr} mck-message-status"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"n-vis mck-context-menu"\x3e\x3cul\x3e\x3cli\x3e\x3ca class\x3d"mck-message-forward ${msgForwardVisibleExpr}"\x3e${msgForwardExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-delete"\x3e${msgDeleteExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-reply"\x3e${msgReplyExpr}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e');
b.template("contactTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}" data-msg-time\x3d"${msgCreatedAtTimeExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${conversationExpr}" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"mck-conversation-topic mck-truncate ${contHeaderExpr}"\x3e${titleExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cdiv class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/div\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-text-muted move-right mck-cont-msg-date mck-truncate blk-lg-4"\x3e${msgCreatedDateExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"mck-cont-msg-wrapper blk-lg-6 mck-truncate msgTextExpr"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-unread-count-box move-right mck-truncate ${contUnreadExpr}"\x3e\x3cspan class\x3d"mck-unread-count-text"\x3e{{html contUnreadCount}}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b.template("searchContactbox",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}"\x3e\x3ca class\x3d"applozic-launcher" href\x3d"#" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3cdiv class\x3d"move-right mck-group-count-box mck-group-count-text ${displayGroupUserCountExpr}"\x3e${groupUserCountExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-muted"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a.openConversation=function(){"none"===p.css("display")&&(b(".mckModal").mckModal("hide"),p.mckModal());B.focus()};a.initEmojis=function(){try{b("#mck-text-box").emojiarea({button:"#mck-btn-smiley",wysiwyg:!0,menuPosition:"top"})}catch(m){c||(c=setTimeout(function(){a.initEmojis()},3E4))}};a.loadTab=function(m,jc){var c=z.data("mck-id");if(c)if(1<s.html().length||C.hasClass("vis")){var d={text:s.html(),files:[]};C.hasClass("vis")&&b(".mck-file-box").each(function(){var a=b(this),m={filelb:a.find(".mck-file-lb").html(),
filesize:a.find(".mck-file-sz").html()},a=a.data("mckfile");"object"===typeof a&&(m.fileMeta=a);d.files.push(m)});Ja[c]=d}else delete Ja[c];Aa=!0;a.clearMessageField(!1);a.addDraftMessage(m.tabId);aa.html("");aa.removeClass("vis").addClass("n-vis");ta.html("");Ga.removeClass("vis").addClass("n-vis");y[0].reset();y.removeClass("n-vis").addClass("vis");z.html("");aa.removeClass("mck-no-mb");ca.removeClass("n-vis").addClass("vis");bb.removeClass("vis").addClass("n-vis");ha.removeClass("vis").addClass("n-vis");
Fa.removeClass("vis").addClass("n-vis");ab.removeClass("vis").addClass("n-vis");G.removeClass("n-vis").addClass("vis");k.removeClass("vis").addClass("n-vis");Ra.addClass("n-vis");ua.removeClass("vis").addClass("n-vis");z.removeClass("mck-group-inner");Pa.removeClass("vis").addClass("n-vis");xa.removeClass("mck-tab-title-w-status");xa.removeClass("mck-tab-title-w-typing");J.removeClass("vis").addClass("n-vis");hc.html(MCK_LABELS.typing);z.data("isgroup",m.isGroup);z.data("datetime","");if(m.tabId)B.val(m.tabId),
z.data("mck-id",m.tabId),z.data("mck-conversationid",m.conversationId),z.data("mck-topicid",m.topicId),w.data("tabId",m.tabId),w.removeClass("n-vis").addClass("vis"),ca.removeClass("vis").addClass("n-vis"),bb.removeClass("n-vis").addClass("vis"),ac.removeClass("n-vis").addClass("vis"),R.removeClass("vis").addClass("n-vis"),m.isGroup?(z.addClass("mck-group-inner"),ya.removeClass("vis").addClass("n-vis"),za.removeClass("vis").addClass("n-vis"),ma.removeClass("vis").addClass("n-vis")):(ya.removeClass("n-vis").addClass("vis"),
za.removeClass("n-vis").addClass("vis"),La&&ma.removeClass("n-vis").addClass("vis")),!m.topicId&&m.conversationId&&(c=Q[m.conversationId],"object"===typeof c&&(m.topicId=c.topicId)),m.topicId&&(c=N[m.topicId],"object"===typeof c&&(va?(z.data("mck-title",c.title),Ra.html(c.title),Ra.removeClass("n-vis")):Ia&&(a.setProductProperties(c,m.topicId),ga.addClass("n-vis"),k.addClass("mck-product-box-wc"),Xa.addClass("n-vis"),k.removeClass("n-vis").addClass("vis")))),qb&&l.google&&"object"===typeof l.google.maps?
($b.removeClass("vis").addClass("n-vis"),f.removeClass("n-vis").addClass("vis")):(f.removeClass("vis").addClass("n-vis"),$b.removeClass("n-vis").addClass("vis")),c=a.getTabDisplayName(m.tabId,m.isGroup,m.userName),a.isGroupDeleted(m.tabId,m.isGroup)&&(aa.html(MCK_LABELS["group.deleted"]),aa.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),y.removeClass("vis").addClass("n-vis")),xa.html(c),xa.attr("title",c),O.removeClass("vis").addClass("n-vis"),Da.removeClass("vis").addClass("n-vis"),Zb.removeClass("n-vis").addClass("vis"),
"support"===mb&&b(".mck-tab-link").removeClass("vis").addClass("n-vis"),xb&&(r.removeClass("n-vis").addClass("vis"),z.addClass("mck-msg-w-panel")),Ya&&(aa.html("Deactivated"),aa.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),y.removeClass("vis").addClass("n-vis")),X.subscibeToTypingChannel(m.tabId,m.isGroup),"function"===typeof ub&&ub({tabId:m.tabId,isGroup:m.isGroup});else if(m.tabId="",Za&&e.hideOfflineMessage(),Zb.removeClass("vis").addClass("n-vis"),O.removeClass("n-vis").addClass("vis"),
Da.removeClass("n-vis").addClass("vis"),k.removeClass("vis").addClass("n-vis"),z.data("mck-id",""),z.data("mck-conversationid",""),z.data("mck-topicid",""),r.removeClass("vis").addClass("n-vis"),z.removeClass("mck-msg-w-panel"),w.removeClass("vis").addClass("n-vis"),ac.removeClass("vis").addClass("n-vis"),B.val(""),c=A.getLatestMessageArray(),X.unsubscibeToTypingChannel(),null!==c&&0<c.length){m.isReload=!0;e.addContactsFromMessageList({message:c},m);a.openConversation();Aa=!1;return}v.loadMessageList(m,
jc);a.openConversation()};a.setProductProperties=function(b,f){I.html(b.title);M.html(a.getTopicLink(b.link));q.html(b.subtitle?b.subtitle:"");var e=b.value1?":"+b.value1:"";Db.html(b.key1?b.key1:"");Z.html(e);e=b.value2?":"+b.value2:"";Ha.html(b.key2?b.key2:"");fa.html(e);"function"===typeof rb&&(b.topicId=f,rb(b))};a.getTopicLink=function(a){return a?'\x3cimg src\x3d"'+a+'"\x3e':'\x3cspan class\x3d"mck-icon-no-image"\x3e\x3c/span\x3e'};a.processMessageList=function(m,f,c){var d,G=z.children("div[name\x3d'message']:first"),
g=z.data("mck-id"),k=z.data("isgroup")?mckGroupUtils.getGroup(g):e.fetchContact(g);"undefined"===typeof m.message.length?(g=[],g.push(m.message),A.updateMckMessageArray(g),a.addMessage(m.message,k,!1,!1,c),d=m.createdAtTime):(A.updateMckMessageArray(m.message),b.each(m.message,function(b,m){"undefined"!==typeof m.to&&(a.addMessage(m,k,!1,!1,c),d=m.createdAtTime)}));w.data("datetime",d);!f&&0<G.length?z.scrollTop(G.offset().top-z.offset().top+z.scrollTop()):f&&z.animate({scrollTop:z.prop("scrollHeight")},
"fast")};a.closeConversation=function(a){if("function"===typeof tb){var b=tb();if("object"===typeof b)var f="BUSY_WITH_OTHER"===a?b.onBusyWithOtherUser:b.onConversationClose}f||(f="Chat disabled with user");aa.html(f);aa.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");y.removeClass("vis").addClass("n-vis")};a.addTooltip=function(a){b("."+a+" .mck-icon-time").attr("title","pending");b("."+a+" .mck-btn-trash").attr("title","delete");b("."+a+" .mck-icon-sent").attr("title","sent");b("."+a+
" .mck-btn-forward").attr("title","forward message");b("."+a+" .mck-icon-delivered").attr("title","delivered");b("."+a+" .mck-icon-read").attr("title","delivered and read");b("."+a+" .msgtype-outbox-cr").attr("title","sent via Carrier");b("."+a+" .msgtype-outbox-mck").attr("title","sent");b("."+a+" .msgtype-inbox-cr").attr("title","received via Carrier");b("."+a+" .msgtype-inbox-mck").attr("title","recieved")};a.fetchContact=function(b){var f=a.getContact(b);"undefined"===typeof f&&(f=a.createContact(b));
return f};a.getContact=function(a){if("object"===typeof pa[a])return pa[a]};a.getContactDisplayName=function(a){if("string"===typeof sa[a])return sa[a];if("undefined"===typeof sa[a]&&(a=H[a],"undefined"!==typeof a))return a.displayName};a.addMessage=function(m,f,c,d,G){var g="",k="",w="",h="vis",O="n-vis",q="",I="n-vis";if("object"===typeof m.metadata&&"undefined"!==typeof m.metadata.AL_REPLY&&(g=m.metadata.AL_REPLY,k=v.getReplyMessageByKey(g),"undefined"!==typeof k)){if(f.isGroup&&k||!f.isGroup&&
"undefined"===typeof k.fileMeta)I="vis";q=5===k.type?"You":e.getTabDisplayName(k.to,!1);if("object"===typeof k.fileMeta||2===k.contentType)w=a.getImageForReplyMessage(k),h="n-vis",O="vis",I="n-vis"}if(6!==m.type&&7!==m.type&&!(m.metadata&&"HIDDEN"===m.metadata.category||102===m.contentType||10===m.contentType&&m.metadata&&"true"===m.metadata.hide||0<b("#mck-message-cell ."+m.key).length)){E.hasClass("vis")&&E.removeClass("vis").addClass("n-vis");var B="mck-msg-right",D="mck-icon-time";if(0===m.type||
4===m.type||6===m.type)B="mck-msg-left";if(4===m.contentType||10===m.contentType||103===m.contentType)B="mck-msg-center";var D=a.getStatusIconName(m),g=m.key,p="'"+m.deviceKey+"','"+m.to+"','"+m.to+"','"+g+"'",s="",C="",y="",M="n-vis",ib="";V.loadUserProfile(m.to);!m.groupId||4===m.contentType||7===f.type||0!==m.type&&4!==m.type&&6!==m.type||(s=a.getTabDisplayName(m.to,!1),M="vis",y=a.getNameTextClassByAlphabet(s));if(Nb){var ib="mck-msg-avator-bubble",n="",r=s;"mck-msg-right"===B?(n=e.fetchContact(x),
r=a.getTabDisplayName(n.displayName,!1)):"mck-msg-left"===B&&(n=m.groupId?e.fetchContact(m.to):f);n&&(C=a.getContactImageLink(n,r))}m.groupId&&10===m.contentType&&(y=C=s="");f="n-vis";var r=n="",L=m.message;"object"===typeof m.fileMeta&&(n=m.fileMeta.name,r=m.fileMeta.size);"object"===typeof m.fileMeta&&(m.fileMeta.contentType.indexOf("audio")||m.fileMeta.contentType.indexOf("image")||m.fileMeta.contentType.indexOf("video"))&&(f="vis");var ga="n-vis";eb&&l.MCK_OL_MAP[m.to]&&10!==m.contentType&&(ga=
"vis");w=[{msgReply:k?k.message+"\n":"",msgReplyTo:k?q+"\n":"",msgReplyDivExpr:k?"vis":"n-vis",msgReplyToVisibleExpr:I,msgPreview:w?a.getImageForReplyMessage(k):"",msgpreviewvisExpr:O,textreplyVisExpr:h,msgKeyExpr:m.key,msgDeliveredExpr:m.delivered,msgSentExpr:m.sent,msgCreatedAtTime:m.createdAtTime,msgTypeExpr:m.type,msgDeleteExpr:MCK_LABELS["delete"],msgReplyExpr:MCK_LABELS.reply,msgForwardExpr:MCK_LABELS.forward,msgForwardVisibleExpr:"vis",msgSourceExpr:m.source,statusIconExpr:D,contactExpr:"vis",
toExpr:m.to,msgAvatorClassExpr:ib,showNameExpr:M,msgNameExpr:s,msgImgExpr:C,nameTextExpr:y,msgFloatExpr:B,replyIdExpr:g,createdAtTimeExpr:mckDateUtils.getDate(m.createdAtTime),msgFeatExpr:"n-vis",replyMessageParametersExpr:p,downloadMediaUrlExpr:a.getFileAttachment(m),msgClassExpr:"",msgExpr:L,selfDestructTimeExpr:m.timeToLive,fileMetaKeyExpr:m.fileMetaKey,downloadIconVisibleExpr:f,fileExpr:a.getFilePath(m),fileUrlExpr:a.getFileurl(m),fileNameExpr:n,fileSizeExpr:r,contOlExpr:ga}];c?b.tmpl("messageTemplate",
w).appendTo("#mck-message-cell .mck-message-inner"):b.tmpl("messageTemplate",w).prependTo("#mck-message-cell .mck-message-inner");w="";m.message&&(w=m.message.replace(/\n/g,"\x3cbr/\x3e"),null!==l.emoji&&"undefined"!==typeof l.emoji&&(w=l.emoji.replace_unified(w),w=l.emoji.replace_colons(w)));m.conversationId&&(h=Q[m.conversationId],"object"!==typeof h&&v.getTopicId({conversationId:m.conversationId}),c&&(z.data("mck-conversationid",m.conversationId),h&&(O=N[h.topicId],"object"===typeof O&&(Ia?a.setProductProperties(O,
h.topicId):va&&Ra.html(O.title)))));4===m.contentType&&(h=w,w="Final agreed price: "+w,xb||(w+='\x3cbr/\x3e\x3cbutton class\x3d"mck-accept" data-mck-topic-price\x3d"'+h+'" data-mck-conversationid\x3d"'+m.conversationId+'"\x3eAccept\x3c/button\x3e'));h=b("."+g+" .mck-msg-content");if(-1===w.indexOf("emoji-inner")&&0===m.contentType)for(w=w.split("\x3cbr/\x3e"),O=0;O<w.length;O++)q=u.createElement("div"),q.appendChild(u.createTextNode(w[O])),w[O]&&w[O].match(ic)&&(q=b(q).linkify({target:"_blank"})),
h.append(q);else h.html(w),h.linkify({target:"_blank"});m.fileMeta&&(b("."+g+" .mck-file-text a:first").trigger("click"),b("."+g+" .mck-file-text").removeClass("n-vis").addClass("vis"),""===h.html()&&h.removeClass("vis").addClass("n-vis"));2===m.contentType&&(h.removeClass("vis").addClass("n-vis"),b("."+g+" .mck-file-text").removeClass("n-vis").addClass("vis"));d&&z.animate({scrollTop:z.prop("scrollHeight")},"fast");Ua.hasClass("n-vis")&&(m.groupId?6!==mckGroupUtils.getGroup(m.groupId).type&&Ua.removeClass("n-vis").addClass("vis"):
Ua.removeClass("n-vis").addClass("vis"));a.addTooltip(m.key);4!==m.contentType&&10!==m.contentType&&G&&a.messageContextMenu(m.key);m.groupId&&10===m.contentType&&c&&mckGroupService.getGroupFeed({groupId:m.groupId,isReloadTab:!0,apzCallback:t.onGroupFeed})}};a.addContactForSearchList=function(m,f){var e=m.userCount,c=m.isGroup,d=a.getTabDisplayName(m.contactId,c),G=a.getContactImageLink(m,d),w=c?"gs-group-"+m.htmlId:"cs-user-"+m.htmlId,g="",k=c&&zb;b("#li-"+w+" .mck-group-count-text").html(e);c||ja[m.contactId]||
(l.MCK_OL_MAP[m.contactId]?g=MCK_LABELS.online:T[m.contactId]&&(g=mckDateUtils.getLastSeenAtStatus(T[m.contactId])));b.tmpl("searchContactbox",[{contHtmlExpr:w,contIdExpr:m.contactId,contTabExpr:m.isGroup,contImgExpr:G,contLastSeenExpr:g,contNameExpr:d,groupUserCountExpr:m.userCount,displayGroupUserCountExpr:k?"vis":"n-vis"}]).prependTo("#"+f)};a.getFileurl=function(a){return"object"===typeof a.fileMeta?a.fileMeta.hasOwnProperty("url")?""+a.fileMeta.url:Ca+"/rest/ws/aws/file/"+a.fileMeta.blobKey:
""};a.getFilePath=function(m){if(2===m.contentType)try{var f=b.parseJSON(m.message);if(f.lat&&f.lon)return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+f.lat+","+f.lon+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+f.lat+","+f.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+f.lat+","+f.lon+"\x26key\x3d"+Lb+'"/\x3e\x3c/a\x3e'}catch(e){if(-1!==m.message.indexOf(","))return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+
m.message+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+m.message+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+m.message+"\x26key\x3d"+Lb+'" /\x3e\x3c/a\x3e'}return"object"===typeof m.fileMeta?-1!==m.fileMeta.contentType.indexOf("image")?-1!==m.fileMeta.contentType.indexOf("svg")?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+m.fileMeta.contentType+
'" data-url\x3d"'+a.getFileurl(m)+'" data-name\x3d"'+m.fileMeta.name+'"\x3e\x3cimg src\x3d"'+a.getFileurl(m)+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':5===m.contentType?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+m.fileMeta.contentType+'" data-url\x3d"'+m.fileMeta.blobKey+'" data-name\x3d"'+m.fileMeta.name+'"\x3e\x3cimg src\x3d"'+m.fileMeta.blobKey+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+
m.fileMeta.contentType+'" data-url\x3d"'+a.getFileurl(m)+'" data-name\x3d"'+m.fileMeta.name+'"\x3e\x3cimg src\x3d"'+m.fileMeta.thumbnailUrl+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':-1!==m.fileMeta.contentType.indexOf("video")?'\x3ca href\x3d "#" target\x3d"_self"  \x3e\x3cvideo controls class\x3d"mck-video-player"\x3e\x3csource src\x3d"'+a.getFileurl(m)+'" type\x3d"video/mp4"\x3e\x3csource src\x3d"'+a.getFileurl(m)+'" type\x3d"video/ogg"\x3e\x3c/video\x3e\x3c/a\x3e':-1!==m.fileMeta.contentType.indexOf("audio")?
'\x3ca href\x3d"#" target\x3d"_self" \x3e\x3caudio controls class\x3d"mck-audio-player"\x3e\x3csource src\x3d"'+a.getFileurl(m)+'" type\x3d"audio/ogg"\x3e\x3csource src\x3d"'+a.getFileurl(m)+'" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e':'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link" target\x3d"_blank"\x3e\x3c/a\x3e':""};a.getImageForMessagePreview=function(f){if("object"===typeof f.fileMeta)return-1!==f.fileMeta.contentType.indexOf("image")?
'\x3cspan\x3ephoto\x3c/span\x3e \x3cimg src\x3d"'+a.getFileurl(f)+'" class\x3d"mck-image-reply move-right"/\x3e':-1!==f.fileMeta.contentType.indexOf("audio")?'\x3cspan\x3eaudio\x3c/span\x3e\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+f.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ba.getFilePreviewSize(f.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":'\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+
f.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ba.getFilePreviewSize(f.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===f.contentType)return f=b.parseJSON(f.message),'\x3cspan\x3elocation\x3c/span\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+f.lat+","+f.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+f.lat+","+f.lon+'" class\x3d"mck-image-reply move-right"/\x3e'};a.getImageForReplyMessage=function(f){var c=
e.getTabDisplayName(f.to,!1);if("object"===typeof f.fileMeta)return-1!==f.fileMeta.contentType.indexOf("image")?'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+c+'\x3c/div\x3e\x3cdiv\x3e\x3cspan class\x3d"mck-icon-camera mck-camera"\x3e\x3c/span\x3e\x3cspan\x3ePhoto\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"'+a.getFileurl(f)+'" class\x3d"mck-image-reply mck-msg-text mck-msg-content"/\x3e\x3c/div\x3e\x3c/div\x3e':
-1!==f.fileMeta.contentType.indexOf("audio")?'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+c+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail mck-msg-text mck-msg-content"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+f.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ba.getFilePreviewSize(f.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+c+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+
f.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ba.getFilePreviewSize(f.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===f.contentType)return f=b.parseJSON(f.message),'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+c+'\x3c/div\x3e\x3cspan class\x3d"mck-icon-marker mck-location-icon"\x3e\x3c/span\x3e\x3cspan\x3eLocation\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+
f.lat+","+f.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+f.lat+","+f.lon+'" class\x3d"mck-image-reply mck-msg-text "/\x3e\x3c/div\x3e\x3c/div\x3e'};a.getFileAttachment=function(b){if("object"===typeof b.fileMeta)return-1!==b.fileMeta.contentType.indexOf("image")||-1!==b.fileMeta.contentType.indexOf("audio")||b.fileMeta.contentType.indexOf("video"),'\x3ca href\x3d"'+a.getFileurl(b)+'" role\x3d"link" target\x3d"_self"  class\x3d"file-preview-link"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+
b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ba.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e"};a.getFileIcon=function(a){return a.fileMetaKey&&"object"===typeof a.fileMeta?-1!==a.fileMeta.contentType.indexOf("image")?'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eImage\x3c/span\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eAudio\x3c/span\x3e':
-1!==a.fileMeta.contentType.indexOf("video")?'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eVideo\x3c/span\x3e':'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eFile\x3c/span\x3e':""};a.getContactFromGroupOfTwo=function(a){for(var b=0;b<a.members.length;b++)if(x!==""+a.members[b])return e.fetchContact(""+a.members[b])};a.getContactImageLink=function(b,f){var e="";if(b.isGroup&&7!==b.type)e=t.getGroupImage(b.imageUrl);else{b.isGroup&&7===
b.type&&1<b.members.length&&(b=a.getContactFromGroupOfTwo(b));if("function"===typeof Ma){var c=Ma(b.contactId);c&&"undefined"!==typeof c&&(e='\x3cimg src\x3d"'+c+'"/\x3e')}e||(b.photoSrc?e='\x3cimg src\x3d"'+b.photoSrc+'"/\x3e':b.photoData?e='\x3cimg src\x3d"data:image/jpeg;base64,'+b.photoData+'"/\x3e':b.photoLink?e='\x3cimg src\x3d"'+MCK_BASE_URL+"/contact.image?photoLink\x3d"+b.photoLink+'"/\x3e':(f||(f=b.displayName),e=a.getContactImageByAlphabet(f)))}return e};a.getContactImageByAlphabet=function(a){if("undefined"===
typeof a||""===a)return'\x3cdiv class\x3d"mck-alpha-contact-image mck-alpha-user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e';a=a.charAt(0);return a.match(/^[a-zA-Z]+$/)?(a=a.toUpperCase(),'\x3cdiv class\x3d"mck-videocall-image alpha_'+a+'"\x3e\x3cspan class\x3d"mck-contact-icon"\x3e'+a+"\x3c/span\x3e\x3c/div\x3e"):'\x3cdiv class\x3d"mck-videocall-image alpha_user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e'};a.getNameTextClassByAlphabet=function(a){if("undefined"===
typeof a||""===a)return"mck-text-user";a=a.toString();a=a.charAt(0);return a.match(/^[a-zA-Z]+$/)?(a=a.toLowerCase(),"mck-text-"+a):"mck-text-user"};a.addContactsFromMessageList=function(f,e){var c;E.removeClass("vis").addClass("n-vis");if("null"===f+"")c="";else if(ib.removeClass("vis").addClass("n-vis"),0==z.has(b("#mck-contact-list")).length&&z.html('\x3cul id\x3d"mck-contact-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),"undefined"===typeof f.message.length?
(f.message.groupId?a.addGroupFromMessage(f.message):a.addContactsFromMessage(f.message),c=f.message.createdAtTime):b.each(f.message,function(b,f){"undefined"!==typeof f.to&&(f.groupId?a.addGroupFromMessage(f,!0):a.addContactsFromMessage(f,!0),c=f.createdAtTime)}),z.data("datetime",c),e.isReload){var d="";e.lastActiveTabId&&(d=e.isLastActiveTabGroup?"group-"+e.lastActiveTabId:"user-"+mckContactUtils.formatContactId(e.lastActiveTabId),d=b("#li-"+d));0<d.length?z.animate({scrollTop:d.offset().top-z.offset().top+
z.scrollTop()},"fast"):z.animate({scrollTop:0},0)}};a.addGroupFromMessageList=function(f,e){"null"!==f+""&&(e&&z.html('\x3cul id\x3d"mck-group-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),"undefined"===typeof f.message.length?a.addGroupFromMessage(f.message):b.each(f.message,function(b,f){"undefined"!==typeof f.to&&a.addGroupFromMessage(f,!0)}))};a.createContact=function(b){var f=a.getContactDisplayName(b);"undefined"===typeof f&&(f=b);f={contactId:b,htmlId:mckContactUtils.formatContactId(b),
displayName:f,name:f+" \x3c"+b+"\x3e [Main]",value:b,photoLink:"",photoSrc:"",photoData:"",email:"",unsaved:!0,isGroup:!1};return pa[b]=f};a.createContactWithDetail=function(b){var f=b.displayName,e=b.userId;f||(f=a.getContactDisplayName(e));"undefined"===typeof f?f=e:sa[e]=f;var c=b.photoLink?b.photoLink:"";c||(c=b.imageLink?b.imageLink:"");b=b.imageData?b.imageData:"";f={contactId:e,htmlId:mckContactUtils.formatContactId(e),displayName:f,name:f+" \x3c"+e+"\x3e [Main]",value:e,photoLink:"",photoSrc:c,
photoData:b,email:"",unsaved:!0,isGroup:!1};return pa[e]=f};a.updateContactDetail=function(b,f){var e=f.displayName,c=f.userId;b.displayName&&b.displayName!==b.contactId||(e||(e=a.getContactDisplayName(c)),"undefined"===typeof e?e=c:sa[c]=e,b.displayName=e);(e=f.photoLink)||(e=f.imageLink?f.imageLink:"");e&&!b.photoSrc&&(b.photoSrc=e);(e=f.imageData?f.imageData:"")&&!b.photoData&&(b.photoData=e);return pa[c]=b};a.addContactsFromMessage=function(b,f){var e=a.getUserIdFromMessage(b);if(0<e.length&&
e[0])for(var c=0;c<e.length;c++){var d=a.fetchContact(""+e[c]);a.updateRecentConversationList(d,b,f)}};a.addGroupFromMessage=function(b,f){var e=b.groupId,c=mckGroupUtils.getGroup(""+e);"undefined"===typeof c&&(c=mckGroupUtils.createGroup(e),mckGroupService.loadGroups({apzCallback:t.loadGroups}));a.updateRecentConversationList(c,b,f)};a.updateRecentConversationList=function(f,e,c){0<b("#mck-contact-list #li-"+(f.isGroup?"group-"+f.htmlId:"user-"+f.htmlId)).length?(b("#mck-contact-list #li-"+f.htmlId+
" .mck-cont-msg-wrapper").is(":empty")||c)&&void 0!==e&&a.updateContact(f,e,"mck-contact-list"):a.addContact(f,"mck-contact-list",e)};a.addContactsToSearchList=function(){var f=[],e=[],c=[];b.each(Oa,function(a,b){e.push(b.contactId);"string"!==typeof H[b.contactId]&&c.push(b.contactId)});V.getUsersDetail(c,{async:!1});var d=e.filter(function(a,b){return e.indexOf(a)===b});d.sort();Qa.removeClass("vis").addClass("n-vis");0<d.length?b.each(d,function(e,c){if(c){var d=a.fetchContact(""+c);f.push(d);
0===b("#li-cs-user-"+d.htmlId).length&&a.addContactForSearchList(d,"mck-contact-search-list")}}):W.removeClass("n-vis").addClass("vis");a.initAutoSuggest({contactsArray:f,$searchId:na,isContactSearch:!0})};a.initAutoSuggest=function(f){for(var c=f.contactsArray,d=f.$searchId,G=[],w,g={},k=[],h=0;h<c.length;h++){var O=c[h];O.displayName=a.getTabDisplayName(O.contactId,O.isGroup);w=O.displayName?b.trim(O.displayName):b.trim(O.contactId);g[w]=O;G.push(w);k.push(w)}c=function(a){a=g[a];var b=a.displayName.split(" "),
f=b.length,m=b[0],e="",c="";2===f?c=b[1]:3<=f&&(c=b[f-1],e=b[f-2]);b=RegExp(this.query,"i");return b.test(a.displayName)||b.test(a.contactId)||b.test(e)||b.test(c)||b.test(a.email)||b.test(m+" "+c)};w=function(a){return g[a].displayName};k=function(a){a=g[a];f.isContactSearch?(e.loadTab({tabId:a.contactId,isGroup:a.isGroup}),bb.removeClass("n-vis").addClass("vis")):t.addGroupMemberFromSearch(a.contactId)};d.hasClass("mck-typeahead")?(d.mcktypeahead().data("mcktypeahead").source=G,d.mcktypeahead().data("mcktypeahead").matcher=
c,d.mcktypeahead().data("mcktypeahead").highlighter=w,d.mcktypeahead().data("mcktypeahead").updater=k):(d.addClass("mck-typeahead"),d.mcktypeahead({source:G,matcher:c,highlighter:w,updater:k}))};a.initSearchAutoType=function(){Wb&&(na.keypress(function(a){if(13===a.which){if(a=na.val())if(a="undefined"!==typeof a&&""!==a?a.toString():"")e.loadTab({tabId:a,isGroup:!1,isSearch:!0}),bb.removeClass("n-vis").addClass("vis");na.val("")}}),qa.keypress(function(a){if(13===a.which)return!0}),b(u).on("click",
".mck-group-search-link",function(a){a.preventDefault();return!0}),b(u).on("click",".mck-contact-search-link",function(a){a.preventDefault();a=na.val();""!==a&&(e.loadTab({tabId:a,isGroup:!1,isSearch:!0}),bb.removeClass("n-vis").addClass("vis"));na.val("")}))};a.removeContact=function(a){b("#li-"+(a.isGroup?"group-"+a.htmlId:"user-"+a.htmlId)).remove()};a.updateContact=function(f,e,c){var d=f.isGroup?"group-"+f.htmlId:"user-"+f.htmlId,G=b("#li-"+d),w=G.data("msg-time");if(e&&e.createdAtTime>w){w=
a.getUnreadCount(e.groupId?"group_"+f.contactId:"user_"+f.contactId);f=a.getMessageTextForContactPreview(e,f,15);b("#li-"+d+" .mck-cont-msg-date").html("undefined"===typeof e.createdAtTime?"":mckDateUtils.getTimeOrDate(e?e.createdAtTime:"",!0));var g=b("#li-"+d+" .mck-cont-msg-wrapper");g.html("");"object"===typeof f?g.append(f):g.html(f);e.conversationId&&(f=e.conversationId,g=Q[f],"object"===typeof g&&(g=g.topicId)&&va&&(g=N[g],"object"===typeof g&&b("#li-"+d+" .mck-conversation-topic").html(g.title)),
b("#li-"+d+" a").data("mck-conversationid",f));0<w&&(b("#li-"+d+" .mck-unread-count-text").html(w),b("#li-"+d+" .mck-unread-count-box").removeClass("n-vis").addClass("vis"));d=b("#"+c+" li:nth-child(1)").data("msg-time");G.data("msg-time",e.createdAtTime);("undefined"===typeof d||(e?e.createdAtTime:"")>=d)&&0!==b("#mck-contact-list li").index(G)&&b("#"+c+" li:nth-child(1)").before(G)}};a.clearContactMessageData=function(a,f){var e=mckContactUtils.formatContactId(a),e=f?"group-"+e:"user-"+e;b("#li-"+
e+" .mck-cont-msg-date").html("");b("#li-"+e+" .mck-cont-msg-wrapper").html("")};a.addContact=function(f,c,d){var G=a.getMessageTextForContactPreview(d,f,100),g=f.userCount,w="",k=!1;if("undefined"!==typeof d){if(d.conversationId)var w=d.conversationId,h=Q[w];d.groupId&&(k=!0)}var O=a.getTabDisplayName(f.contactId,k),q=a.getContactImageLink(f,O),I=!1,z=a.getUnreadCount(k?"group_"+f.contactId:"user_"+f.contactId),B=0<z&&"mck-search-list"!==c?"vis":"n-vis",Ra="n-vis",s=k?"group-"+f.htmlId:"user-"+f.htmlId,
D=k&&zb;b("#li-"+s+" .mck-group-count-text").html(g);b("#li-"+s+" .mck-group-count-box").removeClass("n-vis").addClass("vis");k||ja[f.contactId]||Ba[f.contactId]||!eb||!l.MCK_OL_MAP[f.contactId]||(Ra="vis",I=!0);7===f.type&&1<f.members.length&&(s=mckGroupUtils.getGroup(d.groupId),s=e.getContactFromGroupOfTwo(s),k&&eb&&l.MCK_OL_MAP[s.contactId]&&(Ra="vis",I=!0));g="n-vis";if("object"===typeof h&&va&&(h=N[h.topicId],"object"===typeof h))var g="vis",p=h.title;s=k?"group-"+f.htmlId:"user-"+f.htmlId;f=
[{contHtmlExpr:s,contIdExpr:f.contactId,contTabExpr:k,msgCreatedAtTimeExpr:d?d.createdAtTime:"",mckLauncherExpr:Va,contImgExpr:q,contOlExpr:Ra,onlineLabel:MCK_LABELS.online,contUnreadExpr:B,contUnreadCount:z,contNameExpr:O,conversationExpr:w,contHeaderExpr:g,titleExpr:p,groupUserCountExpr:k?f.userCount:"",displayGroupUserCountExpr:D?"vis":"n-vis",msgCreatedDateExpr:d?mckDateUtils.getTimeOrDate(d.createdAtTime,!0):""}];w=b("#"+c+" li:nth-child(1)").data("msg-time");"undefined"===typeof w||(d?d.createdAtTime:
"")>=w||-1!==c.indexOf("search")&&I?b.tmpl("contactTemplate",f).prependTo("#"+c):b.tmpl("contactTemplate",f).appendTo("#"+c);c=b("#li-"+s+" .msgTextExpr");"object"===typeof G?c.append(G):c.html(G)};a.addContactsToContactSearchList=function(){W.removeClass("vis").addClass("n-vis");la.removeClass("vis").addClass("n-vis");oa.hasClass("active")||(ka.removeClass("active"),oa.addClass("active"));ia.removeClass("vis").addClass("n-vis");ea.removeClass("n-vis").addClass("vis");hb.removeClass("vis").addClass("n-vis");
U.removeClass("n-vis").addClass("vis");ea.html("");ca.removeClass("vis").addClass("n-vis");G.removeClass("vis").addClass("n-vis");Fa.removeClass("vis").addClass("n-vis");ab.removeClass("vis").addClass("n-vis");ha.removeClass("n-vis").addClass("vis");Qa.removeClass("n-vis").addClass("vis");0!==Oa.length?e.addContactsToSearchList():Ab?(Qa.removeClass("vis").addClass("n-vis"),W.removeClass("n-vis").addClass("vis")):V.loadContacts();na.focus()};a.addGroupsToGroupSearchList=function(){var f=[],e=[];W.removeClass("vis").addClass("n-vis");
la.removeClass("vis").addClass("n-vis");da.hasClass("active")||(ka.removeClass("active"),da.addClass("active"));ea.removeClass("vis").addClass("n-vis");ia.removeClass("n-vis").addClass("vis");U.removeClass("vis").addClass("n-vis");hb.removeClass("n-vis").addClass("vis");ia.html("");ca.removeClass("vis").addClass("n-vis");G.removeClass("vis").addClass("n-vis");Fa.removeClass("vis").addClass("n-vis");ab.removeClass("vis").addClass("n-vis");ha.removeClass("n-vis").addClass("vis");Qa.removeClass("n-vis").addClass("vis");
if(0<Na.length){b.each(Na,function(a,b){e.push(b.contactId)});var c=e.filter(function(a,b){return e.indexOf(a)===b});c.sort();b.each(c,function(e,c){if(c){var d=mckGroupUtils.getGroup(""+c);f.push(d);0===b("#li-gs-group-"+d.htmlId).length&&a.addContactForSearchList(d,"mck-group-search-list")}})}else la.removeClass("n-vis").addClass("vis");a.initAutoSuggest({contactsArray:f,$searchId:qa,isContactSearch:!0});Qa.removeClass("vis").addClass("n-vis")};a.addConversationMenu=function(a,f){var e=z.data("mck-id");
Xa.html("");a===e&&(e=Y[a],"undefined"===typeof e||0===e.length||1===e.length?(ga.addClass("n-vis"),k.addClass("mck-product-box-wc"),Xa.addClass("n-vis")):(Xa.removeClass("n-vis"),ga.removeClass("n-vis"),k.removeClass("mck-product-box-wc"),b.each(e,function(e,c){if(0===b("#mck-conversation-list #li-"+c.id).length){var d="";c.topicDetail&&(d=b.parseJSON(c.topicDetail),d="object"===typeof d?d.title:c.topicDetail);d||(d=c.topicId);b.tmpl("convTemplate",[{convIdExpr:c.id,tabIdExpr:a,isGroupExpr:f,topicIdExpr:c.topicId,
convTitleExpr:d,mckLauncherExpr:Va}]).appendTo(Xa)}}),2>b("#mck-conversation-list li").length&&(ga.addClass("n-vis"),k.addClass("mck-product-box-wc"),Xa.addClass("n-vis"))))};a.loadContacts=function(f){"null"!==f+""&&"undefined"!==typeof f&&"undefined"!==typeof f.contacts&&0!==f.contacts.length&&(Oa.length=0,Ka.length=0,b.each(f.contacts,function(b,f){if("undefined"!==typeof f.userId){var e=a.getContact(""+f.userId),e="undefined"===typeof e?a.createContactWithDetail(f):a.updateContactDetail(e,f);
Oa.push(e);Ka.push(e.contactId)}}))};a.getStatusIcon=function(b){return'\x3cspan class\x3d"'+a.getStatusIconName(b)+" move-right "+b.key+'_status status-icon"\x3e\x3c/span\x3e'};a.getStatusIconName=function(a){return 7===a.type||6===a.type||4===a.type||0===a.type?"":5===a.status?"mck-icon-read":4===a.status?"mck-icon-delivered":3===a.type||5===a.type||1===a.type&&(0===a.source||1===a.source)?"mck-icon-sent":""};a.clearMessageField=function(a){s.html("");n.attr("disabled",!1);C.removeClass("vis").removeClass("mck-text-req").addClass("n-vis").attr("required",
"").html("");a?s.focus().select():(h.blur(),s.blur())};a.addDraftMessage=function(a){P=[];a&&"object"===typeof Ja[a]?(a=Ja[a],s.html(a.text),0<a.files.length&&(b.each(a.files,function(a,b){ba.addFileBox(b)}),d.html(a.filelb),D.html(a.filesize),C.removeClass("n-vis").removeClass("mck-text-req").addClass("vis").removeAttr("required"))):P=[]};a.showOfflineMessage=function(){"object"===typeof ra&&ra.innerHTML?(Gb.html(ra.innerHTML),Gb.removeClass("n-vis").addClass("vis")):l.console.log("Offline message innerHTML required.")};
a.hideOfflineMessage=function(){Wa.stopOfflineMessageCounter();Gb.removeClass("vis").addClass("n-vis")};a.removeConversationThread=function(a,f){A.clearMckMessageArray();var c=f?mckGroupUtils.getGroup(a):e.getContact(a),d=z.data("mck-id"),G=z.data("isgroup");"undefined"===typeof d||""===d?(c="undefined"!==typeof c?c.htmlId:mckContactUtils.formatContactId(a),b("#li-"+(f?"group-"+c:"user-"+c)).remove()):d===a&&G===f&&(w.data("datetime",""),E.removeClass("n-vis").addClass("vis"),K.removeClass("n-vis").addClass("vis"),
Ua.removeClass("vis").addClass("n-vis"))};a.removedDeletedMessage=function(a,f,e){A.clearMckMessageArray();a=b("."+a);0<a.length?(a.remove(),z.is(":empty")&&(K.removeClass("n-vis").addClass("vis"),Ua.removeClass("vis").addClass("n-vis"))):"undefined"!==typeof f&&0<b("#mck-contact-list").length&&v.updateContactList(f,e)};a.getMessageTextForContactPreview=function(a,b,f){var c="";if("undefined"!==typeof a){if(a.message)if(2===a.contentType)c='\x3cspan class\x3d"mck-icon-marker"\x3e\x3c/span\x3e';else{c=
a.message;if(mckUtils.startsWith(c,"\x3cimg"))return'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eimage\x3c/span\x3e';null!==l.emoji&&"undefined"!==typeof l.emoji&&(c=l.emoji.replace_unified(c),c=l.emoji.replace_colons(c),c=-1!==c.indexOf("\x3c/span\x3e")?c.substring(0,c.lastIndexOf("\x3c/span\x3e")):c.substring(0,f));b.isGroup||-1!==c.indexOf("emoji-inner")||0!==a.contentType||(f=u.createElement("p"),f.appendChild(u.createTextNode(c)),c=f)}else a.fileMetaKey&&"object"===
typeof a.fileMeta&&(c=e.getFileIcon(a));b.isGroup&&3!==b.type&&7!==b.type&&(b=a.to.split(",")[0]===x?"Me":e.getTabDisplayName(a.to.split(",")[0],!1),10!==a.contentType&&(c=b+": "+c),-1===c.indexOf("emoji-inner")&&a&&a.message&&0===a.contentType&&(f=u.createElement("p"),f.appendChild(u.createTextNode(c)),c=f))}return c};a.getTextForMessagePreview=function(a,f){var c="";if("undefined"!==typeof a){if(2===a.contentType)c="Shared location";else if(a.message)if(c=a.message,mckUtils.startsWith(c,"\x3cimg"))c=
"Image attachment";else{var d=u.createElement("div");d.innerHTML=c;c=b.trim(mckUtils.textVal(d));c=c.substring(0,50)}else a.fileMetaKey&&"object"===typeof a.fileMeta&&(c=-1!==a.fileMeta.contentType.indexOf("image")?"Image attachment":"File attachment");f.isGroup&&3!==f.type&&7!==f.type&&(c=(a.to.split(",")[0]===x?"Me":e.getTabDisplayName(a.to.split(",")[0],!1))+": "+c)}return c};a.getUserIdFromMessage=function(a){a=a.to;a.lastIndexOf(",")===a.length-1&&(a=a.substring(0,a.length-1));return a.split(",")};
a.getUserIdArrayFromMessageList=function(f){var e=[];"undefined"===typeof f.length?e.concat(a.getUserIdFromMessage(f)):b.each(f,function(b,f){"undefined"!==typeof f.to&&(e=e.concat(a.getUserIdFromMessage(f)))});return e};a.messageContextMenu=function(a){var f=b("."+a+" .mck-msg-box");f.addEventListener?f.addEventListener("contextmenu",function(a){a.preventDefault()},!1):f.bind("contextmenu",function(f){f.preventDefault();b(".mck-context-menu").removeClass("vis").addClass("n-vis");b("."+a+" .mck-context-menu").removeClass("n-vis").addClass("vis");
l.event.returnValue=!1})};a.isValidMetaData=function(a){return a.metadata?"HIDDEN"===a.metadata.category||"ARCHIVE"===a.metadata.category?!1:!0:!0};a.updateDraftMessage=function(a,f){if("object"===typeof f){var e={text:"",files:[]},c={fileMeta:f,filelb:ba.getFilePreviewPath(f),filesize:ba.getFilePreviewSize(f.size)};"undefined"!==typeof a&&"object"===typeof Ja[a]&&(e=Ja[a],b.each(e.files,function(a,b){b.filelb===c.filelb&&e.files.splice(a,1)}));e.files.push(c)}Ja[a]=e};a.updateUnreadCount=function(b,
f,e){var c=a.getUnreadCount(b);wa[b]=f;if(e||0<Ea.length)F+=f-c,0>F&&(F=0),0<F?Ea.html(F):Ea.html("")};a.incrementUnreadCount=function(a){F+=1;wa[a]="undefined"===typeof wa[a]?1:wa[a]+1;0<Ea.length&&Ea.html(F)};a.getUnreadCount=function(a){return"undefined"===typeof wa[a]?wa[a]=0:wa[a]};a.isGroupDeleted=function(a,b){if(b){var f=t.getDeletedAtTime(a);return"undefined"!==typeof f&&0<f}return!1};a.getTabDisplayName=function(b,f,e){var c="";if(f)return t.getGroupDisplayName(b);"function"===typeof Ta&&
(c=Ta(b));"undefined"!==typeof e&&e&&(c=e,sa[b]=e);c||(c=a.getContactDisplayName(b));f=a.fetchContact(""+b);c?(f.displayName=c,pa[f.contactId]=f):"undefined"!==typeof f.displayName&&(c=f.displayName);c||(c=b);return c};a.populateMessage=function(a,f,c){var d=mckDateUtils.convertMilisIntoTime(f.metadata.CALL_DURATION);V.loadUserProfile(f.to);103==f.contentType&&(4==f.type&&"CALL_REJECTED"==f.metadata.MSG_TYPE?f.message="you rejected a Video call from "+f.to:5==f.type&&"CALL_REJECTED"==f.metadata.MSG_TYPE?
f.message=f.to+"rejected a Video call from you":4==f.type&&"CALL_END"==f.metadata.MSG_TYPE?f.message="you were in a call with "+f.to+"\n call duration : "+d:5==f.type&&"CALL_END"==f.metadata.MSG_TYPE?f.message="you were in a call with "+f.to+"\n call duration : "+d:4==f.type&&"CALL_MISSED"==f.metadata.MSG_TYPE?f.message="you missed a Video call from "+f.to:5==f.type&&"CALL_MISSED"==f.metadata.MSG_TYPE&&(f.message=f.to+"missed a Video call from you"));var G=z.data("mck-id"),g=e.isValidMetaData(f),
d=f.groupId?mckGroupUtils.getGroup(f.groupId):e.getContact(f.to);if("undefined"===typeof G||""===G){var w=b("#mck-contact-list").length;0<w&&g?f.groupId?e.addGroupFromMessage(f,!0):e.addContactsFromMessage(f,!0):e.addContactsFromMessageList({message:[f]},"");if("APPLOZIC_01"===a||"MESSAGE_RECEIVED"===a){"undefined"===typeof d&&(d=f.groupId?mckGroupUtils.createGroup(f.groupId):e.createContact(f.to));if(fb){e.loadTab({tabId:d.contactId,isGroup:d.isGroup,conversationId:f.conversationId});return}a=f.groupId?
"group_"+d.contactId:"user_"+d.contactId;g&&(10!==f.contentType&&102!==f.contentType&&e.incrementUnreadCount(a),$a.notifyUser(f));c=f.groupId?"group-"+d.htmlId:"user-"+d.htmlId;b("#li-"+c+" .mck-unread-count-text").html(e.getUnreadCount(a));0<e.getUnreadCount(a)&&b("#li-"+c+" .mck-unread-count-box").removeClass("n-vis").addClass("vis");v.sendDeliveryUpdate(f)}}else if("undefined"===typeof d&&(d=f.groupId?mckGroupUtils.createGroup(f.groupId):e.createContact(f.to)),"APPLOZIC_01"===a||"MESSAGE_RECEIVED"===
a){if("undefined"!==typeof d&&(a=z.data("isgroup"),("undefined"===typeof f.oldKey||0===b("."+f.oldKey).length)&&0===b("."+f.key).length||10===f.contentType)){if("undefined"===typeof G||G!==d.contactId||a!==d.isGroup||Fa.hasClass("vis")){if(fb){e.loadTab({tabId:d.contactId,isGroup:d.isGroup,conversationId:f.conversationId});return}if(g&&10!==f.contentType||102!==f.contentType)a=f.groupId?"group_"+d.contactId:"user_"+d.contactId,e.incrementUnreadCount(a);v.sendDeliveryUpdate(f)}else{g=!0;a&&6===d.type&&
(g=t.isAppendOpenGroupContextMenu(d));if(f.conversationId&&(va||Ia))if((a=z.data("mck-conversationid"))&&a.toString()===f.conversationId.toString())f.metadata&&"HIDDEN"===f.metadata.category||e.addMessage(f,d,!0,!0,g),v.sendReadUpdate(f.pairedMessageKey);else{if(fb){e.loadTab({tabId:d.contactId,isGroup:d.isGroup,conversationId:f.conversationId});return}}else 7===d.type&&(a=mckGroupUtils.getGroup(f.groupId),a=e.getContactFromGroupOfTwo(a),S.lastSeenOfGroupOfTwo(a.contactId),e.addMessage(f,d,!0,!0,
g)),(!f.metadata||"HIDDEN"!==f.metadata.category&&7!==d.type)&&e.addMessage(f,d,!0,!0,g),v.sendReadUpdate(f.pairedMessageKey);f.groupId||(b("#mck-tab-status").html(MCK_LABELS.online),S.updateUserStatus({userId:f.to,status:1}))}c&&6!==d.type&&$a.notifyUser(f)}}else"APPLOZIC_02"!==a||102!=!f.contentType||("undefined"!==typeof f.oldKey&&0!==b("."+f.oldKey).length||0!==b("."+f.key).length)&&10!==f.contentType||(0<w?e.addContactsFromMessage(f,!0):"undefined"!==typeof d&&(a=z.data("isgroup"),"undefined"!==
typeof G&&G===d.contactId&&a===d.isGroup&&(g=!0,a&&6===d.type&&(g=t.isAppendOpenGroupContextMenu(d)),f.metadata&&"HIDDEN"===f.metadata.category||e.addMessage(f,d,!0,!0,g),3===f.type&&(b("."+f.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),e.addTooltip(f.key)))));ua.removeClass("vis").addClass("n-vis")};a.getMessageFeed=function(a){var f={};f.key=a.key;f.timeStamp=a.createdAtTime;f.message=a.message;f.from=4===a.type?a.to:x;f.to=a.groupId?a.groupId:5===a.type?a.to:
x;f.status="read";f.type=4===a.type?"inbox":"outbox";5===a.type&&(3===a.status?f.status="sent":4===a.status&&(f.status="delivered"));if("object"===typeof a.fileMeta){var c=b.extend({},a.fileMeta);if("undefined"===typeof c.url||""===c.url)c.url=Ca+"/rest/ws/aws/file/"+a.fileMeta.blobKey;delete c.blobKey;f.file=c}f.source=a.source;f.metadata=a.metadata;return f};a.updateUnreadCountonChatIcon=function(a){if(Bb&&0<a.length){var f=null,c=0;0<a.length&&(b.each(a,function(a,b){!(0<b.unreadCount&&null!==
f)&&0<b.unreadCount&&(f=b.userId,c=b.unreadCount)}),0<F&&"none"===p.css("display")&&(null!==f&&c===F?e.loadTab({tabId:f,isGroup:!1}):e.loadTab({tabId:"",isGroup:!1})))}};a.loadMessageListOnUserDetailFetch=function(a){ua.removeClass("vis").addClass("n-vis");var f=z.data("mck-id"),c=z.data("isgroup");if("undefined"===typeof f||a.tabId===f&&""+c===""+a.isGroup)f=mckGroupUtils.getGroup(a.tabId),t.addGroupStatus(f),c=6===f.type?!1:!0,c=!0,6===f.type&&(t.validateOpenGroupUser(f),c=t.isAppendOpenGroupContextMenu(f)),
a.isMessages?(E.removeClass("vis").addClass("n-vis"),e.processMessageList(a.messageData,!0,c),6!==f.type&&Ua.removeClass("n-vis").addClass("vis"),"function"===typeof Sa&&Sa(a.tabId)):0===b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&(Ua.removeClass("vis").addClass("n-vis"),E.removeClass("n-vis").addClass("vis"))}},v=new function(){var a=this,c=b("#mck-search"),h=b("#mck-msg-to"),B=b("#mck-msg-new");b("#mck-audio");b("#mck-mike-btn");var d=b("#mck-sidebox"),D=b("#mck-file-box"),
p=b("#mck-text-box"),C=b("#mck-msg-form"),n=b("#mck-msg-sbmt"),y=b("#mck-new-group"),s=b("#mck-tab-title"),aa=b("#mck-msg-error"),xa=b("#mck-btn-attach"),Pa=b("#mck-tab-status"),F=b("#mck-message-cell"),J=b(".mck-typing-box"),E=b("#mck-gms-loading"),k=b("#mck-group-title"),M=b("#mck-contact-loading"),I=b("#mck-no-messages"),q=b(".mck-group-search"),ga=b("#mck-msg-response"),U=b("#mck-msg-form input"),Z=b("#mck-block-button"),ca=b("#li-mck-block-user"),da=b("#li-mck-group-info"),Ha=b("#li-mck-video-call"),
ea=b("#mck_response_text"),fa=b(".mck-contact-search"),la=b("#mck-group-info-tab"),W=b("#mck-price-text-box");b("#mck-sidebox-search");var oa=b("#mck-group-info-btn"),la=b("#mck-group-info-tab"),R=b("#mck-btn-group-exit"),ma=b("#mck-group-back-link"),ra=b("#mck-btn-leave-group"),ba=b(".mck-sidebox-content"),ka=b("#mck-no-more-messages"),sa=b("#mck-btn-group-create");b("#mck-group-create-tab");var Ca=b("#mck-group-add-member");b("#mck-contacts-content");var na=b("#mck-tab-option-panel"),wa=b("#mck-no-conversations"),
Ga=b("#mck-group-create-title"),ya=b(".mck-group-menu-options"),ha=b(".mck-tab-message-option"),za=b(".mck-group-admin-options"),pa=b("#mck-group-member-search"),r=b("#mck-message-cell .mck-message-inner");b("#mck-search-cell .mck-message-inner");var ta=b("#mck-no-more-conversations"),Ea=b("#mck-gm-search-box"),La=b("#mck-group-member-search-list"),Ta=b("#mck-no-gsm-text");b.template("oflTemplate",'\x3cdiv id\x3d"mck-ofl-blk" class\x3d"mck-m-b"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-light mck-text-muted mck-test-center"\x3e${userIdExpr} is offline now\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e');
var Qa,Ma=b("#mck-minutes"),Na=b("#mck-seconds");a.timer=function(){var a=0,b=this;Qa=setInterval(function(){++a;Na.html(b.pad(a%60));Ma.html(b.pad(parseInt(a/60)))},1E3);b.pad=function(a){a+="";return 2>a.length?"0"+a:a}};a.stoptimer=function(){Na.html("0");Ma.html("0");clearInterval(Qa)};b(u).on("click",".mck-message-delete",function(){a.deleteMessage(b(this).parents(".mck-m-b").data("msgkey"))});b(u).on("click",".mck-message-reply",function(){a.replyMessage(b(this).parents(".mck-m-b").data("msgkey"))});
b(u).on("click",".mck-message-forward",function(){B.data("forwardMessageKey",b(this).parents(".mck-m-b").data("msgkey"));B.trigger("click")});b(".mck-minimize-icon").click(function(){b(".mck-box-md,.mck-box-ft").animate({height:"toggle"});ba.hasClass("minimized")?(ba.css("height","100%"),ba.removeClass("minimized")):(ba.css("height","0%"),ba.addClass("minimized"))});a.init=function(){A.clearMckMessageArray();b(u).on("click","."+Va,function(){b(this).hasClass("mck-msg-preview")&&b(this).hide()});e.initSearchAutoType();
fa.click(function(){e.addContactsToContactSearchList()});q.click(function(){e.addGroupsToGroupSearchList()});p.keydown(function(a){p.hasClass("mck-text-req")&&p.removeClass("mck-text-req");if(13===a.keyCode&&(a.shiftKey||a.ctrlKey)){if(a.preventDefault(),l.getSelection){a=l.getSelection();var b=a.getRangeAt(0),c=u.createElement("br"),e=u.createTextNode("\u00a0");b.deleteContents();b.insertNode(c);b.collapse(!1);b.insertNode(e);b.selectNodeContents(e);a.removeAllRanges();a.addRange(b);p.animate({scrollTop:p.prop("scrollHeight")},
0);return!1}}else 13===a.keyCode?(a.preventDefault(),1===ia&&X.sendTypingStatus(0,r.data("mck-id")),n.is(":disabled")&&D.hasClass("vis")?alert("Please wait file is uploading."):C.submit()):0===ia&&X.sendTypingStatus(1,r.data("mck-id"))});b(u).on("click",".mck-btn-clear-messages",function(){confirm(MCK_LABELS["clear.messages.alert"])&&v.deleteConversation()});b(u).on("click",".applozic-tm-launcher",function(a){a.preventDefault();var c=b(this).data("mck-id"),c="undefined"!==typeof c&&""!==c?c.toString():
"",d=b(this).data("mck-name"),d="undefined"!==typeof d&&""!==d?d.toString():"";a=b(this).data("mck-supportid");a="undefined"!==typeof a&&""!==a?a.toString():"";var g=b(this).data("mck-topicid"),g="undefined"!==typeof g&&""!==g?g.toString():"",k=b(this).data("mck-msg"),k="undefined"!==typeof k&&""!==k?k.toString():"";if("function"===typeof Da&&g){var h=Da(g);"object"===typeof h&&"undefined"!==h.title&&(N[g]=h)}c={topicId:g,tabId:c,userName:d,isMessage:!0};c.messagePxy={type:5,contentType:0,message:k};
a?(c.isGroup=!0,c.supportId=a,v.getConversationId(c)):(c.isGroup=!1,e.loadTab(c,v.dispatchMessage))});b(u).on("click",".applozic-wt-launcher",function(a){a.preventDefault();a=b(this).data("mck-id");a="undefined"!==typeof a&&""!==a?a.toString():"";var c=b(this).data("mck-name"),c="undefined"!==typeof c&&""!==c?c.toString():"",e=b(this).data("mck-topicid"),e="undefined"!==typeof e&&""!==e?e.toString():"",d=b(this).data("mck-topic-status"),d=d?-1===K.indexOf(d)?K[0]:d.toString():K[0];if("function"===
typeof Da){var g=Da(e);"object"===typeof g&&"undefined"!==g.title&&(N[e]=g)}v.getConversationId({tabId:a,isGroup:!1,userName:c,topicId:e,topicStatus:d,isMessage:!1})});b(u).on("click",".applozic-ct-launcher",function(a){a.preventDefault();var c=b(this).data("mck-id"),c="undefined"!==typeof c&&""!==c?c.toString():"",e=b(this).data("mck-name"),e="undefined"!==typeof e&&""!==e?e.toString():"";a=b(this).data("mck-topicid");a="undefined"!==typeof a&&""!==a?a.toString():"";var d=b(this).data("mck-topic-status"),
d=d?-1===K.indexOf(d)?K[0]:d.toString():K[0],c={tabId:c,isGroup:!1,userName:e,topicId:a,topicStatus:d,isMessage:!1};"function"===typeof yb&&(e=yb(a),"object"===typeof e&&(e.topicDetail&&"object"===typeof e.topicDetail&&"undefined"!==e.topicDetail.title&&(N[a]=e.topicDetail),e.fallBackTemplatesList&&0<e.fallBackTemplatesList.length&&(c.fallBackTemplatesList=e.fallBackTemplatesList)));v.getConversationId(c)});b(u).on("click","."+Va+", .mck-contact-list ."+Va,function(f){f.preventDefault();var e=this;
b(this).parents(".mck-search-list").length?(c.bind("blur"),setTimeout(function(){a.openChat(e)},600)):a.openChat(this)});b(u).on("click",".mck-conversation-tab-link",function(a){a.preventDefault();b(this);a=r.data("mck-id");var c=r.data("isgroup");e.loadTab({tabId:"",isGroup:!1,lastActiveTabId:a,isLastActiveTabGroup:c})});b(u).on("click",".mck-close-sidebox",function(a){a.preventDefault();d.mckModal("hide");a=r.data("mck-conversationid");r.data("mck-id","");r.data("mck-topicid","");r.data("mck-name",
"");r.data("mck-conversationid","");a&&(a=Q[a],"object"===typeof a&&(a=a.topicId,"function"===typeof sb&&sb(x,a)));X.unsubscibeToTypingChannel()});b(u).on("click",".mck-price-submit",function(b){b.preventDefault();a.sendPriceMessage()});W.keydown(function(b){13===b.keyCode&&a.sendPriceMessage()});r.bind("scroll",function(){if(0<r.find(".mck-contact-list").length){if(r.scrollTop()+r.innerHeight()>=r[0].scrollHeight){var a=r.data("datetime");0<a&&!Aa&&v.loadMessageList({tabId:"",isGroup:!1,startTime:a})}}else if(0===
r.scrollTop()){var b=r.data("mck-id");if("undefined"!==typeof b&&""!==b){var c=r.data("isgroup"),e=r.data("mck-conversationid"),e=e?e.toString():"",a=na.data("datetime");0<a&&!Aa&&v.loadMessageList({tabId:b,isGroup:c,conversationId:e,startTime:a})}}});W.on("click",function(a){a.preventDefault();W.removeClass("mck-text-req")});Z.on("click",function(a){a.preventDefault();a=r.data("mck-id");var b=r.data("isgroup"),c=!r.data("blocked");b?(ca.removeClass("vis").addClass("n-vis"),Ha.removeClass("vis").addClass("n-vis")):
confirm(c?MCK_LABELS["block.user.alert"]:MCK_LABELS["unblock.user.alert"])&&V.blockUser(a,c)});ra.on("click",function(a){a.preventDefault();a=r.data("mck-id");r.data("isgroup")?confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({apzCallback:t.onGroupLeft,groupId:a}):ya.removeClass("vis").addClass("n-vis")});b(u).on("click",".mck-add-to-group",function(a){a.preventDefault();a=b(this).data("mck-id");"undefined"!==typeof a&&t.addGroupMemberFromSearch(a);Ea.mckModal("hide")});b(u).on("click",
".mck-btn-remove-member",function(a){a.preventDefault();a=b(this).parents(".mck-li-group-member").data("mck-id");var c=la.data("mck-id");if("undefined"!==typeof c&&"undefined"!==typeof a){var e=mckGroupUtils.getGroup(c);"object"===typeof e&&x===e.adminName?confirm(MCK_LABELS["remove.member.alert"])&&mckGroupService.removeGroupMember({groupId:c,userId:a,apzCallback:t.onRemovedGroupMember}):za.removeClass("vis").addClass("n-vis")}});R.on("click",function(a){a.preventDefault();(a=la.data("mck-id"))?
confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({groupId:a,apzCallback:t.onGroupLeft}):e.loadTab({tabId:"",isGroup:!1})});oa.on("click",function(a){a.preventDefault();a=r.data("mck-id");if(r.data("isgroup")){a={groupId:a};var b=r.data("mck-conversationid");b&&(a.conversationId=b);t.loadGroupInfo(a)}else ya.removeClass("vis").addClass("n-vis")});y.on("click",function(a){a.preventDefault();t.loadCreateGroupTab()});ma.on("click",function(a){a.preventDefault();var b=la.data("mck-id");
a=la.data("mck-conversation-id");b?(b={tabId:b,isGroup:!0},a&&(b.conversationId=a),e.loadTab(b)):e.loadTab({tabId:"",isGroup:!1})});Ca.on("click",function(a){a.preventDefault();if(a=la.data("mck-id"))(a=mckGroupUtils.getGroup(a))&&a.adminName===x?(La.html(""),Ea.mckModal(),E.removeClass("n-vis").addClass("vis"),0<Ka.length?t.addMembersToGroupSearchList():Ab?0<Oa.length?(b.each(Oa,function(a,b){Ka.push(b.contactId)}),t.addMembersToGroupSearchList()):(E.removeClass("vis").addClass("n-vis"),Ta.removeClass("n-vis").addClass("vis")):
V.getUserStatus({callback:t.addMembersToGroupSearchList})):za.removeClass("vis").addClass("n-vis")});pa.keypress(function(a){if(13===a.which)return a=pa.val(),""!==a&&t.addGroupMemberFromSearch(a),pa.val(""),!0});b(u).on("click",".mck-group-member-search-link",function(a){a.preventDefault();a=pa.val();""!==a&&t.addGroupMemberFromSearch(a);pa.val("")});b(u).on("click",".mck-show-more",function(a){a.preventDefault();var c=b(this);a=c.data("tabId");var e=r.data("isgroup"),d=r.data("mck-conversationid"),
d=d?d.toString():"",c=c.data("datetime");v.loadMessageList({tabId:a,isGroup:e,conversationId:d,startTime:c})});b(u).on("click",".mck-accept",function(a){a=b(this).data("mck-conversationid");var c=b(this).data("mck-topic-price");if("function"===typeof ua&&c&&a){var e=Q[a],d=h.val(),d=t.getGroupDisplayName(d);"object"===typeof e?(ua({custId:x,suppId:d,productId:e.topicId,price:c}),v.sendConversationCloseUpdate(a)):v.getTopicId({conversationId:a,suppId:d,priceText:c})}});C.submit(function(){1===ia&&
X.sendTypingStatus(0,r.data("mck-id"));var f=b.trim(mckUtils.textVal(p[0]));D.hasClass("n-vis")&&0<P.length&&(P=[]);if(0===f.length&&0===P.length)return p.addClass("mck-text-req"),!1;if("function"===typeof wb&&!wb(f))return!1;var f={type:5,contentType:0,message:f},c=r.data("mck-conversationid"),e=r.data("mck-topicid");c?f.conversationId=c:e&&(c={topicId:e},e=N[e],"object"===typeof e&&(c.topicDetail=l.JSON.stringify(e)),f.conversationPxy=c);!0===r.data("isgroup")?f.groupId=h.val():f.to=h.val();n.attr("disabled",
!0);aa.removeClass("vis").addClass("n-vis");aa.html("");ea.html("");ga.removeClass("vis").addClass("n-vis");a.sendMessage(f);return!1});U.on("click",function(){b(this).val("");aa.removeClass("vis").addClass("n-vis");ga.removeClass("vis").addClass("n-vis")});b(u).bind("click",function(a){b(".mck-context-menu").removeClass("vis").addClass("n-vis");!xa.hasClass("on")||b(a.target).hasClass("mck-icon-upload")||b(a.target).hasClass("mck-btn-attach")||Cb.fileMenuToggle();p.removeClass("mck-text-req");u.activeElement&&
u.activeElement!==p&&1===ia&&X.sendTypingStatus(0,r.data("mck-id"));u.activeElement&&"mck-group-name-save"!==u.activeElement.id&&k.removeClass("mck-req-border");u.activeElement&&"mck-btn-group-create"!==u.activeElement.id&&Ga.removeClass("mck-req-border");b(".mcktypeahead.mck-dropdown-menu").hide()});b(".mck-tabview-item").click(function(){b(".mck-tabview-item").removeClass("active");b(this).addClass("active")})};b(".mck-sidebox").on("click","#mck-mike-btn",function(){b(this).removeClass("vis").addClass("n-vis");
$(".mck-stop-btn").addClass("vis").removeClass("n-vis");Fr.voice.record(!1,function(){$("#mck-audio").removeClass("n-vis").addClass("vis");v.timer()})});b(".mck-sidebox").on("click","#mck-stop-recording",function(){$("#mck-mike-btn").addClass("vis").removeClass("n-vis");$(".mck-stop-btn").addClass("n-vis").removeClass("vis");$("#mck-audio").removeClass("vis").addClass("n-vis");v.stoptimer();Fr.voice.export(function(a){var c={};c.file=a;c.name="blob";b.fn.applozic("audioAttach",c)},"blob");Fr.voice.stop()});
a.openChat=function(a){var d=b(a);a=d.data("mck-id");a="undefined"!==typeof a&&""!==a?a.toString():"";var k=d.data("mck-name"),k="undefined"!==typeof k&&""!==k?k.toString():"",h=d.data("mck-topicid"),h="undefined"!==typeof h&&""!==h?h.toString():"",l=!0===d.data("isgroup"),d=d.data("mck-conversationid"),d="undefined"!==typeof d&&""!==d?d.toString():"";h&&!d?(d=(d=b(elem).data("mck-topic-status"))?-1===K.indexOf(d)?K[0]:d.toString():K[0],v.getConversationId({tabId:a,isGroup:l,userName:k,topicId:h,
topicStatus:d,isMessage:!1})):e.loadTab({tabId:a,isGroup:l,userName:k,conversationId:d,topicId:h});c.val("")};a.sendMessage=function(f){if("object"===typeof f){var c=f.metadata?f.metadata:{},d=b("#mck-text-box").data("AL_REPLY");"undefined"===typeof d||""===d||f.forward||(c.AL_REPLY=d);f.metadata=c;if("undefined"!==typeof f.message&&0!==f.message.length||0!==P.length){if(f.conversationId&&(c=Q[f.conversationId],"undefined"!==c&&c.closed)){e.closeConversation();n.attr("disabled",!1);return}if(r.data("blocked"))S.toggleBlockUser(k,
!0),n.attr("disabled",!1);else{var g="";f.groupId?(g=mckGroupUtils.getGroup(f.groupId),"undefined"===typeof g&&(g=mckGroupUtils.createGroup(f.groupId))):g=f.clientGroupId?mckGroupUtils.getGroupByClientGroupId(f.clientGroupId):e.fetchContact(f.to);0<b("#mck-message-cell .mck-no-data-text").length&&b(".mck-no-data-text").remove();if(f.message&&0===P.length){var c=ha.hasClass("n-vis"),k=r.data("mck-id"),h=mckUtils.randomId();f.key=h;12!==f.contentType&&k&&k.toString()===g.contactId&&102!==f.contentType&&
a.addMessageToTab(f,g);a.submitMessage(f,{tabId:g.contactId,isTopPanelAdded:c})}else 0<P.length&&b.each(P,function(b,c){var e=ha.hasClass("n-vis"),d=r.data("mck-id"),k=mckUtils.randomId();f.key=k;f.fileMeta=c;f.contentType=1;12!==f.contentType&&d&&d.toString()===g.contactId&&a.addMessageToTab(f,g);a.submitMessage(f,{tabId:g.contactId,isTopPanelAdded:e})});p.removeClass("mck-text-req");n.attr("disabled",!1);b("."+h+" .mck-message-status").removeClass("mck-icon-sent").addClass("mck-icon-time");e.addTooltip(h);
e.clearMessageField(!0);P=[];delete Ja[g.contactId]}}else p.addClass("mck-text-req")}};a.addMessageToTab=function(a,b){var c={to:a.to,groupId:a.groupId,deviceKey:a.deviceKey,contentType:a.contentType,message:a.message,conversationId:a.conversationId,topicId:a.topicId,sendToDevice:!0,createdAtTime:(new Date).getTime(),key:a.key,storeOnDevice:!0,sent:!1,read:!0,metadata:a.metadata?a.metadata:""};c.type=a.type?a.type:5;a.fileMeta&&(c.fileMeta=a.fileMeta);e.addMessage(c,b,!0,!0,!1)};a.sendForwardMessage=
function(b){var c=A.getMessageByKey(b);if("undefined"!==typeof c){c.fileMeta&&P.push(c.fileMeta);b={type:5,contentType:c.contentType,message:c.message,forward:"forward"};c.metadata&&(c.metadata.AL_REPLY&&(c.metadata.AL_REPLY=""),b.metadata=c.metadata);var e=r.data("mck-conversationid"),c=r.data("mck-topicid");e?b.conversationId=e:c&&(e={topicId:c},c=N[c],"object"===typeof c&&(e.topicDetail=l.JSON.stringify(c)),b.conversationPxy=e);!0===r.data("isgroup")?b.groupId=h.val():b.to=h.val();a.sendMessage(b)}};
a.sendWelcomeMessage=function(b){var c=mckUtils.randomId(),d=r.data("mck-id"),g=r.data("isgroup"),c={key:c,type:4,contentType:0,to:b.sender,message:b.messageContent};d&&d.toString()===b.sender&&!g&&(d=e.fetchContact(d),a.addMessageToTab(c,d));mckUtils.ajax({type:"GET",url:MCK_BASE_URL+"/rest/ws/message/add/inbox",global:!1,data:"sender\x3d"+encodeURIComponent(b.sender)+"\x26messageContent\x3d"+encodeURIComponent(b.messageContent),contentType:"text/plain",success:function(a){b.callback&&b.callback(a)}})};
a.submitMessage=function(a,c){var d=a.key,g=a.metadata?a.metadata:{};Qb&&(a.metadata={userStatus:4});var k=b("#mck-text-box").data("AL_REPLY");"undefined"===typeof k||""===k||a.forward||(g.AL_REPLY=k,b("#mck-text-box").data("AL_REPLY",""));a.source=ec;var h=b("#mck-message-cell .mck-message-inner div[name\x3d'message']."+d);102!=a.contentType&&103!=a.contentType&&(a.metadata=Pb);a.metadata=g;mckUtils.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/send",global:!1,data:l.JSON.stringify(a),contentType:"application/json",
success:function(g){var k=r.data("mck-id");if("object"===typeof g){var l=g.messageKey;if(k&&k.toString()===c.tabId){var q=g.conversationId;r.data("mck-conversationid",q);h.removeClass(d).addClass(l);h.data("msgkey",l);b("."+l+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent").attr("title","sent");e.addTooltip(l);c.isTopPanelAdded&&na.data("datetime",g.createdAt);g=!0;a.groupId&&6===mckGroupUtils.getGroup(a.groupId).type&&(g=!1);g&&e.messageContextMenu(l)}a.conversationPxy&&
(l=a.conversationPxy,a.topicId&&(qa[a.topicId]=[q]),Q[q]=l)}else"CONVERSATION_CLOSED"===g||"BUSY_WITH_OTHER"===g?(n.attr("disabled",!1),e.closeConversation(g),h.remove(),c.isTopPanelAdded&&ha.removeClass("vis").addClass("n-vis")):"error"===g&&(n.attr("disabled",!1),aa.html("Unable to process your request. Please try again"),aa.removeClass("n-vis").addClass("vis"),h.remove(),c.isTopPanelAdded&&ha.removeClass("vis").addClass("n-vis"));q=e.getTabDisplayName(k,!1);H[k]||k===q||(V.updateDisplayName(k,
q),k={userId:k,userName:q},H[k.userId]=k)},error:function(){aa.html("Unable to process your request. Please try again.");aa.removeClass("n-vis").addClass("vis");h&&h.remove();c.isTopPanelAdded&&ha.removeClass("vis").addClass("n-vis")}});$("#mck-reply-to-div").removeClass("vis").addClass("n-vis")};a.downloadImage=function(a){window.open(a,"_blank")};a.replyMessage=function(a){var c="";r.data("mck-id");var d=v.getReplyMessageByKey(a);p.focus().select();$("#mck-reply-to-div").removeClass("n-vis").addClass("vis");
c=5===d.type?"You":e.getTabDisplayName(d.to,!1);$("#mck-reply-to").html(c);"object"===typeof d.fileMeta||2===d.contentType?$("#mck-reply-msg").html(e.getImageForMessagePreview(d)):$("#mck-reply-msg").html(d.message);b("#mck-text-box").data("AL_REPLY",a)};$("#close").click(function(){$("#mck-reply-to-div").removeClass("vis").addClass("n-vis");b("#mck-text-box").data("AL_REPLY","")});a.deleteMessage=function(a){var c=r.data("mck-id");"undefined"!==typeof c&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/delete?key\x3d"+
a,type:"get",success:function(e){"success"===e?(r.data("mck-id")===c&&(b("."+a).remove(),r.is(":empty")&&ha.removeClass("vis").addClass("n-vis")),A.clearMckMessageArray()):l.console.log("Unable to delete message. Please reload page.")}})};a.deleteConversation=function(){var a=r.data("mck-id"),b=r.data("isgroup"),c=r.data("mck-conversationid");"undefined"!==typeof a&&(b=b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a),c&&(b+="\x26conversationId\x3d"+c),Aa=!0,mckUtils.ajax({type:"get",url:MCK_BASE_URL+
"/rest/ws/message/delete/conversation",global:!1,data:b,success:function(){r.data("mck-id")===a&&(r.html(""),na.data("datetime",""),F.removeClass("n-vis").addClass("vis"),I.removeClass("n-vis").addClass("vis"),ha.removeClass("vis").addClass("n-vis"),Aa=!1)},error:function(){}}))};a.getMessages=function(a){var b="";"undefined"!==typeof a.userId&&""!==a.userId?(b=a.isGroup?"\x26groupId\x3d"+a.userId:"\x26userId\x3d"+encodeURIComponent(a.userId),a.startTime&&(b+="\x26endTime\x3d"+a.startTime),b+="\x26pageSize\x3d30",
(va||Ia)&&a.conversationId&&(b+="\x26conversationId\x3d"+a.conversationId,"undefined"===typeof Y[a.userId]&&(b+="\x26conversationReq\x3dtrue"))):(a.startTime&&(b+="\x26endTime\x3d"+a.startTime),b+="\x26mainPageSize\x3d100");var c={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+b,type:"get",success:function(b){c.status="success";c.data=b;a.callback&&a.callback(c)},error:function(b,e,d){401===b.status&&(sessionStorage.clear(),console.log("Please reload page."));c.status="error";
a.callback&&a.callback(c)}})};a.getMessageList=function(a){var c=a.id;if("undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId){var d=a.pageSize?"\x26pageSize\x3d"+a.pageSize:"\x26pageSize\x3d50",d=d+("\x26clientGroupId\x3d"+a.clientGroupId);a.startTime&&(d+="\x26endTime\x3d"+a.startTime);var g={clientGroupId:a.clientGroupId}}else"undefined"!==typeof c&&""!==c?(d=a.pageSize?"\x26pageSize\x3d"+a.pageSize:"\x26pageSize\x3d50",d+="true"===""+a.isGroup?"\x26groupId\x3d"+c:"\x26userId\x3d"+c,a.startTime&&
(d+="\x26endTime\x3d"+a.startTime),g={id:c}):(d=a.pageSize?"\x26mainPageSize\x3d"+a.pageSize:"\x26mainPageSize\x3d50",a.startTime&&(d+="\x26endTime\x3d"+a.startTime),g={id:""});a.topicId&&(c||a.clientGroupId)&&(a.conversationId&&(d+="\x26conversationId\x3d"+a.conversationId),a.topicId&&(g.topicId=a.topicId));mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+d,type:"get",global:!1,success:function(c){g.status="success";if("undefined"===typeof c.message||0===c.message.length)g.messages=
[];else{var d=[];b.each(c.message,function(a,b){if("undefined"!==typeof b.to||"undefined"!==typeof b.groupId){var f=e.getMessageFeed(b);d.push(f)}});g.messages=d}0<c.groupFeeds.length&&(g.id=c.groupFeeds[0].id);a.callback(g)},error:function(b,c,e){401===b.status&&(sessionStorage.clear(),console.log("Please reload page."));g.status="error";a.callback(g)}})};a.getReplyMessageByKey=function(a){"undefined"===typeof A.getMessageByKey(a)&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/detail",async:!1,
type:"get",data:"keys\x3d"+a,success:function(a){A.updateMckMessageArray(a)}});return A.getMessageByKey(a)};a.loadMessageList=function(a,c){var d=!1,g=!1,k="";"undefined"!==typeof a.tabId&&""!==a.tabId?(k=a.isGroup?"\x26groupId\x3d"+a.tabId:"\x26userId\x3d"+encodeURIComponent(a.tabId),d=!0,a.startTime&&(k+="\x26endTime\x3d"+a.startTime),k+="\x26pageSize\x3d30",(va||Ia)&&a.conversationId&&(k+="\x26conversationId\x3d"+a.conversationId,"undefined"===typeof Y[a.tabId]?(g=!0,k+="\x26conversationReq\x3dtrue"):
e.addConversationMenu(a.tabId,a.isGroup))):(Aa=!0,a.startTime&&(k+="\x26endTime\x3d"+a.startTime),k+="\x26mainPageSize\x3d60");a.startTime||r.html("");M.removeClass("n-vis").addClass("vis");mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+k,type:"get",global:!1,success:function(k){var h=!0,q=r.data("mck-id"),D=r.data("isgroup");a.isGroup&&!a.startTime||M.removeClass("vis").addClass("n-vis");Aa=!1;if("undefined"===typeof q||a.tabId===q&&""+D===""+a.isGroup){if("null"===k+""||
"undefined"===typeof k.message||0===k.message.length)h=!1,d?a.startTime?(ka.removeClass("n-vis").addClass("vis"),ka.fadeOut(5E3,function(){ka.removeClass("vis").addClass("n-vis")}),na.data("datetime","")):a.isGroup||0!==b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length||(ha.removeClass("vis").addClass("n-vis"),wa.removeClass("vis").addClass("n-vis"),I.removeClass("n-vis").addClass("vis")):(I.removeClass("vis").addClass("n-vis"),a.startTime?(ta.removeClass("n-vis").addClass("vis"),
ta.fadeOut(5E3,function(){ta.removeClass("vis").addClass("n-vis")})):(I.removeClass("vis").addClass("n-vis"),wa.removeClass("n-vis").addClass("vis")),r.data("datetime",""));if("null"!==k+""&&"error"!==k.status)if(d){h&&(0<a.startTime?e.processMessageList(k,!1,!0):a.isGroup||(e.processMessageList(k,!0,!0),ha.removeClass("n-vis").addClass("vis")));0<!a.startTime&&!a.isGroup&&"function"===typeof Sa&&Sa(a.tabId);0<k.userDetails.length&&b.each(k.userDetails,function(b,c){H[c.userId]=c;if(!a.isGroup&&(c.connected?
l.MCK_OL_MAP[c.userId]=!0:(l.MCK_OL_MAP[c.userId]=!1,"undefined"!==typeof c.lastSeenAtTime&&(T[c.userId]=c.lastSeenAtTime)),Ya||a.isGroup||(c.blockedByThis?(ja[c.userId]=!0,S.toggleBlockUser(a.tabId,!0)):c.blockedByOther?(Ba[c.userId]=!0,s.removeClass("mck-tab-title-w-status"),Pa.removeClass("vis").addClass("n-vis"),J.removeClass("vis").addClass("n-vis"),r.data("blocked",!1)):S.toggleBlockUser(a.tabId,!1)),c.userName&&!a.startTime)){var d=e.getTabDisplayName(a.tabId,a.isGroup,c.userName);s.html(d);
s.attr("title",d)}});!Za||a.isGroup||a.startTime||l.MCK_OL_MAP[a.tabId]||Wa.manageOfflineMessageTime(a.tabId);if(0<k.conversationPxys.length){var p=[];b.each(k.conversationPxys,function(a,c){if("object"===typeof c&&(p.push(c),Q[c.id]=c,qa[c.topicId]=[c.id],c.topicDetail))try{N[c.topicId]=b.parseJSON(c.topicDetail)}catch(f){l.console.log("Incorect Topic Detail!")}});g&&(Y[a.tabId]=p,e.addConversationMenu(a.tabId,a.isGroup))}a.conversationId&&(q=Q[a.conversationId],"object"===typeof q&&q.closed&&e.closeConversation());
a.startTime||(a.isGroup?(t.addGroupStatus(mckGroupUtils.getGroup(a.tabId)),e.updateUnreadCount("group_"+a.tabId,0,!0)):e.updateUnreadCount("user_"+a.tabId,0,!0),"function"===typeof c&&c(a));0<k.groupFeeds.length&&b.each(k.groupFeeds,function(c,d){var g=mckGroupUtils.addGroup(d);if(!a.startTime){var m=[];b.each(d.membersId,function(a,b){"undefined"===typeof e.getContact(b)&&m.push(b)});if(0<m.length)a.isMessages=h,a.messageData=k,a.isLoadMessageList=!0,V.getUsersDetail(m,a);else{t.addGroupStatus(g);
var l=!0;if(7===g.type){da.removeClass("vis").addClass("n-vis");var q=e.getContactFromGroupOfTwo(g);S.lastSeenOfGroupOfTwo(q.contactId)}6===g.type&&(t.validateOpenGroupUser(g),l=t.isAppendOpenGroupContextMenu(g));M.removeClass("vis").addClass("n-vis");h?(I.removeClass("vis").addClass("n-vis"),e.processMessageList(k,!0,l),6!==g.type&&ha.removeClass("n-vis").addClass("vis")):0===b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&(ha.removeClass("vis").addClass("n-vis"),I.removeClass("n-vis").addClass("vis"));
"function"===typeof Sa&&Sa(a.tabId)}}})}else a.startTime||(l.MCK_OL_MAP=[]),0<k.userDetails.length&&b.each(k.userDetails,function(a,b){H[b.userId]=b;b.connected?l.MCK_OL_MAP[b.userId]=!0:(l.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(T[b.userId]=b.lastSeenAtTime));e.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);var c=e.getContact(""+b.userId);"undefined"===typeof c?e.createContactWithDetail(b):e.updateContactDetail(c,b)}),0<k.groupFeeds.length&&b.each(k.groupFeeds,function(a,
b){e.updateUnreadCount("group_"+b.id,b.unreadCount,!1);mckGroupUtils.addGroup(b)}),0<k.blockedUserPxyList.blockedToUserList.length&&b.each(k.blockedUserPxyList.blockedToUserList,function(a,b){b.userBlocked&&(ja[b.blockedTo]=!0)}),0<k.blockedUserPxyList.blockedByUserList.length&&b.each(k.blockedUserPxyList.blockedByUserList,function(a,b){b.userBlocked&&(Ba[b.blockedBy]=!0)}),0<k.conversationPxys.length&&b.each(k.conversationPxys,function(a,c){Q[c.id]=c;qa[c.topicId]=[c.id];if(c.topicDetail)try{N[c.topicId]=
b.parseJSON(c.topicDetail)}catch(f){l.console.log("Incorect Topic Detail!")}}),h?(a.startTime?a.startTime&&(a.isReload=!1,d||A.updateLatestMessageArray(k.message)):(a.isReload=!0,d||A.setLatestMessageArray(k.message)),d&&A.updateMckMessageArray(k.message),e.addContactsFromMessageList(k,a)):r.data("datetime",""),a.isLaunch&&e.updateUnreadCountonChatIcon(k.userDetails)}q=B.data("forwardMessageKey");"undefined"!==typeof q&&(v.sendForwardMessage(q),B.data("forwardMessageKey",""))},error:function(a,b,
c){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."));Aa=!1;M.removeClass("vis").addClass("n-vis");l.console.log("Unable to load messages. Please reload page.")}})};a.updateContactList=function(a,b){var c="startIndex\x3d0\x26pageSize\x3d1\x26"+(b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a));mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list",data:c,global:!1,type:"get",success:function(c){"null"===c+""||"undefined"===typeof c.message||0===c.message.length?e.clearContactMessageData(a,
b):(c=c.message[0],"undefined"!==typeof c&&(c.groupId?e.addGroupFromMessage(c,!0):e.addContactsFromMessage(c,!0)))},error:function(c,d,g){401===c.status&&(sessionStorage.clear(),console.log("Please reload page."));e.clearContactMessageData(a,b)}})};a.sendDeliveryUpdate=function(a){mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/delivered",data:"key\x3d"+a.pairedMessageKey,global:!1,type:"get",success:function(){},error:function(){}})};a.sendReadUpdate=function(a){"undefined"!==typeof a&&""!==a&&
mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/read",data:"key\x3d"+a,global:!1,type:"get",success:function(){},error:function(){}})};a.conversationReadUpdate=function(a){var b=a.tabId,c=a.isGroup?"group_"+b:"user_"+b;"undefined"!==typeof b&&""!==b&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/read/conversation?"+("true"===""+a.isGroup?"groupId\x3d"+b:"userId\x3d"+b),global:!1,type:"get",success:function(){e.updateUnreadCount(c,0,!0)},error:function(){}})};a.getConversationId=function(c){if(!c.isGroup&&
!c.isMessage&&c.topicStatus!==K[1]){var d=qa[c.topicId];if(d&&(d=Q[d],"object"===typeof d)){r.data("mck-conversationid",d.id);c.conversationId=d.id;if("undefined"!==typeof Y[c.tabId]){var g=Y[c.tabId];g.push(d);Y[c.tabId]=g}e.loadTab(c);return}}c.topicId&&(d={topicId:c.topicId,status:c.topicStatus},c.isGroup?d.groupId=c.groupId:d.userId=c.tabId,g=N[c.topicId],"object"===typeof g&&(d.topicDetail=l.JSON.stringify(g)),c.fallBackTemplatesList&&0<c.fallBackTemplatesList.length&&(d.fallBackTemplatesList=
c.fallBackTemplatesList),mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/id",global:!1,data:l.JSON.stringify(d),type:"post",contentType:"application/json",success:function(d){if("object"===typeof d&&"success"===d.status){var g=d.response;if("object"===typeof g&&"undefined"!==g.conversationPxy){d=g.conversationPxy;Q[d.id]=d;qa[d.topicId]=[d.id];if(d.topicDetail)try{N[d.topicId]=b.parseJSON(d.topicDetail)}catch(k){l.console.log("Incorect Topic Detail!")}r.data("mck-conversationid",d.id);c.conversationId=
d.id;if("undefined"!==typeof Y[c.tabId]){var h=Y[c.tabId];h.push(d);Y[c.tabId]=h}c.isGroup&&(g=mckGroupUtils.addGroup(g),c.tabId=g.contactId);c.isMessage&&d.created?e.loadTab(c,a.dispatchMessage):e.loadTab(c)}}},error:function(){}}))};a.fetchConversationByTopicId=function(a){var c="topic\x3d"+a.topicId;if(a.tabId)c+="true"===""+a.isGroup?"\x26groupId\x3d"+a.tabId:"\x26userId\x3d"+encodeURIComponent(a.tabId);else if(a.clientGroupId)c+="\x26clientGroupId\x3d"+a.clientGroupId;else return!1;a.pageSize&&
(c+="\x26pageSize\x3d"+a.pageSize);mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/get",data:c,type:"get",success:function(c){"object"===typeof c&&"success"===c.status?(c=c.response,0<c.length&&b.each(c,function(c,d){Q[d.id]=d;qa[d.topicId]=[d.id];if(d.topicDetail)try{N[d.topicId]=b.parseJSON(d.topicDetail)}catch(e){l.console.log("Incorect Topic Detail!")}if(a.tabId&&"undefined"!==typeof Y[a.tabId]){var g=Y[a.tabId];g.push(d);Y[a.tabId]=g}}),a.isExtMessageList&&(0<c.length?(a.conversationId=
c[0].id,a.pageSize=50,v.getMessageList(a)):"function"===typeof a.callback&&(c={},a.tabId?(c.id=a.tabId,c.isGroup=a.isGroup):a.clientGroupId&&(c.clientGroupId=a.clientGroupId),c.topicId=a.topicId,c.status="success",c.messages=[],a.callback(c)))):a.isExtMessageList&&"function"===typeof a.callback&&(c={},a.tabId?c.id=a.tabId:a.clientGroupId&&(c.clientGroupId=a.clientGroupId),c.topicId=a.topicId,c.status="error",c.errorMessage="Unable to process request. Please try again.",a.callback(c))},error:function(){if("function"===
typeof a.callback){var b={};a.tabId?b.id=a.tabId:a.clientGroupId&&(b.clientGroupId=a.clientGroupId);b.topicId=a.topicId;b.status="error";b.errorMessage="Unable to process request. Please try again.";a.callback(b)}}})};a.getTopicId=function(c){c.conversationId&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/topicId",data:"id\x3d"+c.conversationId,global:!1,type:"get",async:"undefined"!==typeof c.async?c.async:!0,success:function(d){if("object"===typeof d&&"success"===d.status&&(d=d.response,
"object"===typeof d)){qa[d.topicId]=[c.conversationId];Q[c.conversationId]=d;if(d.topicDetail)try{N[d.topicId]=b.parseJSON(d.topicDetail)}catch(g){l.console.log("Incorect Topic Detail!")}"function"===typeof ua&&c.priceText&&(ua({custId:x,suppId:c.suppId,productId:d.topicId,price:c.priceText}),a.sendConversationCloseUpdate(c.conversationId));if(c.messageType&&"object"===typeof c.message){var k=c.message.groupId?c.message.groupId:c.message.to;if("undefined"!==typeof Y[k]){var h=Y[k];h.push(d);Y[k]=
h}("undefined"!==typeof c.populate?c.populate:1)&&e.populateMessage(c.messageType,c.message,c.notifyUser)}"function"===typeof c.callback&&c.callback(d)}},error:function(){}})};a.sendConversationCloseUpdate=function(a){a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/close",data:"id\x3d"+a,global:!1,type:"get",success:function(){},error:function(){}})};a.sendPriceMessage=function(){var c=W.val();if(""===c)W.addClass("mck-text-req");else{var c=b.trim(c),d=h.val(),e=r.data("mck-conversationid",
e),g={type:5,contentType:4,message:c};!0===r.data("isgroup")?g.groupId=d:g.to=d;if(r.data("mck-conversationid")){e=r.data("mck-conversationid");g.conversationId=e;var k=Q[e];"object"!==k?a.getTopicId({conversationId:e,suppId:d,priceText:c}):"function"===typeof ua&&ua({custId:x,suppId:d,productId:k.topicId,price:c});W.val("")}a.sendMessage(g)}};a.dispatchMessage=function(c){if("object"===c.messagePxy){var d=c.messagePxy;if(c.topicId){var e=N[c.topicId];if("object"===typeof e&&"undefined"!==e.title)if(d.message||
(d.message=b.trim(e.title)),c.conversationId)d.conversationId=c.conversationId;else if(c.topicId){var g={topicId:c.topicId};"object"===typeof e&&(g.topicDetail=l.JSON.stringify(e));d.conversationPxy=g}!d.message&&e.link&&(e={blobKey:b.trim(e.link),contentType:"image/png"},d.fileMeta=e,d.contentType=5,P=[],P.push(e))}c.isGroup?d.groupId=c.tabId:d.to=c.tabId;a.sendMessage(d)}};a.getGroup=function(c){var d=[];b.each(c.users,function(a,b){"undefined"!==typeof b.userId&&("undefined"!==typeof b.groupRole&&
-1===ob.indexOf(b.groupRole)||d.push(b))});var g={groupName:b.trim(c.groupName),users:d,type:c.type};c.admin&&(g.admin=c.admin);c.clientGroupId&&(g.clientGroupId=c.clientGroupId);c.groupIcon&&(g.imageUrl=c.groupIcon);g.metadata=c.metadata?c.metadata:MCK_LABELS["group.metadata"];var k={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/group/v2.1/create",global:!1,data:l.JSON.stringify(g),type:"post",contentType:"application/json",success:function(d){c.isInternal&&sa.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);
if("object"===typeof d&&"success"===d.status){if(d=d.response,"object"===typeof d){var g=mckGroupUtils.addGroup(d);0<d.users.length&&b.each(d.users,function(a,b){H[b.userId]=b;b.connected?l.MCK_OL_MAP[b.userId]=!0:(l.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(T[b.userId]=b.lastSeenAtTime));e.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);var c=e.getContact(""+b.userId);"undefined"===typeof c?e.createContactWithDetail(b):e.updateContactDetail(c,b)});c.tabId=g.contactId;c.isGroup=
!0;c.isMessage?e.loadTab(c,a.dispatchMessage):c.isInternal?(r.data("mck-id",g.contactId),r.data("isgroup",!0),t.loadGroupInfo({groupId:g.contactId})):e.loadTab(c);"function"===typeof c.callback&&(k.status="success",k.data=g,c.callback(k))}}else"error"===d.status&&"function"===typeof c.callback&&(k.status="error",k.errorMessage=d.errorResponse[0].description,c.callback(k))},error:function(){c.isInternal&&sa.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);"function"===typeof c.callback&&
(k.status="error",k.errorMessage="Unable to process request.",c.callback(k))}})};a.sendVideoCallMessage=function(b,c,d,e){var g="CALL_MISSED"==c?"Missed Call":"CALL_REJECTED"==c?"Call Rejected":"";if(""==g||void 0==g)g="video message";b={to:h.val(),type:5,contentType:d,message:g,metadata:{MSG_TYPE:c,CALL_ID:b,CALL_AUDIO_ONLY:e},senderName:x};a.sendMessage(b);return b};a.sendVideoCallEndMessage=function(b,c,d,e,g){var k="";g&&(k=mckDateUtils.convertMilisIntoTime(g));k="CALL_MISSED"==c?"Missed Call":
"CALL_REJECTED"==c?"Call Rejected":"CALL_END"==c?"Call End \n Duration: "+k:"video message";if(""==k||void 0==k)k="video message";b={to:h.val(),type:5,contentType:d,message:k,metadata:{MSG_TYPE:c,CALL_ID:b,CALL_AUDIO_ONLY:e,CALL_DURATION:g}};a.sendMessage(b);return b}},V=new function(){var a=this;b("#mck-search-list");var c=b("#mck-sidebox-search"),h=b("#mck-search-loading");b("#mck-search-cell .mck-message-inner");b("#mck-message-cell .mck-message-inner");b(".mck-tab-message-option");b("#mck-contact-loading");
a.getContactDisplayName=function(a){var b=[];if(0<a.length&&a[0]){for(var c="",g=a.filter(function(b,c){return a.indexOf(b)===c}),h=0;h<g.length;h++){var l=g[h];"undefined"===typeof sa[l]&&(c+="userIds\x3d"+encodeURIComponent(l)+"\x26")}c.lastIndexOf("\x26")===c.length-1&&(c=c.substring(0,c.length-1));c&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/info",data:c,global:!1,type:"get",success:function(a){for(var c in a)a.hasOwnProperty(c)&&(b.push([c,a[c]]),sa[c]=a[c],e.fetchContact(c).displayName=
a[c]);A.updateMckContactNameArray(b)},error:function(){}})}};a.loadContacts=function(){var a=[],d=[];mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/filter?startIndex\x3d0\x26pageSize\x3d50\x26orderBy\x3d1",type:"get",global:!1,success:function(h){c.hasClass("vis")&&("object"===typeof h&&0<h.users.length&&(b.each(h.users,function(b,c){"string"!==typeof H[c.userId]&&d.push(c.userId);if("undefined"!==typeof c.userId){var g=e.getContact(""+c.userId),g="undefined"===typeof g?e.createContactWithDetail(c):
e.updateContactDetail(g,c);Oa.push(g);Ka.push(g);a.push([c.userId,g.displayName]);c.connected?l.MCK_OL_MAP[c.userId]=!0:(l.MCK_OL_MAP[c.userId]=!1,"undefined"!==typeof c.lastSeenAtTime&&(T[c.userId]=c.lastSeenAtTime))}}),V.getUsersDetail(d,{async:!1}),0<a.length&&A.updateMckContactNameArray(a)),e.addContactsToSearchList())},error:function(){h.removeClass("vis").addClass("n-vis");l.console.log("Unable to load contacts. Please reload page.")}})};a.loadUserProfile=function(b){if("undefined"!==typeof b){var c=
[];b=""+b.split(",")[0];c.push(b);a.loadUserProfiles(c)}};a.loadUserProfiles=function(c){var d=[];b.each(c,function(a,b){"undefined"===typeof e.getContact(b)&&d.push(b)});a.getUsersDetail(d,{async:!1})};a.getUsersDetail=function(a,c){if(!("undefined"===typeof a||1>a.length)){for(var g="undefined"!==typeof c.cached?c.cached:!0,h=[],n=a.filter(function(b,c){return a.indexOf(b)===c}),t=0;t<n.length;t++){var y=n[t];g&&"undefined"!==typeof H[y]||h.push(y)}if(0===h.length)c.setStatus?S.updateUserConnectedStatus():
c.message?e.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&e.loadMessageListOnUserDetailFetch(c);else{var s={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/v2/detail",type:"post",async:"undefined"!==typeof c.async?c.async:!0,data:JSON.stringify({userIdList:h}),contentType:"application/json",success:function(a){"success"===a.status&&0<a.response.length&&b.each(a.response,function(a,b){H[b.userId]=b;l.MCK_OL_MAP[b.userId]=b.connected;var c=e.getContact(""+b.userId);"undefined"===
typeof c?e.createContactWithDetail(b):e.updateContactDetail(c,b)});c.setStatus?S.updateUserConnectedStatus():c.message?e.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&e.loadMessageListOnUserDetailFetch(c);s.status="success";s.data=a;c.callback&&c.callback(s)},error:function(){c.setStatus?S.updateUserConnectedStatus():c.message?e.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&e.loadMessageListOnUserDetailFetch(c);s.status="error";c.callback&&
c.callback(s)}})}}};a.getUserStatus=function(a){var c={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/chat/status",type:"get",success:function(g){0<g.users.length&&(Ka=[],b.each(g.users,function(a,b){var c=e.getContact(""+b.userId),c="undefined"===typeof c?e.createContactWithDetail(b):e.updateContactDetail(c,b);Ka.push(c.contactId)}));c.status="success";c.data=g;a.callback&&a.callback(c)},error:function(){c.status="error";a.callback&&a.callback(c)}})};a.blockUser=function(a,b){a&&"undefined"!==
typeof b&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/block",type:"get",data:"userId\x3d"+a+"\x26block\x3d"+b,success:function(c){"object"===typeof c&&"success"===c.status&&(ja[a]=b,S.toggleBlockUser(a,b))},error:function(){}})};a.updateDisplayName=function(a,c){""!==a&&""!==c&&b.ajax({url:MCK_BASE_URL+"/rest/ws/user/name",type:"get",data:"userId\x3d"+a+"\x26displayName\x3d"+c,success:function(a){if("object"===typeof a&&"success"===a.status)return"success"},error:function(){}})}},$a=new function(){var a=
this,c,h,l,d,n,p,t,u;a.init=function(){b("#mck-sidebox");h=b("#mck-msg-preview");n=b("#mck-group-info-tab");b("#mck-sidebox-launcher");c=b("#mck-message-cell .mck-message-inner");l=b("#mck-msg-preview .mck-preview-icon");d=b("#mck-msg-preview .mck-preview-cont-name");t=b("#mck-msg-preview .mck-preview-msg-content");u=b("#mck-msg-preview .mck-preview-file-content")};a.notifyUser=function(b){if(7!==b.type){var c=b.groupId?mckGroupUtils.getGroup(""+b.groupId):e.fetchContact(""+b.to.split(",")[0]),d=
!1;b.groupId&&(d=!0);V.loadUserProfile(b.to);var d=e.getTabDisplayName(c.contactId,d),g=bc;a.showNewMessageNotification(b,c,d);if(Tb&&!lb){var h=dc;b=e.getTextForMessagePreview(b,c);"function"!==typeof Ma||c.isGroup||(c=Ma(c.contactId))&&"undefined"!==typeof c&&(h=c);g?mckNotificationUtils.sendDesktopNotification(d,h,b,g):mckNotificationUtils.sendDesktopNotification(d,h,b)}}};a.showNewMessageNotification=function(a,b,p){if(Ub&&102!==a.contentType){var v=c.data("mck-id"),x=c.data("isgroup");if(v===
b.contactId&&x===b.isGroup&&!n.hasClass("vis"))if(a.conversationId&&(va||Ia)){if(v=c.data("mck-conversationid"),v="undefined"!==typeof v&&""!==v?v.toString():"",v===a.conversationId.toString())return}else return;h.data("isgroup",b.isGroup);h.data("mck-conversationid",a.conversationId?a.conversationId:"");v=e.getContactImageLink(b,p);a.message?(x=e.getMessageTextForContactPreview(a,b,50),t.html(""),"object"===typeof x?t.append(x):t.html(x),t.removeClass("n-vis").addClass("vis")):t.html("");a.fileMetaKey?
(u.html(e.getFileIcon(a)),u.removeClass("n-vis").addClass("vis"),""===t.html()&&t.removeClass("vis").addClass("n-vis")):(u.html(""),u.removeClass("vis").addClass("n-vis"));d.html(p);l.html(v);h.data("mck-id",b.contactId);h.show();setTimeout(function(){h.fadeOut(3E3)},1E4)}};a.unsubscribeToServiceWorker=function(){p&&navigator.serviceWorker.ready.then(function(a){p.unsubscribe().then(function(a){p=null;console.log("Unsubscribed to notification successfully")})})};a.sendSubscriptionIdToServer=function(){if(p){var a=
p.endpoint.split("/").slice(-1)[0];a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/plugin/update/sw/id",type:"post",data:"registrationId\x3d"+a,success:function(a){},error:function(a,b,c){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."))}})}};a.subscribeToServiceWorker=function(){Vb&&"serviceWorker"in navigator&&(navigator.serviceWorker.register("./service-worker.js",{scope:"./"}),navigator.serviceWorker.ready.then(function(a){a.pushManager.subscribe({userVisibleOnly:!0}).then(function(a){console.log("The reg ID is:: ",
a.endpoint.split("/").slice(-1));p=a})}))}},Ea=b(".chat-launcher-icon"),da=new function(){var a=this;a.token=null;a.Identity=null;a.outgoingCallServices=null;a.incomingCallServices=null;var c=b(".mck-videocall-btn"),h=b(".applozic-vid-container"),l=b("#mck-sidebox"),d=b("#mck-video-call-indicator");a.hideVideoBox=function(){h.addClass("n-vis").removeClass("vis");l.addClass("vis").removeClass("n-vis");d.addClass("n-vis").removeClass("vis")};a.init=function(){Ga.loop=!0;a.token=null!==A.getAppHeaders()?
A.getAppHeaders().videoToken:void 0;a.ringToneForHost=ya.loadRingTone(MCK_BASE_URL+"/resources/sidebox/audio/applozic_video_call_ring_tone.mp3",Ga);b("#mck-btn-video-call").on("click",function(c){if(a.token){c=x+(new Date).getTime().toString()+Math.random().toString(36).slice(2);var d=v.sendVideoCallMessage(c,"CALL_DIALED",102,!1),g=e.fetchContact(d.to),d=e.getTabDisplayName(g.contactId,!1),g=e.getContactImageLink(g,d),h=new Date;a.outgoingCallServices=new MckCallingService(x,da.token,c,d,!0,h,v,
g,!1,a.ringToneForHost);a.outgoingCallServices.startVideoCall();b("#mck-btn-video-call").data("isCallHost",!0);b("#mck-btn-video-call").data("callStartTime",h)}else alert("missing token... please refresh page..")});b("#mck-vid-receive-btn").on("click",function(a){console.log("call received");$("#mck-video-call-indicator").addClass("n-vis").removeClass("vis");c.removeClass("vis").addClass("n-vis");a=b("#mck-video-call-indicator").data("call-id");var d=b("#mck-video-call-indicator").data("isAudioCall");
b("#mck-video-call-indicator").data("callReceived",!0);b("#mck-video-call-indicator").addClass("n-vis");da.callReceived(a,d)});b("#mck-vid-reject-btn").on("click",function(a){console.log("call rejected");a=b("#mck-video-call-indicator").data("call-id");var c=b("#mck-video-call-indicator").data("isAudioCall");da.callRejected(a,c);b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis")})};a.InitilizeVideoClient=function(c,d){a.Identity=c;b.ajax({url:MCK_BASE_URL+"/twilio/token",type:"post",
contentType:"application/x-www-form-urlencoded",data:{identity:c,device:d},success:function(b){if(null!=b&&""!=b){a.token=b.token;var c=A.getAppHeaders();c.videoToken=b.token;A.setAppHeaders(c)}},error:function(a){console.log("error while getting token"+a)}})};a.callReceived=function(b,c){console.log("_this.callReceived");oa&&oa.stop();v.sendVideoCallMessage(b,"CALL_ANSWERED",102,c);a.incomingCallServices=new MckCallingService(a.Identity,a.token,b,null,!1,null,v,null,c);a.incomingCallServices.startVideoCall()};
a.callRejected=function(a,b){oa&&oa.stop();v.sendVideoCallMessage(a,"CALL_REJECTED",102,b)}},bc=null,Ga={},ya,oa=null;l.MCK_OL_MAP=[];h.events={onConnectFailed:function(){},onConnect:function(){},onMessageDelivered:function(){},onMessageRead:function(){},onMessageDeleted:function(){},onConversationDeleted:function(){},onUserConnect:function(){},onUserDisconnect:function(){},onConversationReadFromOtherSource:function(){},onConversationRead:function(){},onMessageReceived:function(){},onMessageSentUpdate:function(){},
onMessageSent:function(){},onUserBlocked:function(){},onUserUnblocked:function(){},onUserActivated:function(){},onUserDeactivated:function(){}};var X=new function(a){var c=this,h=a.events,n=null,d=null,u="",p=null,C=[],L,y,s="",P=b("#mck-sidebox"),F=b("#mck-tab-title"),K=b(".mck-typing-box"),H=b("#mck-tab-status");b("#mck-offline-message-box");var J=b("#mck-typing-label"),E=b("#mck-message-cell .mck-message-inner");c.init=function(){if("undefined"!==typeof za){var a=mckUtils.startsWith(za,"https")?
"15675":"15674";"function"===typeof l.SockJS&&(s||(s=new SockJS(za+":"+a+"/stomp")),d=l.Stomp.over(s),d.heartbeat.outgoing=0,d.heartbeat.incoming=0,d.onclose=function(){c.disconnect()},d.connect("guest","guest",c.onConnect,c.onError,"/"),l.addEventListener("beforeunload",function(a){c.disconnect()}))}};c.checkConnected=function(a){d.connected?(L&&clearInterval(L),y&&clearInterval(y),L=setInterval(function(){c.connectToSocket(a)},6E5),y=setInterval(function(){c.sendStatus(1)},12E5)):c.connectToSocket(a)};
c.connectToSocket=function(a){if(!d.connected){if(a&&"block"===P.css("display"))if(a=E.data("mck-id")){var b=E.data("isgroup"),h=E.data("mck-conversationid"),l=E.data("mck-topicid");A.clearMckMessageArray();e.loadTab({tabId:a,isGroup:b,conversationId:h,topicId:l})}else A.clearMckMessageArray(),e.loadTab({tabId:"",isGroup:!1});c.init()}};c.stopConnectedCheck=function(){L&&clearInterval(L);y&&clearInterval(y);y=L="";c.disconnect()};c.disconnect=function(){clearInterval(void 0);d&&d.connected&&(c.sendStatus(0),
d.disconnect(),s.close(),s="")};c.unsubscibeToTypingChannel=function(){d&&d.connected&&p&&(1===ia&&c.sendTypingStatus(0,u),p.unsubscribe());p=null};c.unsubscibeToNotification=function(){d&&d.connected&&n&&n.unsubscribe();n=null};c.subscibeToTypingChannel=function(a,b){var e=b?a:x;d&&d.connected?p=d.subscribe("/topic/typing-"+U+"-"+e,c.onTypingStatus):c.reconnect()};c.subscribeToOpenGroup=function(a){if(d&&d.connected){var b=d.subscribe("/topic/group-"+U+"-"+a.contactId,c.onOpenGroupMessage);C.push(b.id);
nb[a.contactId]=b.id}else c.reconnect()};c.sendTypingStatus=function(a,b){if(d&&d.connected){1===a&&1===ia&&d.send("/topic/typing-"+U+"-"+u,{"content-type":"text/plain"},U+","+x+","+a);if(b){if(b===u&&a===ia&&1===a)return;u=b;d.send("/topic/typing-"+U+"-"+b,{"content-type":"text/plain"},U+","+x+","+a);setTimeout(function(){ia=0},6E4)}else 0===a&&d.send("/topic/typing-"+U+"-"+u,{"content-type":"text/plain"},U+","+x+","+a);ia=a}};c.onTypingStatus=function(a){if(null!=p&&p.id===a.headers.subscription){var b=
a.body,c=b.split(",")[1],b=Number(b.split(",")[2]);a=a.headers.destination.substring(a.headers.destination.lastIndexOf("-")+1,a.headers.destination.length);var d=E.data("mck-id"),g=E.data("isgroup"),h=mckGroupUtils.getGroup(d);if(!ja[c]&&!Ba[c])if(1===b){if(!(x===c&&g||d!==c&&d!==a)){if(g=E.data("isgroup")){if(c!==x){if(t.authenticateGroupUser(h)||6===h.type&&!fa.disableChatForNonGroupMember)F.addClass("mck-tab-title-w-typing"),H.removeClass("vis").addClass("n-vis"),c=e.getTabDisplayName(c,!1),c=
c.split(" ")[0],J.html(c+" "+MCK_LABELS["is.typing"]);7===h.type&&(F.addClass("mck-tab-title-w-typing"),J.html(MCK_LABELS["is.typing"]),H.html(""))}}else F.addClass("mck-tab-title-w-typing"),H.removeClass("vis").addClass("n-vis"),J.html(MCK_LABELS.typing);K.removeClass("n-vis").addClass("vis");setTimeout(function(){F.removeClass("mck-tab-title-w-typing");K.removeClass("vis").addClass("n-vis");F.hasClass("undefined"===typeof h||7!=h.type)&&H.removeClass("n-vis").addClass("vis");J.html(MCK_LABELS.typing)},
6E4)}}else F.removeClass("mck-tab-title-w-typing"),K.removeClass("vis").addClass("n-vis"),!F.hasClass("mck-tab-title-w-status")||"undefined"!==typeof h&&7==h.type||H.removeClass("n-vis").addClass("vis"),J.html(MCK_LABELS.typing)}};c.reconnect=function(){c.unsubscibeToTypingChannel();c.unsubscibeToNotification();c.disconnect();c.init()};c.onError=function(a){l.console.log("Error in channel notification. "+a);h.onConnectFailed()};c.sendStatus=function(a){d&&d.connected&&d.send("/topic/status-v2",{"content-type":"text/plain"},
Ha+","+ea+","+a)};c.onConnect=function(){d.connected?(n&&c.unsubscibeToNotification(),n=d.subscribe("/topic/"+Ha,c.onMessage),c.sendStatus(1),c.checkConnected(!0)):setTimeout(function(){n=d.subscribe("/topic/"+Ha,c.onMessage);c.sendStatus(1);c.checkConnected(!0)},5E3);h.onConnect()};c.onOpenGroupMessage=function(a){if(-1!==C.indexOf(a.headers.subscription)){var c=b.parseJSON(a.body),d=c.type;a=c.message;if("APPLOZIC_03"===d)A.updateLatestMessage(a),0!==a.type&&4!==a.type&&(b("."+a.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),
e.addTooltip(a.key)),h.onMessageSentUpdate({messageKey:a.key});else if("APPLOZIC_01"===d||"APPLOZIC_02"===d||"MESSAGE_RECEIVED"===d){A.updateLatestMessage(a);var g=a.groupId?mckGroupUtils.getGroup(a.groupId):e.getContact(a.to);b("#mck-sidebox-content");E.data("mck-id");if("APPLOZIC_01"===d||"MESSAGE_RECEIVED"===d){var l=e.getMessageFeed(a);h.onMessageReceived({message:l})}else"APPLOZIC_02"===d&&(l=e.getMessageFeed(a),h.onMessageSent({message:l}));a.conversationId&&(l=Q[a.conversationId],!va&&!Ia||
"object"===typeof l&&"object"===typeof N[l.topicId]||v.getTopicId({conversationId:a.conversationId,messageType:d,message:a,notifyUser:c.notifyUser,async:!1,populate:!1}));"undefined"===typeof g?(c={message:a,messageType:d,notifyUser:c.notifyUser},a.groupId?t.getGroupFeedFromMessage(c):(d=[],d.push(a.to),V.getUsersDetail(d,c))):e.populateMessage(d,a,c.notifyUser)}}};c.onMessage=function(a){if(null!=n&&n.id===a.headers.subscription){a=b.parseJSON(a.body);var c=a.type;if("APPLOZIC_04"===c||"MESSAGE_DELIVERED"===
c)b("."+a.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").addClass("mck-icon-delivered"),e.addTooltip(a.message.split(",")[0]),h.onMessageDelivered({messageKey:a.message.split(",")[0]});else if("APPLOZIC_08"===c||"MT_MESSAGE_DELIVERED_READ"===c)b("."+a.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),e.addTooltip(a.message.split(",")[0]),
h.onMessageRead({messageKey:a.message.split(",")[0]});else if("APPLOZIC_05"===c){var d=a.message.split(",")[0],g=a.message.split(",")[1],p="1"===a.message.split(",")[2]?!0:!1;e.removedDeletedMessage(d,g,p);a={messageKey:a.message.split(",")[0]};p?a.groupId=g:a.userKey=g;console.log(a);h.onMessageDeleted(a)}else if("APPLOZIC_27"===c)d=a.message.split(",")[0],a=a.message.split(",")[1],"undefined"!==typeof d&&(e.removeConversationThread(d,!1),e.updateUnreadCount("user_"+d,0,!0),g={userId:d},a&&(g.topicId=
a),h.onConversationDeleted(g));else if("APPLOZIC_11"===c){d=a.message;p=e.fetchContact(d);g=E.data("mck-id");if(!ja[d]&&!Ba[d]){if(g!==p.contactId||E.data("isgroup")){var s=mckContactUtils.formatContactId(d);b("#li-user-"+s+" .mck-ol-status").removeClass("n-vis").addClass("vis")}else b("#mck-tab-status").html(MCK_LABELS.online),Za&&e.hideOfflineMessage();b(".mck-user-ol-status."+s).removeClass("n-vis").addClass("vis");b(".mck-user-ol-status."+s).next().html("("+MCK_LABELS.online+")");l.MCK_OL_MAP[d]=
!0;S.updateUserStatus({userId:a.message,status:1})}h.onUserConnect({userId:a.message})}else if("APPLOZIC_12"===c)d=a.message.split(",")[0],a=a.message.split(",")[1],p=e.fetchContact(d),l.MCK_OL_MAP[d]=!1,a&&(T[d]=a),ja[d]||Ba[d]||(g=E.data("mck-id"),g!==p.contactId||E.data("isgroup")||(b("#mck-tab-status").html(mckDateUtils.getLastSeenAtStatus(a)),Za&&Wa.manageOfflineMessageTime(g)),b(".mck-user-ol-status."+p.htmlId).removeClass("vis").addClass("n-vis"),b(".mck-user-ol-status."+p.htmlId).next().html("(Offline)"),
b("#li-user-"+s+" .mck-ol-status").removeClass("vis").addClass("n-vis"),S.updateUserStatus({userId:d,status:0,lastSeenAtTime:a})),h.onUserDisconnect({userId:d,lastSeenAtTime:a});else if("APPLOZIC_29"===c){d=a.message.split(",")[0];a=a.message.split(",")[1];p=e.fetchContact(d);e.updateUnreadCount("user_"+p.contactId,0,!0);g=E.data("mck-id");if("undefined"===typeof g||""===g)b("#li-user-"+p.htmlId+" .mck-unread-count-text").html(e.getUnreadCount("user_"+p.contactId)),b("#li-user-"+p.htmlId+" .mck-unread-count-box").removeClass("vis").addClass("n-vis");
g={userId:d};a&&(g.topicId=a);h.onConversationReadFromOtherSource(g)}else if("APPLOZIC_28"===c)d=a.message.split(",")[0],a=a.message.split(",")[1],g=E.data("mck-id"),g===d&&(b(".mck-msg-right .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),b(".mck-msg-right .mck-icon-delivered").attr("title","delivered and read"),p=e.getContact(d),"undefined"===typeof p&&(g=[],g.push(d),V.getUsersDetail(g,{}))),g={userId:d},
a&&(g.topicId=a),h.onConversationRead(g);else if("APPLOZIC_16"===c)c=a.message.split(":")[0],d=a.message.split(":")[1],p=e.fetchContact(d),g=E.data("mck-id"),g===p.contactId?c===Yb[0]?(ja[p.contactId]=!0,S.toggleBlockUser(g,!0)):(Ba[p.contactId]=!0,F.removeClass("mck-tab-title-w-status"),H.removeClass("vis").addClass("n-vis"),K.removeClass("vis").addClass("n-vis")):b("#li-user-"+p.htmlId+" .mck-ol-status").removeClass("vis").addClass("n-vis"),h.onUserBlocked({status:c,userId:d});else if("APPLOZIC_17"===
c){c=a.message.split(":")[0];d=a.message.split(":")[1];p=e.fetchContact(d);g=E.data("mck-id");if(g===p.contactId)if(c===Yb[2])ja[p.contactId]=!1,S.toggleBlockUser(g,!1);else{if(l.MCK_OL_MAP[g]||T[g])Ba[p.contactId]=!1,ja[g]||(l.MCK_OL_MAP[g]?H.html(MCK_LABELS.online):T[g]&&H.html(mckDateUtils.getLastSeenAtStatus(T[g])),F.addClass("mck-tab-title-w-status"),H.removeClass("n-vis").addClass("vis"))}else l.MCK_OL_MAP[g]&&b("#li-user-"+p.htmlId+" .mck-ol-status").removeClass("n-vis").addClass("vis");h.onUserUnblocked({status:c,
userId:d})}else if("APPLOZIC_18"===c)Ya=!1,h.onUserActivated();else if("APPLOZIC_19"===c)Ya=!0,h.onUserDeactivated();else if(d=a.message,"APPLOZIC_03"===c)A.updateLatestMessage(d),0!==d.type&&4!==d.type&&(b("."+d.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),e.addTooltip(d.key)),h.onMessageSentUpdate({messageKey:d.key});else if("APPLOZIC_01"===c||"APPLOZIC_02"===c||"MESSAGE_RECEIVED"===c)A.updateLatestMessage(d),p=d.groupId?mckGroupUtils.getGroup(d.groupId):e.getContact(d.to),
b("#mck-sidebox-content"),g=E.data("mck-id"),"APPLOZIC_01"===c||"MESSAGE_RECEIVED"===c?(g=e.getMessageFeed(d),h.onMessageReceived({message:g})):"APPLOZIC_02"===c&&(g=e.getMessageFeed(d),h.onMessageSent({message:g})),d.conversationId&&(g=Q[d.conversationId],!va&&!Ia||"object"===typeof g&&"object"===typeof N[g.topicId]||v.getTopicId({conversationId:d.conversationId,messageType:c,message:d,notifyUser:a.notifyUser,async:!1,populate:!1})),"undefined"===typeof p?(a={message:d,messageType:c,notifyUser:a.notifyUser},
d.groupId?t.getGroupFeedFromMessage(a):(g=[],g.push(d.to),V.getUsersDetail(g,a))):(102==d.contentType&&La&&(a.notifyUser=!1,4==d.type&&"CALL_DIALED"==d.metadata.MSG_TYPE?(p=e.fetchContact(d.to),g=e.getTabDisplayName(p.contactId,!1),p=e.getContactImageLink(p,g),b("#mck-video-call-indicator").data("call-id",d.metadata.CALL_ID),b("#mck-video-call-indicator").data("isAudioCall",d.metadata.CALL_AUDIO_ONLY),b("#mck-video-call-indicator-txt").html(g+" calling..."),b("#mck-video-call-icon").html(p),b("#mck-video-call-indicator").removeClass("n-vis").addClass("vis"),
oa.play(),setTimeout(function(){b("#mck-video-call-indicator").data("callReceived")||(console.log("call is not answered"),oa.stop(),b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"))},6E4)):4==d.type&&"CALL_REJECTED"==d.metadata.MSG_TYPE&&b("#mck-btn-video-call").data("isCallHost")&&(v.sendVideoCallMessage(d.metadata.CALL_ID,"CALL_REJECTED",103,!1),da.ringToneForHost.stop(),da.outgoingCallServices.twilioService.leaveRoomIfJoined(),da.hideVideoBox(),da.outgoingCallServices&&(da.outgoingCallServices.rejectedByReceiver=
!0))),103==d.contentType?4==d.type&&"CALL_MISSED"==d.metadata.MSG_TYPE&&(b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"),oa&&oa.stop()):e.populateMessage(c,d,a.notifyUser))}}}(h);h.getOptions=function(){return c};h.init=function(){Ga.loop=!1;Mb&&(ya=new RingToneService,bc=ya.loadRingTone(Mb,Ga));v.init();ba.init();Wa.initializeApp(c,!1);$a.init();Cb.init();e.initEmojis();La&&(Ga.loop=!0,ya=new RingToneService,oa=ya.loadRingTone(MCK_BASE_URL+"/resources/sidebox/audio/applozic_video_call_ring_tone.mp3",
Ga),da.init())};h.reInit=function(a){"object"===b.type(a)&&(a=b.extend(!0,{},Hb,a),b.fn.applozic("reset",a),a.userId&&a.appId&&""!==b.trim(a.userId)&&""!==b.trim(a.appId)?(Wa.initializeApp(a,!0),c=a):l.console("Oops! looks like incorrect application id or user Id."))};h.loadTabView=function(a){"undefined"===typeof a.isGroup&&(a.isGroup=!1);e.loadTab(a);b("#mck-search").val("")};h.loadTab=function(a){e.loadTab({tabId:a,isGroup:!1});b("#mck-search").val("")};h.loadChat=function(a){if(!("undefined"!==
typeof a.userId&&""!==a.userId||"undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId))return"UserId or groupId or clientGroupId required";var c={tabId:a.userId,isGroup:!1},c={};a.userId&&(c.tabId=userId,c.isGroup=!1);a.displayName&&(c.userName=a.displayName);a.convId&&(c.conversationId=a.convId);if(a.groupId||a.clientGroupId)if(c.isGroup=!0,a.clientGroupId){c.clientGroupId=a.clientGroupId;var h=mckGroupUtils.getGroupByClientGroupId(a.clientGroupId);
if("object"===typeof h)c.tabId=h.contactId;else{mckGroupService.getGroupFeed({clientGroupId:c.clientGroupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab});b("#mck-search").val("");return}}else if(h=mckGroupUtils.getGroup(a.groupId),"object"===typeof h)c.tabId=a.groupId;else{mckGroupService.getGroupFeed({groupId:a.groupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab});b("#mck-search").val("");return}e.loadTab(c);b("#mck-search").val("")};h.uploadFile=function(a){ba.uploadFile(a)};h.audioAttach=
function(a){ba.audioRecoder(a)};h.loadGroupTab=function(a){if("undefined"===typeof a||""===a)return"GroupId required";"object"===typeof mckGroupUtils.getGroup(a)?(e.loadTab({tabId:a,isGroup:!0}),b("#mck-search").val("")):mckGroupService.getGroupFeed({groupId:a,apzCallback:t.onGroupFeed,callback:t.loadGroupTab})};h.loadGroupTabByClientGroupId=function(a){if("undefined"===typeof a.clientGroupId||""===a.clientGroupId)return"Client Group Id Required";var c=mckGroupUtils.getGroupByClientGroupId(a.clientGroupId);
"object"===typeof c?(e.loadTab({tabId:c.contactId,isGroup:!0}),b("#mck-search").val("")):mckGroupService.getGroupFeed({clientGroupId:a.clientGroupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab})};h.loadConvTab=function(a){"object"===typeof a&&a.userId&&a.convId&&e.loadTab({tabId:a.userId,conversationId:a.convId,isGroup:!1})};h.loadTabWithTopic=function(a){if("object"===typeof a&&(a.userId||a.groupId)&&a.topicId){var b={tabId:a.userId,topicId:a.topicId};a.userName&&(b.userName=a.userName);b.topicStatus=
a.topicStatus?-1===K.indexOf(a.topicStatus)?K[0]:a.topicStatus.toString():K[0];if("function"===typeof Da||a.topicDetail){var c=a.topicDetail?a.topicDetail:Da(a.topicId);"object"===typeof c&&"undefined"!==c.title&&(N[a.topicId]=c)}a.message?(b.messagePxy={type:5,contentType:0,message:message},b.isMessage=!0):b.isMessage=!1;a.groupId?(b.isGroup=!0,b.groupId=a.groupId):(b.isGroup=!1,b.userId=a.userId);v.getConversationId(b)}else{if(!a.userId||!a.groupId)return"UserId or groupId required";if(!a.topicId)return"TopicId required"}};
h.loadContacts=function(a){e.loadContacts(a)};h.setOffline=function(){"undefined"!==typeof X&&X.sendStatus(0)};h.reset=function(a){l.sessionStorage.clear();n=Ha="";P=[];MCK_GROUP_MAP=[];kb=!0;pa=[];ea="";mb=a.mode;ja=[];Ba=[];Aa=!1;ta=90;U=a.appId;T=[];Q=[];N=[];MCK_CLIENT_GROUP_MAP=[];lb=!0;MCK_LABELS=a.labels;F=0;MCK_BASE_URL=a.baseUrl;Z={};Na=[];Va=a.launcher;nb=[];Ib=a.userName;cb=a.visitor;qa=[];Oa=[];Ja={};Ca=a.fileBaseUrl;Jb=c.awsS3Server?c.awsS3Server:!1;qb=a.locShare;La=c.video;J=a.onInit;
rb=a.onTopicDetails;sa=[];wa=[];sb=a.onClose;ca=a.accessToken;tb=a.displayText;Sa=a.readConversation;W=a.maxGroupSize;Y=[];ub=a.onTabClicked;Kb=a.contactNumber;vb=a.appModuleName;Da=a.getTopicDetail;ka=a.maxAttachmentSize;wb=a.validateMessage;Ta=a.contactDisplayName;Ka=[];ua=a.finalPriceResponse;Ma=a.contactDisplayImage;xb=a.priceWidget;fa=c.openGroupSettings;ra=a.offlineMessageDetail;yb=a.getConversationDetail;db=a.authenticationTypeId;x=cb?"guest":b.trim(a.userId);eb="boolean"===typeof a.olStatus?
a.olStatus:!1;Ia="boolean"===typeof a.topicBox?a.topicBox:!1;Za="boolean"===typeof a.showOfflineMessage?a.showOfflineMessage:!1;va="boolean"===typeof a.topicHeader?a.topicHeader:!1;Ub="boolean"===typeof a.notification?a.notification:!0;Vb="boolean"===typeof a.swNotification?a.swNotification:!1;Sb=a.supportId?'data-mck-id\x3d"'+a.supportId+'"':"";Ob="boolean"===typeof a.hideGroupSubtitle?a.hideGroupSubtitle:!1;Pb="undefined"===typeof a.defaultMessageMetaData?{}:a.defaultMessageMetaData;zb="boolean"===
typeof a.groupUserCount?a.groupUserCount:!1;Tb="boolean"===typeof a.desktopNotification?a.desktopNotification:!1;Ab="boolean"===typeof a.loadOwnContacts?a.loadOwnContacts:!1;Nb="boolean"===typeof a.messageBubbleAvator?a.messageBubbleAvator:!1;Rb="boolean"===typeof c.resetUserStatus?c.resetUserStatus:!1;fb="boolean"===typeof a.launchOnNewMessage?a.launchOnNewMessage:!1;Wb="boolean"===typeof a.autoTypeSearchEnabled?a.autoTypeSearchEnabled:!0;Qb="boolean"===typeof a.checkUserBusyWithStatus?a.checkUserBusyWithStatus:
!1;Bb="boolean"===typeof a.launchOnUnreadMessage?a.launchOnUnreadMessage:!1};h.logout=function(){"undefined"!==typeof X&&(X.disconnect(),A.clearMckMessageArray(),b.fn.applozic("reset",c),b("#mck-sidebox").hide(),b("#mck-sidebox-launcher").hide());kb=!1};h.setOnline=function(){"undefined"!==typeof X&&X.sendStatus(1)};h.getUserStatus=function(a){"function"===typeof a.callback&&("undefined"!==typeof a.userIds?V.getUsersDetail(a.userIds,a):V.getUserStatus(a))};h.getGroupList=function(a){return"function"===
typeof a.callback?(a.apzCallback=t.loadGroups,mckGroupService.loadGroups(a),"success"):"Callback Function Required"};h.leaveGroup=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback){if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)return a.apzCallback=t.onGroupLeft,mckGroupService.leaveGroup(a),"success";a.callback({status:"error",errorMessage:"GroupId or Client GroupId Required"})}else return"Callback Function Required"};
h.addGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});else if("undefined"!==typeof a.role&&-1===ob.indexOf(a.role))a.callback({status:"error",errorMessage:"Incorrect member role"});else return V.loadUserProfile(a.userId),
a.apzCallback=t.onAddedGroupMember,mckGroupService.addGroupMember(a),"success";else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};h.removeGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",
errorMessage:"UserId required"});else return a.apzCallback=t.onRemovedGroupMember,mckGroupService.removeGroupMember(a),"success";else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};h.updateGroupInfo=function(a){if("object"!==typeof a)return"Unsupported format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId){if("undefined"!==
typeof a.name&&""!==a.name||"undefined"!==typeof a.imageUrl&&""!==a.imageUrl||a.users&&0!==a.users.length){if(a.users&&0<a.users.length){var c=[];b.each(a.users,function(a,b){b.userId&&"undefined"!==typeof b.role&&-1!==ob.indexOf(b.role)&&c.push(b)});if(0===c.length){a.callback({status:"error",errorMessage:"Incorrect users detail"});return}}c=[];b(".mck-group-change-role-box.vis").each(function(a,e){var d=b(this),h=parseInt(d.find("select").val()),l=d.parents(".mck-li-group-member").data("role");
h!==l&&(d={userId:d.parents(".mck-li-group-member").data("mck-id"),role:h},c.push(d))});a.apzCallback=t.onUpdateGroupInfo;mckGroupService.updateGroupInfo(a);return"success"}a.callback({status:"error",errorMessage:"Group properties required"})}else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};h.getMessages=function(a){"function"===typeof a.callback&&v.getMessages(a)};h.getMessageList=function(a){return"undefined"!==typeof a&&
"function"===typeof a.callback?(v.getMessageList(a),"success"):"Callback function required"};h.getMessageListByTopicId=function(a){if("object"!==typeof a)return"Unsupported format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.id&&""!==a.id||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if(a.id&&"boolean"!==typeof a.isGroup)a.callback({status:"error",errorMessage:"IsGroup parameter required"});else{if(a.topicId){a.id&&(a.tabId=a.id);a.topicStatus=K[0];
var b=qa[a.topicId];b&&"object"===typeof Q[b]?(a.conversationId=b,v.getMessageList(a)):(a.isExtMessageList=!0,a.pageSize=1,v.fetchConversationByTopicId(a));return"success"}a.callback("TopicId required")}else a.callback({status:"error",errorMessage:"Id or clientGroupId required"});else return"Callback function required."};h.sendMessage=function(a){if("object"===typeof a){a=b.extend(!0,{},cc,a);var c=a.message;if(!a.to)return"To field required";if("undefined"===typeof c||""===c)return"Message field required";
if(12<a.type)return"Invalid message type";c=b.trim(c);a={to:b.trim(a.to),type:a.messageType,contentType:a.type,message:c,metadata:a.metadata};v.sendMessage(a);return"success"}return"Unsupported format. Please check format"};h.sendGroupMessage=function(a){if("object"===typeof a){a=b.extend(!0,{},cc,a);var c=a.message;if(!a.groupId&&!a.clientGroupId)return"groupId or clientGroupId required";if("undefined"===typeof c||""===c)return"message field required";if(12<a.type)return"invalid message type";c=
b.trim(c);c={type:a.messageType,contentType:a.type,message:c};if(a.groupId)c.groupId=b.trim(a.groupId);else if(a.clientGroupId){if("undefined"===typeof mckGroupUtils.getGroupByClientGroupId(a.clientGroupId))return"group not found";c.clientGroupId=b.trim(a.clientGroupId)}v.sendMessage(c);return"success"}return"Unsupported format. Please check format"};h.addWelcomeMessage=function(a){if("object"===typeof a){if("undefined"===typeof a.sender||""===a.sender)return"Sender Field Required";if("undefined"===
typeof a.messageContent||""===a.messageContent)return"Message Content Required";v.sendWelcomeMessage(a)}else return"Unsupported format. Please check format"};h.createGroup=function(a){if("object"===typeof a)if("function"===typeof a.callback){var b=a.users;if("undefined"===typeof b||1>b.length)a.callback({status:"error",errorMessage:"Users list required"});else if(b.length>W)a.callback({status:"error",errorMessage:"Users limit exceeds "+W+". Max number of users allowed is "+W+"."});else if(a.groupName)if("undefined"===
typeof a.type||""===a.type)a.callback({status:"error",errorMessage:"Group type required"});else if(-1===pb.indexOf(a.type))a.callback({status:"error",errorMessage:"Invalid group type"});else return v.getGroup(a),"success";else a.callback({status:"error",errorMessage:"Group name required"})}else return"Callback function required";else return"Unsupported Format. Please check format"};h.initGroupTab=function(a){if("object"===typeof a){var b=a.users;if("undefined"===typeof b||1>b.length)return"Users List Required";
if(b.length>W)return"Users limit exceeds "+W+". Max number of users allowed is "+W+".";if(!a.groupName)return"Group name required";if("undefined"===typeof a.type)return"Group type required";if(-1===pb.indexOf(a.type))return"Invalid group type";v.getGroup(a);return"success"}return"Unsupported format. Please check format"};h.getTotalUnreadCount=function(){return F};h.subscribeToEvents=function(a){"object"===typeof a&&("function"===typeof a.onConnectFailed&&(h.events.onConnectFailed=a.onConnectFailed),
"function"===typeof a.onConnect&&(h.events.onConnect=a.onConnect),"function"===typeof a.onMessageDelivered&&(h.events.onMessageDelivered=a.onMessageDelivered),"function"===typeof a.onMessageRead&&(h.events.onMessageRead=a.onMessageRead),"function"===typeof a.onMessageDeleted&&(h.events.onMessageDeleted=a.onMessageDeleted),"function"===typeof a.onConversationDeleted&&(h.events.onConversationDeleted=a.onConversationDeleted),"function"===typeof a.onUserConnect&&(h.events.onUserConnect=a.onUserConnect),
"function"===typeof a.onUserDisconnect&&(h.events.onUserDisconnect=a.onUserDisconnect),"function"===typeof a.onConversationReadFromOtherSource&&(h.events.onConversationReadFromOtherSource=a.onConversationReadFromOtherSource),"function"===typeof a.onConversationRead&&(h.events.onConversationRead=a.onConversationRead),"function"===typeof a.onMessageReceived&&(h.events.onMessageReceived=a.onMessageReceived),"function"===typeof a.onMessageSentUpdate&&(h.events.onMessageSentUpdate=a.onMessageSentUpdate),
"function"===typeof a.onMessageSent&&(h.events.onMessageSent=a.onMessageSent),"function"===typeof a.onUserBlocked&&(h.events.onUserBlocked=a.onUserBlocked),"function"===typeof a.onUserUnblocked&&(h.events.onUserUnblocked=a.onUserUnblocked),"function"===typeof a.onUserActivated&&(h.events.onUserActivated=a.onUserActivated),"function"===typeof a.onUserDeactivated&&(h.events.onUserDeactivated=a.onUserDeactivated))};h.getConversation=function(a){v.getTopicId({conversationId:a.conversationId})}}l.applozic||
(l.applozic=l.applozic?l.applozic:{},b.extend(!0,l.applozic,{applozic:{PRODUCT_ID:"applozic-chat"}}));var Hb={baseUrl:"https://apps.applozic.com",fileBaseUrl:"https://applozic.appspot.com",notificationIconLink:"",notificationSoundLink:"",mapStaticAPIkey:"AIzaSyCWRScTDtbt8tlXDr6hiceCsU83aS2UuZw",launcher:"applozic-launcher",userId:null,appId:null,awsS3Server:!1,userName:null,contactNumber:null,email:null,supportId:null,mode:"standard",visitor:!1,olStatus:!1,groupUserCount:!1,desktopNotification:!1,
locShare:!1,maxAttachmentSize:25,notification:!0,launchOnUnreadMessage:!1,loadOwnContacts:!1,maxGroupSize:100,authenticationTypeId:0,isAnonymousChat:!0,labels:{"conversations.title":"Conversations","start.new":"Start New","search.contacts":"Contacts","search.groups":"Groups","empty.groups":"No groups yet!","empty.contacts":"No contacts yet!","empty.messages":"No messages yet!","no.more.messages":"No more messages!","empty.conversations":"No conversations yet!","no.more.conversations":"No more conversations!",
"search.placeholder":"Search...","location.placeholder":"Enter a location","create.group.title":"Create Group","members.title":"Members","add.members.title":"Add Member","remove.member":"Remove Member","change.role":"Change Role","group.info.update":"Update","group.info.updating":"Updating...","add.group.icon":"Add Group Icon","group.deleted":"Group has been deleted","change.group.icon":"Change Group Icon","group.title":"Group Title","group.type":"Group Type","group.create.submit":"Creating Group...",
blocked:"You have blocked this user","group.chat.disabled":"You are no longer part of this group!","block.user.alert":"Are you sure you want to block this user?","unblock.user.alert":"Are you sure you want to unblock this user?","exit.group.alert":"Are you sure you want to exit this group?","remove.member.alert":"Are you sure you want to remove this member?","clear.messages.alert":"Are you sure you want to delete all the conversation?",typing:"typing...","is.typing":"is typing...",online:"Online",
"clear.messages":"Clear Messages","delete":"Delete",reply:"Reply",forward:"Forward",copy:"Copy","block.user":"Block User","unblock.user":"Unblock User","group.info.title":"Group Info","exit.group":"Exit Group","location.share.title":"Location Sharing","my.location":"My Location",send:"Send","send.message":"Send Message",smiley:"Smiley",close:"Close",edit:"Edit",save:"Save","file.attachment":"Files \x26 Photos","file.attach.title":"Attach File","last.seen":"Last seen","last.seen.on":"Last seen on",
ago:"ago","group.metadata":{CREATE_GROUP_MESSAGE:":adminName created group :groupName",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",GROUP_META_DATA_UPDATED_MESSAGE:"",
ALERT:"",HIDE:""}},openGroupSettings:{deleteChatAccess:0,allowInfoAccessGroupMembers:!0,disableChatForNonGroupMember:!1,defaultChatDisabledMessage:"Chat Disabled!"}},cc={messageType:5,type:0};b.fn.applozic=function(c,h){var l=b("#mck-sidebox");"object"===b.type(c)&&(c=b.extend(!0,{},Hb,c));var n=void 0;if("undefined"!==typeof l.data("applozic_instance"))if(n=l.data("applozic_instance"),"string"===b.type(c))switch(c){case "reInitialize":return n.reInit(h);case "loadConvTab":n.loadConvTab(h);break;
case "loadTab":n.loadTab(h);break;case "uploadFile":n.uploadFile(h);break;case "loadTabView":n.loadTabView(h);break;case "loadChat":n.loadChat(h);break;case "loadContextualTab":return n.loadTabWithTopic(h);case "audioAttach":n.audioAttach(h);break;case "addWelcomeMessage":n.addWelcomeMessage(h);break;case "loadContacts":n.loadContacts(h);break;case "sendMessage":return n.sendMessage(h);case "sendGroupMessage":return n.sendGroupMessage(h);case "createGroup":return n.createGroup(h);case "loadBroadcastTab":return h.groupName=
h.groupName?h.groupName:"Broadcast",h.type=5,n.initGroupTab(h);case "initBroadcastTab":return h.groupName=h.groupName?h.groupName:"Broadcast",h.type=5,n.initGroupTab(h);case "initGroupTab":return n.initGroupTab(h);case "loadGroupTab":return n.loadGroupTab(h);case "loadGroupTabByClientGroupId":return n.loadGroupTabByClientGroupId(h);case "setOffline":return n.setOffline(),"success";case "setOnline":return n.setOffline(),"success";case "logout":return n.logout(),"success";case "reset":n.reset(h);break;
case "getUserDetail":return n.getUserStatus(h),"success";case "getGroupList":return n.getGroupList(h),"success";case "leaveGroup":return n.leaveGroup(h);case "addGroupMember":return n.addGroupMember(h);case "removeGroupMember":return n.removeGroupMember(h);case "updateGroupInfo":return n.updateGroupInfo(h);case "getMessages":n.getMessages(h);break;case "messageList":return n.getMessageList(h);case "getMessageListByTopicId":return n.getMessageListByTopicId(h);case "getTotalUnreadCount":return n.getTotalUnreadCount();
case "subscribeToEvents":return n.subscribeToEvents(h);case "getConversation":return n.getConversation(h)}else"object"===b.type(c)&&n.reInit(c);else"object"===b.type(c)&&(c.userId&&c.appId&&""!==b.trim(c.userId)&&""!==b.trim(c.appId)?"undefined"!==typeof l.data("applozic_instance")?(n=l.data("applozic_instance"),n.reInit(c)):(jQuery="undefined"!==typeof c.ojq?$=c.ojq:$=b,"function"===typeof c.obsm?($.fn.modal=c.obsm,jQuery.fn.modal=c.obsm):"function"===typeof b.fn.modal?(n=b.fn.modal.noConflict(),
$.fn.modal=n,jQuery.fn.modal=n):"function"===typeof $.fn.modal&&(n=$.fn.modal.noConflict(),$.fn.modal=n,jQuery.fn.modal=n),"function"===typeof c.omckm?b.fn.mckModal=c.omckm:"function"===typeof b.fn.mckModal?b.fn.mckModal=b.fn.mckModal.noConflict():"function"===typeof $.fn.mckModal&&(b.fn.mckModal=$.fn.mckModal.noConflict()),"function"===typeof $.fn.linkify?(b.fn.linkify=$.fn.linkify,jQuery.fn.linkify=$.fn.linkify):"function"===typeof b.fn.linkify&&($.fn.linkify=b.fn.linkify,jQuery.fn.linkify=b.fn.linkify),
"function"===typeof $.fn.emojiarea?b.fn.emojiarea=$.fn.emojiarea:"function"===typeof b.fn.emojiarea&&($.fn.emojiarea=b.fn.emojiarea,jQuery.fn.emojiarea=b.fn.emojiarea),"function"===typeof $.fn.locationpicker?b.fn.locationpicker=$.fn.locationpicker:"function"===typeof b.fn.locationpicker&&($.fn.locationpicker=b.fn.locationpicker,jQuery.fn.locationpicker=b.fn.locationpicker),n=new jb(c),l.data("applozic_instance",n),n.init()):alert("Oops! looks like incorrect application id or user Id."))};b.fn.applozic.defaults=
Hb})($applozic,window,document);