!function(t,e,n){var o=1,i=3,s=["p","div","pre","form"],r=27,a=9;t.emojiarea={path:"",icons:{},defaults:{button:null,buttonLabel:"Emojis",buttonPosition:"after"}},t.fn.emojiarea=function(e){return e=t.extend({},t.emojiarea.defaults,e),this.each(function(){var o=t(this);"contentEditable"in n.body&&e.wysiwyg!==!1?new l(o,e):new h(o,e)})};var u={};u.restoreSelection=function(){return e.getSelection?function(t){var n=e.getSelection();n.removeAllRanges();for(var o=0,i=t.length;i>o;++o)n.addRange(t[o])}:n.selection&&n.selection.createRange?function(t){t&&t.select()}:void 0}(),u.saveSelection=function(){return e.getSelection?function(){var t=e.getSelection(),n=[];if(t.rangeCount)for(var o=0,i=t.rangeCount;i>o;++o)n.push(t.getRangeAt(o));return n}:n.selection&&n.selection.createRange?function(){var t=n.selection;return"none"!==t.type.toLowerCase()?t.createRange():null}:void 0}(),u.replaceSelection=function(){return e.getSelection?function(t){var o,i=e.getSelection(),s="string"==typeof t?n.createTextNode(t):t;i.getRangeAt&&i.rangeCount&&(o=i.getRangeAt(0),o.deleteContents(),o.insertNode(n.createTextNode(" ")),o.insertNode(s),o.setStart(s,0),e.setTimeout(function(){o=n.createRange(),o.setStartAfter(s),o.collapse(!0),i.removeAllRanges(),i.addRange(o)},0))}:n.selection&&n.selection.createRange?function(t){var e=n.selection.createRange();"string"==typeof t?e.text=t:e.pasteHTML(t.outerHTML)}:void 0}(),u.insertAtCursor=function(t,e){t=" "+t;var o,i,s,r=e.value;"undefined"!=typeof e.selectionStart&&"undefined"!=typeof e.selectionEnd?(i=e.selectionStart,o=e.selectionEnd,e.value=r.substring(0,i)+t+r.substring(e.selectionEnd),e.selectionStart=e.selectionEnd=i+t.length):"undefined"!=typeof n.selection&&"undefined"!=typeof n.selection.createRange&&(e.focus(),s=n.selection.createRange(),s.text=t,s.select())},u.extend=function(t,e){if("undefined"!=typeof t&&t||(t={}),"object"==typeof e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},u.escapeRegex=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},u.htmlEntities=function(t){return String(t).replace(/&/g,"&").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};u.altEntities=function(t){t=String(t).replace(/&/g, '&').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');return emoji.emojiarea_get_alt(t);};var c=function(){};c.prototype.setup=function(){var t=this;this.$editor.on("focus",function(){t.hasFocus=!0}),this.$editor.on("blur",function(){t.hasFocus=!1}),this.setupButton()},c.prototype.setupButton=function(){var e,n=this;this.options.button?e=t(this.options.button):this.options.button!==!1?(e=t('<a href="javascript:void(0)">'),e.html(this.options.buttonLabel),e.addClass("emoji-button"),e.attr({title:this.options.buttonLabel}),this.$editor[this.options.buttonPosition](e)):e=t(""),e.on("click",function(t){p.show(n),t.stopPropagation()}),t(".emoji-menu div:first").on("scroll",function(t){p.show(n),t.stopPropagation()}),this.$button=e},c.createIcon=function(t,e){var i=u.altEntities(e);if(i.length===0){return "";}var n=emoji.emojiarea_replace_colons(i[0]);return""===n?"":'<img class="emoji-image" style="'+n+'" alt="'+i+'" src="https://apps.applozic.com/resources/images/blank.gif">'};var h=function(t,e){this.options=e,this.$textarea=t,this.$editor=t,this.setup()};h.prototype.insert=function(e,n){t.emojiarea.icons[e].icons.hasOwnProperty(n)&&(u.insertAtCursor(n,this.$textarea[0]),this.$textarea.trigger("change"))},h.prototype.val=function(){return this.$textarea.val()},u.extend(h.prototype,c.prototype);var l=function(e,o){var i=this;this.options=o,this.$textarea=e,this.$editor=e,this.$editor.attr({contenteditable:"true"}),this.$editor.on("blur keyup paste",function(){return i.onChange.apply(i,arguments)}),this.$editor.on("mousedown focus",function(){n.execCommand("enableObjectResizing",!1,!1)}),this.$editor.on("blur",function(){n.execCommand("enableObjectResizing",!0,!0)});var s=this.$editor.text(),r=t.emojiarea.icons;for(var a in r)for(var h in r[a].icons)r[a].icons.hasOwnProperty(h)&&(s=s.replace(new RegExp(u.escapeRegex(h),"g"),c.createIcon(a,h)));this.$editor.html(s),this.setup(),this.$button.on("mousedown",function(){i.hasFocus&&(i.selection=u.saveSelection())})};l.prototype.onChange=function(){this.$textarea.val(this.val()).trigger("change")},l.prototype.insert=function(e,n){var o=t(c.createIcon(e,n));o[0].attachEvent&&o[0].attachEvent("onresizestart",function(t){t.returnValue=!1},!1),this.$editor.trigger("focus"),this.selection&&u.restoreSelection(this.selection);try{u.replaceSelection(o[0])}catch(i){}this.onChange()},l.prototype.val=function(){for(var t=[],e=[],n=function(){t.push(e.join("")),e=[]},r=function(t){if(t.nodeType===i)e.push(t.nodeValue);else if(t.nodeType===o){var a=t.tagName.toLowerCase(),u=-1!==s.indexOf(a);if(u&&e.length&&n(),"img"===a){var c=t.getAttribute("alt")||"";return void(c&&e.push(c))}"br"===a&&n();for(var h=t.childNodes,l=0;l<h.length;l++)r(h[l]);u&&e.length&&n()}},a=this.$editor[0].childNodes,u=0;u<a.length;u++)r(a[u]);return e.length&&n(),t.join("\n")},u.extend(l.prototype,c.prototype);var p=function(){var o=this,i=t(n.body),s=t(e);this.visible=!1,this.emojiarea=null,this.$menu=t("<div>"),this.$menu.addClass("emoji-menu"),this.$menu.hide(),this.$items=t("<div>").appendTo(this.$menu),i.append(this.$menu),i.on("keydown",function(t){(t.keyCode===r||t.keyCode===a)&&o.hide()}),i.on("mouseup",function(){}),s.on("resize",function(){o.visible&&o.reposition(o.emojiarea.options)}),this.$menu.on("mouseup","a",function(t){return t.stopPropagation(),!1}),t(n).click(function(){o.hide()}),this.$menu.on("click","a",function(n){n.stopPropagation();var i=t(".label",t(this)).text(),s=t(".label",t(this)).parent().parent().attr("group");return s&&""!==i?(e.setTimeout(function(){o.onItemSelected.apply(o,[s,i])},0),!1):void 0}),this.load()};p.prototype.onItemSelected=function(t,e){this.emojiarea.insert(t,e),this.hide()},p.prototype.load=function(){var e=[],n=[],o=t.emojiarea.icons,i=t.emojiarea.path;i.length&&"/"!==i.charAt(i.length-1)&&(i+="/"),n.push('<ul class="group-selector">');for(var s in o){n.push('<a href="#group_'+s+'" class="tab_switch"><li>'+o[s].name+"</li></a>"),e.push('<div class="select_group" group="'+s+'" id="group_'+s+'">');for(var r in o[s].icons)if(o[s].icons.hasOwnProperty(r)){var a=(o[r],c.createIcon(s,r));""!==a&&e.push('<a href="javascript:void(0)" title="'+u.htmlEntities(r)+'">'+a+'<span class="label">'+u.htmlEntities(r)+"</span></a>")}e.push("</div>")}n.push("</ul>"),this.$items.html(e.join("")),this.$menu.prepend(n.join("")),this.$menu.find(".tab_switch").each(function(e){if(0!=e){var n=t(this).attr("href");t(n).hide()}else t(this).addClass("active");t(this).click(function(e){e.preventDefault(),t(this).addClass("active"),t(this).siblings().removeClass("active"),t(".select_group").hide();var n=t(this).attr("href");t(n).show()})})},p.prototype.reposition=function(t){var n=this.emojiarea.$button,o=n.offset();o.left+=Math.round(n.outerWidth()/2),"bottom"===t.menuPosition?(o.top+=n.outerHeight()+92,this.$menu.css({top:o.top,right:10})):this.$menu.css({bottom:e.innerHeight-(o.top-11),right:10,top:"initial"})},p.prototype.hide=function(){this.emojiarea&&(this.emojiarea.menu=null,this.emojiarea.$button.removeClass("on"),this.emojiarea=null),this.visible=!1,this.$menu.hide()},p.prototype.show=function(t){return this.emojiarea&&this.emojiarea===t?void this.hide():(this.emojiarea=t,this.emojiarea.menu=this,this.reposition(t.options),this.$menu.show(),void(this.visible=!0))},p.show=function(){var t=null;return function(e){t=t||new p,t.show(e)}}()}(jQuery,window,document);
