function MckCallingService(e,t,o,n,r,s,i,a,c,l){var u=this,p=$applozic("#mck-vid-icon");$applozic("#mck-sidebox");u.callStartTime=s,u.mckMessageService=i,u.identity=e,u.token=t,u.callId=o,u.isCallHost=r,u.toUserImage=a,u.toUserDisplayName=n,u.isAudioCall=c,u.disconectedByHost,u.rejectedByReceiver,u.twilioService,console.log("is AudioCall:"+c),u.ringTone=l;var d=$applozic("#mck-msg-to"),f=$applozic(".applozic-vid-container"),m=($applozic("#mck-sidebox"),$applozic("#mck-video-call-indicator")),h=$applozic("#mck-unmute-icon"),g=$applozic("#mck-mute-icon"),v=$applozic("#mck-microfone-mute-btn");$applozic("#mck-microfone-mute-btn").off("click").on("click",function(){d.val();var e=u.twilioService.activeRoom;if(e){var t=e.localParticipant.media;t.isMuted?(h.addClass("vis").removeClass("n-vis"),g.addClass("n-vis").removeClass("vis"),v.addClass("mck-unmuted").removeClass("mck-muted"),t.unmute()):(g.addClass("vis").removeClass("n-vis"),h.addClass("n-vis").removeClass("vis"),v.addClass("mck-muted").removeClass("mck-unmuted"),t.mute())}}),$applozic("#mck-vid-disconnect").off("click").on("click",function(){var e=d.val();if(r)if(u.disconectedByHost=!0,u.twilioService.callReceivedAt){var t=u.twilioService.callReceivedAt.getTime(),n=(new Date).getTime()-t;alMessageService.sendVideoCallEndMessage(o,"CALL_END",102,!1,n,e,function(e){i.sendMessage(e)})}else u.ringTone.stop(),alMessageService.sendVideoCallMessage(o,"CALL_MISSED",103,!1,e,function(e){i.sendMessage(e)});u.twilioService.leaveRoomIfJoined(),u.removeTracks(["#mck-vid-media > video","#mck-vid-media > audio","#local-media > video","#local-media > audio"]),f.addClass("n-vis").removeClass("vis"),m.addClass("n-vis").removeClass("vis")}),u.startVideoCall=function(){navigator.webkitGetUserMedia||navigator.mozGetUserMedia||alert("WebRTC is not available in your browser. can not start video call"),u.token||(alert("missing token.. can not make video call"),f.removeClass("vis").addClass("n-vis")),u.twilioService=new TwilioService(u.identity,u.token,u.callId,u.ringTone,u.isAudioCall,u.mckMessageService,u.isCallHost);u.twilioService.InitializeVideoClient();r&&(p.html(a+"<span> Calling "+n+"</span>"),p.removeClass("n-vis").addClass("vis"),setTimeout(function(){u.twilioService.isCallReceived||u.disconectedByHost||u.rejectedByReceiver||(console.log("call is not answered...."),u.ringTone.stop(),alMessageService.sendVideoCallMessage(o,"CALL_MISSED",103,c,toUser,function(e){i.sendMessage(e)}),alert(n+" not Available...."),u.twilioService.leaveRoomIfJoined(),u.removeTracks(["#mck-vid-media > video","#mck-vid-media > audio","#local-media > video","#local-media > audio"]),f.addClass("n-vis").removeClass("vis"))},7e4)),window.addEventListener("beforeunload",u.twilioService.leaveRoomIfJoined),u.twilioService.attachUserMedia(r,c),u.twilioService.joinCall(c),f.removeClass("n-vis").addClass("vis"),h.addClass("vis").removeClass("n-vis"),g.addClass("n-vis").removeClass("vis"),v.addClass("mck-unmuted").removeClass("mck-muted")},u.removeTracks=function(e){$applozic.each(e,function(e,t){$applozic(t).remove()})}}function TwilioService(e,t,r,n,o,s,i){var a=this;a.identity=e,a.token=t,a.callId=r,a.videoClient,a.activeRoom,a.previewMedia,a.ringTone=n,a.isCallReceived,a.callReceivedAt,a.isAudioCall=o,a.mckMessageService=s,a.isCallHost=i;var c=$applozic("#mck-msg-to"),l=$applozic("#mck-vid-icon"),u="#local-media",p="#mck-vid-media",d=($applozic("#local-media > video"),$applozic("#mck-vid-media > video"),$applozic("#local-media")),f=$applozic(".applozic-vid-container"),m=($applozic("#mck-sidebox"),$applozic("#mck-video-call-indicator"));a.InitializeVideoClient=function(){a.videoClient=new Twilio.Video.Client(a.token)},a.joinCall=function(e){a.videoClient&&a.videoClient.connect({to:a.callId}).then(a.roomJoined,function(e){console.log("Could not connect to Twilio: "+e.message)})},a.attachUserMedia=function(t,e){a.previewMedia||(a.previewMedia=new Twilio.Video.LocalMedia,Twilio.Video.getUserMedia().then(function(e){a.previewMedia.addStream(e),t?(a.previewMedia.attach(p),a.ringTone.play()):(a.previewMedia.attach(u),d.removeClass("n-vis").addClass("vis"))},function(e){console.error("Unable to access local media",e),console.log("Unable to access Camera and Microphone")}))},a.roomJoined=function(t){console.log("room detail : "+t),a.activeRoom=t,a.previewMedia||t.localParticipant.media.attach(p),t.participants.forEach(function(e){console.log("Already in Room: '"+e.identity+"'"),e.media.attach("#mck-vid-media")}),t.on("participantConnected",function(e){console.log("participent- "+e.identity+"connected to the room- "+t),a.isCallReceived=!0,a.callReceivedAt=new Date,console.log("callReceivedAt : "+a.callReceivedAt),a.ringTone.stop(),l.addClass("n-vis"),$applozic("#mck-vid-media > video").remove(),$applozic("#mck-vid-media > audio").remove(),t.localParticipant.media.attach(u),d.removeClass("n-vis").addClass("vis"),e.media.attach(p)}),t.on("participantDisconnected",function(e){if(console.log("Participant '"+e.identity+"' left the room"),a.isCallHost){var t=c.val(),n=a.callReceivedAt.getTime(),o=(new Date).getTime()-n;alMessageService.sendVideoCallEndMessage(r,"CALL_END",103,!1,o,t,function(e){s.sendMessage(e)})}e.media.detach(),a.leaveRoomIfJoined(),f.addClass("n-vis").removeClass("vis"),m.addClass("n-vis").removeClass("vis")}),t.on("disconnected",function(){console.log("Left"),t.localParticipant.media.detach(),t.participants.forEach(function(e){e.media.detach()}),a.activeRoom=null})},a.leaveRoomIfJoined=function(){a.activeRoom&&a.activeRoom.disconnect(),a.previewMedia&&a.previewMedia.stop()}}!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).SockJS=e()}(function(){return function s(i,a,c){function l(t,e){if(!a[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var r=a[t]={exports:{}};i[t][0].call(r.exports,function(e){return l(i[t][1][e]||e)},r,r.exports,s,i,a,c)}return a[t].exports}for(var u="function"==typeof require&&require,e=0;e<c.length;e++)l(c[e]);return l}({1:[function(n,o,e){(function(e){"use strict";var t=n("./transport-list");o.exports=n("./main")(t),"_sockjs_onload"in e&&setTimeout(e._sockjs_onload,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./main":14,"./transport-list":16}],2:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./event");function s(){r.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}o(s,r),t.exports=s},{"./event":4,inherits:54}],3:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./eventtarget");function s(){r.call(this)}o(s,r),s.prototype.removeAllListeners=function(e){e?delete this._listeners[e]:this._listeners={}},s.prototype.once=function(t,n){var o=this,r=!1;this.on(t,function e(){o.removeListener(t,e),r||(r=!0,n.apply(this,arguments))})},s.prototype.emit=function(){var e=arguments[0],t=this._listeners[e];if(t){for(var n=arguments.length,o=new Array(n-1),r=1;r<n;r++)o[r-1]=arguments[r];for(var s=0;s<t.length;s++)t[s].apply(this,o)}},s.prototype.on=s.prototype.addListener=r.prototype.addEventListener,s.prototype.removeListener=r.prototype.removeEventListener,t.exports.EventEmitter=s},{"./eventtarget":5,inherits:54}],4:[function(e,t,n){"use strict";function o(e){this.type=e}o.prototype.initEvent=function(e,t,n){return this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=+new Date,this},o.prototype.stopPropagation=function(){},o.prototype.preventDefault=function(){},o.CAPTURING_PHASE=1,o.AT_TARGET=2,o.BUBBLING_PHASE=3,t.exports=o},{}],5:[function(e,t,n){"use strict";function o(){this._listeners={}}o.prototype.addEventListener=function(e,t){e in this._listeners||(this._listeners[e]=[]);var n=this._listeners[e];-1===n.indexOf(t)&&(n=n.concat([t])),this._listeners[e]=n},o.prototype.removeEventListener=function(e,t){var n=this._listeners[e];if(n){var o=n.indexOf(t);-1===o||(1<n.length?this._listeners[e]=n.slice(0,o).concat(n.slice(o+1)):delete this._listeners[e])}},o.prototype.dispatchEvent=function(){var e=arguments[0],t=e.type,n=1===arguments.length?[e]:Array.apply(null,arguments);if(this["on"+t]&&this["on"+t].apply(this,n),t in this._listeners)for(var o=this._listeners[t],r=0;r<o.length;r++)o[r].apply(this,n)},t.exports=o},{}],6:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./event");function s(e){r.call(this),this.initEvent("message",!1,!1),this.data=e}o(s,r),t.exports=s},{"./event":4,inherits:54}],7:[function(e,t,n){"use strict";var o=e("json3"),r=e("./utils/iframe");function s(e){(this._transport=e).on("message",this._transportMessage.bind(this)),e.on("close",this._transportClose.bind(this))}s.prototype._transportClose=function(e,t){r.postMessage("c",o.stringify([e,t]))},s.prototype._transportMessage=function(e){r.postMessage("t",e)},s.prototype._send=function(e){this._transport.send(e)},s.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},t.exports=s},{"./utils/iframe":47,json3:55}],8:[function(e,t,n){"use strict";var p=e("./utils/url"),o=e("./utils/event"),d=e("json3"),f=e("./facade"),r=e("./info-iframe-receiver"),m=e("./utils/iframe"),h=e("./location");t.exports=function(c,e){var l,u={};e.forEach(function(e){e.facadeTransport&&(u[e.facadeTransport.transportName]=e.facadeTransport)}),u[r.transportName]=r,c.bootstrap_iframe=function(){var a;m.currentWindowId=h.hash.slice(1),o.attachEvent("message",function(e){if(e.source===parent&&(void 0===l&&(l=e.origin),e.origin===l)){var t;try{t=d.parse(e.data)}catch(n){return void e.data}if(t.windowId===m.currentWindowId)switch(t.type){case"s":var n;try{n=d.parse(t.data)}catch(n){t.data;break}var o=n[0],r=n[1],s=n[2],i=n[3];if(o!==c.version)throw new Error('Incompatible SockJS! Main site uses: "'+o+'", the iframe: "'+c.version+'".');if(!p.isOriginEqual(s,h.href)||!p.isOriginEqual(i,h.href))throw new Error("Can't connect to different domain from within an iframe. ("+h.href+", "+s+", "+i+")");a=new f(new u[r](s,i));break;case"m":a._send(t.data);break;case"c":a&&a._close(),a=null}}}),m.postMessage("s")}}},{"./facade":7,"./info-iframe-receiver":10,"./location":13,"./utils/event":46,"./utils/iframe":47,"./utils/url":52,debug:void 0,json3:55}],9:[function(e,t,n){"use strict";var o=e("events").EventEmitter,r=e("inherits"),i=e("json3"),a=e("./utils/object"),c=function(){};function s(e,t){o.call(this);var r=this,s=+new Date;this.xo=new t("GET",e),this.xo.once("finish",function(e,t){var n,o;if(200===e){if(o=+new Date-s,t)try{n=i.parse(t)}catch(e){c("bad json",t)}a.isObject(n)||(n={})}r.emit("finish",n,o),r.removeAllListeners()})}r(s,o),s.prototype.close=function(){this.removeAllListeners(),this.xo.close()},t.exports=s},{"./utils/object":49,debug:void 0,events:3,inherits:54,json3:55}],10:[function(e,t,n){"use strict";var o=e("inherits"),r=e("events").EventEmitter,s=e("json3"),i=e("./transport/sender/xhr-local"),a=e("./info-ajax");function c(e){var n=this;r.call(this),this.ir=new a(e,i),this.ir.once("finish",function(e,t){n.ir=null,n.emit("message",s.stringify([e,t]))})}o(c,r),c.transportName="iframe-info-receiver",c.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},t.exports=c},{"./info-ajax":9,"./transport/sender/xhr-local":37,events:3,inherits:54,json3:55}],11:[function(n,r,e){(function(o){"use strict";var s=n("events").EventEmitter,e=n("inherits"),i=n("json3"),a=n("./utils/event"),c=n("./transport/iframe"),l=n("./info-iframe-receiver"),u=function(){};function t(t,n){var r=this;function e(){var e=r.ifr=new c(l.transportName,n,t);e.once("message",function(e){if(e){var t;try{t=i.parse(e)}catch(t){return u("bad json",e),r.emit("finish"),void r.close()}var n=t[0],o=t[1];r.emit("finish",n,o)}r.close()}),e.once("close",function(){r.emit("finish"),r.close()})}s.call(this),o.document.body?e():a.attachEvent("load",e)}e(t,s),t.enabled=function(){return c.enabled()},t.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},r.exports=t}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./info-iframe-receiver":10,"./transport/iframe":22,"./utils/event":46,debug:void 0,events:3,inherits:54,json3:55}],12:[function(e,t,n){"use strict";var o=e("events").EventEmitter,r=e("inherits"),s=e("./utils/url"),i=e("./transport/sender/xdr"),a=e("./transport/sender/xhr-cors"),c=e("./transport/sender/xhr-local"),l=e("./transport/sender/xhr-fake"),u=e("./info-iframe"),p=e("./info-ajax"),d=function(){};function f(e,t){d(e);var n=this;o.call(this),setTimeout(function(){n.doXhr(e,t)},0)}r(f,o),f._getReceiver=function(e,t,n){return n.sameOrigin?new p(t,c):a.enabled?new p(t,a):i.enabled&&n.sameScheme?new p(t,i):u.enabled()?new u(e,t):new p(t,l)},f.prototype.doXhr=function(e,t){var n=this,o=s.addPath(e,"/info");d("doXhr",o),this.xo=f._getReceiver(e,o,t),this.timeoutRef=setTimeout(function(){d("timeout"),n._cleanup(!1),n.emit("finish")},f.timeout),this.xo.once("finish",function(e,t){d("finish",e,t),n._cleanup(!0),n.emit("finish",e,t)})},f.prototype._cleanup=function(e){d("_cleanup"),clearTimeout(this.timeoutRef),this.timeoutRef=null,!e&&this.xo&&this.xo.close(),this.xo=null},f.prototype.close=function(){d("close"),this.removeAllListeners(),this._cleanup(!1)},f.timeout=8e3,t.exports=f},{"./info-ajax":9,"./info-iframe":11,"./transport/sender/xdr":34,"./transport/sender/xhr-cors":35,"./transport/sender/xhr-fake":36,"./transport/sender/xhr-local":37,"./utils/url":52,debug:void 0,events:3,inherits:54}],13:[function(e,t,n){(function(e){"use strict";t.exports=e.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],14:[function(A,M,e){(function(s){"use strict";A("./shims");var o,c=A("url-parse"),e=A("inherits"),i=A("json3"),l=A("./utils/random"),t=A("./utils/escape"),u=A("./utils/url"),a=A("./utils/event"),n=A("./utils/transport"),r=A("./utils/object"),p=A("./utils/browser"),d=A("./utils/log"),f=A("./event/event"),m=A("./event/eventtarget"),h=A("./location"),g=A("./event/close"),v=A("./event/trans-message"),y=A("./info-receiver"),b=function(){};function S(e,t,n){if(!(this instanceof S))return new S(e,t,n);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");m.call(this),this.readyState=S.CONNECTING,this.extensions="",this.protocol="",(n=n||{}).protocols_whitelist&&d.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=n.transports,this._transportOptions=n.transportOptions||{},this._timeout=n.timeout||0;var o=n.sessionId||8;if("function"==typeof o)this._generateSessionId=o;else{if("number"!=typeof o)throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return l.string(o)}}this._server=n.server||l.numberString(1e3);var r=new c(e);if(!r.host||!r.protocol)throw new SyntaxError("The URL '"+e+"' is invalid");if(r.hash)throw new SyntaxError("The URL must not contain a fragment");if("http:"!==r.protocol&&"https:"!==r.protocol)throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+r.protocol+"' is not allowed.");var s="https:"===r.protocol;if("https:"===h.protocol&&!s)throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");t?Array.isArray(t)||(t=[t]):t=[];var i=t.sort();i.forEach(function(e,t){if(!e)throw new SyntaxError("The protocols entry '"+e+"' is invalid.");if(t<i.length-1&&e===i[t+1])throw new SyntaxError("The protocols entry '"+e+"' is duplicated.")});var a=u.getOrigin(h.href);this._origin=a?a.toLowerCase():null,r.set("pathname",r.pathname.replace(/\/+$/,"")),this.url=r.href,b("using url",this.url),this._urlInfo={nullOrigin:!p.hasDomain(),sameOrigin:u.isOriginEqual(this.url,h.href),sameScheme:u.isSchemeEqual(this.url,h.href)},this._ir=new y(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function w(e){return 1e3===e||3e3<=e&&e<=4999}e(S,m),S.prototype.close=function(e,t){if(e&&!w(e))throw new Error("InvalidAccessError: Invalid code");if(t&&123<t.length)throw new SyntaxError("reason argument has an invalid length");this.readyState!==S.CLOSING&&this.readyState!==S.CLOSED&&this._close(e||1e3,t||"Normal closure",!0)},S.prototype.send=function(e){if("string"!=typeof e&&(e=""+e),this.readyState===S.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===S.OPEN&&this._transport.send(t.quote(e))},S.version=A("./version"),S.CONNECTING=0,S.OPEN=1,S.CLOSING=2,S.CLOSED=3,S.prototype._receiveInfo=function(e,t){if(b("_receiveInfo",t),this._ir=null,e){this._rto=this.countRTO(t),this._transUrl=e.base_url?e.base_url:this.url,e=r.extend(e,this._urlInfo),b("info",e);var n=o.filterToEnabled(this._transportsWhitelist,e);this._transports=n.main,b(this._transports.length+" enabled transports"),this._connect()}else this._close(1002,"Cannot connect to server")},S.prototype._connect=function(){for(var e=this._transports.shift();e;e=this._transports.shift()){if(b("attempt",e.transportName),e.needBody&&(!s.document.body||void 0!==s.document.readyState&&"complete"!==s.document.readyState&&"interactive"!==s.document.readyState))return b("waiting for body"),this._transports.unshift(e),void a.attachEvent("load",this._connect.bind(this));var t=Math.max(this._timeout,this._rto*e.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),t),b("using timeout",t);var n=u.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),o=this._transportOptions[e.transportName];b("transport url",n);var r=new e(n,this._transUrl,o);return r.on("message",this._transportMessage.bind(this)),r.once("close",this._transportClose.bind(this)),r.transportName=e.transportName,void(this._transport=r)}this._close(2e3,"All transports failed",!1)},S.prototype._transportTimeout=function(){b("_transportTimeout"),this.readyState===S.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},S.prototype._transportMessage=function(e){b("_transportMessage",e);var t,n=this,o=e.slice(0,1),r=e.slice(1);switch(o){case"o":return void this._open();case"h":return this.dispatchEvent(new f("heartbeat")),void b("heartbeat",this.transport)}if(r)try{t=i.parse(r)}catch(e){b("bad json",r)}if(void 0!==t)switch(o){case"a":Array.isArray(t)&&t.forEach(function(e){b("message",n.transport,e),n.dispatchEvent(new v(e))});break;case"m":b("message",this.transport,t),this.dispatchEvent(new v(t));break;case"c":Array.isArray(t)&&2===t.length&&this._close(t[0],t[1],!0)}else b("empty payload",r)},S.prototype._transportClose=function(e,t){b("_transportClose",this.transport,e,t),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),w(e)||2e3===e||this.readyState!==S.CONNECTING?this._close(e,t):this._connect()},S.prototype._open=function(){b("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===S.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=S.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new f("open")),b("connected",this.transport)):this._close(1006,"Server lost session")},S.prototype._close=function(t,n,o){b("_close",this.transport,t,n,o,this.readyState);var r=!1;if(this._ir&&(r=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===S.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=S.CLOSING,setTimeout(function(){this.readyState=S.CLOSED,r&&this.dispatchEvent(new f("error"));var e=new g("close");e.wasClean=o||!1,e.code=t||1e3,e.reason=n,this.dispatchEvent(e),this.onmessage=this.onclose=this.onerror=null,b("disconnected")}.bind(this),0)},S.prototype.countRTO=function(e){return 100<e?4*e:300+e},M.exports=function(e){return o=n(e),A("./iframe-bootstrap")(S,e),S}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./event/close":2,"./event/event":4,"./event/eventtarget":5,"./event/trans-message":6,"./iframe-bootstrap":8,"./info-receiver":12,"./location":13,"./shims":15,"./utils/browser":44,"./utils/escape":45,"./utils/event":46,"./utils/log":48,"./utils/object":49,"./utils/random":50,"./utils/transport":51,"./utils/url":52,"./version":53,debug:void 0,inherits:54,json3:55,"url-parse":58}],15:[function(e,t,n){"use strict";function a(e){return"[object Function]"===s.toString.call(e)}function c(e){return"[object String]"===p.call(e)}var r,u=Array.prototype,s=Object.prototype,o=Function.prototype,i=String.prototype,l=u.slice,p=s.toString,d=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}();function f(e,t,n){for(var o in t)s.hasOwnProperty.call(t,o)&&r(e,o,t[o],n)}function m(e){if(null==e)throw new TypeError("can't convert "+e+" to object");return Object(e)}function h(){}r=d?function(e,t,n,o){!o&&t in e||Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(e,t,n,o){!o&&t in e||(e[t]=n)},f(o,{bind:function(t){var n=this;if(!a(n))throw new TypeError("Function.prototype.bind called on incompatible "+n);for(var o=l.call(arguments,1),e=Math.max(0,n.length-o.length),r=[],s=0;s<e;s++)r.push("$"+s);var i=Function("binder","return function ("+r.join(",")+"){ return binder.apply(this, arguments); }")(function(){if(this instanceof i){var e=n.apply(this,o.concat(l.call(arguments)));return Object(e)===e?e:this}return n.apply(t,o.concat(l.call(arguments)))});return n.prototype&&(h.prototype=n.prototype,i.prototype=new h,h.prototype=null),i}}),f(Array,{isArray:function(e){return"[object Array]"===p.call(e)}});var g,v,y,b=Object("a"),S="a"!==b[0]||!(0 in b);f(u,{forEach:function(e,t){var n=m(this),o=S&&c(this)?this.split(""):n,r=t,s=-1,i=o.length>>>0;if(!a(e))throw new TypeError;for(;++s<i;)s in o&&e.call(r,o[s],s,n)}},(g=u.forEach,y=v=!0,g&&(g.call("foo",function(e,t,n){"object"!=typeof n&&(v=!1)}),g.call([1],function(){y="string"==typeof this},"x")),!(g&&v&&y)));var w=Array.prototype.indexOf&&-1!==[0,1].indexOf(1,2);f(u,{indexOf:function(e,t){var n=S&&c(this)?this.split(""):m(this),o=n.length>>>0;if(!o)return-1;var r,s=0;for(1<arguments.length&&(r=void 0,(r=+t)!=r?r=0:0!==r&&r!==1/0&&r!==-1/0&&(r=(0<r||-1)*Math.floor(Math.abs(r))),s=r),s=0<=s?s:Math.max(0,o+s);s<o;s++)if(s in n&&n[s]===e)return s;return-1}},w);var A,M=i.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||1<".".split(/()()/).length?(A=void 0===/()??/.exec("")[1],i.split=function(e,t){var n=this;if(void 0===e&&0===t)return[];if("[object RegExp]"!==p.call(e))return M.call(this,e,t);var o,r,s,i,a=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":""),l=0;for(e=new RegExp(e.source,c+"g"),n+="",A||(o=new RegExp("^"+e.source+"$(?!\\s)",c)),t=void 0===t?-1>>>0:t>>>0;(r=e.exec(n))&&!(l<(s=r.index+r[0].length)&&(a.push(n.slice(l,r.index)),!A&&1<r.length&&r[0].replace(o,function(){for(var e=1;e<arguments.length-2;e++)void 0===arguments[e]&&(r[e]=void 0)}),1<r.length&&r.index<n.length&&u.push.apply(a,r.slice(1)),i=r[0].length,l=s,a.length>=t));)e.lastIndex===r.index&&e.lastIndex++;return l===n.length?!i&&e.test("")||a.push(""):a.push(n.slice(l)),a.length>t?a.slice(0,t):a}):"0".split(void 0,0).length&&(i.split=function(e,t){return void 0===e&&0===t?[]:M.call(this,e,t)});var C=i.substr;f(i,{substr:function(e,t){return C.call(this,e<0&&(e=this.length+e)<0?0:e,t)}},"".substr&&"b"!=="0b".substr(-1))},{}],16:[function(e,t,n){"use strict";t.exports=[e("./transport/websocket"),e("./transport/xhr-streaming"),e("./transport/xdr-streaming"),e("./transport/eventsource"),e("./transport/lib/iframe-wrap")(e("./transport/eventsource")),e("./transport/htmlfile"),e("./transport/lib/iframe-wrap")(e("./transport/htmlfile")),e("./transport/xhr-polling"),e("./transport/xdr-polling"),e("./transport/lib/iframe-wrap")(e("./transport/xhr-polling")),e("./transport/jsonp-polling")]},{"./transport/eventsource":20,"./transport/htmlfile":21,"./transport/jsonp-polling":23,"./transport/lib/iframe-wrap":26,"./transport/websocket":38,"./transport/xdr-polling":39,"./transport/xdr-streaming":40,"./transport/xhr-polling":41,"./transport/xhr-streaming":42}],17:[function(r,p,e){(function(e){"use strict";var s=r("events").EventEmitter,t=r("inherits"),i=r("../../utils/event"),a=r("../../utils/url"),c=e.XMLHttpRequest,l=function(){};function u(e,t,n,o){l(e,t);var r=this;s.call(this),setTimeout(function(){r._start(e,t,n,o)},0)}t(u,s),u.prototype._start=function(e,t,n,o){var r=this;try{this.xhr=new c}catch(e){}if(!this.xhr)return l("no xhr"),this.emit("finish",0,"no xhr support"),void this._cleanup();t=a.addQuery(t,"t="+ +new Date),this.unloadRef=i.unloadAdd(function(){l("unload cleanup"),r._cleanup(!0)});try{this.xhr.open(e,t,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){l("xhr timeout"),r.emit("finish",0,""),r._cleanup(!1)})}catch(e){return l("exception",e),this.emit("finish",0,""),void this._cleanup(!1)}if(o&&o.noCredentials||!u.supportsCORS||(l("withCredentials"),this.xhr.withCredentials=!0),o&&o.headers)for(var s in o.headers)this.xhr.setRequestHeader(s,o.headers[s]);this.xhr.onreadystatechange=function(){if(r.xhr){var e,t,n=r.xhr;switch(l("readyState",n.readyState),n.readyState){case 3:try{t=n.status,e=n.responseText}catch(e){}l("status",t),1223===t&&(t=204),200===t&&e&&0<e.length&&(l("chunk"),r.emit("chunk",t,e));break;case 4:t=n.status,l("status",t),1223===t&&(t=204),12005!==t&&12029!==t||(t=0),l("finish",t,n.responseText),r.emit("finish",t,n.responseText),r._cleanup(!1)}}};try{r.xhr.send(n)}catch(e){r.emit("finish",0,""),r._cleanup(!1)}},u.prototype._cleanup=function(e){if(l("cleanup"),this.xhr){if(this.removeAllListeners(),i.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),e)try{this.xhr.abort()}catch(e){}this.unloadRef=this.xhr=null}},u.prototype.close=function(){l("close"),this._cleanup(!0)},u.enabled=!!c;var n=["Active"].concat("Object").join("X");!u.enabled&&n in e&&(l("overriding xmlhttprequest"),u.enabled=!!new(c=function(){try{return new e[n]("Microsoft.XMLHTTP")}catch(e){return null}}));var o=!1;try{o="withCredentials"in new c}catch(e){}u.supportsCORS=o,p.exports=u}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],18:[function(e,t,n){(function(e){t.exports=e.EventSource}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(e,n,t){(function(e){"use strict";var t=e.WebSocket||e.MozWebSocket;n.exports=t?function(e){return new t(e)}:void 0}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./lib/ajax-based"),s=e("./receiver/eventsource"),i=e("./sender/xhr-cors"),a=e("eventsource");function c(e){if(!c.enabled())throw new Error("Transport created when disabled");r.call(this,e,"/eventsource",s,i)}o(c,r),c.enabled=function(){return!!a},c.transportName="eventsource",c.roundTrips=2,t.exports=c},{"./lib/ajax-based":24,"./receiver/eventsource":29,"./sender/xhr-cors":35,eventsource:18,inherits:54}],21:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./receiver/htmlfile"),s=e("./sender/xhr-local"),i=e("./lib/ajax-based");function a(e){if(!r.enabled)throw new Error("Transport created when disabled");i.call(this,e,"/htmlfile",r,s)}o(a,i),a.enabled=function(e){return r.enabled&&e.sameOrigin},a.transportName="htmlfile",a.roundTrips=2,t.exports=a},{"./lib/ajax-based":24,"./receiver/htmlfile":30,"./sender/xhr-local":37,inherits:54}],22:[function(e,t,n){"use strict";var o=e("inherits"),r=e("json3"),s=e("events").EventEmitter,i=e("../version"),a=e("../utils/url"),c=e("../utils/iframe"),l=e("../utils/event"),u=e("../utils/random"),p=function(){};function d(e,t,n){if(!d.enabled())throw new Error("Transport created when disabled");s.call(this);var o=this;this.origin=a.getOrigin(n),this.baseUrl=n,this.transUrl=t,this.transport=e,this.windowId=u.string(8);var r=a.addPath(n,"/iframe.html")+"#"+this.windowId;p(e,t,r),this.iframeObj=c.createIframe(r,function(e){p("err callback"),o.emit("close",1006,"Unable to load an iframe ("+e+")"),o.close()}),this.onmessageCallback=this._message.bind(this),l.attachEvent("message",this.onmessageCallback)}o(d,s),d.prototype.close=function(){if(p("close"),this.removeAllListeners(),this.iframeObj){l.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch(e){}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},d.prototype._message=function(e){if(p("message",e.data),a.isOriginEqual(e.origin,this.origin)){var t;try{t=r.parse(e.data)}catch(n){return void p("bad json",e.data)}if(t.windowId===this.windowId)switch(t.type){case"s":this.iframeObj.loaded(),this.postMessage("s",r.stringify([i,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",t.data);break;case"c":var n;try{n=r.parse(t.data)}catch(n){return void p("bad json",t.data)}this.emit("close",n[0],n[1]),this.close()}else p("mismatched window id",t.windowId,this.windowId)}else p("not same origin",e.origin,this.origin)},d.prototype.postMessage=function(e,t){p("postMessage",e,t),this.iframeObj.post(r.stringify({windowId:this.windowId,type:e,data:t||""}),this.origin)},d.prototype.send=function(e){p("send",e),this.postMessage("m",e)},d.enabled=function(){return c.iframeEnabled},d.transportName="iframe",d.roundTrips=2,t.exports=d},{"../utils/event":46,"../utils/iframe":47,"../utils/random":50,"../utils/url":52,"../version":53,debug:void 0,events:3,inherits:54,json3:55}],23:[function(i,a,e){(function(e){"use strict";var t=i("inherits"),n=i("./lib/sender-receiver"),o=i("./receiver/jsonp"),r=i("./sender/jsonp");function s(e){if(!s.enabled())throw new Error("Transport created when disabled");n.call(this,e,"/jsonp",r,o)}t(s,n),s.enabled=function(){return!!e.document},s.transportName="jsonp-polling",s.roundTrips=1,s.needBody=!0,a.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/sender-receiver":28,"./receiver/jsonp":31,"./sender/jsonp":33,inherits:54}],24:[function(e,t,n){"use strict";var o=e("inherits"),a=e("../../utils/url"),r=e("./sender-receiver"),c=function(){};function s(e,t,n,o){var i;r.call(this,e,t,(i=o,function(e,t,n){c("create ajax sender",e,t);var o={};"string"==typeof t&&(o.headers={"Content-type":"text/plain"});var r=a.addPath(e,"/xhr_send"),s=new i("POST",r,t,o);return s.once("finish",function(e){if(c("finish",e),s=null,200!==e&&204!==e)return n(new Error("http status "+e));n()}),function(){c("abort"),s.close(),s=null;var e=new Error("Aborted");e.code=1e3,n(e)}}),n,o)}o(s,r),t.exports=s},{"../../utils/url":52,"./sender-receiver":28,debug:void 0,inherits:54}],25:[function(e,t,n){"use strict";var o=e("inherits"),r=e("events").EventEmitter,s=function(){};function i(e,t){s(e),r.call(this),this.sendBuffer=[],this.sender=t,this.url=e}o(i,r),i.prototype.send=function(e){s("send",e),this.sendBuffer.push(e),this.sendStop||this.sendSchedule()},i.prototype.sendScheduleWait=function(){s("sendScheduleWait");var e,t=this;this.sendStop=function(){s("sendStop"),t.sendStop=null,clearTimeout(e)},e=setTimeout(function(){s("timeout"),t.sendStop=null,t.sendSchedule()},25)},i.prototype.sendSchedule=function(){s("sendSchedule",this.sendBuffer.length);var t=this;if(0<this.sendBuffer.length){var e="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,e,function(e){t.sendStop=null,e?(s("error",e),t.emit("close",e.code||1006,"Sending error: "+e),t.close()):t.sendScheduleWait()}),this.sendBuffer=[]}},i.prototype._cleanup=function(){s("_cleanup"),this.removeAllListeners()},i.prototype.close=function(){s("close"),this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},t.exports=i},{debug:void 0,events:3,inherits:54}],26:[function(e,n,t){(function(r){"use strict";var t=e("inherits"),s=e("../iframe"),i=e("../../utils/object");n.exports=function(o){function e(e,t){s.call(this,o.transportName,e,t)}return t(e,s),e.enabled=function(e,t){if(!r.document)return!1;var n=i.extend({},t);return n.sameOrigin=!0,o.enabled(n)&&s.enabled()},e.transportName="iframe-"+o.transportName,e.needBody=!0,e.roundTrips=s.roundTrips+o.roundTrips-1,e.facadeTransport=o,e}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/object":49,"../iframe":22,inherits:54}],27:[function(e,t,n){"use strict";var o=e("inherits"),r=e("events").EventEmitter,s=function(){};function i(e,t,n){s(t),r.call(this),this.Receiver=e,this.receiveUrl=t,this.AjaxObject=n,this._scheduleReceiver()}o(i,r),i.prototype._scheduleReceiver=function(){s("_scheduleReceiver");var n=this,o=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);o.on("message",function(e){s("message",e),n.emit("message",e)}),o.once("close",function(e,t){s("close",e,t,n.pollIsClosing),n.poll=o=null,n.pollIsClosing||("network"===t?n._scheduleReceiver():(n.emit("close",e||1006,t),n.removeAllListeners()))})},i.prototype.abort=function(){s("abort"),this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},t.exports=i},{debug:void 0,events:3,inherits:54}],28:[function(e,t,n){"use strict";var o=e("inherits"),a=e("../../utils/url"),c=e("./buffered-sender"),l=e("./polling"),u=function(){};function r(e,t,n,o,r){var s=a.addPath(e,t);u(s);var i=this;c.call(this,e,n),this.poll=new l(o,s,r),this.poll.on("message",function(e){u("poll message",e),i.emit("message",e)}),this.poll.once("close",function(e,t){u("poll close",e,t),i.poll=null,i.emit("close",e,t),i.close()})}o(r,c),r.prototype.close=function(){c.prototype.close.call(this),u("close"),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},t.exports=r},{"../../utils/url":52,"./buffered-sender":25,"./polling":27,debug:void 0,inherits:54}],29:[function(e,t,n){"use strict";var o=e("inherits"),r=e("events").EventEmitter,s=e("eventsource"),i=function(){};function a(e){i(e),r.call(this);var n=this,o=this.es=new s(e);o.onmessage=function(e){i("message",e.data),n.emit("message",decodeURI(e.data))},o.onerror=function(e){i("error",o.readyState,e);var t=2!==o.readyState?"network":"permanent";n._cleanup(),n._close(t)}}o(a,r),a.prototype.abort=function(){i("abort"),this._cleanup(),this._close("user")},a.prototype._cleanup=function(){i("cleanup");var e=this.es;e&&(e.onmessage=e.onerror=null,e.close(),this.es=null)},a.prototype._close=function(e){i("close",e);var t=this;setTimeout(function(){t.emit("close",null,e),t.removeAllListeners()},200)},t.exports=a},{debug:void 0,events:3,eventsource:18,inherits:54}],30:[function(n,u,e){(function(o){"use strict";var e=n("inherits"),r=n("../../utils/iframe"),s=n("../../utils/url"),i=n("events").EventEmitter,a=n("../../utils/random"),c=function(){};function l(e){c(e),i.call(this);var t=this;r.polluteGlobalNamespace(),this.id="a"+a.string(6),e=s.addQuery(e,"c="+decodeURIComponent(r.WPrefix+"."+this.id)),c("using htmlfile",l.htmlfileEnabled);var n=l.htmlfileEnabled?r.createHtmlfile:r.createIframe;o[r.WPrefix][this.id]={start:function(){c("start"),t.iframeObj.loaded()},message:function(e){c("message",e),t.emit("message",e)},stop:function(){c("stop"),t._cleanup(),t._close("network")}},this.iframeObj=n(e,function(){c("callback"),t._cleanup(),t._close("permanent")})}e(l,i),l.prototype.abort=function(){c("abort"),this._cleanup(),this._close("user")},l.prototype._cleanup=function(){c("_cleanup"),this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete o[r.WPrefix][this.id]},l.prototype._close=function(e){c("_close",e),this.emit("close",null,e),this.removeAllListeners()},l.htmlfileEnabled=!1;var t=["Active"].concat("Object").join("X");if(t in o)try{l.htmlfileEnabled=!!new o[t]("htmlfile")}catch(e){}l.enabled=l.htmlfileEnabled||r.iframeEnabled,u.exports=l}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],31:[function(t,n,e){(function(s){"use strict";var o=t("../../utils/iframe"),i=t("../../utils/random"),a=t("../../utils/browser"),r=t("../../utils/url"),e=t("inherits"),c=t("events").EventEmitter,l=function(){};function u(e){l(e);var t=this;c.call(this),o.polluteGlobalNamespace(),this.id="a"+i.string(6);var n=r.addQuery(e,"c="+encodeURIComponent(o.WPrefix+"."+this.id));s[o.WPrefix][this.id]=this._callback.bind(this),this._createScript(n),this.timeoutId=setTimeout(function(){l("timeout"),t._abort(new Error("JSONP script loaded abnormally (timeout)"))},u.timeout)}e(u,c),u.prototype.abort=function(){if(l("abort"),s[o.WPrefix][this.id]){var e=new Error("JSONP user aborted read");e.code=1e3,this._abort(e)}},u.timeout=35e3,u.scriptErrorTimeout=1e3,u.prototype._callback=function(e){l("_callback",e),this._cleanup(),this.aborting||(e&&(l("message",e),this.emit("message",e)),this.emit("close",null,"network"),this.removeAllListeners())},u.prototype._abort=function(e){l("_abort",e),this._cleanup(),this.aborting=!0,this.emit("close",e.code,e.message),this.removeAllListeners()},u.prototype._cleanup=function(){if(l("_cleanup"),clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var e=this.script;e.parentNode.removeChild(e),e.onreadystatechange=e.onerror=e.onload=e.onclick=null,this.script=null}delete s[o.WPrefix][this.id]},u.prototype._scriptError=function(){l("_scriptError");var e=this;this.errorTimer||(this.errorTimer=setTimeout(function(){e.loadedOkay||e._abort(new Error("JSONP script loaded abnormally (onerror)"))},u.scriptErrorTimeout))},u.prototype._createScript=function(e){l("_createScript",e);var t,n=this,o=this.script=s.document.createElement("script");if(o.id="a"+i.string(8),o.src=e,o.type="text/javascript",o.charset="UTF-8",o.onerror=this._scriptError.bind(this),o.onload=function(){l("onload"),n._abort(new Error("JSONP script loaded abnormally (onload)"))},o.onreadystatechange=function(){if(l("onreadystatechange",o.readyState),/loaded|closed/.test(o.readyState)){if(o&&o.htmlFor&&o.onclick){n.loadedOkay=!0;try{o.onclick()}catch(e){}}o&&n._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},void 0===o.async&&s.document.attachEvent)if(a.isOpera())(t=this.script2=s.document.createElement("script")).text="try{var a = document.getElementById('"+o.id+"'); if(a)a.onerror();}catch(x){};",o.async=t.async=!1;else{try{o.htmlFor=o.id,o.event="onclick"}catch(e){}o.async=!0}void 0!==o.async&&(o.async=!0);var r=s.document.getElementsByTagName("head")[0];r.insertBefore(o,r.firstChild),t&&r.insertBefore(t,r.firstChild)},n.exports=u}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],32:[function(e,t,n){"use strict";var o=e("inherits"),r=e("events").EventEmitter,s=function(){};function i(e,t){s(e),r.call(this);var o=this;this.bufferPosition=0,this.xo=new t("POST",e,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(e,t){s("finish",e,t),o._chunkHandler(e,t),o.xo=null;var n=200===e?"network":"permanent";s("close",n),o.emit("close",null,n),o._cleanup()})}o(i,r),i.prototype._chunkHandler=function(e,t){if(s("_chunkHandler",e),200===e&&t)for(var n=-1;;this.bufferPosition+=n+1){var o=t.slice(this.bufferPosition);if(-1===(n=o.indexOf("\n")))break;var r=o.slice(0,n);r&&(s("message",r),this.emit("message",r))}},i.prototype._cleanup=function(){s("_cleanup"),this.removeAllListeners()},i.prototype.abort=function(){s("abort"),this.xo&&(this.xo.close(),s("close"),this.emit("close",null,"user"),this.xo=null),this._cleanup()},t.exports=i},{debug:void 0,events:3,inherits:54}],33:[function(e,t,n){(function(i){"use strict";var a,c,l=e("../../utils/random"),u=e("../../utils/url"),p=function(){};t.exports=function(e,t,n){p(e,t),a||(p("createForm"),(a=i.document.createElement("form")).style.display="none",a.style.position="absolute",a.method="POST",a.enctype="application/x-www-form-urlencoded",a.acceptCharset="UTF-8",(c=i.document.createElement("textarea")).name="d",a.appendChild(c),i.document.body.appendChild(a));var o="a"+l.string(8);a.target=o,a.action=u.addQuery(u.addPath(e,"/jsonp_send"),"i="+o);var r=function(t){p("createIframe",t);try{return i.document.createElement('<iframe name="'+t+'">')}catch(e){var n=i.document.createElement("iframe");return n.name=t,n}}(o);r.id=o,r.style.display="none",a.appendChild(r);try{c.value=t}catch(e){}function s(e){p("completed",o,e),r.onerror&&(r.onreadystatechange=r.onerror=r.onload=null,setTimeout(function(){p("cleaning up",o),r.parentNode.removeChild(r),r=null},500),c.value="",n(e))}return a.submit(),r.onerror=function(){p("onerror",o),s()},r.onload=function(){p("onload",o),s()},r.onreadystatechange=function(e){p("onreadystatechange",o,r.readyState,e),"complete"===r.readyState&&s()},function(){p("aborted",o),s(new Error("Aborted"))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/random":50,"../../utils/url":52,debug:void 0}],34:[function(o,l,e){(function(s){"use strict";var r=o("events").EventEmitter,e=o("inherits"),i=o("../../utils/event"),t=o("../../utils/browser"),a=o("../../utils/url"),c=function(){};function n(e,t,n){c(e,t);var o=this;r.call(this),setTimeout(function(){o._start(e,t,n)},0)}e(n,r),n.prototype._start=function(e,t,n){c("_start");var o=this,r=new s.XDomainRequest;t=a.addQuery(t,"t="+ +new Date),r.onerror=function(){c("onerror"),o._error()},r.ontimeout=function(){c("ontimeout"),o._error()},r.onprogress=function(){c("progress",r.responseText),o.emit("chunk",200,r.responseText)},r.onload=function(){c("load"),o.emit("finish",200,r.responseText),o._cleanup(!1)},this.xdr=r,this.unloadRef=i.unloadAdd(function(){o._cleanup(!0)});try{this.xdr.open(e,t),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(n)}catch(e){this._error()}},n.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},n.prototype._cleanup=function(e){if(c("cleanup",e),this.xdr){if(this.removeAllListeners(),i.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,e)try{this.xdr.abort()}catch(e){}this.unloadRef=this.xdr=null}},n.prototype.close=function(){c("close"),this._cleanup(!0)},n.enabled=!(!s.XDomainRequest||!t.hasDomain()),l.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],35:[function(e,t,n){"use strict";var o=e("inherits"),r=e("../driver/xhr");function s(e,t,n,o){r.call(this,e,t,n,o)}o(s,r),s.enabled=r.enabled&&r.supportsCORS,t.exports=s},{"../driver/xhr":17,inherits:54}],36:[function(e,t,n){"use strict";var o=e("events").EventEmitter;function r(){var e=this;o.call(this),this.to=setTimeout(function(){e.emit("finish",200,"{}")},r.timeout)}e("inherits")(r,o),r.prototype.close=function(){clearTimeout(this.to)},r.timeout=2e3,t.exports=r},{events:3,inherits:54}],37:[function(e,t,n){"use strict";var o=e("inherits"),r=e("../driver/xhr");function s(e,t,n){r.call(this,e,t,n,{noCredentials:!0})}o(s,r),s.enabled=r.enabled,t.exports=s},{"../driver/xhr":17,inherits:54}],38:[function(e,t,n){"use strict";var s=e("../utils/event"),i=e("../utils/url"),o=e("inherits"),a=e("events").EventEmitter,c=e("./driver/websocket"),l=function(){};function u(e,t,n){if(!u.enabled())throw new Error("Transport created when disabled");a.call(this),l("constructor",e);var o=this,r=i.addPath(e,"/websocket");r="https"===r.slice(0,5)?"wss"+r.slice(5):"ws"+r.slice(4),this.url=r,this.ws=new c(this.url,[],n),this.ws.onmessage=function(e){l("message event",e.data),o.emit("message",e.data)},this.unloadRef=s.unloadAdd(function(){l("unload"),o.ws.close()}),this.ws.onclose=function(e){l("close event",e.code,e.reason),o.emit("close",e.code,e.reason),o._cleanup()},this.ws.onerror=function(e){l("error event",e),o.emit("close",1006,"WebSocket connection broken"),o._cleanup()}}o(u,a),u.prototype.send=function(e){var t="["+e+"]";l("send",t),this.ws.send(t)},u.prototype.close=function(){l("close");var e=this.ws;this._cleanup(),e&&e.close()},u.prototype._cleanup=function(){l("_cleanup");var e=this.ws;e&&(e.onmessage=e.onclose=e.onerror=null),s.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},u.enabled=function(){return l("enabled"),!!c},u.transportName="websocket",u.roundTrips=2,t.exports=u},{"../utils/event":46,"../utils/url":52,"./driver/websocket":19,debug:void 0,events:3,inherits:54}],39:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./lib/ajax-based"),s=e("./xdr-streaming"),i=e("./receiver/xhr"),a=e("./sender/xdr");function c(e){if(!a.enabled)throw new Error("Transport created when disabled");r.call(this,e,"/xhr",i,a)}o(c,r),c.enabled=s.enabled,c.transportName="xdr-polling",c.roundTrips=2,t.exports=c},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,"./xdr-streaming":40,inherits:54}],40:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./lib/ajax-based"),s=e("./receiver/xhr"),i=e("./sender/xdr");function a(e){if(!i.enabled)throw new Error("Transport created when disabled");r.call(this,e,"/xhr_streaming",s,i)}o(a,r),a.enabled=function(e){return!e.cookie_needed&&!e.nullOrigin&&i.enabled&&e.sameScheme},a.transportName="xdr-streaming",a.roundTrips=2,t.exports=a},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,inherits:54}],41:[function(e,t,n){"use strict";var o=e("inherits"),r=e("./lib/ajax-based"),s=e("./receiver/xhr"),i=e("./sender/xhr-cors"),a=e("./sender/xhr-local");function c(e){if(!a.enabled&&!i.enabled)throw new Error("Transport created when disabled");r.call(this,e,"/xhr",s,i)}o(c,r),c.enabled=function(e){return!e.nullOrigin&&(!(!a.enabled||!e.sameOrigin)||i.enabled)},c.transportName="xhr-polling",c.roundTrips=2,t.exports=c},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],42:[function(c,l,e){(function(e){"use strict";var t=c("inherits"),n=c("./lib/ajax-based"),o=c("./receiver/xhr"),r=c("./sender/xhr-cors"),s=c("./sender/xhr-local"),i=c("../utils/browser");function a(e){if(!s.enabled&&!r.enabled)throw new Error("Transport created when disabled");n.call(this,e,"/xhr_streaming",o,r)}t(a,n),a.enabled=function(e){return!e.nullOrigin&&!i.isOpera()&&r.enabled},a.transportName="xhr-streaming",a.roundTrips=2,a.needBody=!!e.document,l.exports=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/browser":44,"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],43:[function(e,t,n){(function(n){"use strict";n.crypto&&n.crypto.getRandomValues?t.exports.randomBytes=function(e){var t=new Uint8Array(e);return n.crypto.getRandomValues(t),t}:t.exports.randomBytes=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=Math.floor(256*Math.random());return t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(e,t,n){(function(e){"use strict";t.exports={isOpera:function(){return e.navigator&&/opera/i.test(e.navigator.userAgent)},isKonqueror:function(){return e.navigator&&/konqueror/i.test(e.navigator.userAgent)},hasDomain:function(){if(!e.document)return!0;try{return!!e.document.domain}catch(e){return!1}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(e,t,n){"use strict";var o,r=e("json3"),s=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g;t.exports={quote:function(e){var t=r.stringify(e);return s.lastIndex=0,s.test(t)?(o=o||function(e){var t,n={},o=[];for(t=0;t<65536;t++)o.push(String.fromCharCode(t));return e.lastIndex=0,o.join("").replace(e,function(e){return n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,n}(s),t.replace(s,function(e){return o[e]})):t}}},{json3:55}],46:[function(e,t,n){(function(n){"use strict";var o=e("./random"),r={},s=!1,i=n.chrome&&n.chrome.app&&n.chrome.app.runtime;t.exports={attachEvent:function(e,t){void 0!==n.addEventListener?n.addEventListener(e,t,!1):n.document&&n.attachEvent&&(n.document.attachEvent("on"+e,t),n.attachEvent("on"+e,t))},detachEvent:function(e,t){void 0!==n.addEventListener?n.removeEventListener(e,t,!1):n.document&&n.detachEvent&&(n.document.detachEvent("on"+e,t),n.detachEvent("on"+e,t))},unloadAdd:function(e){if(i)return null;var t=o.string(8);return r[t]=e,s&&setTimeout(this.triggerUnloadCallbacks,0),t},unloadDel:function(e){e in r&&delete r[e]},triggerUnloadCallbacks:function(){for(var e in r)r[e](),delete r[e]}},i||t.exports.attachEvent("unload",function(){s||(s=!0,t.exports.triggerUnloadCallbacks())})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./random":50}],47:[function(t,m,e){(function(p){"use strict";var d=t("./event"),n=t("json3"),e=t("./browser"),f=function(){};m.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){m.exports.WPrefix in p||(p[m.exports.WPrefix]={})},postMessage:function(e,t){p.parent!==p?p.parent.postMessage(n.stringify({windowId:m.exports.currentWindowId,type:e,data:t||""}),"*"):f("Cannot postMessage, no parent window.",e,t)},createIframe:function(e,t){function n(){f("unattach"),clearTimeout(s);try{a.onload=null}catch(e){}a.onerror=null}function o(){f("cleanup"),a&&(n(),setTimeout(function(){a&&a.parentNode.removeChild(a),a=null},0),d.unloadDel(i))}function r(e){f("onerror",e),a&&(o(),t(e))}var s,i,a=p.document.createElement("iframe");return a.src=e,a.style.display="none",a.style.position="absolute",a.onerror=function(){r("onerror")},a.onload=function(){f("onload"),clearTimeout(s),s=setTimeout(function(){r("onload timeout")},2e3)},p.document.body.appendChild(a),s=setTimeout(function(){r("timeout")},15e3),i=d.unloadAdd(o),{post:function(e,t){f("post",e,t),setTimeout(function(){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(e){}},0)},cleanup:o,loaded:n}},createHtmlfile:function(e,t){function n(){clearTimeout(s),a.onerror=null}function o(){l&&(n(),d.unloadDel(i),a.parentNode.removeChild(a),a=l=null,CollectGarbage())}function r(e){f("onerror",e),l&&(o(),t(e))}var s,i,a,c=["Active"].concat("Object").join("X"),l=new p[c]("htmlfile");l.open(),l.write('<html><script>document.domain="'+p.document.domain+'";<\/script></html>'),l.close(),l.parentWindow[m.exports.WPrefix]=p[m.exports.WPrefix];var u=l.createElement("div");return l.body.appendChild(u),a=l.createElement("iframe"),u.appendChild(a),a.src=e,a.onerror=function(){r("onerror")},s=setTimeout(function(){r("timeout")},15e3),i=d.unloadAdd(o),{post:function(e,t){try{setTimeout(function(){a&&a.contentWindow&&a.contentWindow.postMessage(e,t)},0)}catch(e){}},cleanup:o,loaded:n}}},m.exports.iframeEnabled=!1,p.document&&(m.exports.iframeEnabled=("function"==typeof p.postMessage||"object"==typeof p.postMessage)&&!e.isKonqueror())}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./browser":44,"./event":46,debug:void 0,json3:55}],48:[function(e,t,n){(function(n){"use strict";var o={};["log","debug","warn"].forEach(function(e){var t;try{t=n.console&&n.console[e]&&n.console[e].apply}catch(e){}o[e]=t?function(){return n.console[e].apply(n.console,arguments)}:"log"===e?function(){}:o.log}),t.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(e,t,n){"use strict";t.exports={isObject:function(e){var t=typeof e;return"function"==t||"object"==t&&!!e},extend:function(e){if(!this.isObject(e))return e;for(var t,n,o=1,r=arguments.length;o<r;o++)for(n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}}},{}],50:[function(e,t,n){"use strict";var s=e("crypto"),i="abcdefghijklmnopqrstuvwxyz012345";t.exports={string:function(e){for(var t=i.length,n=s.randomBytes(e),o=[],r=0;r<e;r++)o.push(i.substr(n[r]%t,1));return o.join("")},number:function(e){return Math.floor(Math.random()*e)},numberString:function(e){var t=(""+(e-1)).length;return(new Array(t+1).join("0")+this.number(e)).slice(-t)}}},{crypto:43}],51:[function(e,t,n){"use strict";t.exports=function(e){return{filterToEnabled:function(t,n){var o={main:[],facade:[]};return t?"string"==typeof t&&(t=[t]):t=[],e.forEach(function(e){e&&("websocket"!==e.transportName||!1!==n.websocket)&&(t.length&&-1===t.indexOf(e.transportName)?e.transportName:e.enabled(n)?(e.transportName,o.main.push(e),e.facadeTransport&&o.facade.push(e.facadeTransport)):e.transportName)}),o}}}},{debug:void 0}],52:[function(e,t,n){"use strict";var o=e("url-parse");t.exports={getOrigin:function(e){if(!e)return null;var t=new o(e);if("file:"===t.protocol)return null;var n=t.port;return n=n||("https:"===t.protocol?"443":"80"),t.protocol+"//"+t.hostname+":"+n},isOriginEqual:function(e,t){var n=this.getOrigin(e)===this.getOrigin(t);return n},isSchemeEqual:function(e,t){return e.split(":")[0]===t.split(":")[0]},addPath:function(e,t){var n=e.split("?");return n[0]+t+(n[1]?"?"+n[1]:"")},addQuery:function(e,t){return e+(-1===e.indexOf("?")?"?"+t:"&"+t)}}},{debug:void 0,"url-parse":58}],53:[function(e,t,n){t.exports="1.4.0"},{}],54:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){function n(){}e.super_=t,n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],55:[function(e,a,c){(function(i){(function(){var R={function:!0,object:!0},e=R[typeof c]&&c&&!c.nodeType&&c,z=R[typeof window]&&window||this,t=e&&R[typeof a]&&a&&!a.nodeType&&"object"==typeof i&&i;function K(e,c){e=e||z.Object(),c=c||z.Object();var l=e.Number||z.Number,u=e.String||z.String,t=e.Object||z.Object,p=e.Date||z.Date,n=e.SyntaxError||z.SyntaxError,M=e.TypeError||z.TypeError,o=e.Math||z.Math,r=e.JSON||z.JSON;"object"==typeof r&&r&&(c.stringify=r.stringify,c.parse=r.parse);var C,_,I,s=t.prototype,E=s.toString,d=new p(-0xc782b5b800cec);try{d=-109252==d.getUTCFullYear()&&0===d.getUTCMonth()&&1===d.getUTCDate()&&10==d.getUTCHours()&&37==d.getUTCMinutes()&&6==d.getUTCSeconds()&&708==d.getUTCMilliseconds()}catch(e){}function f(e){if(f[e]!==I)return f[e];var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=f("json-stringify")&&f("json-parse");else{var n,o='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var r=c.stringify,s="function"==typeof r&&d;if(s){(n=function(){return 1}).toJSON=n;try{s="0"===r(0)&&"0"===r(new l)&&'""'==r(new u)&&r(E)===I&&r(I)===I&&r()===I&&"1"===r(n)&&"[1]"==r([n])&&"[null]"==r([I])&&"null"==r(null)&&"[null,null,null]"==r([I,E,null])&&r({a:[n,!0,!1,null,"\0\b\n\f\r\t"]})==o&&"1"===r(null,n)&&"[\n 1,\n 2\n]"==r([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==r(new p(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==r(new p(864e13))&&'"-000001-01-01T00:00:00.000Z"'==r(new p(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==r(new p(-1))}catch(e){s=!1}}t=s}if("json-parse"==e){var i=c.parse;if("function"==typeof i)try{if(0===i("0")&&!i(!1)){var a=5==(n=i(o)).a.length&&1===n.a[0];if(a){try{a=!i('"\t"')}catch(e){}if(a)try{a=1!==i("01")}catch(e){}if(a)try{a=1!==i("1.")}catch(e){}}}}catch(e){a=!1}t=a}}return f[e]=!!t}if(!f("json")){var m="[object Function]",k="[object Number]",T="[object String]",L="[object Array]",a=f("bug-string-char-index");if(!d)var x=o.floor,i=[0,31,59,90,120,151,181,212,243,273,304,334],O=function(e,t){return i[t]+365*(e-1970)+x((e-1969+(t=+(1<t)))/4)-x((e-1901+t)/100)+x((e-1601+t)/400)};if((C=s.hasOwnProperty)||(C=function(e){var n,t={};return C=(t.__proto__=null,t.__proto__={toString:1},t).toString!=E?function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(n=t.constructor,function(e){var t=(this.constructor||n).prototype;return e in this&&!(e in t&&this[e]===t[e])}),t=null,C.call(this,e)}),_=function(e,t){var n,i,o,r=0;for(o in(n=function(){this.valueOf=0}).prototype.valueOf=0,i=new n)C.call(i,o)&&r++;return n=i=null,(_=r?2==r?function(e,t){var n,o={},r=E.call(e)==m;for(n in e)r&&"prototype"==n||C.call(o,n)||!(o[n]=1)||!C.call(e,n)||t(n)}:function(e,t){var n,o,r=E.call(e)==m;for(n in e)r&&"prototype"==n||!C.call(e,n)||(o="constructor"===n)||t(n);(o||C.call(e,n="constructor"))&&t(n)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],function(e,t){var n,o,r=E.call(e)==m,s=!r&&"function"!=typeof e.constructor&&R[typeof e.hasOwnProperty]&&e.hasOwnProperty||C;for(n in e)r&&"prototype"==n||!s.call(e,n)||t(n);for(o=i.length;n=i[--o];s.call(e,n)&&t(n));}))(e,t)},!f("json-stringify")){function U(e,t){return("000000"+(t||0)).slice(-e)}function N(e){for(var t='"',n=0,o=e.length,r=!a||10<o,s=r&&(a?e.split(""):e);n<o;n++){var i=e.charCodeAt(n);switch(i){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=h[i];break;default:if(i<32){t+="\\u00"+U(2,i.toString(16));break}t+=r?s[n]:e.charAt(n)}}return t+'"'}var h={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},P=function(e,t,n,o,r,s,i){var a,c,l,u,p,d,f,m,h,g,v,y,b,S,w,A;try{a=t[e]}catch(e){}if("object"==typeof a&&a)if("[object Date]"!=(c=E.call(a))||C.call(a,"toJSON"))"function"==typeof a.toJSON&&(c!=k&&c!=T&&c!=L||C.call(a,"toJSON"))&&(a=a.toJSON(e));else if(-1/0<a&&a<1/0){if(O){for(p=x(a/864e5),l=x(p/365.2425)+1970-1;O(l+1,0)<=p;l++);for(u=x((p-O(l,0))/30.42);O(l,u+1)<=p;u++);p=1+p-O(l,u),f=x((d=(a%864e5+864e5)%864e5)/36e5)%24,m=x(d/6e4)%60,h=x(d/1e3)%60,g=d%1e3}else l=a.getUTCFullYear(),u=a.getUTCMonth(),p=a.getUTCDate(),f=a.getUTCHours(),m=a.getUTCMinutes(),h=a.getUTCSeconds(),g=a.getUTCMilliseconds();a=(l<=0||1e4<=l?(l<0?"-":"+")+U(6,l<0?-l:l):U(4,l))+"-"+U(2,u+1)+"-"+U(2,p)+"T"+U(2,f)+":"+U(2,m)+":"+U(2,h)+"."+U(3,g)+"Z"}else a=null;if(n&&(a=n.call(t,e,a)),null===a)return"null";if("[object Boolean]"==(c=E.call(a)))return""+a;if(c==k)return-1/0<a&&a<1/0?""+a:"null";if(c==T)return N(""+a);if("object"==typeof a){for(S=i.length;S--;)if(i[S]===a)throw M();if(i.push(a),v=[],w=s,s+=r,c==L){for(b=0,S=a.length;b<S;b++)y=P(b,a,n,o,r,s,i),v.push(y===I?"null":y);A=v.length?r?"[\n"+s+v.join(",\n"+s)+"\n"+w+"]":"["+v.join(",")+"]":"[]"}else _(o||a,function(e){var t=P(e,a,n,o,r,s,i);t!==I&&v.push(N(e)+":"+(r?" ":"")+t)}),A=v.length?r?"{\n"+s+v.join(",\n"+s)+"\n"+w+"}":"{"+v.join(",")+"}":"{}";return i.pop(),A}};c.stringify=function(e,t,n){var o,r,s,i;if(R[typeof t]&&t)if((i=E.call(t))==m)r=t;else if(i==L){s={};for(var a,c=0,l=t.length;c<l;a=t[c++],(i=E.call(a))!=T&&i!=k||(s[a]=1));}if(n)if((i=E.call(n))==k){if(0<(n-=n%1))for(o="",10<n&&(n=10);o.length<n;o+=" ");}else i==T&&(o=n.length<=10?n:n.slice(0,10));return P("",((a={})[""]=e,a),r,s,o,"",[])}}if(!f("json-parse")){function g(){throw b=S=null,n()}function v(){for(var e,t,n,o,r,s=S,i=s.length;b<i;)switch(r=s.charCodeAt(b)){case 9:case 10:case 13:case 32:b++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=a?s.charAt(b):s[b],b++,e;case 34:for(e="@",b++;b<i;)if((r=s.charCodeAt(b))<32)g();else if(92==r)switch(r=s.charCodeAt(++b)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=A[r],b++;break;case 117:for(t=++b,n=b+4;b<n;b++)48<=(r=s.charCodeAt(b))&&r<=57||97<=r&&r<=102||65<=r&&r<=70||g();e+=w("0x"+s.slice(t,b));break;default:g()}else{if(34==r)break;for(r=s.charCodeAt(b),t=b;32<=r&&92!=r&&34!=r;)r=s.charCodeAt(++b);e+=s.slice(t,b)}if(34==s.charCodeAt(b))return b++,e;g();default:if(t=b,45==r&&(o=!0,r=s.charCodeAt(++b)),48<=r&&r<=57){for(48==r&&48<=(r=s.charCodeAt(b+1))&&r<=57&&g(),o=!1;b<i&&48<=(r=s.charCodeAt(b))&&r<=57;b++);if(46==s.charCodeAt(b)){for(n=++b;n<i&&48<=(r=s.charCodeAt(n))&&r<=57;n++);n==b&&g(),b=n}if(101==(r=s.charCodeAt(b))||69==r){for(43!=(r=s.charCodeAt(++b))&&45!=r||b++,n=b;n<i&&48<=(r=s.charCodeAt(n))&&r<=57;n++);n==b&&g(),b=n}return+s.slice(t,b)}if(o&&g(),"true"==s.slice(b,b+4))return b+=4,!0;if("false"==s.slice(b,b+5))return b+=5,!1;if("null"==s.slice(b,b+4))return b+=4,null;g()}return"$"}function y(e,t,n){var o=j(e,t,n);o===I?delete e[t]:e[t]=o}var b,S,w=u.fromCharCode,A={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},G=function(e){var t,n;if("$"==e&&g(),"string"==typeof e){if("@"==(a?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];"]"!=(e=v());n=n||!0)n&&(","==e?"]"==(e=v())&&g():g()),","==e&&g(),t.push(G(e));return t}if("{"==e){for(t={};"}"!=(e=v());n=n||!0)n&&(","==e?"}"==(e=v())&&g():g()),","!=e&&"string"==typeof e&&"@"==(a?e.charAt(0):e[0])&&":"==v()||g(),t[e.slice(1)]=G(v());return t}g()}return e},j=function(e,t,n){var o,r=e[t];if("object"==typeof r&&r)if(E.call(r)==L)for(o=r.length;o--;)y(r,o,n);else _(r,function(e){y(r,e,n)});return n.call(e,t,r)};c.parse=function(e,t){var n,o;return b=0,S=""+e,n=G(v()),"$"!=v()&&g(),b=S=null,t&&E.call(t)==m?j(((o={})[""]=n,o),"",t):n}}}return c.runInContext=K,c}if(!t||t.global!==t&&t.window!==t&&t.self!==t||(z=t),e)K(z,e);else{var n=z.JSON,o=z.JSON3,r=!1,s=K(z,z.JSON3={noConflict:function(){return r||(r=!0,z.JSON=n,z.JSON3=o,n=o=null),s}});z.JSON={parse:s.parse,stringify:s.stringify}}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty;function i(e){return decodeURIComponent(e.replace(/\+/g," "))}n.stringify=function(e,t){t=t||"";var n=[];for(var o in"string"!=typeof t&&(t="?"),e)r.call(e,o)&&n.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return n.length?t+n.join("&"):""},n.parse=function(e){for(var t,n=/([^=?&]+)=?([^&]*)/g,o={};t=n.exec(e);){var r=i(t[1]),s=i(t[2]);r in o||(o[r]=s)}return o}},{}],57:[function(e,t,n){"use strict";t.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},{}],58:[function(e,t,n){(function(s){"use strict";var f=e("requires-port"),m=e("querystringify"),n=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,i=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,h=[["#","hash"],["?","query"],function(e){return e.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],a={hash:1,query:1};function g(e){var t,n=s&&s.location||{},o={},r=typeof(e=e||n);if("blob:"===e.protocol)o=new y(unescape(e.pathname),{});else if("string"==r)for(t in o=new y(e,{}),a)delete o[t];else if("object"==r){for(t in e)t in a||(o[t]=e[t]);void 0===o.slashes&&(o.slashes=i.test(e.href))}return o}function v(e){var t=n.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function y(e,a,t){if(!(this instanceof y))return new y(e,a,t);var n,o,r,s,i,c,l=h.slice(),u=typeof a,p=this,d=0;for("object"!=u&&"string"!=u&&(t=a,a=null),t&&"function"!=typeof t&&(t=m.parse),a=g(a),n=!(o=v(e||"")).protocol&&!o.slashes,p.slashes=o.slashes||n&&a.slashes,p.protocol=o.protocol||a.protocol||"",e=o.rest,o.slashes||(l[3]=[/(.*)/,"pathname"]);d<l.length;d++)"function"!=typeof(s=l[d])?(r=s[0],c=s[1],r!=r?p[c]=e:"string"==typeof r?~(i=e.indexOf(r))&&(e="number"==typeof s[2]?(p[c]=e.slice(0,i),e.slice(i+s[2])):(p[c]=e.slice(i),e.slice(0,i))):(i=r.exec(e))&&(p[c]=i[1],e=e.slice(0,i.index)),p[c]=p[c]||n&&s[3]&&a[c]||"",s[4]&&(p[c]=p[c].toLowerCase())):e=s(e);t&&(p.query=t(p.query)),n&&a.slashes&&"/"!==p.pathname.charAt(0)&&(""!==p.pathname||""!==a.pathname)&&(p.pathname=function(e,t){for(var n=(a.pathname||"/").split("/").slice(0,-1).concat(e.split("/")),o=n.length,r=n[o-1],s=!1,i=0;o--;)"."===n[o]?n.splice(o,1):".."===n[o]?(n.splice(o,1),i++):i&&(0===o&&(s=!0),n.splice(o,1),i--);return s&&n.unshift(""),"."!==r&&".."!==r||n.push(""),n.join("/")}(p.pathname)),f(p.port,p.protocol)||(p.host=p.hostname,p.port=""),p.username=p.password="",p.auth&&(s=p.auth.split(":"),p.username=s[0]||"",p.password=s[1]||""),p.origin=p.protocol&&p.host&&"file:"!==p.protocol?p.protocol+"//"+p.host:"null",p.href=p.toString()}y.prototype={set:function(e,t,n){var o=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(n||m.parse)(t)),o[e]=t;break;case"port":o[e]=t,f(t,o.protocol)?t&&(o.host=o.hostname+":"+t):(o.host=o.hostname,o[e]="");break;case"hostname":o[e]=t,o.port&&(t+=":"+o.port),o.host=t;break;case"host":o[e]=t,/:\d+$/.test(t)?(t=t.split(":"),o.port=t.pop(),o.hostname=t.join(":")):(o.hostname=t,o.port="");break;case"protocol":o.protocol=t.toLowerCase(),o.slashes=!n;break;case"pathname":case"hash":if(t){var r="pathname"===e?"/":"#";o[e]=t.charAt(0)!==r?r+t:t}else o[e]=t;break;default:o[e]=t}for(var s=0;s<h.length;s++){var i=h[s];i[4]&&(o[i[1]]=o[i[1]].toLowerCase())}return o.origin=o.protocol&&o.host&&"file:"!==o.protocol?o.protocol+"//"+o.host:"null",o.href=o.toString(),o},toString:function(e){e&&"function"==typeof e||(e=m.stringify);var t,n=this,o=n.protocol;o&&":"!==o.charAt(o.length-1)&&(o+=":");var r=o+(n.slashes?"//":"");return n.username&&(r+=n.username,n.password&&(r+=":"+n.password),r+="@"),r+=n.host+n.pathname,(t="object"==typeof n.query?e(n.query):n.query)&&(r+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(r+=n.hash),r}},y.extractProtocol=v,y.location=g,y.qs=m,t.exports=y}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{querystringify:56,"requires-port":57}]},{},[1])(1)}),function(){var b,o,g,l,s={}.hasOwnProperty,i=[].slice;b={LF:"\n",NULL:"\0"},g=function(){var i;function y(e,t,n){this.command=e,this.headers=null!=t?t:{},this.body=null!=n?n:""}return y.prototype.toString=function(){var e,t,n,o,r;for(t in(n=!(e=[this.command])===this.headers["content-length"])&&delete this.headers["content-length"],r=this.headers)s.call(r,t)&&(o=r[t],e.push(t+":"+o));return this.body&&!n&&e.push("content-length:"+y.sizeOfUTF8(this.body)),e.push(b.LF+this.body),e.join(b.LF)},y.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},i=function(e){var t,n,o,r,s,i,a,c,l,u,p,d,f,m,h,g,v;for(r=e.search(RegExp(""+b.LF+b.LF)),o=(s=e.substring(0,r).split(b.LF)).shift(),i={},d=function(e){return e.replace(/^\s+|\s+$/g,"")},f=0,h=(g=s.reverse()).length;f<h;f++)c=(u=g[f]).indexOf(":"),i[d(u.substring(0,c))]=d(u.substring(c+1));if(t="",p=r+2,i["content-length"])l=parseInt(i["content-length"]),t=(""+e).substring(p,p+l);else for(n=null,a=m=p,v=e.length;(p<=v?m<v:v<m)&&(n=e.charAt(a))!==b.NULL;a=p<=v?++m:--m)t+=n;return new y(o,i,t)},y.unmarshall=function(r){var s;return function(){var e,t,n,o;for(o=[],e=0,t=(n=r.split(RegExp(""+b.NULL+b.LF+"*"))).length;e<t;e++)0<(null!=(s=n[e])?s.length:void 0)&&o.push(i(s));return o}()},y.marshall=function(e,t,n){return new y(e,t,n).toString()+b.NULL},y}(),o=function(){var h;function e(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}return e.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},h=function(){return Date.now?Date.now():(new Date).valueOf},e.prototype._transmit=function(e,t,n){var o;for(o=g.marshall(e,t,n),"function"==typeof this.debug&&this.debug(">>> "+o);;){if(!(o.length>this.maxWebSocketFrameSize))return this.ws.send(o);this.ws.send(o.substring(0,this.maxWebSocketFrameSize)),o=o.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+o.length)}},e.prototype._setupHeartbeat=function(r){var e,t,n,s,o,i,a,c;if((o=r.version)===l.VERSIONS.V1_1||o===l.VERSIONS.V1_2)return t=(i=function(){var e,t,n,o;for(o=[],e=0,t=(n=r["heart-beat"].split(",")).length;e<t;e++)s=n[e],o.push(parseInt(s));return o}())[0],e=i[1],0!==this.heartbeat.outgoing&&0!==e&&(n=Math.max(this.heartbeat.outgoing,e),"function"==typeof this.debug&&this.debug("send PING every "+n+"ms"),this.pinger=l.setInterval(n,(a=this,function(){return a.ws.send(b.LF),"function"==typeof a.debug?a.debug(">>> PING"):void 0}))),0!==this.heartbeat.incoming&&0!==t?(n=Math.max(this.heartbeat.incoming,t),"function"==typeof this.debug&&this.debug("check PONG every "+n+"ms"),this.ponger=l.setInterval(n,(c=this,function(){var e;if(e=h()-c.serverActivity,2*n<e)return"function"==typeof c.debug&&c.debug("did not receive server activity for the last "+e+"ms"),c.ws.close()}))):void 0},e.prototype._parseConnect=function(){var e,t,n,o;switch(o={},(e=1<=arguments.length?i.call(arguments,0):[]).length){case 2:o=e[0],t=e[1];break;case 3:e[1]instanceof Function?(o=e[0],t=e[1],n=e[2]):(o.login=e[0],o.passcode=e[1],t=e[2]);break;case 4:o.login=e[0],o.passcode=e[1],t=e[2],n=e[3];break;default:o.login=e[0],o.passcode=e[1],t=e[2],n=e[3],o.host=e[4]}return[o,t,n]},e.prototype.connect=function(){var e,f,t,n,m,o,r;return e=1<=arguments.length?i.call(arguments,0):[],n=this._parseConnect.apply(this,e),t=n[0],this.connectCallback=n[1],f=n[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=(m=this,function(e){var o,r,t,n,s,i,a,c,l,u,p,d;if(n="undefined"!=typeof ArrayBuffer&&e.data instanceof ArrayBuffer?(o=new Uint8Array(e.data),"function"==typeof m.debug&&m.debug("--- got data length: "+o.length),function(){var e,t,n;for(n=[],e=0,t=o.length;e<t;e++)r=o[e],n.push(String.fromCharCode(r));return n}().join("")):e.data,m.serverActivity=h(),n!==b.LF){for("function"==typeof m.debug&&m.debug("<<< "+n),d=[],l=0,u=(p=g.unmarshall(n)).length;l<u;l++)switch((s=p[l]).command){case"CONNECTED":"function"==typeof m.debug&&m.debug("connected to server "+s.headers.server),m.connected=!0,m._setupHeartbeat(s.headers),d.push("function"==typeof m.connectCallback?m.connectCallback(s):void 0);break;case"MESSAGE":c=s.headers.subscription,(a=m.subscriptions[c]||m.onreceive)?(t=m,i=s.headers["message-id"],s.ack=function(e){return null==e&&(e={}),t.ack(i,c,e)},s.nack=function(e){return null==e&&(e={}),t.nack(i,c,e)},d.push(a(s))):d.push("function"==typeof m.debug?m.debug("Unhandled received MESSAGE: "+s):void 0);break;case"RECEIPT":d.push("function"==typeof m.onreceipt?m.onreceipt(s):void 0);break;case"ERROR":d.push("function"==typeof f?f(s):void 0);break;default:d.push("function"==typeof m.debug?m.debug("Unhandled frame: "+s):void 0)}return d}"function"==typeof m.debug&&m.debug("<<< PONG")}),this.ws.onclose=(o=this,function(){var e;return e="Whoops! Lost connection to "+o.ws.url,"function"==typeof o.debug&&o.debug(e),o._cleanUp(),"function"==typeof f?f(e):void 0}),this.ws.onopen=(r=this,function(){return"function"==typeof r.debug&&r.debug("Web Socket Opened..."),t["accept-version"]=l.VERSIONS.supportedVersions(),t["heart-beat"]=[r.heartbeat.outgoing,r.heartbeat.incoming].join(","),r._transmit("CONNECT",t)})},e.prototype.disconnect=function(e,t){return null==t&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof e?e():void 0},e.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&l.clearInterval(this.pinger),this.ponger)return l.clearInterval(this.ponger)},e.prototype.send=function(e,t,n){return null==t&&(t={}),null==n&&(n=""),t.destination=e,this._transmit("SEND",t,n)},e.prototype.subscribe=function(e,t,n){var o;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=e,this.subscriptions[n.id]=t,this._transmit("SUBSCRIBE",n),o=this,{id:n.id,unsubscribe:function(){return o.unsubscribe(n.id)}}},e.prototype.unsubscribe=function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})},e.prototype.begin=function(e){var t,n;return n=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),t=this,{id:n,commit:function(){return t.commit(n)},abort:function(){return t.abort(n)}}},e.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},e.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},e.prototype.ack=function(e,t,n){return null==n&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("ACK",n)},e.prototype.nack=function(e,t,n){return null==n&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("NACK",n)},e}(),l={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,t){var n;return null==t&&(t=["v10.stomp","v11.stomp"]),n=new(l.WebSocketClass||WebSocket)(e,t),new o(n)},over:function(e){return new o(e)},Frame:g},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=l),"undefined"!=typeof window&&null!==window?(l.setInterval=function(e,t){return window.setInterval(t,e)},l.clearInterval=function(e){return window.clearInterval(e)},window.Stomp=l):exports||(self.Stomp=l)}.call(this);var MCK_LABELS,MCK_BASE_URL,w=window,d=document,MCK_CURR_LATITIUDE=40.7324319,MCK_CURR_LONGITUDE=-73.82480777777776,mckUtils=new MckUtils,mckDateUtils=new MckDateUtils,mckContactUtils=new MckContactUtils,mckMapUtils=new MckMapUtils;function MckUtils(){var n=this,l=["p","div","pre","form"];n.init=function(){var e=MCK_CONTEXTPATH?MCK_CONTEXTPATH+"/v2/tab/initialize.page":"https://apps.applozic.com/v2/tab/initialize.page",t=MCK_CONTEXTPATH?MCK_CONTEXTPATH+"/rest/ws/message/list":"https://apps.applozic.com/rest/ws/message/list";$applozic.ajax({url:e,contentType:"application/json",type:"OPTIONS"}).done(function(e){}),$applozic.ajax({url:t,contentType:"application/json",type:"OPTIONS"}).done(function(e){})},n.showElement=function(e){("object"!=typeof e&&void 0!==e&&null!==typeof e||e&&"object"==typeof e&&0!==e.length)&&(e.classList.remove("n-vis"),e.classList.add("vis"))},n.hideElement=function(e){("object"!=typeof e&&void 0!==e&&null!==typeof e||e&&"object"==typeof e&&0!==e.length)&&(e.classList.remove("vis"),e.classList.add("n-vis"))},n.badgeCountOnLaucher=function(e,t){var n=document.getElementById("applozic-badge-count");!0===e&&0<t&&(n.innerHTML=t<99?t:"99+",n.classList.add("mck-badge-count")),!0===e&&0===t&&(n.innerHTML="",n.classList.remove("mck-badge-count"))},n.randomId=function(){return w.Math.random().toString(36).substring(7)},n.textVal=function(e){for(var t=[],i=[],a=function(){t.push(i.join("")),i=[]},c=function(e){if(3===e.nodeType)i.push(e.nodeValue);else if(1===e.nodeType){var t=e.tagName.toLowerCase(),n=-1!==l.indexOf(t);if(n&&i.length&&a(),"img"===t){var o=e.getAttribute("alt")||"";return void(o&&i.push(o))}if("style"===t)return;"br"===t&&a();for(var r=e.childNodes,s=0;s<r.length;s++)c(r[s]);n&&i.length&&a()}},n=e.childNodes,o=0;o<n.length;o++)c(n[o]);return i.length&&a(),t.join("\n")},n.mouseX=function(e){return e.pageX?e.pageX:e.clientX?e.clientX+(d.documentElement.scrollLeft?d.documentElement.scrollLeft:d.body.scrollLeft):null},n.mouseY=function(e){return e.pageY?e.pageY:e.clientY?e.clientY+(d.documentElement.scrollTop?d.documentElement.scrollTop:d.body.scrollTop):null},n.startsWith=function(e,t){if(null===t||void 0===e)return!1;var n=t.length;if(e.length<n)return!1;for(--n;0<=n&&e[n]===t[n];--n)continue;return n<0},n.setEndOfContenteditable=function(e){var t,n;document.createRange?((t=document.createRange()).selectNodeContents(e),t.collapse(!1),(n=window.getSelection()).removeAllRanges(),n.addRange(t)):document.selection&&((t=document.body.createTextRange()).moveToElementText(e),t.collapse(!1),t.select())},n.b64EncodeUnicode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))},n.b64DecodeUnicode=function(e){return decodeURIComponent(Array.prototype.map.call(atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},n.checkIfB64Encoded=function(e){return/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e)},n.encrypt=function(e,t){if(!t)return e;for(;e&&e.length%16!=0;)e+=" ";var n=aesjs.util.convertStringToBytes(t),o=new aesjs.ModeOfOperation.ecb(n),r=aesjs.util.convertStringToBytes(e),s=o.encrypt(r),i=String.fromCharCode.apply(null,s);return btoa(i)},n.decrypt=function(e,t){if(!t)return e;for(var n=aesjs.util.convertStringToBytes(t),o=atob(e),r=[],s=0;s<o.length;s++)r.push(o.charCodeAt(s));var i=new aesjs.ModeOfOperation.ecb(n).decrypt(r);return aesjs.util.convertBytesToString(i).replace(/\\u0000/g,"").replace(/^\s*|\s*[\x00-\x10]*$/g,"")},n.ajax=function(t){var e=$applozic.extend({},{},t);!t.skipEncryption&&t.encryptionKey&&("post"===e.type.toLowerCase()&&(e.data=encrypt(t.data,t.encryptionKey)),e.success=function(e){res=n.decrypt(e,t.encryptionKey),mckUtils.isJsonString(res)?t.success(JSON.parse(res)):t.success(res)}),$applozic.ajax(e)},n.isJsonString=function(e){try{JSON.parse(e)}catch(e){return!1}return!0}}function MckContactUtils(){var n=this;n.getContactId=function(e){var t=e.contactId;return n.formatContactId(t)},n.formatContactId=function(e){return 0===e.indexOf("+")&&(e=e.substring(1)),e=decodeURIComponent(e),$applozic.trim(e.replace(/\@/g,"AT").replace(/\./g,"DOT").replace(/\*/g,"STAR").replace(/\#/g,"HASH").replace(/\|/g,"VBAR").replace(/\+/g,"PLUS").replace(/\;/g,"SCOLON").replace(/\?/g,"QMARK").replace(/\,/g,"COMMA").replace(/\:/g,"COLON"))}}function MckMapUtils(){this.getCurrentLocation=function(e,t){w.navigator.geolocation.getCurrentPosition(e,t)},this.getSelectedLocation=function(){return{lat:MCK_CURR_LATITIUDE,lon:MCK_CURR_LONGITUDE}}}function MckDateUtils(){var e=this,r="mmm d, h:MM TT",s="h:MM TT";e.getDate=function(e){var t=new Date(parseInt(e,10)),n=new Date;return n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()&&n.getYear()===t.getYear()?b(t,s,!1):b(t,r,!1)},e.getLastSeenAtStatus=function(e){var t=new Date(parseInt(e,10)),n=new Date;if(n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()&&n.getYear()===t.getYear()){var o=n.getHours()-t.getHours(),r=w.Math.floor((n.getTime()-t.getTime())/6e4);return r<60?r<=1?MCK_LABELS["last.seen"]+" 1 "+MCK_LABELS.min+" "+MCK_LABELS.ago:MCK_LABELS["last.seen"]+" "+r+MCK_LABELS.mins+" "+MCK_LABELS.ago:1===o?MCK_LABELS["last.seen"]+" 1 "+MCK_LABELS.hour+" "+MCK_LABELS.ago:MCK_LABELS["last.seen"]+" "+o+MCK_LABELS.hours+" "+MCK_LABELS.ago}return n.getDate()-t.getDate()==1&&n.getMonth()===t.getMonth()&&n.getYear()===t.getYear()?MCK_LABELS["last.seen.on"]+" "+MCK_LABELS.yesterday:MCK_LABELS["last.seen.on"]+" "+b(t,"mmm d",!1)},e.getTimeOrDate=function(e,t){var n=new Date(parseInt(e,10)),o=new Date;return t?o.getDate()===n.getDate()&&o.getMonth()===n.getMonth()&&o.getYear()===n.getYear()?b(n,s,!1):b(n,"mmm d",!1):b(n,r,!1)},e.getSystemDate=function(e){var t=new Date(parseInt(e,10));return b(t,r,!1)},e.convertMilisIntoTime=function(e){parseInt(e%1e3/100);var t=parseInt(e/1e3%60),n=parseInt(e/6e4%60),o=parseInt(e/36e5%24);return 0<o?o+" Hr "+n+" Min "+t+" Sec":0<n?n+" Min "+t+" Sec":t+" Sec "};var h,g,v,y,b=(h=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,g=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,v=/[^-+\dA-Z]/g,y=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e},function(e,t,n){var o=b;if(1!==arguments.length||"[object String]"!==Object.prototype.toString.call(e)||/\d/.test(e)||(t=e,e=void 0),e=e?new Date(e):new Date,isNaN(e))throw SyntaxError("invalid date");"UTC:"===(t=String(t)).slice(0,4)&&(t=t.slice(4),n=!0);var r=n?"getUTC":"get",s=e[r+"Date"](),i=e[r+"Day"](),a=e[r+"Month"](),c=e[r+"FullYear"](),l=e[r+"Hours"](),u=e[r+"Minutes"](),p=e[r+"Seconds"](),d=e[r+"Milliseconds"](),f=n?0:e.getTimezoneOffset(),m={d:s,dd:y(s),ddd:o.i18n.dayNames[i],dddd:o.i18n.dayNames[i+7],m:a+1,mm:y(a+1),mmm:o.i18n.monthNames[a],mmmm:o.i18n.monthNames[a+12],yy:String(c).slice(2),yyyy:c,h:l%12||12,hh:y(l%12||12),H:l,HH:y(l),M:u,MM:y(u),s:p,ss:y(p),l:y(d,3),L:y(99<d?w.Math.round(d/10):d),t:l<12?"a":"p",tt:l<12?MCK_LABELS["time.format.am"]||"am":MCK_LABELS["time.format.pm"]||"pm",T:l<12?"A":"P",TT:l<12?MCK_LABELS["time.format.AM"]||"AM":MCK_LABELS["time.format.PM"]||"PM",Z:n?"UTC":(String(e).match(g)||[""]).pop().replace(v,""),o:(0<f?"-":"+")+y(100*w.Math.floor(w.Math.abs(f)/60)+w.Math.abs(f)%60,4),S:["th","st","nd","rd"][3<s%10?0:(s%100-s%10!=10)*s%10]};return t.replace(h,function(e){return e in m?m[e]:e.slice(1,e.length-1)})});b.masks={default:"mmm d, yyyy h:MM TT",fullDateFormat:"mmm d, yyyy h:MM TT",onlyDateFormat:"mmm d",onlyTimeFormat:"h:MM TT",mailDateFormat:"mmm d, yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},b.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]}}!function(e){"use strict";"undefined"==typeof Applozic?e.Applozic={init:function(){}}:console.log("Applozic already defined.")}(window);var ALStorage=function(e){var t,n,o=[],r=[],s=[],i=[],a=new MckUtils;return{updateLatestMessage:function(e){var t=[];t.push(e),ALStorage.updateLatestMessageArray(t),ALStorage.updateMckMessageArray(t)},getLatestMessageArray:function(){return ALStorage.isSessionStorageAvailable()?$applozic.parseJSON(w.sessionStorage.getItem("mckLatestMessageArray")):o},getFriendListGroupName:function(){return ALStorage.isSessionStorageAvailable()?w.sessionStorage.getItem("friendListGroupName"):t},setFriendListGroupName:function(e){ALStorage.isSessionStorageAvailable()?w.sessionStorage.setItem("friendListGroupName",e):t=e},setFriendListGroupType:function(e){ALStorage.isSessionStorageAvailable()?w.sessionStorage.setItem("friendListGroupType",e):n=e},getFriendListGroupType:function(){return ALStorage.isSessionStorageAvailable()?w.sessionStorage.getItem("friendListGroupType"):n},setLatestMessageArray:function(e){ALStorage.isSessionStorageAvailable()?w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(e)):o=e},updateLatestMessageArray:function(e){if(ALStorage.isSessionStorageAvailable()){var t=$applozic.parseJSON(w.sessionStorage.getItem("mckLatestMessageArray"));return null!==t?(t=t.concat(e),w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(t))):w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(e)),e}return o=o.concat(e)},getMckMessageArray:function(){return ALStorage.isSessionStorageAvailable()?$applozic.parseJSON(w.sessionStorage.getItem("mckMessageArray")):r},clearMckMessageArray:function(){ALStorage.isSessionStorageAvailable()?(w.sessionStorage.removeItem("mckMessageArray"),w.sessionStorage.removeItem("mckLatestMessageArray")):(r.length=0,o.length=0)},clearAppHeaders:function(){ALStorage.isSessionStorageAvailable()&&w.sessionStorage.removeItem("chatheaders")},setAppHeaders:function(e){if(ALStorage.isSessionStorageAvailable()){var t=a.b64EncodeUnicode(JSON.stringify(e));w.sessionStorage.setItem("chatheaders",t)}},getAppHeaders:function(){if(ALStorage.isSessionStorageAvailable()){var e=w.sessionStorage.getItem("chatheaders");return e=e?JSON.parse(a.checkIfB64Encoded(e)?a.b64DecodeUnicode(e):e):{}}},getMessageByKey:function(e){return s[e]},updateMckMessageArray:function(e){for(var t=0;t<e.length;t++){var n=e[t];s[n.key]=n}if(ALStorage.isSessionStorageAvailable()){var o=$applozic.parseJSON(w.sessionStorage.getItem("mckMessageArray"));return null!==o?(o=o.concat(e),w.sessionStorage.setItem("mckMessageArray",w.JSON.stringify(o))):w.sessionStorage.setItem("mckMessageArray",w.JSON.stringify(e)),e}return r=r.concat(e)},getMckContactNameArray:function(){return ALStorage.isSessionStorageAvailable()?$applozic.parseJSON(w.sessionStorage.getItem("mckContactNameArray")):i},setMckContactNameArray:function(e){ALStorage.isSessionStorageAvailable()?w.sessionStorage.setItem("mckContactNameArray",w.JSON.stringify(e)):i=e},updateMckContactNameArray:function(e){if(ALStorage.isSessionStorageAvailable()){var t=$applozic.parseJSON(w.sessionStorage.getItem("mckContactNameArray"));return null!==t&&(e=e.concat(t)),w.sessionStorage.setItem("mckContactNameArray",w.JSON.stringify(e)),e}return i=i.concat(e)},clearMckContactNameArray:function(){ALStorage.isSessionStorageAvailable()?w.sessionStorage.removeItem("mckContactNameArray"):i.length=0},clearSessionStorageElements:function(){ALStorage.clearMckMessageArray(),ALStorage.clearAppHeaders(),ALStorage.clearMckContactNameArray()},isSessionStorageAvailable:function(){try{return void 0!==w.sessionStorage}catch(e){return!1}}}}(window);!function(h){"use strict";"undefined"==typeof ALApiService?h.Applozic.ALApiService=function(e){var a={},c="",l=new MckUtils;a.DEFAULT_ENCRYPTED_APP_VERSION=112;var s,i,u,p,d,n,f="https://apps.applozic.com",t="https://applozic.appspot.com",o="/rest/ws/group/left",r="/rest/ws/group/";function m(e){var t="";for(var n in e)t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])+"&";return t.substring(0,t.length-1)}return a.getFileUrl=function(){return t},a.initServerUrl=function(e){f=e},a.login=function(e){a.connect(e)},a.connect=function(t){c=t.data.alUser.applicationId,f=t.data.baseUrl?t.data.baseUrl:"https://apps.applozic.com",n=t.data.alUser.fileupload,t.appVersionCode=t.appVersionCode||a.DEFAULT_ENCRYPTED_APP_VERSION,a.ajax({url:f+"/v2/tab/initialize.page",skipEncryption:!0,type:"post",async:void 0===t.async||t.async,data:JSON.stringify(t.data.alUser),contentType:"application/json",headers:{"Application-Key":c},success:function(e){p=btoa(e.userId+":"+e.deviceKey),i=e.deviceKey,s=t.data.alUser.password,u=t.data.alUser.appModuleName,a.AUTH_TOKEN=e.authToken,a.setAjaxHeaders(p,c,e.deviceKey,t.data.alUser.password,t.data.alUser.appModuleName),a.setEncryptionKeys(e.encryptionKey,e.userEncryptionKey),e.appVersionCode=a.DEFAULT_ENCRYPTED_APP_VERSION,t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.addRequestHeaders=function(e){a.AUTH_TOKEN?e.setRequestHeader("X-Authorization",a.AUTH_TOKEN):(p&&(e.setRequestHeader("Authorization","Basic "+p),e.setRequestHeader("Application-User","Basic "+p)),i&&e.setRequestHeader("Device-Key",i),s&&e.setRequestHeader("Access-Token",s),u&&e.setRequestHeader("App-Module-Name",u),e.setRequestHeader("UserId-Enabled",!0)),e.setRequestHeader("Application-Key",c)},a.getAttachmentHeaders=function(){var e={};return a.AUTH_TOKEN?e["X-Authorization"]=a.AUTH_TOKEN:(e={"UserId-Enabled":!0,Authorization:"Basic "+p,"Application-User":"Basic "+p,"Application-Key":c,"Device-Key":i},s&&(e["Access-Token"]=s)),e},a.getEncryptionKey=function(){return d},a.setEncryptionKeys=function(e,t){d=e},a.setAjaxHeaders=function(e,t,n,o,r){c=t,p=e,i=n,s=o,u=r},a.ajax=function(t){var n=function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}({},{},t);!t.skipEncryption&&d&&("post"===n.type.toLowerCase()&&(n.data=l.encrypt(t.data,d)),n.success=function(e){res=l.decrypt(e,d),l.isJsonString(res)?t.success(JSON.parse(res)):t.success(res)});var o,e,r=new XMLHttpRequest,s=!0;(void 0!==n.async||t.async)&&(s=n.async);var i=n.type.toUpperCase();"GET"===i&&void 0!==n.data&&(n.url=n.url+"?"+n.data),r.open(i,n.url,s),"POST"!==i&&"GET"!==i||(e=void 0===n.contentType?"application/x-www-form-urlencoded; charset=UTF-8":n.contentType,r.setRequestHeader("Content-Type",e)),f=f||"https://apps.applozic.com",-1!==n.url.indexOf(f)&&a.addRequestHeaders(r),-1!==n.url.indexOf("applozic.appspot.com")&&r.setRequestHeader("Application-Key",c),void 0===n.data?r.send():r.send(n.data),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status){var e=r.getResponseHeader("Content-Type");void 0!==e&&"null"!==e&&null!==e||(e=""),o=-1!=e.toLowerCase().indexOf("text/html")?r.responseXML:-1!=e.toLowerCase().indexOf("application/json")?JSON.parse(r.responseText):r.responseText,n.success(o)}else n.error(o)}},a.getMessages=function(o){o.data.userId||o.data.groupId?"undefined"===o.data.pageSize&&(o.data.pageSize=30):void 0===o.data.mainPageSize&&(o.data.mainPageSize=60);var e=m(o.data),r=new Object;a.ajax({url:f+"/rest/ws/message/list?"+e,async:void 0===o.async||o.async,type:"get",success:function(e){r.status="success",r.data=e,o.success&&o.success(r)},error:function(e,t,n){r.status="error",o.error&&o.error(r)}})},a.sendMessage=function(t){a.ajax({type:"POST",url:f+"/rest/ws/message/send",global:!1,data:JSON.stringify(t.data.message),async:void 0===t.async||t.async,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.sendDeliveryUpdate=function(t){a.ajax({url:f+"/rest/ws/message/delivered",data:"key="+t.data.key,global:!1,type:"get",async:void 0===t.async||t.async,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.sendReadUpdate=function(t){a.ajax({url:f+"/rest/ws/message/read",data:"key="+t.data.key,global:!1,type:"get",async:void 0===t.async||t.async,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.deleteMessage=function(t){a.ajax({url:f+"/rest/ws/message/delete?key="+t.data.key,global:!1,type:"get",async:void 0===t.async||t.async,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.updateReplyMessage=function(t){a.ajax({url:f+"/rest/ws/message/detail?keys="+t.data.key,type:"get",async:void 0===t.async||t.async,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.deleteConversation=function(t){a.ajax({url:f+"/rest/ws/message/delete/conversation",type:"get",async:void 0===t.async||t.async,global:!1,data:m(t.data),success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.createGroup=function(t){a.ajax({url:f+"/rest/ws/group/create",global:!1,data:JSON.stringify(t.data.group),type:"post",async:void 0===t.async||t.async,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.loadGroups=function(t){t.baseUrl&&(f=t.baseUrl),a.ajax({url:f+"/rest/ws/group/list",type:"get",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.getGroupInfo=function(t){var e=t.data.groupId?"?groupId="+t.data.groupId:"?clientGroupId="+t.data.clientGroupId;a.ajax({url:f+"/rest/ws/group/v2/info"+e,type:"get",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.addGroupMember=function(t){a.ajax({url:f+"/rest/ws/group/add/member",type:"POST",data:JSON.stringify(t.data.group),async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.removeGroupMember=function(t){a.ajax({url:f+"/rest/ws/group/remove/member",type:"POST",data:JSON.stringify(t.data),async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.groupLeave=function(t){a.ajax({url:f+o,type:"POST",data:JSON.stringify(t.data),async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.groupUpdate=function(t){a.ajax({url:f+"/rest/ws/group/update",type:"POST",data:JSON.stringify(t.data),async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e,t.data)},error:function(e){t.error&&t.error(e)}})},a.isUserPresentInGroup=function(t){a.ajax({url:f+"/rest/ws/group/check/user?userId="+t.data.userId+"&clientGroupId="+t.data.clientGroupId,type:"get",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.groupUserCount=function(t){a.ajax({url:f+"/rest/ws/group/user/count?clientGroupIds="+t.data.clientGroupId,type:"get",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.groupDelete=function(t){a.ajax({url:f+o+"?clientGroupId="+t.data.clientGroupId,type:"GET",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.createUserFriendList=function(t){a.ajax({url:f+r+t.data.group.groupName+"/add/",type:"POST",async:void 0===t.async||t.async,global:!1,data:JSON.stringify(t.data.group.groupMemberList),contentType:"application/json",success:function(e){t.success&&(t.success(e),ALStorage.setFriendListGroupName(t.data.group.groupName))},error:function(e){t.error&&t.error(e)}})},a.createOpenFriendList=function(t){a.ajax({url:f+r+t.data.group.groupName+"/add/members",type:"POST",data:JSON.stringify(t.data.group),async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&(t.success(e),ALStorage.setFriendListGroupName(t.data.group.groupName),ALStorage.setFriendListGroupType(t.data.group.type))},error:function(e){t.error&&t.error(e)}})},a.getFriendList=function(t){var e="null"!==t.data.type?"/get?groupType=9":"/get";t.data.url=t.data.url?t.data.url:e,a.ajax({url:f+r+t.data.groupName+t.data.url,type:"GET",async:void 0===t.data.async||t.data.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.removeUserFromFriendList=function(t){var e=t.group.type?"/remove?userId="+t.group.userId+"&groupType=9":"/remove?userId="+t.group.userId;a.ajax({url:f+r+t.group.groupName+e,type:"Post",contentType:"application/json",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.deleteFriendList=function(t){var e=t.group.type?"/delete?groupType=9":"/delete";a.ajax({url:f+r+t.group.groupName+e,type:"GET",async:!1,contentType:"application/json",async:void 0===t.async||t.async,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.getUserDetail=function(t){a.ajax({url:f+"/rest/ws/user/v2/detail",data:JSON.stringify({userIdList:t.data}),type:"POST",async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.updateUserDetail=function(t){a.ajax({url:f+"/rest/ws/user/update",data:JSON.stringify(t.data),type:"POST",async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.updatePassword=function(t){a.ajax({url:f+"/rest/ws/user/update/password?oldPassword="+t.data.oldPassword+"&newPassword="+t.data.newPassword,type:"GET",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.getContactList=function(t){var e=t.baseUrl?t.baseUrl:f;a.ajax({url:e+t.url,type:"GET",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.userChatMute=function(t){a.ajax({url:f+"/rest/ws/user/chat/mute?userId="+t.data.userId+"&notificationAfterTime="+t.data.notificationAfterTime,type:"post",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.groupMute=function(t){var e={};e.clientGroupId=t.data.clientGroupId,e.notificationAfterTime=t.data.notificationAfterTime,a.ajax({url:f+"/rest/ws/group/user/update",type:"post",data:JSON.stringify(e),contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.syncMuteUserList=function(t){a.ajax({url:f+"/rest/ws/user/chat/mute/list",type:"get",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.blockUser=function(t){a.ajax({url:f+"/rest/ws/user/block?userId="+t.data.userId+"&block="+t.data.isBlock,type:"GET",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.unBlockUser=function(t){a.ajax({url:f+"/rest/ws/user/unblock?userId="+t.data.userId,type:"GET",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.sendConversationCloseUpdate=function(e){var t="id="+e.conversationId;a.ajax({url:f+"/rest/ws/conversation/close",data:t,global:!1,type:"get",success:function(){},error:function(){}})},a.fileUpload=function(t){a.ajax({type:"GET",skipEncryption:!0,url:t.data.url,global:!1,data:"data="+(new Date).getTime(),crosDomain:!0,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.sendAttachment=function(e){"awsS3Server"===n?h.Applozic.ALApiService.sendAttachmentToAWS(e):"googleCloud"===n?h.Applozic.ALApiService.sendAttachmentToCloud(e):h.Applozic.ALApiService.sendAttachmentToGoogleServer(e)},a.sendAttachmentToGoogleServer=function(o){var r=new XMLHttpRequest;a.ajax({type:"GET",skipEncryption:!0,url:void 0!==o.url?o.url:"https://applozic.appspot.com/rest/ws/aws/file/url",global:!1,data:"data="+(new Date).getTime(),crosDomain:!0,success:function(e){r.addEventListener("load",function(e){var t=JSON.parse(this.responseText),n=o.data.messagePxy;t&&(n.fileMeta=t.fileMeta,Applozic.ALApiService.sendMessage({data:{message:n},success:function(e){console.log(e)},error:function(){}}))});var t=new FormData,n=o.data.file;t.append("files[]",n),r.open("POST",e,!0),a.addRequestHeaders(r),r.send(t)},error:function(e){o.error&&o.error(e)}})},a.sendAttachmentToAWS=function(o){var e=new FormData,t=new XMLHttpRequest,n=f+"/rest/ws/upload/image";t.addEventListener("load",function(e){var t=this.responseText,n=o.data.messagePxy;t&&(n.fileMeta=JSON.parse(t),Applozic.ALApiService.sendMessage({data:{message:n},success:function(e){console.log(e)},error:function(){}}))}),e.append("file",o.data.file),t.open("post",n,!0),a.addRequestHeaders(t),t.send(e)},a.sendAttachmentToCloud=function(o){var e=new FormData,t=new XMLHttpRequest,n=void 0!==o.cloudUploadUrl?o.cloudUploadUrl:"https://googleupload.applozic.com/files/upload/";t.addEventListener("load",function(e){var t=JSON.parse(this.responseText),n=o.data.messagePxy;t&&(n.fileMeta=t.fileMeta,Applozic.ALApiService.sendMessage({data:{message:n},success:function(e){console.log(e)},error:function(){}}))}),e.append("files[]",o.data.file),t.open("post",n,!0),a.addRequestHeaders(t),t.send(e)},a.deleteFileMeta=function(t){a.ajax({url:t.data.url,skipEncryption:!0,type:"post",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.addMessageInbox=function(t){a.ajax({type:"GET",url:f+"/rest/ws/message/add/inbox",global:!1,data:"sender="+encodeURIComponent(t.data.sender)+"&messageContent="+encodeURIComponent(t.data.messageContent),contentType:"text/plain",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.conversationReadUpdate=function(t){a.ajax({url:f+"/rest/ws/message/read/conversation",data:t.data,global:!1,type:"get",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},a.sendSubscriptionIdToServer=function(e){var t=e.data.subscriptionId;a.ajax({url:f+"/rest/ws/plugin/update/sw/id",skipEncryption:!0,type:"post",data:"registrationId="+t,success:function(e){},error:function(e,t,n){401===e.status&&(ALStorage.clearSessionStorageElements(),console.log("Please reload page."))}})},a.getTopicId=function(t){var e="id="+t.data.conversationId;a.ajax({url:f+"/rest/ws/conversation/topicId?"+e,type:"get",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},a.getContactDisplayName=function(t){var n=t.data.userIdArray;if(0<n.length&&n[0]){for(var e="",o=n.filter(function(e,t){return n.indexOf(e)===t}),r=0;r<o.length;r++){var s=o[r];void 0===MCK_CONTACT_NAME_MAP[s]&&(e+="userIds="+encodeURIComponent(s)+"&")}e.lastIndexOf("&")===e.length-1&&(e=e.substring(0,e.length-1)),e&&a.ajax({url:f+"/rest/ws/user/info",data:e,global:!1,type:"get",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})}},a.getUserStatus=function(t){a.ajax({url:f+"/rest/ws/user/chat/status",type:"get",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},a.fetchConversationByTopicId=function(t){var e="topic="+t.data.topicId;if(t.data.tabId)e+=""+t.data.isGroup=="true"?"&groupId="+t.data.tabId:"&userId="+encodeURIComponent(t.data.tabId);else{if(!t.data.clientGroupId)return!1;e+="&clientGroupId="+t.data.clientGroupId}t.data.pageSize&&(e+="&pageSize="+t.data.pageSize),a.ajax({url:f+"/rest/ws/conversation/get",data:e,type:"get",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},a.getConversationId=function(t){a.ajax({url:f+"/rest/ws/conversation/id",global:!1,data:w.JSON.stringify(t.data),type:"post",contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},a.registerClientApi=function(t){a.ajax({url:f+"/rest/ws/register/client",type:"post",data:JSON.stringify(t.data.userPxy),contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},a.logout=function(t){a.ajax({url:f+"/rest/ws/device/logout",type:"post",async:void 0===t.async||t.async,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a.getUsersByRole=function(t){var e=m(t.data);a.ajax({url:f+"/rest/ws/user/v3/filter?"+e,global:!1,type:"get",contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},a.pushNotificationLogout=function(t){a.ajax({url:f+"/rest/ws/device/logout",type:"post",async:void 0===t.async||t.async,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},a}():console.log("ALApiService already defined.")}(window),function(d){"use strict";"undefined"==typeof ALSocket?d.Applozic.ALSocket=function(){var r,l={events:{}},u=null;l.stompClient=null;var t,n,s="";l.typingSubscriber=null,l.openGroupSubscriber=[];var o=[];l.mck_typing_status=0;var i="",a="https://socket.applozic.com",c="80";l.MCK_TOKEN,l.USER_DEVICE_KEY,l.USER_ENCRYPTION_KEY;var p=new MckUtils;return l.init=function(e,t,n){e&&(r=e),void 0!==t&&(l.MCK_TOKEN=t.token,l.APP_VERSION_CODE=t.appVersionCode,l.USER_DEVICE_KEY=t.deviceKey,(t.encryptionKey||t.appVersionCode===d.Applozic.ALApiService.DEFAULT_ENCRYPTED_APP_VERSION)&&(l.USER_ENCRYPTION_KEY=t.userEncryptionKey),a=t.websocketUrl,c=void 0===t.websocketPort?p.startsWith(a,"https")?"15675":"15674":t.websocketPort),l.setOnline=function(){void 0!==d.Applozic.ALSocket&&d.Applozic.ALSocket.sendStatus(1)},l.events=n,void 0!==a&&navigator.onLine&&"function"==typeof SockJS&&(i=new SockJS(a+":"+c+"/stomp"),l.stompClient=Stomp.over(i),l.stompClient.heartbeat.outgoing=1e4,l.stompClient.heartbeat.incoming=0,l.stompClient.reconnect_delay=3e4,l.stompClient.onclose=function(){l.disconnect()},l.stompClient.connect("guest","guest",l.onConnect,l.onError,"/"),d.addEventListener("beforeunload",function(e){var t;e.target.activeElement&&(t=e.target.activeElement.href),t&&0!==t.length||l.disconnect()}))},l.checkConnected=function(e){l.stompClient.connected?(t&&clearInterval(t),n&&clearInterval(n),t=setInterval(function(){l.connectToSocket(e)},6e5),n=setInterval(function(){l.sendStatus(1)},12e5)):l.connectToSocket(e)},l.connectToSocket=function(e){"function"==typeof l.connectToSocket&&l.events.connectToSocket(e)},l.stopConnectedCheck=function(){t&&clearInterval(t),n&&clearInterval(n),n=t="",l.disconnect()},l.disconnect=function(){l.stompClient&&l.stompClient.connected&&(l.sendStatus(0),l.stompClient.disconnect())},l.unsubscibeToTypingChannel=function(){l.stompClient&&l.stompClient.connected&&l.typingSubscriber&&(1===l.mck_typing_status&&l.sendTypingStatus(0,s),l.typingSubscriber.unsubscribe()),l.typingSubscriber=null},l.unsubscibeToNotification=function(){l.stompClient&&l.stompClient.connected&&u&&u.unsubscribe(),u=null},l.subscibeToTypingChannel=function(e){l.stompClient&&l.stompClient.connected?l.typingSubscriber=l.stompClient.subscribe("/topic/typing-"+r+"-"+e,l.onTypingStatus):l.reconnect()},l.subscribeToOpenGroup=function(e){if(console.log("adding subscription"),l.stompClient&&l.stompClient.connected){var t=l.stompClient.subscribe("/topic/group-"+r+"-"+e.contactId,l.onOpenGroupMessage);l.openGroupSubscriber.push(t.id),o[e.contactId]=t.id}else l.reconnect()},l.sendTypingStatus=function(e,t,n,o){if(l.mck_typing_status=t,l.stompClient&&l.stompClient.connected){if(1===e&&1===l.mck_typing_status&&l.stompClient.send("/topic/typing-"+r+"-"+s,{"content-type":"text/plain"},r+","+n+","+e),o){if(o===s&&e===l.mck_typing_status&&1===e)return;s=o,l.stompClient.send("/topic/typing-"+r+"-"+o,{"content-type":"text/plain"},r+","+n+","+e),setTimeout(function(){l.mck_typing_status=0},6e4)}else 0===e&&l.stompClient.send("/topic/typing-"+r+"-"+s,{"content-type":"text/plain"},r+","+n+","+e);l.mck_typing_status=e}},l.onTypingStatus=function(e){"function"==typeof l.events.onTypingStatus&&l.events.onTypingStatus(e)},l.reconnect=function(){l.unsubscibeToTypingChannel(),l.unsubscibeToNotification(),l.disconnect();var e={};e.token=l.MCK_TOKEN,e.deviceKey=l.USER_DEVICE_KEY,e.userEncryptionKey=l.USER_ENCRYPTION_KEY,e.websocketUrl=a,e.websocketPort=c,l.init(r,e,l.events)},l.onError=function(e){console.log("Error in channel notification. "+e),"function"==typeof l.events.onConnectFailed&&setTimeout(function(){l.events.onConnectFailed()},3e4)},l.sendStatus=function(e){l.stompClient&&l.stompClient.connected&&l.stompClient.send("/topic/status-v2",{"content-type":"text/plain"},l.MCK_TOKEN+","+l.USER_DEVICE_KEY+","+e)},l.onConnect=function(){var e="/topic/"+(l.USER_ENCRYPTION_KEY?"encr-":"")+l.MCK_TOKEN;l.stompClient.connected?(u&&l.unsubscibeToNotification(),u=l.stompClient.subscribe(e,l.onMessage),l.sendStatus(1),l.checkConnected(!0)):setTimeout(function(){u=l.stompClient.subscribe(e,l.onMessage),l.sendStatus(1),l.checkConnected(!0)},5e3),"function"==typeof l.events.onConnect&&l.events.onConnect()},l.onOpenGroupMessage=function(e){"function"==typeof l.events.onOpenGroupMessage&&l.events.onOpenGroupMessage(e)},l.onMessage=function(e){if(null!=u&&u.id===e.headers.subscription){var t=p.decrypt(e.body,l.USER_ENCRYPTION_KEY),n=JSON.parse(t),o=n.type;if("function"==typeof l.events.onMessage&&l.events.onMessage(n),"APPLOZIC_04"===o||"MESSAGE_DELIVERED"===o)l.events.onMessageDelivered(n);else if("APPLOZIC_08"===o||"MT_MESSAGE_DELIVERED_READ"===o)l.events.onMessageRead(n);else if("APPLOZIC_05"===o)l.events.onMessageDeleted(n);else if("APPLOZIC_27"===o)l.events.onConversationDeleted(n);else if("APPLOZIC_11"===o)l.events.onUserConnect(n.message);else if("APPLOZIC_12"===o){var r=n.message.split(",")[1];l.events.onUserDisconnect({userId:i,lastSeenAtTime:r})}else if("APPLOZIC_29"===o)l.events.onConversationReadFromOtherSource(n);else if("APPLOZIC_28"===o)l.events.onConversationRead(n);else if("APPLOZIC_16"===o){var s=n.message.split(":")[0],i=n.message.split(":")[1];l.events.onUserBlocked({status:s,userId:i})}else if("APPLOZIC_17"===o)s=n.message.split(":")[0],i=n.message.split(":")[1],l.events.onUserUnblocked({status:s,userId:i});else if("APPLOZIC_18"===o)l.events.onUserActivated();else if("APPLOZIC_19"===o)l.events.onUserDeactivated();else{var a=n.message;if("APPLOZIC_03"===o)l.events.onMessageSentUpdate({messageKey:a.key});else if("APPLOZIC_01"===o||"MESSAGE_RECEIVED"===o){var c=alMessageService.getMessageFeed(a);l.events.onMessageReceived({message:c})}else"APPLOZIC_02"===o&&(c=alMessageService.getMessageFeed(a),l.events.onMessageSent({message:c}))}}},l}():console.log("ALSocket already defined.")}(window);var mckNotificationUtils=new MckNotificationUtils,alNotificationService=new AlNotificationService;function AlNotificationService(){var t,n,o=this;o.init=function(e){t="boolean"==typeof e.swNotification&&e.swNotification,e.contactDisplayImage,e.notificationIconLink,"boolean"==typeof e.desktopNotification&&e.desktopNotification},o.unsubscribeToServiceWorker=function(){n&&navigator.serviceWorker.ready.then(function(e){n.unsubscribe().then(function(e){n=null,console.log("Unsubscribed to notification successfully")})})},o.sendSubscriptionIdToServer=function(){if(n){var e=n.endpoint.split("/").slice(-1)[0];e&&window.Applozic.ALApiService.sendSubscriptionIdToServer({data:{subscriptionId:e},success:function(e){},error:function(){}})}},o.subscribeToServiceWorker=function(){t&&"serviceWorker"in navigator&&(navigator.serviceWorker.register("./service-worker.js",{scope:"./"}),navigator.serviceWorker.ready.then(function(e){e.pushManager.subscribe({userVisibleOnly:!0}).then(function(e){console.log("The reg ID is:: ",e.endpoint.split("/").slice(-1)),n=e,o.sendSubscriptionIdToServer()})}))}}function MckNotificationUtils(){var i=this,a=window.top,t="default",c="granted",n=[c,t,"denied"],o=function(){var e=!1;try{e=!!(a.Notification||a.webkitNotifications||navigator.mozNotification||a.external&&void 0!==a.external.msIsSiteMode())}catch(e){}return e}(),l=Math.floor(10*Math.random()+1),r=function(){};i.permissionLevel=function(){var e;if(o)return a.Notification&&a.Notification.permissionLevel?e=a.Notification.permissionLevel():a.webkitNotifications&&a.webkitNotifications.checkPermission?e=n[a.webkitNotifications.checkPermission()]:a.Notification&&a.Notification.permission?e=a.Notification.permission:navigator.mozNotification?e=c:a.external&&void 0!==a.external.msIsSiteMode()&&(e=a.external.msIsSiteMode()?c:t),e},i.requestPermission=function(e){var t,n=(t=e)&&t.constructor===Function?e:r;a.webkitNotifications&&a.webkitNotifications.checkPermission?a.webkitNotifications.requestPermission(n):a.Notification&&a.Notification.requestPermission&&a.Notification.requestPermission(n)},i.isChrome=function(){return/chrom(e|ium)/.test(a.navigator.userAgent.toLowerCase())},i.getNotification=function(e,t,n,o){var r;if(o&&(o.play(),setTimeout(function(){o.stop()},1e3)),a.Notification){var s={icon:t,body:n};(r=new a.Notification(e,s)).onclick=function(){a.focus(),this.close()}}else a.webkitNotifications?(r=a.webkitNotifications.createNotification(t,e,n),o&&r.show(),i.isChrome()&&(r.onclick=function(){a.focus(),this.cancel()}),r.show(),setTimeout(function(){r.cancel()},3e4)):navigator.mozNotification?(r=navigator.mozNotification.createNotification(e,n,t)).show():a.external&&a.external.msIsSiteMode()&&(a.external.msSiteModeClearIconOverlay(),a.external.msSiteModeSetIconOverlay(t,e),a.external.msSiteModeActivate(),r={ieVerification:l+1});return r},i.sendDesktopNotification=function(e,t,n,o){if(i.permissionLevel()!==c&&a.Notification.requestPermission(),i.permissionLevel()===c){var r;r=o?i.getNotification(e,t,n,o):i.getNotification(e,t,n);var s=i.getWrapper(r);r&&!r.ieVerification&&r.addEventListener&&r.addEventListener("show",function(){var e=s;a.setTimeout(function(){e.close()},3e4)})}},i.getWrapper=function(e){return{close:function(){e&&(e.close?e.close():e.cancel?e.cancel():a.external&&a.external.msIsSiteMode()&&e.ieVerification===l&&a.external.msSiteModeClearIconOverlay())}}}}var mckGroupUtils=new MckGroupUtils,mckGroupService=new MckGroupService;function MckGroupUtils(){var e=this;e.GROUP_ROLE_MAP=[0,1,2,3],e.GROUP_TYPE_MAP=[1,2,5,6,7,9,10],e.CONVERSATION_STATUS_MAP=["DEFAULT","NEW","OPEN"],e.ROLE_MAP={0:"User",1:"Admin",2:"Moderator",3:"Member"},e.getDeletedAtTime=function(e){if("object"==typeof MCK_GROUP_MAP[e])return MCK_GROUP_MAP[e].deletedAtTime},e.leaveGroup=function(e){return"object"!=typeof e?"Unsupported Format. Please check format":"function"==typeof e.callback?void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId?(e.apzCallback=mckGroupLayout.onGroupLeft,mckGroupService.leaveGroup(e),"success"):void e.callback({status:"error",errorMessage:"GroupId or Client GroupId Required"}):"Callback Function Required"},e.initGroupTab=function(e){if("object"==typeof e){var t=e.users;return void 0===t||t.length<1?"Users List Required":t.length>MCK_GROUPMAXSIZE?"Users limit exceeds "+MCK_GROUPMAXSIZE+". Max number of users allowed is "+MCK_GROUPMAXSIZE+".":e.groupName?void 0===e.type?"Group type required":-1===GROUP_TYPE_MAP.indexOf(e.type)?"Invalid group type":(mckMessageService.getGroup(e),"success"):"Group name required"}return"Unsupported format. Please check format"},e.getGroup=function(e){return"object"==typeof MCK_GROUP_MAP[e]?MCK_GROUP_MAP[e]:void 0},e.getGroupByClientGroupId=function(e){return"object"==typeof MCK_CLIENT_GROUP_MAP[e]?MCK_CLIENT_GROUP_MAP[e]:void 0},e.addGroup=function(e){var t=e.name?e.name:e.id,n=[];$applozic.each(e.groupUsers,function(e,t){t.userId&&(n[t.userId]=t)});var o=void 0!==e.removedMembersId?e.removedMembersId:[],r={contactId:e.id.toString(),htmlId:mckContactUtils.formatContactId(""+e.id),displayName:t,value:e.id.toString(),adminName:e.adminId?e.adminId:e.adminName,type:e.type,members:e.membersId?e.membersId:e.membersName,imageUrl:e.imageUrl,users:n,userCount:e.userCount,removedMembersId:o,clientGroupId:e.clientGroupId,isGroup:!0,deletedAtTime:e.deletedAtTime,metadata:e.metadata};return MCK_GROUP_MAP[e.id]=r,e.clientGroupId&&(MCK_CLIENT_GROUP_MAP[e.clientGroupId]=r),r},e.createGroup=function(e){var t={contactId:e.toString(),htmlId:mckContactUtils.formatContactId(""+e),displayName:e.toString(),value:e.toString(),type:2,adminName:"",imageUrl:"",userCount:"",users:[],removedMembersId:[],clientGroupId:"",isGroup:!0,deletedAtTime:""};return MCK_GROUP_MAP[e]=t}}function MckGroupService(){var t,i,n,a=this;MCK_GROUP_ARRAY=new Array,a.addGroups=function(e){var t=e.data;MCK_GROUP_ARRAY.length=0,t.forEach(function(e,t){if(void 0!==e.id){e=mckGroupUtils.addGroup(e);MCK_GROUP_ARRAY.push(e)}})},a.removeGroupMember=function(e){return"object"!=typeof e?"Unsupported Format. Please check format":"function"==typeof e.callback?void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId?void 0===e.userId||""===e.userId?void e.callback({status:"error",errorMessage:"UserId required"}):(e.apzCallback=mckGroupLayout.onRemovedGroupMember,mckGroupService.removeGroupMemberFromChat(e),"success"):void e.callback({status:"error",errorMessage:"GroupId or clientGroupId required"}):"Callback function required"},a.createGroup=function(e){if("object"==typeof e){if("function"==typeof e.callback){var t=e.users;return void 0===t||t.length<1?void e.callback({status:"error",errorMessage:"Users list required"}):t.length>MCK_GROUPMAXSIZE?void e.callback({status:"error",errorMessage:"Users limit exceeds "+MCK_GROUPMAXSIZE+". Max number of users allowed is "+MCK_GROUPMAXSIZE+"."}):e.groupName?void 0===e.type||""===e.type?void e.callback({status:"error",errorMessage:"Group type required"}):-1===GROUP_TYPE_MAP.indexOf(e.type)?void e.callback({status:"error",errorMessage:"Invalid group type"}):(mckMessageService.getGroup(e),"success"):void e.callback({status:"error",errorMessage:"Group name required"})}return"Callback function required"}return"Unsupported Format. Please check format"},a.init=function(e){t=e.visitor,i=t?"guest":$applozic.trim(e.userId),n=e.openGroupSettings},a.getGroupList=function(e){return"function"==typeof e.callback?(e.apzCallback=a.addGroups,a.loadGroups(e),"success"):"Callback Function Required"},a.loadGroups=function(t){var n=new Object;window.Applozic.ALApiService.loadGroups({baseUrl:MCK_BASE_URL,success:function(e){"success"===e.status?(n.status="success",n.data=e.response,t.apzCallback&&t.apzCallback(n)):n.status="error",t.callback&&t.callback(n)},error:function(){console.log("Unable to load groups. Please reload page."),n.status="error",t.callback&&t.callback(n),t.apzCallback&&t.apzCallback(n)}})},a.getGroupFeed=function(o){var e={};if("function"==typeof o.callback||"function"==typeof o.apzCallback){var t=new Object;if(o.groupId)e.groupId=o.groupId;else{if(!o.clientGroupId)return void("function"==typeof o.callback&&(t.status="error",t.errorMessage="GroupId or Client GroupId Required",o.callback(t)));e.clientGroupId=o.clientGroupId}o.conversationId&&(e.conversationId=o.conversationId),Applozic.ALApiService.getGroupInfo({data:e,success:function(e){if("success"===e.status){var t=e.response;if(t+""=="null"||"object"!=typeof t)e.status="error",e.errorMessage="GroupId not found";else{var n=mckGroupUtils.addGroup(t);e.status="success",e.data=n}}else"error"===e.status&&(e.status="error",e.errorMessage=e.errorResponse[0].description);o.callback&&o.callback(e),o.apzCallback&&("success"===e.status&&(e.data=t),o.apzCallback(e,o))},error:function(){console.log("Unable to load group. Please reload page."),t.status="error",t.errorMessage="Please reload page.",o.callback&&o.callback(t),o.apzCallback&&o.apzCallback(t,o)}})}},a.leaveGroup=function(n){var e={},o=new Object;if(n.groupId)e.groupId=n.groupId;else{if(!n.clientGroupId)return o.status="error",o.errorMessage="GroupId or Client GroupId Required",void(n.callback&&n.callback(o));e.clientGroupId=n.clientGroupId}Applozic.ALApiService.groupLeave({data:e,success:function(e){if("success"===e.status){if(n.clientGroupId){var t=mckGroupUtils.getGroupByClientGroupId(n.clientGroupId);"object"==typeof t&&(n.groupInfo=t.contactId)}o.status="success",o.data={groupId:n.groupId}}else o.status="error",o.errorMessage=e.errorResponse[0].description;n.callback&&n.callback(o),n.apzCallback&&n.apzCallback(o,{groupId:n.groupId})},error:function(){console.log("Unable to process your request. Please reload page."),o.status="error",o.errorMessage="",n.callback&&n.callback(o),n.apzCallback&&n.apzCallback(o)}})},a.removeGroupMemberFromChat=function(n){var e={},t=new Object;if(n.groupId)e.groupId=n.groupId;else{if(!n.clientGroupId)return t.status="error",t.errorMessage="GroupId or Client GroupId Required",void("function"==typeof n.callback&&n.callback(t));e.clientGroupId=n.clientGroupId}e.userId=n.userId,Applozic.ALApiService.removeGroupMember({data:e,success:function(e){if("success"===e.status){if(n.clientGroupId){var t=mckGroupUtils.getGroupByClientGroupId(n.clientGroupId);"object"==typeof t&&(n.groupId=t.contactId)}e.status="success"}else e.status="error",e.errorMessage=data.errorResponse[0].description;n.callback&&n.callback(e),n.apzCallback&&n.apzCallback(e,n)},error:function(){console.log("Unable to process your request. Please reload page."),t.status="error",t.errorMessage="",n.callback&&n.callback(t),n.apzCallback&&n.apzCallback(t),n.apzCallback(t)}})},a.addGroupMember=function(n){var e={},o=new Object;if(n.groupId)e.groupId=n.groupId;else{if(!n.clientGroupId)return void("function"==typeof n.callback&&n.callback(o));e.clientGroupId=n.clientGroupId}e.userId=n.userId,void 0!==n.role&&(e.role=n.role),Applozic.ALApiService.addGroupMember({data:{group:e},success:function(e){if("success"===e.status){if(n.clientGroupId){var t=mckGroupUtils.getGroupByClientGroupId(n.clientGroupId);"object"==typeof t&&(n.groupId=t.contactId)}o.status="success",o.data=e.response}else o.status="error",o.errorMessage=e.errorResponse[0].description;n.callback&&n.callback(o),n.apzCallback&&n.apzCallback(o,n)},error:function(){console.log("Unable to process your request. Please reload page."),o.status="error",o.errorMessage="",n.callback&&n.callback(o),n.apzCallback&&n.apzCallback(o)}})},a.updateGroupInfo=function(n){var e={},o=new Object;if(n.groupId)e.groupId=n.groupId;else{if(!n.clientGroupId)return void("function"==typeof n.callback&&(o.status="error",o.errorMessage="GroupId or Client GroupId Required",n.callback(o)));e.clientGroupId=n.clientGroupId}n.name&&(e.newName=n.name),n.imageUrl&&(e.imageUrl=n.imageUrl),n.users&&0<n.users.length&&(e.users=n.users),Applozic.ALApiService.groupUpdate({data:e,success:function(e,t){if("success"===e.status){if(n.clientGroupId)"object"==typeof(t=mckGroupLayout.getGroupByClientGroupId(n.clientGroupId))&&(n.groupId=t.contactId);o.status="success",o.data=e.response}else o.status="error",o.errorMessage=e.errorResponse[0].description;n.callback&&n.callback(o),n.apzCallback&&n.apzCallback(o,{groupId:n.groupId,groupInfo:t,users:n.users})},error:function(){console.log("Unable to process your request. Please reload page."),o.status="error",o.errorMessage="Unable to process your request. Please reload page.",n.callback&&n.callback(o),n.apzCallback&&n.apzCallback(o)}})},a.sendGroupMessage=function(e){if("object"==typeof e){var t=(e=$applozic.extend(!0,{},message_default_options,e)).message;if(!e.groupId&&!e.clientGroupId)return"groupId or clientGroupId required";if(void 0===t||""===t)return"message field required";if(12<e.type)return"invalid message type";t=$applozic.trim(t);var n={type:e.messageType,contentType:e.type,message:t};if(e.groupId)n.groupId=$applozic.trim(e.groupId);else if(e.clientGroupId){if(void 0===mckGroupUtils.getGroupByClientGroupId(e.clientGroupId))return"group not found";n.clientGroupId=$applozic.trim(e.clientGroupId)}return mckMessageService.sendMessage(n),"success"}return"Unsupported format. Please check format"},a.getContactFromGroupOfTwo=function(e,t){for(var n,o=0;o<e.members.length;o++)if(n=""+e.members[o],i!==n)return"function"==typeof t&&t(n),n},a.addGroupFromMessage=function(e,t,n){var o=e.groupId,r=mckGroupUtils.getGroup(""+o);void 0===r&&(r=mckGroupUtils.createGroup(o),a.loadGroups({apzCallback:a.addGroups})),"function"==typeof n&&n(r,e,t)},a.isGroupDeleted=function(e,t){if(t){var n=mckGroupUtils.getDeletedAtTime(e);return void 0!==n&&0<n}return!1},a.loadGroupsCallback=function(e){var t=e.data;MCK_GROUP_ARRAY.length=0,$applozic.each(t,function(e,t){if(void 0!==t.id){t=mckGroupUtils.addGroup(t);MCK_GROUP_ARRAY.push(t)}})},a.getGroupDisplayName=function(e){if("object"==typeof MCK_GROUP_MAP[e]){var t=MCK_GROUP_MAP[e],n=t.displayName,o=[];if(7===t.type){var r=a.getContactFromGroupOfTwo(t);void 0!==r&&(alUserService.MCK_USER_DETAIL_MAP[r]?alUserService.MCK_USER_DETAIL_MAP[r]&&alUserService.MCK_USER_DETAIL_MAP[r].displayName&&(n=alUserService.MCK_USER_DETAIL_MAP[r].displayName):(o.push(r),window.Applozic.ALApiService.getUserDetail({data:o,success:function(e){0<e.response.length&&$applozic.each(e.response,function(e,t){alUserService.MCK_USER_DETAIL_MAP[t.userId]=t,alUserService.MCK_USER_DETAIL_MAP[r]&&alUserService.MCK_USER_DETAIL_MAP[r].displayName&&(n=alUserService.MCK_USER_DETAIL_MAP[r].displayName)})}})))}if(3===t.type&&-1!==n.indexOf(i)&&(n=n.replace(i,"").replace(":",""),"function"==typeof MCK_GETUSERNAME)){var s=MCK_GETUSERNAME(n);n=s||n}return n||5!==t.type||(n="Broadcast"),n||(n=t.contactId),n}return e},a.getGroupImage=function(e){return e?'<img src="'+e+'"/>':'<img src="'+MCK_BASE_URL+'/resources/sidebox/css/app/images/mck-icon-group.png"/>'},a.getGroupDefaultIcon=function(){return'<div class="mck-group-icon-default"></div>'},a.addMemberToGroup=function(e,t){return"object"==typeof e.members&&(-1===e.members.indexOf(t)&&e.members.push(t),"object"==typeof e.removedMembersId&&-1!==e.removedMembersId.indexOf(t)&&e.removedMembersId.splice(e.removedMembersId.indexOf(t),1),MCK_GROUP_MAP[e.contactId]=e),e},a.removeMemberFromGroup=function(e,t){return"object"!=typeof e.removedMembersId||e.removedMembersId.length<1?(e.removedMembersId=[],e.removedMembersId.push(t)):-1===e.removedMembersId.indexOf(t)&&e.removedMembersId.push(t),MCK_GROUP_MAP[e.contactId]=e},a.authenticateGroupUser=function(e){var t=!1;if(!a.isGroupLeft(e)&&0<e.members.length)for(var n=0;n<e.members.length;n++)if(i===""+e.members[n])return t=!0;return t},a.isAppendOpenGroupContextMenu=function(e){return 0!==n.deleteChatAccess&&(!!mckGroupService.authenticateGroupUser(e)&&(e.adminName===i||2===n.deleteChatAccess))},a.isGroupLeft=function(e){var n=!1;return e.removedMembersId&&0<e.removedMembersId.length&&e.removedMembersId.forEach(function(e,t){e===i&&(n=!0)}),n}}var alUserService=new AlUserService;function AlUserService(){var o=this;o.MCK_USER_DETAIL_MAP=[],o.MCK_BLOCKED_TO_MAP=[];new Array;o.updateUserStatus=function(e,t){if("object"==typeof alUserService.MCK_USER_DETAIL_MAP[e.userId]){var n=alUserService.MCK_USER_DETAIL_MAP[e.userId];0===e.status?(n.connected=!1,n.lastSeenAtTime=e.lastSeenAtTime):1===e.status&&(n.connected=!0)}else{var o=new Array;o.push(e.userId),"function"==typeof t&&t(o)}},o.getUserDetail=function(e){return"object"==typeof alUserService.MCK_USER_DETAIL_MAP[e]?alUserService.MCK_USER_DETAIL_MAP[e]:void 0},o.checkUserConnectedStatus=function(e){var n=new Array,o=new Array;$applozic(".mck-user-ol-status").each(function(){var e=$applozic(this).data("mck-id");if(void 0!==e&&""!==e){n.push(e);var t=mckContactUtils.formatContactId(""+e);$applozic(this).addClass(t),$applozic(this).next().addClass(t)}}),0<n.length&&($applozic.each(n,function(e,t){void 0===alUserService.MCK_USER_DETAIL_MAP[t]&&o.push(t)}),"function"==typeof e&&e(o))},o.loadUserProfile=function(e){if(void 0!==e){"string"!=typeof e&&(e=String(e));var t=[],n=""+e.split(",")[0];t.push(n),o.loadUserProfiles(t)}},o.loadUserProfiles=function(e,t){"function"==typeof t&&t(e,[])},o.getUserStatus=function(t,n){var o=new Object;window.Applozic.ALApiService.getUserStatus({success:function(e){0<e.users.length&&([],"function"==typeof n&&n(e)),o.status="success",o.data=e,t.callback&&t.callback(o)},error:function(){o.status="error",t.callback&&t.callback(o)}})},o.blockUser=function(t,n,o){if(t&&void 0!==n){var e="userId="+t+"&block="+n;mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/block",type:"get",data:e,encryptionKey:window.Applozic.ALApiService.getEncryptionKey(),success:function(e){"object"==typeof e&&"success"===e.status&&(alUserService.MCK_BLOCKED_TO_MAP[t]=n,"function"==typeof o&&o(t))},error:function(){}})}}}var alFileService=new AlFileService;function AlFileService(){var r,n,s,i,a=this,o="/rest/ws/aws/file/",c="www.googleapis.com";a.init=function(e){n=e.fileBaseUrl,btoa(e.userId+":"+e.deviceKey),e.deviceKey},a.get=function(e){e.appId,r=e.customUploadUrl,e.fileupload,s=e.mapStaticAPIkey,e.accessToken,e.appModuleName,i=e.genereateCloudFileUrl},a.deleteFileMeta=function(e){window.Applozic.ALApiService.deleteFileMeta({data:{blobKey:e,url:n+"/rest/ws/aws/file/delete?key="+e},success:function(e){console.log(e)},error:function(){}})},a.getFilePreviewPath=function(e){return"object"==typeof e?'<a href="'+n+o+e.blobKey+'" target="_blank">'+e.name+"</a>":""},a.getFilePreviewSize=function(e){return e?1048576<e?"("+parseInt(e/1048576)+" MB)":1024<e?"("+parseInt(e/1024)+" KB)":"("+parseInt(e)+" B)":""},a.getFileurl=function(e){var t;return"object"==typeof e.fileMeta?e.fileMeta.hasOwnProperty("url")?-1!==e.fileMeta.url.indexOf(c)?(a.generateCloudUrl(e.fileMeta.blobKey,function(e){t=e}),t):""+e.fileMeta.url:e.fileMeta.thumbnailUrl==="thumbnail_"+e.fileMeta.name?r+"/files/"+e.fileMeta.name:n+o+e.fileMeta.blobKey:""},a.generateCloudUrl=function(e,t){var n=i.replace("{key}",e),o=window.Applozic.ALApiService.getAttachmentHeaders();mckUtils.ajax({type:"get",async:!1,skipEncryption:!0,headers:o,url:n,success:function(e){"function"==typeof t&&t(e)},error:function(e){console.log("error while getting token"+e)}})},a.getFilePath=function(t){if(2===t.contentType)try{var e=$applozic.parseJSON(t.message);if(e.lat&&e.lon)return'<a href="http://maps.google.com/maps?z=17&t=m&q=loc:'+e.lat+","+e.lon+'" target="_blank"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+e.lat+","+e.lon+"&maptype=roadmap&markers=color:red|"+e.lat+","+e.lon+"&key="+s+'"/></a>'}catch(e){if(-1!==t.message.indexOf(","))return'<a href="http://maps.google.com/maps?z=17&t=m&q=loc:'+t.message+'" target="_blank"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+t.message+"&maptype=roadmap&markers=color:red|"+t.message+"&key="+s+'" /></a>'}var n,o;return"object"==typeof t.fileMeta?-1===t.fileMeta.contentType.indexOf("image")?-1!==t.fileMeta.contentType.indexOf("video")?t.fileMeta.hasOwnProperty("url")&&-1!==t.fileMeta.url.indexOf(c)?(a.generateCloudUrl(t.fileMeta.blobKey,function(e){n=e}),'<a href="#" target="_self"><video controls class="mck-video-player" onplay="alFileService.updateAudVidUrl(this);" data-cloud-service="google_cloud" data-blobKey="'+t.fileMeta.blobKey+'"><source src="'+n+'" type="video/mp4"><source src="'+n+'" type="video/ogg"></video>'):'<a href= "#" target="_self"><video controls class="mck-video-player"><source src="'+a.getFileurl(t)+'" type="video/mp4"><source src="'+a.getFileurl(t)+'" type="video/ogg"></video></a>':-1!==t.fileMeta.contentType.indexOf("audio")?t.fileMeta.hasOwnProperty("url")&&-1!==t.fileMeta.url.indexOf(c)?(a.generateCloudUrl(t.fileMeta.blobKey,function(e){n=e}),'<a href="#" target="_self"><audio controls class="mck-audio-player" onplay="alFileService.updateAudVidUrl(this);" data-cloud-service="google_cloud" data-blobKey="'+t.fileMeta.blobKey+'"><source src="'+n+'" type="audio/ogg"><source src="'+n+'" type="audio/mpeg"></audio><p class="mck-file-tag"></p></a>'):'<a href="#" target="_self"><audio controls class="mck-audio-player"><source src="'+a.getFileurl(t)+'" type="audio/ogg"><source src="'+a.getFileurl(t)+'" type="audio/mpeg"></audio><p class="mck-file-tag"></p></a>':'<a href="#" role="link" class="file-preview-link" target="_self"></a>':-1!==t.fileMeta.contentType.indexOf("svg")?'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+a.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+a.getFileurl(t)+'" area-hidden="true"></img></a>':5===t.contentType?'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+t.fileMeta.blobKey+'" data-name="'+t.fileMeta.name+'"><img src="'+t.fileMeta.blobKey+'" area-hidden="true"></img></a>':t.fileMeta.hasOwnProperty("url")?-1!==t.fileMeta.url.indexOf(c)?(a.generateCloudUrl(t.fileMeta.thumbnailBlobKey,function(e){o=e}),'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="" data-blobKey="'+t.fileMeta.blobKey+'" data-name="'+t.fileMeta.name+'"><img src="'+o+'" area-hidden="true"></img></a>'):'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+a.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+t.fileMeta.thumbnailUrl+'" area-hidden="true"></img></a>':t.fileMeta.thumbnailUrl==="thumbnail_"+t.fileMeta.name?'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+a.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+r+"/files/thumbnail_"+t.fileMeta.name+'" area-hidden="true"></img></a>':'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+a.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+t.fileMeta.thumbnailUrl+'" area-hidden="true"></img></a>':""},a.updateAudVidUrl=function(e){var t=e.dataset.blobkey,n=(new Date).getTime(),o=e.currentSrc;1e3*a.fetchQueryString("Expires",o)<=n&&(a.generateCloudUrl(t,function(e){getUrl=e}),e.src=getUrl)},this.fetchQueryString=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==n&&console.log("The parameter is null for the searchedquery"),n[1]},a.getFileAttachment=function(e){if("object"==typeof e.fileMeta)return(-1!==e.fileMeta.contentType.indexOf("image")||-1!==e.fileMeta.contentType.indexOf("audio")||-1!==e.fileMeta.contentType.indexOf("video"))&&e.fileMeta.hasOwnProperty("url")&&-1!==e.fileMeta.url.indexOf(c)?'<a href="javascript:void(0);" role="link" target="_self"  class="file-preview-link" data-blobKey="'+e.fileMeta.blobKey+'" data-cloud-service="google_cloud"><span class="file-detail mck-image-download"><span class="mck-file-name"><span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+alFileService.getFilePreviewSize(e.fileMeta.size)+"</span></span></a>":'<a href="'+a.getFileurl(e)+'" role="link" target="_self"  class="file-preview-link"><span class="file-detail mck-image-download"><span class="mck-file-name"><span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+alFileService.getFilePreviewSize(e.fileMeta.size)+"</span></span></a>"},a.getFileIcon=function(e){return e.fileMetaKey&&"object"==typeof e.fileMeta?-1!==e.fileMeta.contentType.indexOf("image")?'<span class="mck-icon--camera"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3.2" fill="rgba(38,50,56,.52)"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z" fill="rgba(38,50,56,.52)"/><path d="M0 0h24v24H0z" fill="none"/></svg></span>&nbsp;<span>Image</span>':-1!==e.fileMeta.contentType.indexOf("audio")?'<span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;<span>Audio</span>':-1!==e.fileMeta.contentType.indexOf("video")?'<span class="mck-icon--video"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22"><path fill="rgba(38,50,56,.52)" d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l2.29 2.29c.63.63 1.71.18 1.71-.71V8.91c0-.89-1.08-1.34-1.71-.71L17 10.5z"/></svg></span>&nbsp;<span class="mck-icon-video-text">Video</span>':'<span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;<span>File</span>':""},a.downloadfile=function(){var e=a.getFileurl(msg),t=document.createElement("a");t.download=thefilename,t.setAttribute("href",e);var n="data:text/csv;charset=utf-8;base64,"+someb64data;t.href=n,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}!function(e){"use strict";"undefined"==typeof AlCustomService?e.Applozic.AlCustomService={logout:function(){void 0!==e.Applozic.ALSocket&&(e.Applozic.ALApiService.AUTH_TOKEN=null,e.Applozic.ALApiService.setAjaxHeaders("","","","",""),e.Applozic.ALApiService.setEncryptionKeys(null,null),e.Applozic.ALSocket.disconnect(),ALStorage.clearSessionStorageElements())}}:console.log("ALCustomService already defined.")}(window);var mckLabels=new MckLabels;function MckLabels(){this.getLabels=function(){return{"conversations.title":"Conversations","start.new":"Start New","search.contacts":"Contacts","search.groups":"Groups","empty.groups":"No groups yet!","empty.contacts":"No contacts yet!","empty.messages":"No messages yet!","no.more.messages":"No more messages!","empty.conversations":"No conversations yet!","no.more.conversations":"No more conversations!","search.placeholder":"Search...","location.placeholder":"Enter a location","create.group.title":"Create Group","members.title":"Members","add.members.title":"Add Member","remove.member":"Remove Member","change.role":"Change Role","group.info.update":"Update","group.info.updating":"Updating...","add.group.icon":"Add Group Icon","group.deleted":"Group has been deleted","change.group.icon":"Change Group Icon","group.title":"Group Title","group.type":"Group Type","group.create.submit":"Creating Group...",blocked:"You have blocked this user","group.chat.disabled":"You are no longer part of this group!","block.user.alert":"Are you sure you want to block this user?","unblock.user.alert":"Are you sure you want to unblock this user?","exit.group.alert":"Are you sure you want to exit this group?","remove.member.alert":"Are you sure you want to remove this member?","clear.messages.alert":"Are you sure you want to delete all the conversation?",typing:"typing...","is.typing":"is typing...",online:"Online","clear.messages":"Clear Messages",delete:"Delete",reply:"Reply",forward:"Forward",copy:"Copy","block.user":"Block User","unblock.user":"Unblock User","group.info.title":"Group Info","exit.group":"Exit Group","location.share.title":"Location Sharing","my.location":"My Location",send:"Send","send.message":"Send Message",smiley:"Smiley",close:"Close",edit:"Edit",save:"Save","file.attachment":"Files & Photos","file.attach.title":"Attach File","last.seen":"Last seen","last.seen.on":"Last seen on",hour:" hour",min:" min",yesterday:"yesterday",hours:" hours",mins:" mins","time.format.AM":"AM","time.format.PM":"PM","time.format.am":"am","time.format.pm":"pm","user.delete":"This user has been deleted",ago:"ago",admin:"Admin",user:"User",moderator:"Moderator",member:"Member",public:"Public",private:"Private",open:"Open",you:"You",userIdPattern:"[^!$%^&*()]+",charsNotAllowedMessage:"Following characters are not allowed: !$%^&*()","group.metadata":{CREATE_GROUP_MESSAGE:":adminName created group :groupName",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",GROUP_META_DATA_UPDATED_MESSAGE:"",ALERT:"",HIDE:""}}},this.setLabels=function(){$applozic("#mck-conversation-title").html(MCK_LABELS["conversations.title"]).attr("title",MCK_LABELS["conversations.title"]),$applozic("#mck-msg-new, #mck-sidebox-search .mck-box-title").html(MCK_LABELS["start.new"]).attr("title",MCK_LABELS["start.new"]),$applozic("#mck-contact-search-tab strong").html(MCK_LABELS["search.contacts"]).attr("title",MCK_LABELS["search.contacts"]),$applozic("#mck-group-search-tab strong").html(MCK_LABELS["search.groups"]).attr("title",MCK_LABELS["search.groups"]),$applozic("#mck-contact-search-input, #mck-group-search-input, #mck-group-member-search").attr("placeholder",MCK_LABELS["search.placeholder"]),$applozic("#mck-loc-address").attr("placeholder",MCK_LABELS["location.placeholder"]),$applozic("#mck-no-conversations").html(MCK_LABELS["empty.conversations"]),$applozic("#mck-no-messages").html(MCK_LABELS["empty.messages"]),$applozic("#mck-no-more-conversations").html(MCK_LABELS["no.more.conversations"]),$applozic("#mck-no-more-messages").html(MCK_LABELS["no.more.messages"]),$applozic("#mck-no-search-contacts").html(MCK_LABELS["empty.contacts"]),$applozic("#mck-no-search-groups").html(MCK_LABELS["empty.groups"]),$applozic("#mck-new-group, #mck-group-create-tab .mck-box-title, #mck-btn-group-create").html(MCK_LABELS["create.group.title"]).attr("title",MCK_LABELS["create.group.title"]),$applozic("#mck-gc-overlay-label").html(MCK_LABELS["add.group.icon"]),$applozic("#mck-msg-error").html(MCK_LABELS["group.deleted"]),$applozic("#mck-gc-title-label").html(MCK_LABELS["group.title"]),$applozic("#mck-gc-type-label").html(MCK_LABELS["group.type"]),$applozic("#mck-group-info-btn, #mck-group-info-tab .mck-box-title").html(MCK_LABELS["group.info.title"]).attr("title",MCK_LABELS["group.info.title"]),$applozic("#mck-gi-overlay-label").html(MCK_LABELS["change.group.icon"]),$applozic("#mck-group-member-title").html(MCK_LABELS["members.title"]).attr("title",MCK_LABELS["members.title"]),$applozic("#mck-group-add-member .blk-lg-9, #mck-gm-search-box .mck-box-title").html(MCK_LABELS["add.members.title"]).attr("title",MCK_LABELS["add.members.title"]),$applozic("#mck-btn-group-update").html(MCK_LABELS["group.info.update"]).attr("title",MCK_LABELS["group.info.update"]),$applozic("#mck-leave-group-btn, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]),$applozic("#mck-btn-leave-group, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]),$applozic("#mck-typing-label").html(MCK_LABELS.typing),$applozic("#mck-btn-clear-messages").html(MCK_LABELS["clear.messages"]).attr("title",MCK_LABELS["clear.messages"]),$applozic("#mck-block-button").html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),$applozic("#mck-loc-box .mck-box-title, #mck-share-loc-label").html(MCK_LABELS["location.share.title"]).attr("title",MCK_LABELS["location.share.title"]),$applozic("#mck-btn-loc").attr("title",MCK_LABELS["location.share.title"]),$applozic("#mck-file-up-label").html(MCK_LABELS["file.attachment"]),$applozic("#mck-file-up").attr("title",MCK_LABELS["file.attachment"]),$applozic(".mck-file-attach-label").attr("title",MCK_LABELS["file.attach.title"]),$applozic("#mck-my-loc").html(MCK_LABELS["my.location"]).attr("title",MCK_LABELS["my.location"]),$applozic("#mck-btn-close-loc-box").html(MCK_LABELS.close).attr("title",MCK_LABELS.close),$applozic("#mck-loc-submit").html(MCK_LABELS.send).attr("title",MCK_LABELS.send),$applozic("#mck-msg-sbmt").attr("title",MCK_LABELS["send.message"]),$applozic("#mck-btn-smiley").attr("title",MCK_LABELS.smiley),$applozic("#mck-group-name-save").attr("title",MCK_LABELS.save),$applozic("#mck-btn-group-icon-save").attr("title",MCK_LABELS.save),$applozic("#mck-group-name-edit").attr("title",MCK_LABELS.edit),$applozic("#mck-contact-search-input").attr("title",MCK_LABELS.charsNotAllowedMessage)}}var alMessageService=new AlMessageService;function AlMessageService(){var t,c,o,a=this;a.init=function(e){o=e.fileBaseUrl,t=e.visitor,c=t?"guest":$applozic.trim(e.userId)},a.getConversation=function(e){a.getTopicId({conversationId:e.conversationId},function(e){mckMessageLayout.populateMessage(e.messageType,e.message,e.notifyUser)})},a.addWelcomeMessage=function(e){return"object"!=typeof e?"Unsupported format. Please check format":void 0===e.sender||""===e.sender?"Sender Field Required":void 0===e.messageContent||""===e.messageContent?"Message Content Required":void mckMessageService.sendWelcomeMessage(e)},a.getUserIdFromMessage=function(e){var t=e.to;return t.lastIndexOf(",")===t.length-1&&(t=t.substring(0,t.length-1)),t.split(",")},a.isValidMetaData=function(e){return!e.metadata||"HIDDEN"!==e.metadata.category&&"ARCHIVE"!==e.metadata.category},a.getStatusIconName=function(e){return 7===e.type||6===e.type||4===e.type||0===e.type?"":5===e.status?"mck-icon-read":4===e.status?"mck-icon-delivered":3===e.type||5===e.type||1===e.type&&(0===e.source||1===e.source)?"mck-icon-sent":""},a.addMessageToTab=function(e,t,n){var o={to:e.to,groupId:e.groupId,deviceKey:e.deviceKey,contentType:e.contentType,message:e.message,conversationId:e.conversationId,topicId:e.topicId,sendToDevice:!0,createdAtTime:(new Date).getTime(),key:e.key,storeOnDevice:!0,sent:!1,read:!0,metadata:e.metadata?e.metadata:""};o.type=e.type?e.type:5,e.fileMeta&&(o.fileMeta=e.fileMeta),"function"==typeof n&&n(o,t)},a.getMessages=function(e){var t={};e.startTime&&(t.endTime=e.startTime),void 0!==e.userId&&""!==e.userId?(e.isGroup?t.groupId=e.userId:t.userId=e.userId,t.pageSize=30,(IS_MCK_TOPIC_HEADER||IS_MCK_TOPIC_BOX)&&e.conversationId&&(t.conversationId=e.conversationId,void 0===MCK_TAB_CONVERSATION_MAP[e.userId]&&(t.conversationReq=!0))):t.mainPageSize=100,window.Applozic.ALApiService.getMessages({data:t,success:e.callback,error:e.callback})},a.getMessageList=function(r,s){var e=r.id,t={},i={};r.startTime&&(t.endTime=r.startTime),void 0!==r.clientGroupId&&""!==r.clientGroupId?(r.pageSize?t.pageSize=r.pageSize:t.pageSize=50,t.clientGroupId=r.clientGroupId,i={clientGroupId:r.clientGroupId}):void 0!==e&&""!==e?(r.pageSize?t.pageSize=r.pageSize:t.pageSize=50,""+r.isGroup=="true"?t.groupId=e:t.userId=e,i={id:e}):(r.mainPageSize?t.mainPageSize=r.pageSize:t.mainPageSize=50,i={id:""}),r.topicId&&(e||r.clientGroupId)&&(r.conversationId&&(t.conversationId=r.conversationId),r.topicId&&(i.topicId=r.topicId)),window.Applozic.ALApiService.getMessages({data:t,success:function(e){var t=e.data;if(i.status="success",void 0===t.message||0===t.message.length)i.messages=[];else{var n=t.message,o=new Array;$applozic.each(n,function(e,t){"function"==typeof s&&s(t)}),i.messages=o}0<t.groupFeeds.length&&(i.id=t.groupFeeds[0].id),r.callback(t)},error:function(e){i.status="error",r.callback(i)}})},a.getReplyMessageByKey=function(e){return void 0===ALStorage.getMessageByKey(e)&&window.Applozic.ALApiService.updateReplyMessage({data:{key:e},async:!1,success:function(e){ALStorage.updateMckMessageArray(e)}}),ALStorage.getMessageByKey(e)},a.sendDeliveryUpdate=function(e){window.Applozic.ALApiService.sendDeliveryUpdate({data:{key:e.pairedMessageKey},success:function(){},error:function(){}})},a.sendReadUpdate=function(e){void 0!==e&&""!==e&&window.Applozic.ALApiService.sendReadUpdate({data:{key:e},success:function(){},error:function(){}})},a.fetchConversationByTopicId=function(e,o){window.Applozic.ALApiService.fetchConversationByTopicId({data:e,success:function(e){if("object"==typeof e&&"success"===e.status){var t=e.response;if(0<t.length&&$applozic.each(t,function(e,t){if(MCK_CONVERSATION_MAP[t.id]=t,MCK_TOPIC_CONVERSATION_MAP[t.topicId]=[t.id],t.topicDetail)try{MCK_TOPIC_DETAIL_MAP[t.topicId]=$applozic.parseJSON(t.topicDetail)}catch(e){w.console.log("Incorect Topic Detail!")}if(params.tabId&&void 0!==MCK_TAB_CONVERSATION_MAP[params.tabId]){var n=MCK_TAB_CONVERSATION_MAP[params.tabId];n.push(t),MCK_TAB_CONVERSATION_MAP[params.tabId]=n}}),params.isExtMessageList)if(0<t.length)params.conversationId=t[0].id,params.pageSize=50,"function"==typeof o&&o(params);else if("function"==typeof params.callback){var n={};params.tabId?(n.id=params.tabId,n.isGroup=params.isGroup):params.clientGroupId&&(n.clientGroupId=params.clientGroupId),n.topicId=params.topicId,n.status="success",n.messages=[],params.callback(n)}}else if(params.isExtMessageList&&"function"==typeof params.callback){n={};params.tabId?n.id=params.tabId:params.clientGroupId&&(n.clientGroupId=params.clientGroupId),n.topicId=params.topicId,n.status="error",n.errorMessage="Unable to process request. Please try again.",params.callback(n)}},error:function(){if("function"==typeof params.callback){var e={};params.tabId?e.id=params.tabId:params.clientGroupId&&(e.clientGroupId=params.clientGroupId),e.topicId=params.topicId,e.status="error",e.errorMessage="Unable to process request. Please try again.",params.callback(e)}}})},a.getTopicId=function(r,s){if(r.conversationId){var i="id="+r.conversationId;window.Applozic.ALApiService.getTopicId({data:{conversationId:r.conversationId},success:function(e){if("object"==typeof i&&"success"===i.status){var t=i.response;if("object"==typeof t){if(MCK_TOPIC_CONVERSATION_MAP[t.topicId]=[r.conversationId],(MCK_CONVERSATION_MAP[r.conversationId]=t).topicDetail)try{MCK_TOPIC_DETAIL_MAP[t.topicId]=$applozic.parseJSON(t.topicDetail)}catch(e){w.console.log("Incorect Topic Detail!")}if("function"==typeof MCK_PRICE_DETAIL&&r.priceText&&(MCK_PRICE_DETAIL({custId:c,suppId:r.suppId,productId:t.topicId,price:r.priceText}),a.sendConversationCloseUpdate(r.conversationId)),r.messageType&&"object"==typeof r.message){var n=r.message.groupId?r.message.groupId:r.message.to;if(void 0!==MCK_TAB_CONVERSATION_MAP[n]){var o=MCK_TAB_CONVERSATION_MAP[n];o.push(t),MCK_TAB_CONVERSATION_MAP[n]=o}(void 0===r.populate||r.populate)&&"function"==typeof s&&s(r)}"function"==typeof r.callback&&r.callback(t)}}},error:function(){}})}},a.sendConversationCloseUpdate=function(e){if(e){window.Applozic.ALApiService.sendConversationCloseUpdate({conversationId:e,success:function(e){},error:function(){}})}},a.dispatchMessage=function(e){if("object"===e.messagePxy){var t=e.messagePxy;if(e.topicId){var n=MCK_TOPIC_DETAIL_MAP[e.topicId];if("object"==typeof n&&"undefined"!==n.title)if(t.message||(t.message=$applozic.trim(n.title)),e.conversationId)t.conversationId=e.conversationId;else if(e.topicId){var o={topicId:e.topicId};"object"==typeof n&&(o.topicDetail=w.JSON.stringify(n)),t.conversationPxy=o}if(!t.message&&n.link){var r={blobKey:$applozic.trim(n.link),contentType:"image/png"};t.fileMeta=r,t.contentType=5,FILE_META=[],FILE_META.push(r)}}e.isGroup?t.groupId=e.tabId:t.to=e.tabId,mckMessageService.sendMessage(t)}},a.sendVideoCallMessage=function(e,t,n,o,r,s){var i="CALL_MISSED"==t?"Missed Call":"CALL_REJECTED"==t?"Call Rejected":"";""!=i&&null!=i||(i="video message");var a={to:r,type:5,contentType:n,message:i,metadata:{MSG_TYPE:t,CALL_ID:e,CALL_AUDIO_ONLY:o},senderName:c};return s(a),a},a.sendVideoCallEndMessage=function(e,t,n,o,r,s,i){var a="";r&&(a=mckDateUtils.convertMilisIntoTime(r));var c="CALL_MISSED"==t?"Missed Call":"CALL_REJECTED"==t?"Call Rejected":"CALL_END"==t?"Call End \n Duration: "+a:"video message";""!=c&&null!=c||(c="video message");var l={to:s,type:5,contentType:n,message:c,metadata:{MSG_TYPE:t,CALL_ID:e,CALL_AUDIO_ONLY:o,CALL_DURATION:r}};return i(l),l},a.getMessageFeed=function(e){var t={};if(o=window.Applozic.ALApiService.getFileUrl(),t.key=e.key,t.contentType=e.contentType,t.timeStamp=e.createdAtTime,t.message=e.message,t.from=4===e.type?e.to:c,e.groupId?t.to=e.groupId:t.to=5===e.type?e.to:c,t.status="read",t.type=4===e.type?"inbox":"outbox",5===e.type&&(3===e.status?t.status="sent":4===e.status&&(t.status="delivered")),"object"==typeof e.fileMeta){var n=Object.assign({},e.fileMeta);void 0!==n.url&&""!==n.url||(n.url=o+"/rest/ws/aws/file/"+e.fileMeta.blobKey),delete n.blobKey,t.file=n}return t.source=e.source,t.metadata=e.metadata,t}}