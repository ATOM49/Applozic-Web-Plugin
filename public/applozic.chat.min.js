function MckCallingService(e,t,a,o,s,n,r,i,c,l){var u=this,p=$applozic("#mck-vid-icon");$applozic("#mck-sidebox");u.callStartTime=n,u.mckMessageService=r,u.identity=e,u.token=t,u.callId=a,u.isCallHost=s,u.toUserImage=i,u.toUserDisplayName=o,u.isAudioCall=c,u.disconectedByHost,u.rejectedByReceiver,u.twilioService,console.log("is AudioCall:"+c),u.ringTone=l;var d=$applozic("#mck-msg-to"),m=$applozic(".applozic-vid-container"),g=($applozic("#mck-sidebox"),$applozic("#mck-video-call-indicator")),f=$applozic("#mck-unmute-icon"),v=$applozic("#mck-mute-icon"),y=$applozic("#mck-microfone-mute-btn");$applozic("#mck-microfone-mute-btn").off("click").on("click",function(){d.val();var e=u.twilioService.activeRoom;if(e){var t=e.localParticipant.media;t.isMuted?(f.addClass("vis").removeClass("n-vis"),v.addClass("n-vis").removeClass("vis"),y.addClass("mck-unmuted").removeClass("mck-muted"),t.unmute()):(v.addClass("vis").removeClass("n-vis"),f.addClass("n-vis").removeClass("vis"),y.addClass("mck-muted").removeClass("mck-unmuted"),t.mute())}}),$applozic("#mck-vid-disconnect").off("click").on("click",function(){var e=d.val();if(s)if(u.disconectedByHost=!0,u.twilioService.callReceivedAt){var t=u.twilioService.callReceivedAt.getTime(),o=(new Date).getTime()-t;alMessageService.sendVideoCallEndMessage(a,"CALL_END",102,!1,o,e,function(e){r.sendMessage(e)})}else u.ringTone.stop(),alMessageService.sendVideoCallMessage(a,"CALL_MISSED",103,!1,e,function(e){r.sendMessage(e)});u.twilioService.leaveRoomIfJoined(),u.removeTracks(["#mck-vid-media > video","#mck-vid-media > audio","#local-media > video","#local-media > audio"]),m.addClass("n-vis").removeClass("vis"),g.addClass("n-vis").removeClass("vis")}),u.startVideoCall=function(){navigator.webkitGetUserMedia||navigator.mozGetUserMedia||alert("WebRTC is not available in your browser. can not start video call"),u.token||(alert("missing token.. can not make video call"),m.removeClass("vis").addClass("n-vis")),u.twilioService=new TwilioService(u.identity,u.token,u.callId,u.ringTone,u.isAudioCall,u.mckMessageService,u.isCallHost);u.twilioService.InitializeVideoClient();s&&(p.html(i+"<span> Calling "+o+"</span>"),p.removeClass("n-vis").addClass("vis"),setTimeout(function(){u.twilioService.isCallReceived||u.disconectedByHost||u.rejectedByReceiver||(console.log("call is not answered...."),u.ringTone.stop(),alMessageService.sendVideoCallMessage(a,"CALL_MISSED",103,c,toUser,function(e){r.sendMessage(e)}),alert(o+" not Available...."),u.twilioService.leaveRoomIfJoined(),u.removeTracks(["#mck-vid-media > video","#mck-vid-media > audio","#local-media > video","#local-media > audio"]),m.addClass("n-vis").removeClass("vis"))},7e4)),window.addEventListener("beforeunload",u.twilioService.leaveRoomIfJoined),u.twilioService.attachUserMedia(s,c),u.twilioService.joinCall(c),m.removeClass("n-vis").addClass("vis"),f.addClass("vis").removeClass("n-vis"),v.addClass("n-vis").removeClass("vis"),y.addClass("mck-unmuted").removeClass("mck-muted")},u.removeTracks=function(e){$applozic.each(e,function(e,t){$applozic(t).remove()})}}function TwilioService(e,t,s,o,a,n,r){var i=this;i.identity=e,i.token=t,i.callId=s,i.videoClient,i.activeRoom,i.previewMedia,i.ringTone=o,i.isCallReceived,i.callReceivedAt,i.isAudioCall=a,i.mckMessageService=n,i.isCallHost=r;var c=$applozic("#mck-msg-to"),l=$applozic("#mck-vid-icon"),u="#local-media",p="#mck-vid-media",d=($applozic("#local-media > video"),$applozic("#mck-vid-media > video"),$applozic("#local-media")),m=$applozic(".applozic-vid-container"),g=($applozic("#mck-sidebox"),$applozic("#mck-video-call-indicator"));i.InitializeVideoClient=function(){i.videoClient=new Twilio.Video.Client(i.token)},i.joinCall=function(e){i.videoClient&&i.videoClient.connect({to:i.callId}).then(i.roomJoined,function(e){console.log("Could not connect to Twilio: "+e.message)})},i.attachUserMedia=function(t,e){i.previewMedia||(i.previewMedia=new Twilio.Video.LocalMedia,Twilio.Video.getUserMedia().then(function(e){i.previewMedia.addStream(e),t?(i.previewMedia.attach(p),i.ringTone.play()):(i.previewMedia.attach(u),d.removeClass("n-vis").addClass("vis"))},function(e){console.error("Unable to access local media",e),console.log("Unable to access Camera and Microphone")}))},i.roomJoined=function(t){console.log("room detail : "+t),i.activeRoom=t,i.previewMedia||t.localParticipant.media.attach(p),t.participants.forEach(function(e){console.log("Already in Room: '"+e.identity+"'"),e.media.attach("#mck-vid-media")}),t.on("participantConnected",function(e){console.log("participent- "+e.identity+"connected to the room- "+t),i.isCallReceived=!0,i.callReceivedAt=new Date,console.log("callReceivedAt : "+i.callReceivedAt),i.ringTone.stop(),l.addClass("n-vis"),$applozic("#mck-vid-media > video").remove(),$applozic("#mck-vid-media > audio").remove(),t.localParticipant.media.attach(u),d.removeClass("n-vis").addClass("vis"),e.media.attach(p)}),t.on("participantDisconnected",function(e){if(console.log("Participant '"+e.identity+"' left the room"),i.isCallHost){var t=c.val(),o=i.callReceivedAt.getTime(),a=(new Date).getTime()-o;alMessageService.sendVideoCallEndMessage(s,"CALL_END",103,!1,a,t,function(e){n.sendMessage(e)})}e.media.detach(),i.leaveRoomIfJoined(),m.addClass("n-vis").removeClass("vis"),g.addClass("n-vis").removeClass("vis")}),t.on("disconnected",function(){console.log("Left"),t.localParticipant.media.detach(),t.participants.forEach(function(e){e.media.detach()}),i.activeRoom=null})},i.leaveRoomIfJoined=function(){i.activeRoom&&i.activeRoom.disconnect(),i.previewMedia&&i.previewMedia.stop()}}(function(){var M,a,v,l,n={}.hasOwnProperty,r=[].slice;M={LF:"\n",NULL:"\0"},v=function(){var r;function b(e,t,o){this.command=e,this.headers=null!=t?t:{},this.body=null!=o?o:""}return b.prototype.toString=function(){var e,t,o,a,s;for(t in(o=!(e=[this.command])===this.headers["content-length"])&&delete this.headers["content-length"],s=this.headers)n.call(s,t)&&(a=s[t],e.push(t+":"+a));return this.body&&!o&&e.push("content-length:"+b.sizeOfUTF8(this.body)),e.push(M.LF+this.body),e.join(M.LF)},b.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},r=function(e){var t,o,a,s,n,r,i,c,l,u,p,d,m,g,f,v,y;for(s=e.search(RegExp(""+M.LF+M.LF)),a=(n=e.substring(0,s).split(M.LF)).shift(),r={},d=function(e){return e.replace(/^\s+|\s+$/g,"")},m=0,f=(v=n.reverse()).length;m<f;m++)c=(u=v[m]).indexOf(":"),r[d(u.substring(0,c))]=d(u.substring(c+1));if(t="",p=s+2,r["content-length"])l=parseInt(r["content-length"]),t=(""+e).substring(p,p+l);else for(o=null,i=g=p,y=e.length;(p<=y?g<y:y<g)&&(o=e.charAt(i))!==M.NULL;i=p<=y?++g:--g)t+=o;return new b(a,r,t)},b.unmarshall=function(s){var n;return function(){var e,t,o,a;for(a=[],e=0,t=(o=s.split(RegExp(""+M.NULL+M.LF+"*"))).length;e<t;e++)0<(null!=(n=o[e])?n.length:void 0)&&a.push(r(n));return a}()},b.marshall=function(e,t,o){return new b(e,t,o).toString()+M.NULL},b}(),a=function(){var f;function e(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}return e.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},f=function(){return Date.now?Date.now():(new Date).valueOf},e.prototype._transmit=function(e,t,o){var a;for(a=v.marshall(e,t,o),"function"==typeof this.debug&&this.debug(">>> "+a);;){if(!(a.length>this.maxWebSocketFrameSize))return this.ws.send(a);this.ws.send(a.substring(0,this.maxWebSocketFrameSize)),a=a.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+a.length)}},e.prototype._setupHeartbeat=function(s){var e,t,o,n,a,r,i,c;if((a=s.version)===l.VERSIONS.V1_1||a===l.VERSIONS.V1_2)return t=(r=function(){var e,t,o,a;for(a=[],e=0,t=(o=s["heart-beat"].split(",")).length;e<t;e++)n=o[e],a.push(parseInt(n));return a}())[0],e=r[1],0!==this.heartbeat.outgoing&&0!==e&&(o=Math.max(this.heartbeat.outgoing,e),"function"==typeof this.debug&&this.debug("send PING every "+o+"ms"),this.pinger=l.setInterval(o,(i=this,function(){return i.ws.send(M.LF),"function"==typeof i.debug?i.debug(">>> PING"):void 0}))),0!==this.heartbeat.incoming&&0!==t?(o=Math.max(this.heartbeat.incoming,t),"function"==typeof this.debug&&this.debug("check PONG every "+o+"ms"),this.ponger=l.setInterval(o,(c=this,function(){var e;if(e=f()-c.serverActivity,2*o<e)return"function"==typeof c.debug&&c.debug("did not receive server activity for the last "+e+"ms"),c.ws.close()}))):void 0},e.prototype._parseConnect=function(){var e,t,o,a;switch(a={},(e=1<=arguments.length?r.call(arguments,0):[]).length){case 2:a=e[0],t=e[1];break;case 3:e[1]instanceof Function?(a=e[0],t=e[1],o=e[2]):(a.login=e[0],a.passcode=e[1],t=e[2]);break;case 4:a.login=e[0],a.passcode=e[1],t=e[2],o=e[3];break;default:a.login=e[0],a.passcode=e[1],t=e[2],o=e[3],a.host=e[4]}return[a,t,o]},e.prototype.connect=function(){var e,m,t,o,g,a,s;return e=1<=arguments.length?r.call(arguments,0):[],o=this._parseConnect.apply(this,e),t=o[0],this.connectCallback=o[1],m=o[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=(g=this,function(e){var a,s,t,o,n,r,i,c,l,u,p,d;if(o="undefined"!=typeof ArrayBuffer&&e.data instanceof ArrayBuffer?(a=new Uint8Array(e.data),"function"==typeof g.debug&&g.debug("--- got data length: "+a.length),function(){var e,t,o;for(o=[],e=0,t=a.length;e<t;e++)s=a[e],o.push(String.fromCharCode(s));return o}().join("")):e.data,g.serverActivity=f(),o!==M.LF){for("function"==typeof g.debug&&g.debug("<<< "+o),d=[],l=0,u=(p=v.unmarshall(o)).length;l<u;l++)switch((n=p[l]).command){case"CONNECTED":"function"==typeof g.debug&&g.debug("connected to server "+n.headers.server),g.connected=!0,g._setupHeartbeat(n.headers),d.push("function"==typeof g.connectCallback?g.connectCallback(n):void 0);break;case"MESSAGE":c=n.headers.subscription,(i=g.subscriptions[c]||g.onreceive)?(t=g,r=n.headers["message-id"],n.ack=function(e){return null==e&&(e={}),t.ack(r,c,e)},n.nack=function(e){return null==e&&(e={}),t.nack(r,c,e)},d.push(i(n))):d.push("function"==typeof g.debug?g.debug("Unhandled received MESSAGE: "+n):void 0);break;case"RECEIPT":d.push("function"==typeof g.onreceipt?g.onreceipt(n):void 0);break;case"ERROR":d.push("function"==typeof m?m(n):void 0);break;default:d.push("function"==typeof g.debug?g.debug("Unhandled frame: "+n):void 0)}return d}"function"==typeof g.debug&&g.debug("<<< PONG")}),this.ws.onclose=(a=this,function(){var e;return e="Whoops! Lost connection to "+a.ws.url,"function"==typeof a.debug&&a.debug(e),a._cleanUp(),"function"==typeof m?m(e):void 0}),this.ws.onopen=(s=this,function(){return"function"==typeof s.debug&&s.debug("Web Socket Opened..."),t["accept-version"]=l.VERSIONS.supportedVersions(),t["heart-beat"]=[s.heartbeat.outgoing,s.heartbeat.incoming].join(","),s._transmit("CONNECT",t)})},e.prototype.disconnect=function(e,t){return null==t&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof e?e():void 0},e.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&l.clearInterval(this.pinger),this.ponger)return l.clearInterval(this.ponger)},e.prototype.send=function(e,t,o){return null==t&&(t={}),null==o&&(o=""),t.destination=e,this._transmit("SEND",t,o)},e.prototype.subscribe=function(e,t,o){var a;return null==o&&(o={}),o.id||(o.id="sub-"+this.counter++),o.destination=e,this.subscriptions[o.id]=t,this._transmit("SUBSCRIBE",o),a=this,{id:o.id,unsubscribe:function(){return a.unsubscribe(o.id)}}},e.prototype.unsubscribe=function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})},e.prototype.begin=function(e){var t,o;return o=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:o}),t=this,{id:o,commit:function(){return t.commit(o)},abort:function(){return t.abort(o)}}},e.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},e.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},e.prototype.ack=function(e,t,o){return null==o&&(o={}),o["message-id"]=e,o.subscription=t,this._transmit("ACK",o)},e.prototype.nack=function(e,t,o){return null==o&&(o={}),o["message-id"]=e,o.subscription=t,this._transmit("NACK",o)},e}(),l={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,t){var o;return null==t&&(t=["v10.stomp","v11.stomp"]),o=new(l.WebSocketClass||WebSocket)(e,t),new a(o)},over:function(e){return new a(e)},Frame:v},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=l),"undefined"!=typeof window&&null!==window?(l.setInterval=function(e,t){return window.setInterval(t,e)},l.clearInterval=function(e){return window.clearInterval(e)},window.Stomp=l):exports||(self.Stomp=l)}).call(this);var MCK_LABELS,MCK_BASE_URL,w=window,d=document,MCK_CURR_LATITIUDE=40.7324319,MCK_CURR_LONGITUDE=-73.82480777777776,mckUtils=new MckUtils,mckDateUtils=new MckDateUtils,mckContactUtils=new MckContactUtils,mckMapUtils=new MckMapUtils;function MckUtils(){var o=this,l=["p","div","pre","form"];o.init=function(){var e=MCK_CONTEXTPATH?MCK_CONTEXTPATH+"/v2/tab/initialize.page":"https://apps.applozic.com/v2/tab/initialize.page",t=MCK_CONTEXTPATH?MCK_CONTEXTPATH+"/rest/ws/message/list":"https://apps.applozic.com/rest/ws/message/list";$applozic.ajax({url:e,contentType:"application/json",type:"OPTIONS"}).done(function(e){}),$applozic.ajax({url:t,contentType:"application/json",type:"OPTIONS"}).done(function(e){})},o.showElement=function(e){("object"!=typeof e&&void 0!==e&&null!==typeof e||e&&"object"==typeof e&&0!==e.length)&&(e.classList.remove("n-vis"),e.classList.add("vis"))},o.hideElement=function(e){("object"!=typeof e&&void 0!==e&&null!==typeof e||e&&"object"==typeof e&&0!==e.length)&&(e.classList.remove("vis"),e.classList.add("n-vis"))},o.badgeCountOnLaucher=function(e,t){var o=document.getElementById("applozic-badge-count");!0===e&&0<t&&(o.innerHTML=t<99?t:"99+",o.classList.add("mck-badge-count")),!0===e&&0===t&&(o.innerHTML="",o.classList.remove("mck-badge-count"))},o.randomId=function(){return w.Math.random().toString(36).substring(7)},o.textVal=function(e){for(var t=[],r=[],i=function(){t.push(r.join("")),r=[]},c=function(e){if(3===e.nodeType)r.push(e.nodeValue);else if(1===e.nodeType){var t=e.tagName.toLowerCase(),o=-1!==l.indexOf(t);if(o&&r.length&&i(),"img"===t){var a=e.getAttribute("alt")||"";return void(a&&r.push(a))}if("style"===t)return;"br"===t&&i();for(var s=e.childNodes,n=0;n<s.length;n++)c(s[n]);o&&r.length&&i()}},o=e.childNodes,a=0;a<o.length;a++)c(o[a]);return r.length&&i(),t.join("\n")},o.mouseX=function(e){return e.pageX?e.pageX:e.clientX?e.clientX+(d.documentElement.scrollLeft?d.documentElement.scrollLeft:d.body.scrollLeft):null},o.mouseY=function(e){return e.pageY?e.pageY:e.clientY?e.clientY+(d.documentElement.scrollTop?d.documentElement.scrollTop:d.body.scrollTop):null},o.startsWith=function(e,t){if(null===t||void 0===e)return!1;var o=t.length;if(e.length<o)return!1;for(--o;0<=o&&e[o]===t[o];--o)continue;return o<0},o.setEndOfContenteditable=function(e){var t,o;document.createRange?((t=document.createRange()).selectNodeContents(e),t.collapse(!1),(o=window.getSelection()).removeAllRanges(),o.addRange(t)):document.selection&&((t=document.body.createTextRange()).moveToElementText(e),t.collapse(!1),t.select())},o.b64EncodeUnicode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))},o.b64DecodeUnicode=function(e){return decodeURIComponent(Array.prototype.map.call(atob(e),function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},o.checkIfB64Encoded=function(e){return/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e)},o.encrypt=function(e,t){if(!t)return e;for(;e&&e.length%16!=0;)e+=" ";var o=aesjs.util.convertStringToBytes(t),a=new aesjs.ModeOfOperation.ecb(o),s=aesjs.util.convertStringToBytes(e),n=a.encrypt(s),r=String.fromCharCode.apply(null,n);return btoa(r)},o.decrypt=function(e,t){if(!t)return e;for(var o=aesjs.util.convertStringToBytes(t),a=atob(e),s=[],n=0;n<a.length;n++)s.push(a.charCodeAt(n));var r=new aesjs.ModeOfOperation.ecb(o).decrypt(s);return aesjs.util.convertBytesToString(r).replace(/\\u0000/g,"").replace(/^\s*|\s*[\x00-\x10]*$/g,"")},o.ajax=function(t){var e=$applozic.extend({},{},t);!t.skipEncryption&&t.encryptionKey&&("post"===e.type.toLowerCase()&&(e.data=encrypt(t.data,t.encryptionKey)),e.success=function(e){res=o.decrypt(e,t.encryptionKey),mckUtils.isJsonString(res)?t.success(JSON.parse(res)):t.success(res)}),$applozic.ajax(e)},o.isJsonString=function(e){try{JSON.parse(e)}catch(e){return!1}return!0}}function MckContactUtils(){var o=this;o.getContactId=function(e){var t=e.contactId;return o.formatContactId(t)},o.formatContactId=function(e){return 0===e.indexOf("+")&&(e=e.substring(1)),e=decodeURIComponent(e),$applozic.trim(e.replace(/\@/g,"AT").replace(/\./g,"DOT").replace(/\*/g,"STAR").replace(/\#/g,"HASH").replace(/\|/g,"VBAR").replace(/\+/g,"PLUS").replace(/\;/g,"SCOLON").replace(/\?/g,"QMARK").replace(/\,/g,"COMMA").replace(/\:/g,"COLON"))}}function MckMapUtils(){this.getCurrentLocation=function(e,t){w.navigator.geolocation.getCurrentPosition(e,t)},this.getSelectedLocation=function(){return{lat:MCK_CURR_LATITIUDE,lon:MCK_CURR_LONGITUDE}}}function MckDateUtils(){var e=this,s="mmm d, h:MM TT",n="h:MM TT";e.getDate=function(e){var t=new Date(parseInt(e,10)),o=new Date;return o.getDate()===t.getDate()&&o.getMonth()===t.getMonth()&&o.getYear()===t.getYear()?M(t,n,!1):M(t,s,!1)},e.getLastSeenAtStatus=function(e){var t=new Date(parseInt(e,10)),o=new Date;if(o.getDate()===t.getDate()&&o.getMonth()===t.getMonth()&&o.getYear()===t.getYear()){var a=o.getHours()-t.getHours(),s=w.Math.floor((o.getTime()-t.getTime())/6e4);return s<60?s<=1?MCK_LABELS["last.seen"]+" 1 "+MCK_LABELS.min+" "+MCK_LABELS.ago:MCK_LABELS["last.seen"]+" "+s+MCK_LABELS.mins+" "+MCK_LABELS.ago:1===a?MCK_LABELS["last.seen"]+" 1 "+MCK_LABELS.hour+" "+MCK_LABELS.ago:MCK_LABELS["last.seen"]+" "+a+MCK_LABELS.hours+" "+MCK_LABELS.ago}return o.getDate()-t.getDate()==1&&o.getMonth()===t.getMonth()&&o.getYear()===t.getYear()?MCK_LABELS["last.seen.on"]+" "+MCK_LABELS.yesterday:MCK_LABELS["last.seen.on"]+" "+M(t,"mmm d",!1)},e.getTimeOrDate=function(e,t){var o=new Date(parseInt(e,10)),a=new Date;return t?a.getDate()===o.getDate()&&a.getMonth()===o.getMonth()&&a.getYear()===o.getYear()?M(o,n,!1):M(o,"mmm d",!1):M(o,s,!1)},e.getSystemDate=function(e){var t=new Date(parseInt(e,10));return M(t,s,!1)},e.convertMilisIntoTime=function(e){parseInt(e%1e3/100);var t=parseInt(e/1e3%60),o=parseInt(e/6e4%60),a=parseInt(e/36e5%24);return 0<a?a+" Hr "+o+" Min "+t+" Sec":0<o?o+" Min "+t+" Sec":t+" Sec "};var f,v,y,b,M=(f=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,v=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,y=/[^-+\dA-Z]/g,b=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e},function(e,t,o){var a=M;if(1!==arguments.length||"[object String]"!==Object.prototype.toString.call(e)||/\d/.test(e)||(t=e,e=void 0),e=e?new Date(e):new Date,isNaN(e))throw SyntaxError("invalid date");"UTC:"===(t=String(t)).slice(0,4)&&(t=t.slice(4),o=!0);var s=o?"getUTC":"get",n=e[s+"Date"](),r=e[s+"Day"](),i=e[s+"Month"](),c=e[s+"FullYear"](),l=e[s+"Hours"](),u=e[s+"Minutes"](),p=e[s+"Seconds"](),d=e[s+"Milliseconds"](),m=o?0:e.getTimezoneOffset(),g={d:n,dd:b(n),ddd:a.i18n.dayNames[r],dddd:a.i18n.dayNames[r+7],m:i+1,mm:b(i+1),mmm:a.i18n.monthNames[i],mmmm:a.i18n.monthNames[i+12],yy:String(c).slice(2),yyyy:c,h:l%12||12,hh:b(l%12||12),H:l,HH:b(l),M:u,MM:b(u),s:p,ss:b(p),l:b(d,3),L:b(99<d?w.Math.round(d/10):d),t:l<12?"a":"p",tt:l<12?MCK_LABELS["time.format.am"]||"am":MCK_LABELS["time.format.pm"]||"pm",T:l<12?"A":"P",TT:l<12?MCK_LABELS["time.format.AM"]||"AM":MCK_LABELS["time.format.PM"]||"PM",Z:o?"UTC":(String(e).match(v)||[""]).pop().replace(y,""),o:(0<m?"-":"+")+b(100*w.Math.floor(w.Math.abs(m)/60)+w.Math.abs(m)%60,4),S:["th","st","nd","rd"][3<n%10?0:(n%100-n%10!=10)*n%10]};return t.replace(f,function(e){return e in g?g[e]:e.slice(1,e.length-1)})});M.masks={default:"mmm d, yyyy h:MM TT",fullDateFormat:"mmm d, yyyy h:MM TT",onlyDateFormat:"mmm d",onlyTimeFormat:"h:MM TT",mailDateFormat:"mmm d, yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},M.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]}}!function(e){"use strict";"undefined"==typeof Applozic?e.Applozic={init:function(){}}:console.log("Applozic already defined.")}(window);var ALStorage=function(e){var t,o,a=[],s=[],n=[],r=[],i=new MckUtils;return{updateLatestMessage:function(e){var t=[];t.push(e),ALStorage.updateLatestMessageArray(t),ALStorage.updateMckMessageArray(t)},getLatestMessageArray:function(){return ALStorage.isSessionStorageAvailable()?$applozic.parseJSON(w.sessionStorage.getItem("mckLatestMessageArray")):a},getFriendListGroupName:function(){return ALStorage.isSessionStorageAvailable()?w.sessionStorage.getItem("friendListGroupName"):t},setFriendListGroupName:function(e){ALStorage.isSessionStorageAvailable()?w.sessionStorage.setItem("friendListGroupName",e):t=e},setFriendListGroupType:function(e){ALStorage.isSessionStorageAvailable()?w.sessionStorage.setItem("friendListGroupType",e):o=e},getFriendListGroupType:function(){return ALStorage.isSessionStorageAvailable()?w.sessionStorage.getItem("friendListGroupType"):o},setLatestMessageArray:function(e){ALStorage.isSessionStorageAvailable()?w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(e)):a=e},updateLatestMessageArray:function(e){if(ALStorage.isSessionStorageAvailable()){var t=$applozic.parseJSON(w.sessionStorage.getItem("mckLatestMessageArray"));return null!==t?(t=t.concat(e),w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(t))):w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(e)),e}return a=a.concat(e)},getMckMessageArray:function(){return ALStorage.isSessionStorageAvailable()?$applozic.parseJSON(w.sessionStorage.getItem("mckMessageArray")):s},clearMckMessageArray:function(){ALStorage.isSessionStorageAvailable()?(w.sessionStorage.removeItem("mckMessageArray"),w.sessionStorage.removeItem("mckLatestMessageArray")):(s.length=0,a.length=0)},clearAppHeaders:function(){ALStorage.isSessionStorageAvailable()&&w.sessionStorage.removeItem("chatheaders")},setAppHeaders:function(e){if(ALStorage.isSessionStorageAvailable()){var t=i.b64EncodeUnicode(JSON.stringify(e));w.sessionStorage.setItem("chatheaders",t)}},getAppHeaders:function(){if(ALStorage.isSessionStorageAvailable()){var e=w.sessionStorage.getItem("chatheaders");return e=e?JSON.parse(i.checkIfB64Encoded(e)?i.b64DecodeUnicode(e):e):{}}},getMessageByKey:function(e){return n[e]},updateMckMessageArray:function(e){for(var t=0;t<e.length;t++){var o=e[t];n[o.key]=o}if(ALStorage.isSessionStorageAvailable()){var a=$applozic.parseJSON(w.sessionStorage.getItem("mckMessageArray"));return null!==a?(a=a.concat(e),w.sessionStorage.setItem("mckMessageArray",w.JSON.stringify(a))):w.sessionStorage.setItem("mckMessageArray",w.JSON.stringify(e)),e}return s=s.concat(e)},getMckContactNameArray:function(){return ALStorage.isSessionStorageAvailable()?$applozic.parseJSON(w.sessionStorage.getItem("mckContactNameArray")):r},setMckContactNameArray:function(e){ALStorage.isSessionStorageAvailable()?w.sessionStorage.setItem("mckContactNameArray",w.JSON.stringify(e)):r=e},updateMckContactNameArray:function(e){if(ALStorage.isSessionStorageAvailable()){var t=$applozic.parseJSON(w.sessionStorage.getItem("mckContactNameArray"));return null!==t&&(e=e.concat(t)),w.sessionStorage.setItem("mckContactNameArray",w.JSON.stringify(e)),e}return r=r.concat(e)},clearMckContactNameArray:function(){ALStorage.isSessionStorageAvailable()?w.sessionStorage.removeItem("mckContactNameArray"):r.length=0},clearSessionStorageElements:function(){ALStorage.clearMckMessageArray(),ALStorage.clearAppHeaders(),ALStorage.clearMckContactNameArray()},isSessionStorageAvailable:function(){try{return void 0!==w.sessionStorage}catch(e){return!1}}}}(window);!function(f){"use strict";"undefined"==typeof ALApiService?f.Applozic.ALApiService=function(e){var i={},c="",l=new MckUtils;i.DEFAULT_ENCRYPTED_APP_VERSION=112;var n,r,u,p,d,o,m="https://apps.applozic.com",t="https://applozic.appspot.com",a="/rest/ws/group/left",s="/rest/ws/group/";function g(e){var t="";for(var o in e)t+=encodeURIComponent(o)+"="+encodeURIComponent(e[o])+"&";return t.substring(0,t.length-1)}return i.getFileUrl=function(){return t},i.initServerUrl=function(e){m=e},i.login=function(e){i.connect(e)},i.connect=function(t){c=t.data.alUser.applicationId,m=t.data.baseUrl?t.data.baseUrl:"https://apps.applozic.com",o=t.data.alUser.fileupload,t.appVersionCode=t.appVersionCode||i.DEFAULT_ENCRYPTED_APP_VERSION,i.ajax({url:m+"/v2/tab/initialize.page",skipEncryption:!0,type:"post",async:void 0===t.async||t.async,data:JSON.stringify(t.data.alUser),contentType:"application/json",headers:{"Application-Key":c},success:function(e){p=btoa(e.userId+":"+e.deviceKey),r=e.deviceKey,n=t.data.alUser.password,u=t.data.alUser.appModuleName,i.AUTH_TOKEN=e.authToken,i.setAjaxHeaders(p,c,e.deviceKey,t.data.alUser.password,t.data.alUser.appModuleName),i.setEncryptionKeys(e.encryptionKey,e.userEncryptionKey),e.appVersionCode=i.DEFAULT_ENCRYPTED_APP_VERSION,t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.addRequestHeaders=function(e){i.AUTH_TOKEN?e.setRequestHeader("X-Authorization",i.AUTH_TOKEN):(p&&(e.setRequestHeader("Authorization","Basic "+p),e.setRequestHeader("Application-User","Basic "+p)),r&&e.setRequestHeader("Device-Key",r),n&&e.setRequestHeader("Access-Token",n),u&&e.setRequestHeader("App-Module-Name",u),e.setRequestHeader("UserId-Enabled",!0)),e.setRequestHeader("Application-Key",c)},i.getAttachmentHeaders=function(){var e={};return i.AUTH_TOKEN?e["X-Authorization"]=i.AUTH_TOKEN:(e={"UserId-Enabled":!0,Authorization:"Basic "+p,"Application-User":"Basic "+p,"Application-Key":c,"Device-Key":r},n&&(e["Access-Token"]=n)),e},i.getEncryptionKey=function(){return d},i.setEncryptionKeys=function(e,t){d=e},i.setAjaxHeaders=function(e,t,o,a,s){c=t,p=e,r=o,n=a,u=s},i.ajax=function(t){var o=function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}({},{},t);!t.skipEncryption&&d&&("post"===o.type.toLowerCase()&&(o.data=l.encrypt(t.data,d)),o.success=function(e){res=l.decrypt(e,d),l.isJsonString(res)?t.success(JSON.parse(res)):t.success(res)});var a,e,s=new XMLHttpRequest,n=!0;(void 0!==o.async||t.async)&&(n=o.async);var r=o.type.toUpperCase();"GET"===r&&void 0!==o.data&&(o.url=o.url+"?"+o.data),s.open(r,o.url,n),"POST"!==r&&"GET"!==r||(e=void 0===o.contentType?"application/x-www-form-urlencoded; charset=UTF-8":o.contentType,s.setRequestHeader("Content-Type",e)),m=m||"https://apps.applozic.com",-1!==o.url.indexOf(m)&&i.addRequestHeaders(s),-1!==o.url.indexOf("applozic.appspot.com")&&s.setRequestHeader("Application-Key",c),void 0===o.data?s.send():s.send(o.data),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){var e=s.getResponseHeader("Content-Type");void 0!==e&&"null"!==e&&null!==e||(e=""),a=-1!=e.toLowerCase().indexOf("text/html")?s.responseXML:-1!=e.toLowerCase().indexOf("application/json")?JSON.parse(s.responseText):s.responseText,o.success(a)}else o.error(a)}},i.getMessages=function(a){a.data.userId||a.data.groupId?"undefined"===a.data.pageSize&&(a.data.pageSize=30):void 0===a.data.mainPageSize&&(a.data.mainPageSize=60);var e=g(a.data),s=new Object;i.ajax({url:m+"/rest/ws/message/list?"+e,async:void 0===a.async||a.async,type:"get",success:function(e){s.status="success",s.data=e,a.success&&a.success(s)},error:function(e,t,o){s.status="error",a.error&&a.error(s)}})},i.sendMessage=function(t){i.ajax({type:"POST",url:m+"/rest/ws/message/send",global:!1,data:JSON.stringify(t.data.message),async:void 0===t.async||t.async,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.sendDeliveryUpdate=function(t){i.ajax({url:m+"/rest/ws/message/delivered",data:"key="+t.data.key,global:!1,type:"get",async:void 0===t.async||t.async,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.sendReadUpdate=function(t){i.ajax({url:m+"/rest/ws/message/read",data:"key="+t.data.key,global:!1,type:"get",async:void 0===t.async||t.async,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.deleteMessage=function(t){i.ajax({url:m+"/rest/ws/message/delete?key="+t.data.key,global:!1,type:"get",async:void 0===t.async||t.async,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.updateReplyMessage=function(t){i.ajax({url:m+"/rest/ws/message/detail?keys="+t.data.key,type:"get",async:void 0===t.async||t.async,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.deleteConversation=function(t){i.ajax({url:m+"/rest/ws/message/delete/conversation",type:"get",async:void 0===t.async||t.async,global:!1,data:g(t.data),success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.createGroup=function(t){i.ajax({url:m+"/rest/ws/group/create",global:!1,data:JSON.stringify(t.data.group),type:"post",async:void 0===t.async||t.async,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.loadGroups=function(t){t.baseUrl&&(m=t.baseUrl),i.ajax({url:m+"/rest/ws/group/list",type:"get",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.getGroupInfo=function(t){var e=t.data.groupId?"?groupId="+t.data.groupId:"?clientGroupId="+t.data.clientGroupId;i.ajax({url:m+"/rest/ws/group/v2/info"+e,type:"get",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.addGroupMember=function(t){i.ajax({url:m+"/rest/ws/group/add/member",type:"POST",data:JSON.stringify(t.data.group),async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.removeGroupMember=function(t){i.ajax({url:m+"/rest/ws/group/remove/member",type:"POST",data:JSON.stringify(t.data),async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.groupLeave=function(t){i.ajax({url:m+a,type:"POST",data:JSON.stringify(t.data),async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.groupUpdate=function(t){i.ajax({url:m+"/rest/ws/group/update",type:"POST",data:JSON.stringify(t.data),async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e,t.data)},error:function(e){t.error&&t.error(e)}})},i.isUserPresentInGroup=function(t){i.ajax({url:m+"/rest/ws/group/check/user?userId="+t.data.userId+"&clientGroupId="+t.data.clientGroupId,type:"get",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.groupUserCount=function(t){i.ajax({url:m+"/rest/ws/group/user/count?clientGroupIds="+t.data.clientGroupId,type:"get",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.groupDelete=function(t){i.ajax({url:m+a+"?clientGroupId="+t.data.clientGroupId,type:"GET",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.createUserFriendList=function(t){i.ajax({url:m+s+t.data.group.groupName+"/add/",type:"POST",async:void 0===t.async||t.async,global:!1,data:JSON.stringify(t.data.group.groupMemberList),contentType:"application/json",success:function(e){t.success&&(t.success(e),ALStorage.setFriendListGroupName(t.data.group.groupName))},error:function(e){t.error&&t.error(e)}})},i.createOpenFriendList=function(t){i.ajax({url:m+s+t.data.group.groupName+"/add/members",type:"POST",data:JSON.stringify(t.data.group),async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&(t.success(e),ALStorage.setFriendListGroupName(t.data.group.groupName),ALStorage.setFriendListGroupType(t.data.group.type))},error:function(e){t.error&&t.error(e)}})},i.getFriendList=function(t){var e="null"!==t.data.type?"/get?groupType=9":"/get";t.data.url=t.data.url?t.data.url:e,i.ajax({url:m+s+t.data.groupName+t.data.url,type:"GET",async:void 0===t.data.async||t.data.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.removeUserFromFriendList=function(t){var e=t.group.type?"/remove?userId="+t.group.userId+"&groupType=9":"/remove?userId="+t.group.userId;i.ajax({url:m+s+t.group.groupName+e,type:"Post",contentType:"application/json",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.deleteFriendList=function(t){var e=t.group.type?"/delete?groupType=9":"/delete";i.ajax({url:m+s+t.group.groupName+e,type:"GET",async:!1,contentType:"application/json",async:void 0===t.async||t.async,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.getUserDetail=function(t){i.ajax({url:m+"/rest/ws/user/v2/detail",data:JSON.stringify({userIdList:t.data}),type:"POST",async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.updateUserDetail=function(t){i.ajax({url:m+"/rest/ws/user/update",data:JSON.stringify(t.data),type:"POST",async:void 0===t.async||t.async,global:!1,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.updatePassword=function(t){i.ajax({url:m+"/rest/ws/user/update/password?oldPassword="+t.data.oldPassword+"&newPassword="+t.data.newPassword,type:"GET",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.getContactList=function(t){var e=t.baseUrl?t.baseUrl:m;i.ajax({url:e+t.url,type:"GET",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.userChatMute=function(t){i.ajax({url:m+"/rest/ws/user/chat/mute?userId="+t.data.userId+"&notificationAfterTime="+t.data.notificationAfterTime,type:"post",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.groupMute=function(t){var e={};e.clientGroupId=t.data.clientGroupId,e.notificationAfterTime=t.data.notificationAfterTime,i.ajax({url:m+"/rest/ws/group/user/update",type:"post",data:JSON.stringify(e),contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.syncMuteUserList=function(t){i.ajax({url:m+"/rest/ws/user/chat/mute/list",type:"get",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.blockUser=function(t){i.ajax({url:m+"/rest/ws/user/block?userId="+t.data.userId+"&block="+t.data.isBlock,type:"GET",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.unBlockUser=function(t){i.ajax({url:m+"/rest/ws/user/unblock?userId="+t.data.userId,type:"GET",async:void 0===t.async||t.async,global:!1,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.sendConversationCloseUpdate=function(e){var t="id="+e.conversationId;i.ajax({url:m+"/rest/ws/conversation/close",data:t,global:!1,type:"get",success:function(){},error:function(){}})},i.fileUpload=function(t){i.ajax({type:"GET",skipEncryption:!0,url:t.data.url,global:!1,data:"data="+(new Date).getTime(),crosDomain:!0,success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.sendAttachment=function(e){"awsS3Server"===o?f.Applozic.ALApiService.sendAttachmentToAWS(e):"googleCloud"===o?f.Applozic.ALApiService.sendAttachmentToCloud(e):f.Applozic.ALApiService.sendAttachmentToGoogleServer(e)},i.sendAttachmentToGoogleServer=function(a){var s=new XMLHttpRequest;i.ajax({type:"GET",skipEncryption:!0,url:void 0!==a.url?a.url:"https://applozic.appspot.com/rest/ws/aws/file/url",global:!1,data:"data="+(new Date).getTime(),crosDomain:!0,success:function(e){s.addEventListener("load",function(e){var t=JSON.parse(this.responseText),o=a.data.messagePxy;t&&(o.fileMeta=t.fileMeta,Applozic.ALApiService.sendMessage({data:{message:o},success:function(e){console.log(e)},error:function(){}}))});var t=new FormData,o=a.data.file;t.append("files[]",o),s.open("POST",e,!0),i.addRequestHeaders(s),s.send(t)},error:function(e){a.error&&a.error(e)}})},i.sendAttachmentToAWS=function(a){var e=new FormData,t=new XMLHttpRequest,o=m+"/rest/ws/upload/image";t.addEventListener("load",function(e){var t=this.responseText,o=a.data.messagePxy;t&&(o.fileMeta=JSON.parse(t),Applozic.ALApiService.sendMessage({data:{message:o},success:function(e){console.log(e)},error:function(){}}))}),e.append("file",a.data.file),t.open("post",o,!0),i.addRequestHeaders(t),t.send(e)},i.sendAttachmentToCloud=function(a){var e=new FormData,t=new XMLHttpRequest,o=void 0!==a.cloudUploadUrl?a.cloudUploadUrl:"https://googleupload.applozic.com/files/upload/";t.addEventListener("load",function(e){var t=JSON.parse(this.responseText),o=a.data.messagePxy;t&&(o.fileMeta=t.fileMeta,Applozic.ALApiService.sendMessage({data:{message:o},success:function(e){console.log(e)},error:function(){}}))}),e.append("files[]",a.data.file),t.open("post",o,!0),i.addRequestHeaders(t),t.send(e)},i.deleteFileMeta=function(t){i.ajax({url:t.data.url,skipEncryption:!0,type:"post",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.addMessageInbox=function(t){i.ajax({type:"GET",url:m+"/rest/ws/message/add/inbox",global:!1,data:"sender="+encodeURIComponent(t.data.sender)+"&messageContent="+encodeURIComponent(t.data.messageContent),contentType:"text/plain",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.conversationReadUpdate=function(t){i.ajax({url:m+"/rest/ws/message/read/conversation",data:t.data,global:!1,type:"get",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},i.sendSubscriptionIdToServer=function(e){var t=e.data.subscriptionId;i.ajax({url:m+"/rest/ws/plugin/update/sw/id",skipEncryption:!0,type:"post",data:"registrationId="+t,success:function(e){},error:function(e,t,o){401===e.status&&(ALStorage.clearSessionStorageElements(),console.log("Please reload page."))}})},i.getTopicId=function(t){var e="id="+t.data.conversationId;i.ajax({url:m+"/rest/ws/conversation/topicId?"+e,type:"get",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},i.getContactDisplayName=function(t){var o=t.data.userIdArray;if(0<o.length&&o[0]){for(var e="",a=o.filter(function(e,t){return o.indexOf(e)===t}),s=0;s<a.length;s++){var n=a[s];void 0===MCK_CONTACT_NAME_MAP[n]&&(e+="userIds="+encodeURIComponent(n)+"&")}e.lastIndexOf("&")===e.length-1&&(e=e.substring(0,e.length-1)),e&&i.ajax({url:m+"/rest/ws/user/info",data:e,global:!1,type:"get",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})}},i.getUserStatus=function(t){i.ajax({url:m+"/rest/ws/user/chat/status",type:"get",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},i.fetchConversationByTopicId=function(t){var e="topic="+t.data.topicId;if(t.data.tabId)e+=""+t.data.isGroup=="true"?"&groupId="+t.data.tabId:"&userId="+encodeURIComponent(t.data.tabId);else{if(!t.data.clientGroupId)return!1;e+="&clientGroupId="+t.data.clientGroupId}t.data.pageSize&&(e+="&pageSize="+t.data.pageSize),i.ajax({url:m+"/rest/ws/conversation/get",data:e,type:"get",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},i.getConversationId=function(t){i.ajax({url:m+"/rest/ws/conversation/id",global:!1,data:w.JSON.stringify(t.data),type:"post",contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},i.registerClientApi=function(t){i.ajax({url:m+"/rest/ws/register/client",type:"post",data:JSON.stringify(t.data.userPxy),contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},i.logout=function(t){i.ajax({url:m+"/rest/ws/device/logout",type:"post",async:void 0===t.async||t.async,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i.getUsersByRole=function(t){var e=g(t.data);i.ajax({url:m+"/rest/ws/user/v3/filter?"+e,global:!1,type:"get",contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.success(e)}})},i.pushNotificationLogout=function(t){i.ajax({url:m+"/rest/ws/device/logout",type:"post",async:void 0===t.async||t.async,contentType:"application/json",success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},i}():console.log("ALApiService already defined.")}(window),function(d){"use strict";"undefined"==typeof ALSocket?d.Applozic.ALSocket=function(){var s,l={events:{}},u=null;l.stompClient=null;var t,o,n="";l.typingSubscriber=null,l.openGroupSubscriber=[];var a=[];l.mck_typing_status=0;var r="",i="socket.applozic.com",c="80";l.MCK_TOKEN,l.USER_DEVICE_KEY,l.USER_ENCRYPTION_KEY;var p=new MckUtils;return l.init=function(e,t,o){e&&(s=e),void 0!==t&&(l.MCK_TOKEN=t.token,l.APP_VERSION_CODE=t.appVersionCode,l.USER_DEVICE_KEY=t.deviceKey,(t.encryptionKey||t.appVersionCode===d.Applozic.ALApiService.DEFAULT_ENCRYPTED_APP_VERSION)&&(l.USER_ENCRYPTION_KEY=t.userEncryptionKey),i=t.websocketUrl,c=void 0===t.websocketPort?p.startsWith(i,"https")?"15675":"15674":t.websocketPort),l.setOnline=function(){void 0!==d.Applozic.ALSocket&&d.Applozic.ALSocket.sendStatus(1)},l.events=o,void 0!==i&&navigator.onLine&&d.WebSocket&&(i=i.replace("https://",""),r=new WebSocket("wss://"+i+":"+c+"/ws"),l.stompClient=Stomp.over(r),l.stompClient.heartbeat.outgoing=0,l.stompClient.heartbeat.incoming=0,l.stompClient.reconnect_delay=3e4,l.stompClient.debug=null,l.stompClient.onclose=function(){l.disconnect()},l.stompClient.connect("guest","guest",l.onConnect,l.onError,"/"),d.addEventListener("beforeunload",function(e){var t;e.target.activeElement&&(t=e.target.activeElement.href),t&&0!==t.length||l.disconnect()}))},l.checkConnected=function(e){l.stompClient.connected?(t&&clearInterval(t),o&&clearInterval(o),t=setInterval(function(){l.connectToSocket(e)},6e5),o=setInterval(function(){l.sendStatus(1)},12e5)):l.connectToSocket(e)},l.connectToSocket=function(e){"function"==typeof l.connectToSocket&&l.events.connectToSocket(e)},l.stopConnectedCheck=function(){t&&clearInterval(t),o&&clearInterval(o),o=t="",l.disconnect()},l.disconnect=function(){l.stompClient&&l.stompClient.connected&&(l.sendStatus(0),l.stompClient.disconnect())},l.unsubscibeToTypingChannel=function(){l.stompClient&&l.stompClient.connected&&l.typingSubscriber&&(1===l.mck_typing_status&&l.sendTypingStatus(0,n),l.typingSubscriber.unsubscribe()),l.typingSubscriber=null},l.unsubscibeToNotification=function(){l.stompClient&&l.stompClient.connected&&u&&u.unsubscribe(),u=null},l.subscibeToTypingChannel=function(e){l.stompClient&&l.stompClient.connected?l.typingSubscriber=l.stompClient.subscribe("/topic/typing-"+s+"-"+e,l.onTypingStatus):l.reconnect()},l.subscribeToOpenGroup=function(e){if(console.log("adding subscription"),l.stompClient&&l.stompClient.connected){var t=l.stompClient.subscribe("/topic/group-"+s+"-"+e.contactId,l.onOpenGroupMessage);l.openGroupSubscriber.push(t.id),a[e.contactId]=t.id}else l.reconnect()},l.sendTypingStatus=function(e,t,o,a){if(l.mck_typing_status=t,l.stompClient&&l.stompClient.connected){if(1===e&&1===l.mck_typing_status&&l.stompClient.send("/topic/typing-"+s+"-"+n,{"content-type":"text/plain"},s+","+o+","+e),a){if(a===n&&e===l.mck_typing_status&&1===e)return;n=a,l.stompClient.send("/topic/typing-"+s+"-"+a,{"content-type":"text/plain"},s+","+o+","+e),setTimeout(function(){l.mck_typing_status=0},6e4)}else 0===e&&l.stompClient.send("/topic/typing-"+s+"-"+n,{"content-type":"text/plain"},s+","+o+","+e);l.mck_typing_status=e}},l.onTypingStatus=function(e){"function"==typeof l.events.onTypingStatus&&l.events.onTypingStatus(e)},l.reconnect=function(){l.unsubscibeToTypingChannel(),l.unsubscibeToNotification(),l.disconnect();var e={};e.token=l.MCK_TOKEN,e.deviceKey=l.USER_DEVICE_KEY,e.userEncryptionKey=l.USER_ENCRYPTION_KEY,e.websocketUrl=i,e.websocketPort=c,l.init(s,e,l.events)},l.onError=function(e){console.log("Error in channel notification. "+e),"function"==typeof l.events.onConnectFailed&&setTimeout(function(){l.events.onConnectFailed()},3e4)},l.sendStatus=function(e){l.stompClient&&l.stompClient.connected&&l.stompClient.send("/topic/status-v2",{"content-type":"text/plain"},l.MCK_TOKEN+","+l.USER_DEVICE_KEY+","+e)},l.onConnect=function(){var e="/topic/"+(l.USER_ENCRYPTION_KEY?"encr-":"")+l.MCK_TOKEN;l.stompClient.connected?(u&&l.unsubscibeToNotification(),u=l.stompClient.subscribe(e,l.onMessage),l.sendStatus(1),l.checkConnected(!0)):setTimeout(function(){u=l.stompClient.subscribe(e,l.onMessage),l.sendStatus(1),l.checkConnected(!0)},5e3),"function"==typeof l.events.onConnect&&l.events.onConnect()},l.onOpenGroupMessage=function(e){"function"==typeof l.events.onOpenGroupMessage&&l.events.onOpenGroupMessage(e)},l.onMessage=function(e){if(null!=u&&u.id===e.headers.subscription){var t=p.decrypt(e.body,l.USER_ENCRYPTION_KEY),o=JSON.parse(t),a=o.type;if("function"==typeof l.events.onMessage&&l.events.onMessage(o),"APPLOZIC_04"===a||"MESSAGE_DELIVERED"===a)l.events.onMessageDelivered(o);else if("APPLOZIC_08"===a||"MT_MESSAGE_DELIVERED_READ"===a)l.events.onMessageRead(o);else if("APPLOZIC_05"===a)l.events.onMessageDeleted(o);else if("APPLOZIC_27"===a)l.events.onConversationDeleted(o);else if("APPLOZIC_11"===a)l.events.onUserConnect(o.message);else if("APPLOZIC_12"===a){var s=o.message.split(",")[1];l.events.onUserDisconnect({userId:r,lastSeenAtTime:s})}else if("APPLOZIC_29"===a)l.events.onConversationReadFromOtherSource(o);else if("APPLOZIC_28"===a)l.events.onConversationRead(o);else if("APPLOZIC_16"===a){var n=o.message.split(":")[0],r=o.message.split(":")[1];l.events.onUserBlocked({status:n,userId:r})}else if("APPLOZIC_17"===a)n=o.message.split(":")[0],r=o.message.split(":")[1],l.events.onUserUnblocked({status:n,userId:r});else if("APPLOZIC_18"===a)l.events.onUserActivated();else if("APPLOZIC_19"===a)l.events.onUserDeactivated();else{var i=o.message;if("APPLOZIC_03"===a)l.events.onMessageSentUpdate({messageKey:i.key});else if("APPLOZIC_01"===a||"MESSAGE_RECEIVED"===a){var c=alMessageService.getMessageFeed(i);l.events.onMessageReceived({message:c})}else"APPLOZIC_02"===a&&(c=alMessageService.getMessageFeed(i),l.events.onMessageSent({message:c}))}}},l}():console.log("ALSocket already defined.")}(window);var mckNotificationUtils=new MckNotificationUtils,alNotificationService=new AlNotificationService;function AlNotificationService(){var t,o,a=this;a.init=function(e){t="boolean"==typeof e.swNotification&&e.swNotification,e.contactDisplayImage,e.notificationIconLink,"boolean"==typeof e.desktopNotification&&e.desktopNotification},a.unsubscribeToServiceWorker=function(){o&&navigator.serviceWorker.ready.then(function(e){o.unsubscribe().then(function(e){o=null,console.log("Unsubscribed to notification successfully")})})},a.sendSubscriptionIdToServer=function(){if(o){var e=o.endpoint.split("/").slice(-1)[0];e&&window.Applozic.ALApiService.sendSubscriptionIdToServer({data:{subscriptionId:e},success:function(e){},error:function(){}})}},a.subscribeToServiceWorker=function(){t&&"serviceWorker"in navigator&&(navigator.serviceWorker.register("./service-worker.js",{scope:"./"}),navigator.serviceWorker.ready.then(function(e){e.pushManager.subscribe({userVisibleOnly:!0}).then(function(e){console.log("The reg ID is:: ",e.endpoint.split("/").slice(-1)),o=e,a.sendSubscriptionIdToServer()})}))}}function MckNotificationUtils(){var r=this,i=window.top,t="default",c="granted",o=[c,t,"denied"],a=function(){var e=!1;try{e=!!(i.Notification||i.webkitNotifications||navigator.mozNotification||i.external&&void 0!==i.external.msIsSiteMode())}catch(e){}return e}(),l=Math.floor(10*Math.random()+1),s=function(){};r.permissionLevel=function(){var e;if(a)return i.Notification&&i.Notification.permissionLevel?e=i.Notification.permissionLevel():i.webkitNotifications&&i.webkitNotifications.checkPermission?e=o[i.webkitNotifications.checkPermission()]:i.Notification&&i.Notification.permission?e=i.Notification.permission:navigator.mozNotification?e=c:i.external&&void 0!==i.external.msIsSiteMode()&&(e=i.external.msIsSiteMode()?c:t),e},r.requestPermission=function(e){var t,o=(t=e)&&t.constructor===Function?e:s;i.webkitNotifications&&i.webkitNotifications.checkPermission?i.webkitNotifications.requestPermission(o):i.Notification&&i.Notification.requestPermission&&i.Notification.requestPermission(o)},r.isChrome=function(){return/chrom(e|ium)/.test(i.navigator.userAgent.toLowerCase())},r.getNotification=function(e,t,o,a){var s;if(a&&(a.play(),setTimeout(function(){a.stop()},1e3)),i.Notification){var n={icon:t,body:o};(s=new i.Notification(e,n)).onclick=function(){i.focus(),this.close()}}else i.webkitNotifications?(s=i.webkitNotifications.createNotification(t,e,o),a&&s.show(),r.isChrome()&&(s.onclick=function(){i.focus(),this.cancel()}),s.show(),setTimeout(function(){s.cancel()},3e4)):navigator.mozNotification?(s=navigator.mozNotification.createNotification(e,o,t)).show():i.external&&i.external.msIsSiteMode()&&(i.external.msSiteModeClearIconOverlay(),i.external.msSiteModeSetIconOverlay(t,e),i.external.msSiteModeActivate(),s={ieVerification:l+1});return s},r.sendDesktopNotification=function(e,t,o,a){if(r.permissionLevel()!==c&&i.Notification.requestPermission(),r.permissionLevel()===c){var s;s=a?r.getNotification(e,t,o,a):r.getNotification(e,t,o);var n=r.getWrapper(s);s&&!s.ieVerification&&s.addEventListener&&s.addEventListener("show",function(){var e=n;i.setTimeout(function(){e.close()},3e4)})}},r.getWrapper=function(e){return{close:function(){e&&(e.close?e.close():e.cancel?e.cancel():i.external&&i.external.msIsSiteMode()&&e.ieVerification===l&&i.external.msSiteModeClearIconOverlay())}}}}var mckGroupUtils=new MckGroupUtils,mckGroupService=new MckGroupService;function MckGroupUtils(){var e=this;e.GROUP_ROLE_MAP=[0,1,2,3],e.GROUP_TYPE_MAP=[1,2,5,6,7,9,10],e.CONVERSATION_STATUS_MAP=["DEFAULT","NEW","OPEN"],e.ROLE_MAP={0:"User",1:"Admin",2:"Moderator",3:"Member"},e.getDeletedAtTime=function(e){if("object"==typeof MCK_GROUP_MAP[e])return MCK_GROUP_MAP[e].deletedAtTime},e.leaveGroup=function(e){return"object"!=typeof e?"Unsupported Format. Please check format":"function"==typeof e.callback?void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId?(e.apzCallback=mckGroupLayout.onGroupLeft,mckGroupService.leaveGroup(e),"success"):void e.callback({status:"error",errorMessage:"GroupId or Client GroupId Required"}):"Callback Function Required"},e.initGroupTab=function(e){if("object"==typeof e){var t=e.users;return void 0===t||t.length<1?"Users List Required":t.length>MCK_GROUPMAXSIZE?"Users limit exceeds "+MCK_GROUPMAXSIZE+". Max number of users allowed is "+MCK_GROUPMAXSIZE+".":e.groupName?void 0===e.type?"Group type required":-1===GROUP_TYPE_MAP.indexOf(e.type)?"Invalid group type":(mckMessageService.getGroup(e),"success"):"Group name required"}return"Unsupported format. Please check format"},e.getGroup=function(e){return"object"==typeof MCK_GROUP_MAP[e]?MCK_GROUP_MAP[e]:void 0},e.getGroupByClientGroupId=function(e){return"object"==typeof MCK_CLIENT_GROUP_MAP[e]?MCK_CLIENT_GROUP_MAP[e]:void 0},e.addGroup=function(e){var t=e.name?e.name:e.id,o=[];$applozic.each(e.groupUsers,function(e,t){t.userId&&(o[t.userId]=t)});var a=void 0!==e.removedMembersId?e.removedMembersId:[],s={contactId:e.id.toString(),htmlId:mckContactUtils.formatContactId(""+e.id),displayName:t,value:e.id.toString(),adminName:e.adminId?e.adminId:e.adminName,type:e.type,members:e.membersId?e.membersId:e.membersName,imageUrl:e.imageUrl,users:o,userCount:e.userCount,removedMembersId:a,clientGroupId:e.clientGroupId,isGroup:!0,deletedAtTime:e.deletedAtTime,metadata:e.metadata};return MCK_GROUP_MAP[e.id]=s,e.clientGroupId&&(MCK_CLIENT_GROUP_MAP[e.clientGroupId]=s),s},e.createGroup=function(e){var t={contactId:e.toString(),htmlId:mckContactUtils.formatContactId(""+e),displayName:e.toString(),value:e.toString(),type:2,adminName:"",imageUrl:"",userCount:"",users:[],removedMembersId:[],clientGroupId:"",isGroup:!0,deletedAtTime:""};return MCK_GROUP_MAP[e]=t}}function MckGroupService(){var t,r,o,i=this;MCK_GROUP_ARRAY=new Array,i.addGroups=function(e){var t=e.data;MCK_GROUP_ARRAY.length=0,t.forEach(function(e,t){if(void 0!==e.id){e=mckGroupUtils.addGroup(e);MCK_GROUP_ARRAY.push(e)}})},i.removeGroupMember=function(e){return"object"!=typeof e?"Unsupported Format. Please check format":"function"==typeof e.callback?void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId?void 0===e.userId||""===e.userId?void e.callback({status:"error",errorMessage:"UserId required"}):(e.apzCallback=mckGroupLayout.onRemovedGroupMember,mckGroupService.removeGroupMemberFromChat(e),"success"):void e.callback({status:"error",errorMessage:"GroupId or clientGroupId required"}):"Callback function required"},i.createGroup=function(e){if("object"==typeof e){if("function"==typeof e.callback){var t=e.users;return void 0===t||t.length<1?void e.callback({status:"error",errorMessage:"Users list required"}):t.length>MCK_GROUPMAXSIZE?void e.callback({status:"error",errorMessage:"Users limit exceeds "+MCK_GROUPMAXSIZE+". Max number of users allowed is "+MCK_GROUPMAXSIZE+"."}):e.groupName?void 0===e.type||""===e.type?void e.callback({status:"error",errorMessage:"Group type required"}):-1===GROUP_TYPE_MAP.indexOf(e.type)?void e.callback({status:"error",errorMessage:"Invalid group type"}):(mckMessageService.getGroup(e),"success"):void e.callback({status:"error",errorMessage:"Group name required"})}return"Callback function required"}return"Unsupported Format. Please check format"},i.init=function(e){t=e.visitor,r=t?"guest":$applozic.trim(e.userId),o=e.openGroupSettings},i.getGroupList=function(e){return"function"==typeof e.callback?(e.apzCallback=i.addGroups,i.loadGroups(e),"success"):"Callback Function Required"},i.loadGroups=function(t){var o=new Object;window.Applozic.ALApiService.loadGroups({baseUrl:MCK_BASE_URL,success:function(e){"success"===e.status?(o.status="success",o.data=e.response,t.apzCallback&&t.apzCallback(o)):o.status="error",t.callback&&t.callback(o)},error:function(){console.log("Unable to load groups. Please reload page."),o.status="error",t.callback&&t.callback(o),t.apzCallback&&t.apzCallback(o)}})},i.getGroupFeed=function(a){var e={};if("function"==typeof a.callback||"function"==typeof a.apzCallback){var t=new Object;if(a.groupId)e.groupId=a.groupId;else{if(!a.clientGroupId)return void("function"==typeof a.callback&&(t.status="error",t.errorMessage="GroupId or Client GroupId Required",a.callback(t)));e.clientGroupId=a.clientGroupId}a.conversationId&&(e.conversationId=a.conversationId),Applozic.ALApiService.getGroupInfo({data:e,success:function(e){if("success"===e.status){var t=e.response;if(t+""=="null"||"object"!=typeof t)e.status="error",e.errorMessage="GroupId not found";else{var o=mckGroupUtils.addGroup(t);e.status="success",e.data=o}}else"error"===e.status&&(e.status="error",e.errorMessage=e.errorResponse[0].description);a.callback&&a.callback(e),a.apzCallback&&("success"===e.status&&(e.data=t),a.apzCallback(e,a))},error:function(){console.log("Unable to load group. Please reload page."),t.status="error",t.errorMessage="Please reload page.",a.callback&&a.callback(t),a.apzCallback&&a.apzCallback(t,a)}})}},i.leaveGroup=function(o){var e={},a=new Object;if(o.groupId)e.groupId=o.groupId;else{if(!o.clientGroupId)return a.status="error",a.errorMessage="GroupId or Client GroupId Required",void(o.callback&&o.callback(a));e.clientGroupId=o.clientGroupId}Applozic.ALApiService.groupLeave({data:e,success:function(e){if("success"===e.status){if(o.clientGroupId){var t=mckGroupUtils.getGroupByClientGroupId(o.clientGroupId);"object"==typeof t&&(o.groupInfo=t.contactId)}a.status="success",a.data={groupId:o.groupId}}else a.status="error",a.errorMessage=e.errorResponse[0].description;o.callback&&o.callback(a),o.apzCallback&&o.apzCallback(a,{groupId:o.groupId})},error:function(){console.log("Unable to process your request. Please reload page."),a.status="error",a.errorMessage="",o.callback&&o.callback(a),o.apzCallback&&o.apzCallback(a)}})},i.removeGroupMemberFromChat=function(o){var e={},t=new Object;if(o.groupId)e.groupId=o.groupId;else{if(!o.clientGroupId)return t.status="error",t.errorMessage="GroupId or Client GroupId Required",void("function"==typeof o.callback&&o.callback(t));e.clientGroupId=o.clientGroupId}e.userId=o.userId,Applozic.ALApiService.removeGroupMember({data:e,success:function(e){if("success"===e.status){if(o.clientGroupId){var t=mckGroupUtils.getGroupByClientGroupId(o.clientGroupId);"object"==typeof t&&(o.groupId=t.contactId)}e.status="success"}else e.status="error",e.errorMessage=data.errorResponse[0].description;o.callback&&o.callback(e),o.apzCallback&&o.apzCallback(e,o)},error:function(){console.log("Unable to process your request. Please reload page."),t.status="error",t.errorMessage="",o.callback&&o.callback(t),o.apzCallback&&o.apzCallback(t),o.apzCallback(t)}})},i.addGroupMember=function(o){var e={},a=new Object;if(o.groupId)e.groupId=o.groupId;else{if(!o.clientGroupId)return void("function"==typeof o.callback&&o.callback(a));e.clientGroupId=o.clientGroupId}e.userId=o.userId,void 0!==o.role&&(e.role=o.role),Applozic.ALApiService.addGroupMember({data:{group:e},success:function(e){if("success"===e.status){if(o.clientGroupId){var t=mckGroupUtils.getGroupByClientGroupId(o.clientGroupId);"object"==typeof t&&(o.groupId=t.contactId)}a.status="success",a.data=e.response}else a.status="error",a.errorMessage=e.errorResponse[0].description;o.callback&&o.callback(a),o.apzCallback&&o.apzCallback(a,o)},error:function(){console.log("Unable to process your request. Please reload page."),a.status="error",a.errorMessage="",o.callback&&o.callback(a),o.apzCallback&&o.apzCallback(a)}})},i.updateGroupInfo=function(o){var e={},a=new Object;if(o.groupId)e.groupId=o.groupId;else{if(!o.clientGroupId)return void("function"==typeof o.callback&&(a.status="error",a.errorMessage="GroupId or Client GroupId Required",o.callback(a)));e.clientGroupId=o.clientGroupId}o.name&&(e.newName=o.name),o.imageUrl&&(e.imageUrl=o.imageUrl),o.users&&0<o.users.length&&(e.users=o.users),Applozic.ALApiService.groupUpdate({data:e,success:function(e,t){if("success"===e.status){if(o.clientGroupId)"object"==typeof(t=mckGroupLayout.getGroupByClientGroupId(o.clientGroupId))&&(o.groupId=t.contactId);a.status="success",a.data=e.response}else a.status="error",a.errorMessage=e.errorResponse[0].description;o.callback&&o.callback(a),o.apzCallback&&o.apzCallback(a,{groupId:o.groupId,groupInfo:t,users:o.users})},error:function(){console.log("Unable to process your request. Please reload page."),a.status="error",a.errorMessage="Unable to process your request. Please reload page.",o.callback&&o.callback(a),o.apzCallback&&o.apzCallback(a)}})},i.sendGroupMessage=function(e){if("object"==typeof e){var t=(e=$applozic.extend(!0,{},message_default_options,e)).message;if(!e.groupId&&!e.clientGroupId)return"groupId or clientGroupId required";if(void 0===t||""===t)return"message field required";if(12<e.type)return"invalid message type";t=$applozic.trim(t);var o={type:e.messageType,contentType:e.type,message:t};if(e.groupId)o.groupId=$applozic.trim(e.groupId);else if(e.clientGroupId){if(void 0===mckGroupUtils.getGroupByClientGroupId(e.clientGroupId))return"group not found";o.clientGroupId=$applozic.trim(e.clientGroupId)}return mckMessageService.sendMessage(o),"success"}return"Unsupported format. Please check format"},i.getContactFromGroupOfTwo=function(e,t){for(var o,a=0;a<e.members.length;a++)if(o=""+e.members[a],r!==o)return"function"==typeof t&&t(o),o},i.addGroupFromMessage=function(e,t,o){var a=e.groupId,s=mckGroupUtils.getGroup(""+a);void 0===s&&(s=mckGroupUtils.createGroup(a),i.loadGroups({apzCallback:i.addGroups})),"function"==typeof o&&o(s,e,t)},i.isGroupDeleted=function(e,t){if(t){var o=mckGroupUtils.getDeletedAtTime(e);return void 0!==o&&0<o}return!1},i.loadGroupsCallback=function(e){var t=e.data;MCK_GROUP_ARRAY.length=0,$applozic.each(t,function(e,t){if(void 0!==t.id){t=mckGroupUtils.addGroup(t);MCK_GROUP_ARRAY.push(t)}})},i.getGroupDisplayName=function(e){if("object"==typeof MCK_GROUP_MAP[e]){var t=MCK_GROUP_MAP[e],o=t.displayName,a=[];if(7===t.type){var s=i.getContactFromGroupOfTwo(t);void 0!==s&&(alUserService.MCK_USER_DETAIL_MAP[s]?alUserService.MCK_USER_DETAIL_MAP[s]&&alUserService.MCK_USER_DETAIL_MAP[s].displayName&&(o=alUserService.MCK_USER_DETAIL_MAP[s].displayName):(a.push(s),window.Applozic.ALApiService.getUserDetail({data:a,success:function(e){0<e.response.length&&$applozic.each(e.response,function(e,t){alUserService.MCK_USER_DETAIL_MAP[t.userId]=t,alUserService.MCK_USER_DETAIL_MAP[s]&&alUserService.MCK_USER_DETAIL_MAP[s].displayName&&(o=alUserService.MCK_USER_DETAIL_MAP[s].displayName)})}})))}if(3===t.type&&-1!==o.indexOf(r)&&(o=o.replace(r,"").replace(":",""),"function"==typeof MCK_GETUSERNAME)){var n=MCK_GETUSERNAME(o);o=n||o}return o||5!==t.type||(o="Broadcast"),o||(o=t.contactId),o}return e},i.getGroupImage=function(e){return e?'<img src="'+e+'"/>':'<img src="'+MCK_BASE_URL+'/resources/sidebox/css/app/images/mck-icon-group.png"/>'},i.getGroupDefaultIcon=function(){return'<div class="mck-group-icon-default"></div>'},i.addMemberToGroup=function(e,t){return"object"==typeof e.members&&(-1===e.members.indexOf(t)&&e.members.push(t),"object"==typeof e.removedMembersId&&-1!==e.removedMembersId.indexOf(t)&&e.removedMembersId.splice(e.removedMembersId.indexOf(t),1),MCK_GROUP_MAP[e.contactId]=e),e},i.removeMemberFromGroup=function(e,t){return"object"!=typeof e.removedMembersId||e.removedMembersId.length<1?(e.removedMembersId=[],e.removedMembersId.push(t)):-1===e.removedMembersId.indexOf(t)&&e.removedMembersId.push(t),MCK_GROUP_MAP[e.contactId]=e},i.authenticateGroupUser=function(e){var t=!1;if(!i.isGroupLeft(e)&&0<e.members.length)for(var o=0;o<e.members.length;o++)if(r===""+e.members[o])return t=!0;return t},i.isAppendOpenGroupContextMenu=function(e){return 0!==o.deleteChatAccess&&(!!mckGroupService.authenticateGroupUser(e)&&(e.adminName===r||2===o.deleteChatAccess))},i.isGroupLeft=function(e){var o=!1;return e.removedMembersId&&0<e.removedMembersId.length&&e.removedMembersId.forEach(function(e,t){e===r&&(o=!0)}),o}}var alUserService=new AlUserService;function AlUserService(){var a=this;a.MCK_USER_DETAIL_MAP=[],a.MCK_BLOCKED_TO_MAP=[];new Array;a.updateUserStatus=function(e,t){if("object"==typeof alUserService.MCK_USER_DETAIL_MAP[e.userId]){var o=alUserService.MCK_USER_DETAIL_MAP[e.userId];0===e.status?(o.connected=!1,o.lastSeenAtTime=e.lastSeenAtTime):1===e.status&&(o.connected=!0)}else{var a=new Array;a.push(e.userId),"function"==typeof t&&t(a)}},a.getUserDetail=function(e){return"object"==typeof alUserService.MCK_USER_DETAIL_MAP[e]?alUserService.MCK_USER_DETAIL_MAP[e]:void 0},a.checkUserConnectedStatus=function(e){var o=new Array,a=new Array;$applozic(".mck-user-ol-status").each(function(){var e=$applozic(this).data("mck-id");if(void 0!==e&&""!==e){o.push(e);var t=mckContactUtils.formatContactId(""+e);$applozic(this).addClass(t),$applozic(this).next().addClass(t)}}),0<o.length&&($applozic.each(o,function(e,t){void 0===alUserService.MCK_USER_DETAIL_MAP[t]&&a.push(t)}),"function"==typeof e&&e(a))},a.loadUserProfile=function(e){if(void 0!==e){"string"!=typeof e&&(e=String(e));var t=[],o=""+e.split(",")[0];t.push(o),a.loadUserProfiles(t)}},a.loadUserProfiles=function(e,t){"function"==typeof t&&t(e,[])},a.getUserStatus=function(t,o){var a=new Object;window.Applozic.ALApiService.getUserStatus({success:function(e){0<e.users.length&&([],"function"==typeof o&&o(e)),a.status="success",a.data=e,t.callback&&t.callback(a)},error:function(){a.status="error",t.callback&&t.callback(a)}})},a.blockUser=function(t,o,a){if(t&&void 0!==o){var e="userId="+t+"&block="+o;mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/block",type:"get",data:e,encryptionKey:window.Applozic.ALApiService.getEncryptionKey(),success:function(e){"object"==typeof e&&"success"===e.status&&(alUserService.MCK_BLOCKED_TO_MAP[t]=o,"function"==typeof a&&a(t))},error:function(){}})}}}var alFileService=new AlFileService;function AlFileService(){var s,o,n,r,i=this,a="/rest/ws/aws/file/",c="www.googleapis.com";i.init=function(e){o=e.fileBaseUrl,btoa(e.userId+":"+e.deviceKey),e.deviceKey},i.get=function(e){e.appId,s=e.customUploadUrl,e.fileupload,n=e.mapStaticAPIkey,e.accessToken,e.appModuleName,r=e.genereateCloudFileUrl},i.deleteFileMeta=function(e){window.Applozic.ALApiService.deleteFileMeta({data:{blobKey:e,url:o+"/rest/ws/aws/file/delete?key="+e},success:function(e){console.log(e)},error:function(){}})},i.getFilePreviewPath=function(e){return"object"==typeof e?'<a href="'+o+a+e.blobKey+'" target="_blank">'+e.name+"</a>":""},i.getFilePreviewSize=function(e){return e?1048576<e?"("+parseInt(e/1048576)+" MB)":1024<e?"("+parseInt(e/1024)+" KB)":"("+parseInt(e)+" B)":""},i.getFileurl=function(e){var t;return"object"==typeof e.fileMeta?e.fileMeta.hasOwnProperty("url")?-1!==e.fileMeta.url.indexOf(c)?(i.generateCloudUrl(e.fileMeta.blobKey,function(e){t=e}),t):""+e.fileMeta.url:e.fileMeta.thumbnailUrl==="thumbnail_"+e.fileMeta.name?s+"/files/"+e.fileMeta.name:o+a+e.fileMeta.blobKey:""},i.generateCloudUrl=function(e,t){var o=r.replace("{key}",e),a=window.Applozic.ALApiService.getAttachmentHeaders();mckUtils.ajax({type:"get",async:!1,skipEncryption:!0,headers:a,url:o,success:function(e){"function"==typeof t&&t(e)},error:function(e){console.log("error while getting token"+e)}})},i.getFilePath=function(t){if(2===t.contentType)try{var e=$applozic.parseJSON(t.message);if(e.lat&&e.lon)return'<a href="http://maps.google.com/maps?z=17&t=m&q=loc:'+e.lat+","+e.lon+'" target="_blank"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+e.lat+","+e.lon+"&maptype=roadmap&markers=color:red|"+e.lat+","+e.lon+"&key="+n+'"/></a>'}catch(e){if(-1!==t.message.indexOf(","))return'<a href="http://maps.google.com/maps?z=17&t=m&q=loc:'+t.message+'" target="_blank"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+t.message+"&maptype=roadmap&markers=color:red|"+t.message+"&key="+n+'" /></a>'}var o,a;return"object"==typeof t.fileMeta?-1===t.fileMeta.contentType.indexOf("image")?-1!==t.fileMeta.contentType.indexOf("video")?t.fileMeta.hasOwnProperty("url")&&-1!==t.fileMeta.url.indexOf(c)?(i.generateCloudUrl(t.fileMeta.blobKey,function(e){o=e}),'<a href="#" target="_self"><video controls class="mck-video-player" onplay="alFileService.updateAudVidUrl(this);" data-cloud-service="google_cloud" data-blobKey="'+t.fileMeta.blobKey+'"><source src="'+o+'" type="video/mp4"><source src="'+o+'" type="video/ogg"></video>'):'<a href= "#" target="_self"><video controls class="mck-video-player"><source src="'+i.getFileurl(t)+'" type="video/mp4"><source src="'+i.getFileurl(t)+'" type="video/ogg"></video></a>':-1!==t.fileMeta.contentType.indexOf("audio")?t.fileMeta.hasOwnProperty("url")&&-1!==t.fileMeta.url.indexOf(c)?(i.generateCloudUrl(t.fileMeta.blobKey,function(e){o=e}),'<a href="#" target="_self"><audio controls class="mck-audio-player" onplay="alFileService.updateAudVidUrl(this);" data-cloud-service="google_cloud" data-blobKey="'+t.fileMeta.blobKey+'"><source src="'+o+'" type="audio/ogg"><source src="'+o+'" type="audio/mpeg"></audio><p class="mck-file-tag"></p></a>'):'<a href="#" target="_self"><audio controls class="mck-audio-player"><source src="'+i.getFileurl(t)+'" type="audio/ogg"><source src="'+i.getFileurl(t)+'" type="audio/mpeg"></audio><p class="mck-file-tag"></p></a>':'<a href="#" role="link" class="file-preview-link" target="_self"></a>':-1!==t.fileMeta.contentType.indexOf("svg")?'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+i.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+i.getFileurl(t)+'" area-hidden="true"></img></a>':5===t.contentType?'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+t.fileMeta.blobKey+'" data-name="'+t.fileMeta.name+'"><img src="'+t.fileMeta.blobKey+'" area-hidden="true"></img></a>':t.fileMeta.hasOwnProperty("url")?-1!==t.fileMeta.url.indexOf(c)?(i.generateCloudUrl(t.fileMeta.thumbnailBlobKey,function(e){a=e}),'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="" data-blobKey="'+t.fileMeta.blobKey+'" data-name="'+t.fileMeta.name+'"><img src="'+a+'" area-hidden="true"></img></a>'):'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+i.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+t.fileMeta.thumbnailUrl+'" area-hidden="true"></img></a>':t.fileMeta.thumbnailUrl==="thumbnail_"+t.fileMeta.name?'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+i.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+s+"/files/thumbnail_"+t.fileMeta.name+'" area-hidden="true"></img></a>':'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+i.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+t.fileMeta.thumbnailUrl+'" area-hidden="true"></img></a>':""},i.updateAudVidUrl=function(e){var t=e.dataset.blobkey,o=(new Date).getTime(),a=e.currentSrc;1e3*i.fetchQueryString("Expires",a)<=o&&(i.generateCloudUrl(t,function(e){getUrl=e}),e.src=getUrl)},this.fetchQueryString=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==o&&console.log("The parameter is null for the searchedquery"),o[1]},i.getFileAttachment=function(e){if("object"==typeof e.fileMeta)return(-1!==e.fileMeta.contentType.indexOf("image")||-1!==e.fileMeta.contentType.indexOf("audio")||-1!==e.fileMeta.contentType.indexOf("video"))&&e.fileMeta.hasOwnProperty("url")&&-1!==e.fileMeta.url.indexOf(c)?'<a href="javascript:void(0);" role="link" target="_self"  class="file-preview-link" data-blobKey="'+e.fileMeta.blobKey+'" data-cloud-service="google_cloud"><span class="file-detail mck-image-download"><span class="mck-file-name"><span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+alFileService.getFilePreviewSize(e.fileMeta.size)+"</span></span></a>":'<a href="'+i.getFileurl(e)+'" role="link" target="_self"  class="file-preview-link"><span class="file-detail mck-image-download"><span class="mck-file-name"><span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+alFileService.getFilePreviewSize(e.fileMeta.size)+"</span></span></a>"},i.getFileIcon=function(e){return e.fileMetaKey&&"object"==typeof e.fileMeta?-1!==e.fileMeta.contentType.indexOf("image")?'<span class="mck-icon--camera"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3.2" fill="rgba(38,50,56,.52)"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z" fill="rgba(38,50,56,.52)"/><path d="M0 0h24v24H0z" fill="none"/></svg></span>&nbsp;<span>Image</span>':-1!==e.fileMeta.contentType.indexOf("audio")?'<span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;<span>Audio</span>':-1!==e.fileMeta.contentType.indexOf("video")?'<span class="mck-icon--video"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22"><path fill="rgba(38,50,56,.52)" d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l2.29 2.29c.63.63 1.71.18 1.71-.71V8.91c0-.89-1.08-1.34-1.71-.71L17 10.5z"/></svg></span>&nbsp;<span class="mck-icon-video-text">Video</span>':'<span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;<span>File</span>':""},i.downloadfile=function(){var e=i.getFileurl(msg),t=document.createElement("a");t.download=thefilename,t.setAttribute("href",e);var o="data:text/csv;charset=utf-8;base64,"+someb64data;t.href=o,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}!function(e){"use strict";"undefined"==typeof AlCustomService?e.Applozic.AlCustomService={logout:function(){void 0!==e.Applozic.ALSocket&&(e.Applozic.ALApiService.AUTH_TOKEN=null,e.Applozic.ALApiService.setAjaxHeaders("","","","",""),e.Applozic.ALApiService.setEncryptionKeys(null,null),e.Applozic.ALSocket.disconnect(),ALStorage.clearSessionStorageElements())}}:console.log("ALCustomService already defined.")}(window);var mckLabels=new MckLabels;function MckLabels(){this.getLabels=function(){return{"conversations.title":"Conversations","start.new":"Start New","search.contacts":"Contacts","search.groups":"Groups","empty.groups":"No groups yet!","empty.contacts":"No contacts yet!","empty.messages":"No messages yet!","no.more.messages":"No more messages!","empty.conversations":"No conversations yet!","no.more.conversations":"No more conversations!","search.placeholder":"Search...","location.placeholder":"Enter a location","create.group.title":"Create Group","members.title":"Members","add.members.title":"Add Member","remove.member":"Remove Member","change.role":"Change Role","group.info.update":"Update","group.info.updating":"Updating...","add.group.icon":"Add Group Icon","group.deleted":"Group has been deleted","change.group.icon":"Change Group Icon","group.title":"Group Title","group.type":"Group Type","group.create.submit":"Creating Group...",blocked:"You have blocked this user","group.chat.disabled":"You are no longer part of this group!","block.user.alert":"Are you sure you want to block this user?","unblock.user.alert":"Are you sure you want to unblock this user?","exit.group.alert":"Are you sure you want to exit this group?","remove.member.alert":"Are you sure you want to remove this member?","clear.messages.alert":"Are you sure you want to delete all the conversation?",typing:"typing...","is.typing":"is typing...",online:"Online","clear.messages":"Clear Messages",delete:"Delete",reply:"Reply",forward:"Forward",copy:"Copy","block.user":"Block User","unblock.user":"Unblock User","group.info.title":"Group Info","exit.group":"Exit Group","location.share.title":"Location Sharing","my.location":"My Location",send:"Send","send.message":"Send Message",smiley:"Smiley",close:"Close",edit:"Edit",save:"Save","file.attachment":"Files & Photos","file.attach.title":"Attach File","last.seen":"Last seen","last.seen.on":"Last seen on",hour:" hour",min:" min",yesterday:"yesterday",hours:" hours",mins:" mins","time.format.AM":"AM","time.format.PM":"PM","time.format.am":"am","time.format.pm":"pm","user.delete":"This user has been deleted",ago:"ago",admin:"Admin",user:"User",moderator:"Moderator",member:"Member",public:"Public",private:"Private",open:"Open",you:"You",userIdPattern:"[^!$%^&*()]+",charsNotAllowedMessage:"Following characters are not allowed: !$%^&*()","group.metadata":{CREATE_GROUP_MESSAGE:":adminName created group :groupName",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",GROUP_META_DATA_UPDATED_MESSAGE:"",ALERT:"",HIDE:""}}},this.setLabels=function(){$applozic("#mck-conversation-title").html(MCK_LABELS["conversations.title"]).attr("title",MCK_LABELS["conversations.title"]),$applozic("#mck-msg-new, #mck-sidebox-search .mck-box-title").html(MCK_LABELS["start.new"]).attr("title",MCK_LABELS["start.new"]),$applozic("#mck-contact-search-tab strong").html(MCK_LABELS["search.contacts"]).attr("title",MCK_LABELS["search.contacts"]),$applozic("#mck-group-search-tab strong").html(MCK_LABELS["search.groups"]).attr("title",MCK_LABELS["search.groups"]),$applozic("#mck-contact-search-input, #mck-group-search-input, #mck-group-member-search").attr("placeholder",MCK_LABELS["search.placeholder"]),$applozic("#mck-loc-address").attr("placeholder",MCK_LABELS["location.placeholder"]),$applozic("#mck-no-conversations").html(MCK_LABELS["empty.conversations"]),$applozic("#mck-no-messages").html(MCK_LABELS["empty.messages"]),$applozic("#mck-no-more-conversations").html(MCK_LABELS["no.more.conversations"]),$applozic("#mck-no-more-messages").html(MCK_LABELS["no.more.messages"]),$applozic("#mck-no-search-contacts").html(MCK_LABELS["empty.contacts"]),$applozic("#mck-no-search-groups").html(MCK_LABELS["empty.groups"]),$applozic("#mck-new-group, #mck-group-create-tab .mck-box-title, #mck-btn-group-create").html(MCK_LABELS["create.group.title"]).attr("title",MCK_LABELS["create.group.title"]),$applozic("#mck-gc-overlay-label").html(MCK_LABELS["add.group.icon"]),$applozic("#mck-msg-error").html(MCK_LABELS["group.deleted"]),$applozic("#mck-gc-title-label").html(MCK_LABELS["group.title"]),$applozic("#mck-gc-type-label").html(MCK_LABELS["group.type"]),$applozic("#mck-group-info-btn, #mck-group-info-tab .mck-box-title").html(MCK_LABELS["group.info.title"]).attr("title",MCK_LABELS["group.info.title"]),$applozic("#mck-gi-overlay-label").html(MCK_LABELS["change.group.icon"]),$applozic("#mck-group-member-title").html(MCK_LABELS["members.title"]).attr("title",MCK_LABELS["members.title"]),$applozic("#mck-group-add-member .blk-lg-9, #mck-gm-search-box .mck-box-title").html(MCK_LABELS["add.members.title"]).attr("title",MCK_LABELS["add.members.title"]),$applozic("#mck-btn-group-update").html(MCK_LABELS["group.info.update"]).attr("title",MCK_LABELS["group.info.update"]),$applozic("#mck-leave-group-btn, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]),$applozic("#mck-btn-leave-group, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]),$applozic("#mck-typing-label").html(MCK_LABELS.typing),$applozic("#mck-btn-clear-messages").html(MCK_LABELS["clear.messages"]).attr("title",MCK_LABELS["clear.messages"]),$applozic("#mck-block-button").html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),$applozic("#mck-loc-box .mck-box-title, #mck-share-loc-label").html(MCK_LABELS["location.share.title"]).attr("title",MCK_LABELS["location.share.title"]),$applozic("#mck-btn-loc").attr("title",MCK_LABELS["location.share.title"]),$applozic("#mck-file-up-label").html(MCK_LABELS["file.attachment"]),$applozic("#mck-file-up").attr("title",MCK_LABELS["file.attachment"]),$applozic(".mck-file-attach-label").attr("title",MCK_LABELS["file.attach.title"]),$applozic("#mck-my-loc").html(MCK_LABELS["my.location"]).attr("title",MCK_LABELS["my.location"]),$applozic("#mck-btn-close-loc-box").html(MCK_LABELS.close).attr("title",MCK_LABELS.close),$applozic("#mck-loc-submit").html(MCK_LABELS.send).attr("title",MCK_LABELS.send),$applozic("#mck-msg-sbmt").attr("title",MCK_LABELS["send.message"]),$applozic("#mck-btn-smiley").attr("title",MCK_LABELS.smiley),$applozic("#mck-group-name-save").attr("title",MCK_LABELS.save),$applozic("#mck-btn-group-icon-save").attr("title",MCK_LABELS.save),$applozic("#mck-group-name-edit").attr("title",MCK_LABELS.edit),$applozic("#mck-contact-search-input").attr("title",MCK_LABELS.charsNotAllowedMessage)}}var alMessageService=new AlMessageService;function AlMessageService(){var t,c,a,i=this;i.init=function(e){a=e.fileBaseUrl,t=e.visitor,c=t?"guest":$applozic.trim(e.userId)},i.getConversation=function(e){i.getTopicId({conversationId:e.conversationId},function(e){mckMessageLayout.populateMessage(e.messageType,e.message,e.notifyUser)})},i.addWelcomeMessage=function(e){return"object"!=typeof e?"Unsupported format. Please check format":void 0===e.sender||""===e.sender?"Sender Field Required":void 0===e.messageContent||""===e.messageContent?"Message Content Required":void mckMessageService.sendWelcomeMessage(e)},i.getUserIdFromMessage=function(e){var t=e.to;return t.lastIndexOf(",")===t.length-1&&(t=t.substring(0,t.length-1)),t.split(",")},i.isValidMetaData=function(e){return!e.metadata||"HIDDEN"!==e.metadata.category&&"ARCHIVE"!==e.metadata.category},i.getStatusIconName=function(e){return 7===e.type||6===e.type||4===e.type||0===e.type?"":5===e.status?"mck-icon-read":4===e.status?"mck-icon-delivered":3===e.type||5===e.type||1===e.type&&(0===e.source||1===e.source)?"mck-icon-sent":""},i.addMessageToTab=function(e,t,o){var a={to:e.to,groupId:e.groupId,deviceKey:e.deviceKey,contentType:e.contentType,message:e.message,conversationId:e.conversationId,topicId:e.topicId,sendToDevice:!0,createdAtTime:(new Date).getTime(),key:e.key,storeOnDevice:!0,sent:!1,read:!0,metadata:e.metadata?e.metadata:""};a.type=e.type?e.type:5,e.fileMeta&&(a.fileMeta=e.fileMeta),"function"==typeof o&&o(a,t)},i.getMessages=function(e){var t={};e.startTime&&(t.endTime=e.startTime),void 0!==e.userId&&""!==e.userId?(e.isGroup?t.groupId=e.userId:t.userId=e.userId,t.pageSize=30,(IS_MCK_TOPIC_HEADER||IS_MCK_TOPIC_BOX)&&e.conversationId&&(t.conversationId=e.conversationId,void 0===MCK_TAB_CONVERSATION_MAP[e.userId]&&(t.conversationReq=!0))):t.mainPageSize=100,window.Applozic.ALApiService.getMessages({data:t,success:e.callback,error:e.callback})},i.getMessageList=function(s,n){var e=s.id,t={},r={};s.startTime&&(t.endTime=s.startTime),void 0!==s.clientGroupId&&""!==s.clientGroupId?(s.pageSize?t.pageSize=s.pageSize:t.pageSize=50,t.clientGroupId=s.clientGroupId,r={clientGroupId:s.clientGroupId}):void 0!==e&&""!==e?(s.pageSize?t.pageSize=s.pageSize:t.pageSize=50,""+s.isGroup=="true"?t.groupId=e:t.userId=e,r={id:e}):(s.mainPageSize?t.mainPageSize=s.pageSize:t.mainPageSize=50,r={id:""}),s.topicId&&(e||s.clientGroupId)&&(s.conversationId&&(t.conversationId=s.conversationId),s.topicId&&(r.topicId=s.topicId)),window.Applozic.ALApiService.getMessages({data:t,success:function(e){var t=e.data;if(r.status="success",void 0===t.message||0===t.message.length)r.messages=[];else{var o=t.message,a=new Array;$applozic.each(o,function(e,t){"function"==typeof n&&n(t)}),r.messages=a}0<t.groupFeeds.length&&(r.id=t.groupFeeds[0].id),s.callback(t)},error:function(e){r.status="error",s.callback(r)}})},i.getReplyMessageByKey=function(e){return void 0===ALStorage.getMessageByKey(e)&&window.Applozic.ALApiService.updateReplyMessage({data:{key:e},async:!1,success:function(e){ALStorage.updateMckMessageArray(e)}}),ALStorage.getMessageByKey(e)},i.sendDeliveryUpdate=function(e){window.Applozic.ALApiService.sendDeliveryUpdate({data:{key:e.pairedMessageKey},success:function(){},error:function(){}})},i.sendReadUpdate=function(e){void 0!==e&&""!==e&&window.Applozic.ALApiService.sendReadUpdate({data:{key:e},success:function(){},error:function(){}})},i.fetchConversationByTopicId=function(e,a){window.Applozic.ALApiService.fetchConversationByTopicId({data:e,success:function(e){if("object"==typeof e&&"success"===e.status){var t=e.response;if(0<t.length&&$applozic.each(t,function(e,t){if(MCK_CONVERSATION_MAP[t.id]=t,MCK_TOPIC_CONVERSATION_MAP[t.topicId]=[t.id],t.topicDetail)try{MCK_TOPIC_DETAIL_MAP[t.topicId]=$applozic.parseJSON(t.topicDetail)}catch(e){w.console.log("Incorect Topic Detail!")}if(params.tabId&&void 0!==MCK_TAB_CONVERSATION_MAP[params.tabId]){var o=MCK_TAB_CONVERSATION_MAP[params.tabId];o.push(t),MCK_TAB_CONVERSATION_MAP[params.tabId]=o}}),params.isExtMessageList)if(0<t.length)params.conversationId=t[0].id,params.pageSize=50,"function"==typeof a&&a(params);else if("function"==typeof params.callback){var o={};params.tabId?(o.id=params.tabId,o.isGroup=params.isGroup):params.clientGroupId&&(o.clientGroupId=params.clientGroupId),o.topicId=params.topicId,o.status="success",o.messages=[],params.callback(o)}}else if(params.isExtMessageList&&"function"==typeof params.callback){o={};params.tabId?o.id=params.tabId:params.clientGroupId&&(o.clientGroupId=params.clientGroupId),o.topicId=params.topicId,o.status="error",o.errorMessage="Unable to process request. Please try again.",params.callback(o)}},error:function(){if("function"==typeof params.callback){var e={};params.tabId?e.id=params.tabId:params.clientGroupId&&(e.clientGroupId=params.clientGroupId),e.topicId=params.topicId,e.status="error",e.errorMessage="Unable to process request. Please try again.",params.callback(e)}}})},i.getTopicId=function(s,n){if(s.conversationId){var r="id="+s.conversationId;window.Applozic.ALApiService.getTopicId({data:{conversationId:s.conversationId},success:function(e){if("object"==typeof r&&"success"===r.status){var t=r.response;if("object"==typeof t){if(MCK_TOPIC_CONVERSATION_MAP[t.topicId]=[s.conversationId],(MCK_CONVERSATION_MAP[s.conversationId]=t).topicDetail)try{MCK_TOPIC_DETAIL_MAP[t.topicId]=$applozic.parseJSON(t.topicDetail)}catch(e){w.console.log("Incorect Topic Detail!")}if("function"==typeof MCK_PRICE_DETAIL&&s.priceText&&(MCK_PRICE_DETAIL({custId:c,suppId:s.suppId,productId:t.topicId,price:s.priceText}),i.sendConversationCloseUpdate(s.conversationId)),s.messageType&&"object"==typeof s.message){var o=s.message.groupId?s.message.groupId:s.message.to;if(void 0!==MCK_TAB_CONVERSATION_MAP[o]){var a=MCK_TAB_CONVERSATION_MAP[o];a.push(t),MCK_TAB_CONVERSATION_MAP[o]=a}(void 0===s.populate||s.populate)&&"function"==typeof n&&n(s)}"function"==typeof s.callback&&s.callback(t)}}},error:function(){}})}},i.sendConversationCloseUpdate=function(e){if(e){window.Applozic.ALApiService.sendConversationCloseUpdate({conversationId:e,success:function(e){},error:function(){}})}},i.dispatchMessage=function(e){if("object"===e.messagePxy){var t=e.messagePxy;if(e.topicId){var o=MCK_TOPIC_DETAIL_MAP[e.topicId];if("object"==typeof o&&"undefined"!==o.title)if(t.message||(t.message=$applozic.trim(o.title)),e.conversationId)t.conversationId=e.conversationId;else if(e.topicId){var a={topicId:e.topicId};"object"==typeof o&&(a.topicDetail=w.JSON.stringify(o)),t.conversationPxy=a}if(!t.message&&o.link){var s={blobKey:$applozic.trim(o.link),contentType:"image/png"};t.fileMeta=s,t.contentType=5,FILE_META=[],FILE_META.push(s)}}e.isGroup?t.groupId=e.tabId:t.to=e.tabId,mckMessageService.sendMessage(t)}},i.sendVideoCallMessage=function(e,t,o,a,s,n){var r="CALL_MISSED"==t?"Missed Call":"CALL_REJECTED"==t?"Call Rejected":"";""!=r&&null!=r||(r="video message");var i={to:s,type:5,contentType:o,message:r,metadata:{MSG_TYPE:t,CALL_ID:e,CALL_AUDIO_ONLY:a},senderName:c};return n(i),i},i.sendVideoCallEndMessage=function(e,t,o,a,s,n,r){var i="";s&&(i=mckDateUtils.convertMilisIntoTime(s));var c="CALL_MISSED"==t?"Missed Call":"CALL_REJECTED"==t?"Call Rejected":"CALL_END"==t?"Call End \n Duration: "+i:"video message";""!=c&&null!=c||(c="video message");var l={to:n,type:5,contentType:o,message:c,metadata:{MSG_TYPE:t,CALL_ID:e,CALL_AUDIO_ONLY:a,CALL_DURATION:s}};return r(l),l},i.getMessageFeed=function(e){var t={};if(a=window.Applozic.ALApiService.getFileUrl(),t.key=e.key,t.contentType=e.contentType,t.timeStamp=e.createdAtTime,t.message=e.message,t.from=4===e.type?e.to:c,e.groupId?t.to=e.groupId:t.to=5===e.type?e.to:c,t.status="read",t.type=4===e.type?"inbox":"outbox",5===e.type&&(3===e.status?t.status="sent":4===e.status&&(t.status="delivered")),"object"==typeof e.fileMeta){var o=Object.assign({},e.fileMeta);void 0!==o.url&&""!==o.url||(o.url=a+"/rest/ws/aws/file/"+e.fileMeta.blobKey),delete o.blobKey,t.file=o}return t.source=e.source,t.metadata=e.metadata,t}}